# VPSãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆæ¨™æº–æ‰‹é †ï¼‰

## ğŸš¨ é‡è¦ï¼šå¿…ãšã“ã®æ‰‹é †ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„

ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¸æ•´åˆã‚’é˜²ããŸã‚ã€**å¿…ãšã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰**ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ï¼ˆVPSä¸Šã§å®Ÿè¡Œï¼‰

### æ–¹æ³•1: ä¸€æ‹¬å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰

VPSã«SSHã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€ä»¥ä¸‹ã‚’ä¸€è¡Œã§å®Ÿè¡Œï¼š

```bash
cd ~/n3-frontend_new && git fetch origin claude/inventory-scraping-sync-011CUMaeWipViad45zaNRUXz && git pull origin claude/inventory-scraping-sync-011CUMaeWipViad45zaNRUXz && rm -rf .next && npm install && npm run build && pm2 restart n3-frontend && pm2 logs n3-frontend --lines 20
```

### æ–¹æ³•2: ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«å®Ÿè¡Œ

```bash
# 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/n3-frontend_new

# 2. æœ€æ–°ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
git fetch origin claude/inventory-scraping-sync-011CUMaeWipViad45zaNRUXz
git pull origin claude/inventory-scraping-sync-011CUMaeWipViad45zaNRUXz

# 3. ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ï¼ˆé‡è¦ï¼ï¼‰
rm -rf .next

# 4. ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°ï¼ˆpackage.jsonãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆï¼‰
npm install

# 5. ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰
npm run build

# 6. PM2ã‚’å†èµ·å‹•
pm2 restart n3-frontend

# 7. ãƒ­ã‚°ã‚’ç¢ºèª
pm2 logs n3-frontend --lines 20
```

---

## ãªãœãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼Ÿ

### å•é¡Œã®åŸå› 

Next.jsã¯é«˜é€ŸåŒ–ã®ãŸã‚ã«`.next/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿å­˜ã—ã¾ã™ã€‚

**æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’pullã—ãŸã ã‘ã§ã¯ï¼š**
- æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒå–å¾—ã•ã‚Œã‚‹
- ã—ã‹ã—**å¤ã„ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã‚‹**
- æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ + å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ = **ä¸æ•´åˆã‚¨ãƒ©ãƒ¼**

**å…¸å‹çš„ãªã‚¨ãƒ©ãƒ¼ï¼š**
```
Cannot access 'l' before initialization
```

### è§£æ±ºæ–¹æ³•

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«**å¿…ãš**ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```bash
rm -rf .next
```

ã“ã‚Œã§å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå‰Šé™¤ã•ã‚Œã€ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Cannot access 'l' before initialization"

**åŸå› **: ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¸æ•´åˆ

**è§£æ±º**:
```bash
cd ~/n3-frontend_new
rm -rf .next
rm -rf node_modules
npm install
npm run build
pm2 restart n3-frontend
```

### ã‚¨ãƒ©ãƒ¼: "Module not found"

**åŸå› **: æ–°ã—ã„ä¾å­˜é–¢ä¿‚ãŒè¿½åŠ ã•ã‚ŒãŸãŒã€node_modulesãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„

**è§£æ±º**:
```bash
cd ~/n3-frontend_new
npm install
npm run build
pm2 restart n3-frontend
```

### PuppeteerãŒå‹•ã‹ãªã„

**åŸå› **: Chromiumã®ä¾å­˜é–¢ä¿‚ãŒä¸è¶³

**è§£æ±º**:
```bash
sudo apt-get update
sudo apt-get install -y chromium-browser
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### 1. PM2ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
```bash
pm2 status
```

**æ­£å¸¸ãªçŠ¶æ…‹:**
- `n3-frontend` ãŒ `online`
- `cpu` ãŒå®‰å®šã—ã¦ã„ã‚‹ï¼ˆ100%ã§ãªã„ï¼‰

### 2. ãƒ­ã‚°ç¢ºèª
```bash
pm2 logs n3-frontend --lines 30
```

**æ­£å¸¸ãªãƒ­ã‚°:**
```
âœ… SupabaseåˆæœŸåŒ–: https://...
âœ“ Ready in XXXms
```

**ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°:**
```
[Scraping] ã‚¨ãƒ©ãƒ¼: ...
```

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œç¢ºèª

- https://n3.emverze.com/tools/data-collection ã«ã‚¢ã‚¯ã‚»ã‚¹
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„ã‹ç¢ºèª

---

## æ³¨æ„äº‹é …

### âš ï¸ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨

1. **ãƒ“ãƒ«ãƒ‰ã›ãšã«PM2ã‚’å†èµ·å‹•**
   ```bash
   # âŒ NG
   git pull && pm2 restart n3-frontend

   # âœ… OK
   git pull && rm -rf .next && npm run build && pm2 restart n3-frontend
   ```

2. **æœ¬ç•ªç’°å¢ƒã§ç›´æ¥ã‚³ãƒ¼ãƒ‰ç·¨é›†**
   - å¿…ãšãƒ­ãƒ¼ã‚«ãƒ«ã§ç·¨é›† â†’ git push â†’ VPSã§pull

3. **.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤**
   - ç’°å¢ƒå¤‰æ•°ãŒå¤±ã‚ã‚Œã¾ã™

### âœ… æ¨å¥¨äº‹é …

1. **ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª**
   ```bash
   npm run build
   ```

2. **ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã¯å¿…ãšãƒ­ã‚°ç¢ºèª**
   ```bash
   pm2 logs n3-frontend --lines 30
   ```

3. **ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ã™ãã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**
   ```bash
   git checkout [å‰ã®ã‚³ãƒŸãƒƒãƒˆ]
   rm -rf .next
   npm run build
   pm2 restart n3-frontend
   ```

---

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

| æ“ä½œ | ã‚³ãƒãƒ³ãƒ‰ |
|------|----------|
| VPSã«ãƒ­ã‚°ã‚¤ãƒ³ | `ssh ubuntu@tk2-236-27682.vs.sakura.ne.jp` |
| æœ€æ–°ã‚³ãƒ¼ãƒ‰å–å¾— | `cd ~/n3-frontend_new && git pull origin [branch]` |
| ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰ | `rm -rf .next && npm run build` |
| PM2å†èµ·å‹• | `pm2 restart n3-frontend` |
| ãƒ­ã‚°ç¢ºèª | `pm2 logs n3-frontend --lines 30` |
| PM2ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `pm2 status` |
| ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤ | `rm -rf .next` |
| ä¾å­˜é–¢ä¿‚å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | `rm -rf node_modules && npm install` |

---

## æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ç¢ºèªï¼š

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ `npm run build` ãŒæˆåŠŸã—ã¦ã„ã‚‹
- [ ] git push ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] VPSã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹
- [ ] æ­£ã—ã„ãƒ–ãƒ©ãƒ³ãƒã«ã„ã‚‹ (`git branch` ã§ç¢ºèª)

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ç¢ºèªï¼š

- [ ] `pm2 status` ã§ `online` ã«ãªã£ã¦ã„ã‚‹
- [ ] `pm2 logs` ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- [ ] ä¸»è¦æ©Ÿèƒ½ï¼ˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰ãŒå‹•ä½œã™ã‚‹

---

## æ›´æ–°å±¥æ­´

- 2025-01-XX: åˆç‰ˆä½œæˆ - ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰æ‰‹é †ã‚’æ¨™æº–åŒ–
