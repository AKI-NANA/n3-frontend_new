/**
 * NAGANO-3 サイドバー第二階層緊急修正CSS
 * transform: none !important の競合を完全回避
 */

/* 🚨 緊急：transform制約からの第二階層メニュー除外 */
.unified-submenu,
.unified-submenu *,
.unified-submenu-link,
.status-badge {
    /* transformリセットを無効化 */
    transform: unset !important;
    animation: unset !important;
    
    /* 独自のスタッキングコンテキストを作成 */
    position: fixed !important;
    z-index: 2147483647 !important; /* 32bit整数の最大値 */
}

/* 🔥 第二階層メニュー完全独立スタイル */
.unified-submenu {
    /* ポジション（最優先） */
    position: fixed !important;
    left: var(--sidebar-expanded) !important;
    z-index: 2147483647 !important;
    
    /* 外観 */
    background: #34495e !important;
    width: 280px !important;
    min-width: 280px !important;
    border: 2px solid #00ff00 !important;
    border-radius: 0 12px 12px 0 !important;
    box-shadow: 4px 0 25px rgba(0,0,0,0.5) !important;
    
    /* サイズ制限 */
    max-height: 400px !important;
    min-height: 50px !important;
    overflow-y: auto !important;
    overflow-x: visible !important;
    
    /* 内部構造 */
    padding: 8px 0 !important;
    margin: 0 !important;
    box-sizing: border-box !important;
    
    /* 🚨 競合CSS回避：独自トランジション */
    transition: opacity 0.3s ease, visibility 0.3s ease, left 0.3s ease !important;
    
    /* 表示制御（初期非表示） */
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
    
    /* 🔥 完全に独立したスタック作成 */
    will-change: transform !important;
    contain: layout style paint !important;
    isolation: isolate !important;
}

/* 表示状態 */
.unified-submenu.show {
    opacity: 1 !important;
    visibility: visible !important;
    pointer-events: auto !important;
    z-index: 2147483647 !important;
}

/* 🔥 各メニューの個別位置設定（競合回避版） */
#submenu-products { 
    top: calc(80px + 54px * 1 + 1px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-inventory { 
    top: calc(80px + 54px * 2 + 2px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-orders { 
    top: calc(80px + 54px * 3 + 3px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-ai { 
    top: calc(80px + 54px * 4 + 4px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-accounting { 
    top: calc(80px + 54px * 5 + 5px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-system { 
    top: calc(80px + 54px * 6 + 6px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}
#submenu-others { 
    top: calc(80px + 54px * 7 + 7px) !important; 
    z-index: 2147483647 !important;
    position: fixed !important;
}

/* サイドバー狭い状態での調整 */
body.sidebar-collapsed .unified-submenu {
    left: var(--sidebar-collapsed) !important;
    width: 250px !important;
    z-index: 2147483647 !important;
}

body.sidebar-hidden .unified-submenu {
    display: none !important;
}

/* 🔥 第二階層リンク（競合完全回避版） */
.unified-submenu-link {
    /* 基本レイアウト（独立スタック） */
    display: flex !important;
    position: relative !important;
    width: 100% !important;
    z-index: 2147483647 !important;
    
    /* 競合回避：独自のトランジション */
    transition: background-color 0.2s ease, padding-left 0.2s ease !important;
    transform: none !important;
    animation: none !important;
    
    /* サイズ */
    min-height: 44px !important;
    padding: 12px 16px !important;
    margin: 0 !important;
    
    /* 外観 */
    color: rgba(255, 255, 255, 0.85) !important;
    text-decoration: none !important;
    font-size: 13px !important;
    font-weight: 500 !important;
    line-height: 1.3 !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    
    /* レイアウト */
    align-items: center !important;
    justify-content: space-between !important;
    box-sizing: border-box !important;
    
    /* スタッキング独立性 */
    isolation: isolate !important;
}

.unified-submenu-link:last-child {
    border-bottom: none !important;
    border-radius: 0 0 12px 0 !important;
}

.unified-submenu-link:hover {
    background: rgba(52, 152, 219, 0.25) !important;
    color: rgba(255, 255, 255, 1) !important;
    padding-left: 20px !important;
    z-index: 2147483647 !important;
}

/* アイコン */
.unified-submenu-link i,
.unified-submenu-link-content i {
    flex-shrink: 0 !important;
    width: 16px !important;
    margin-right: 8px !important;
    font-size: 12px !important;
    text-align: center !important;
    opacity: 0.7 !important;
    color: currentColor !important;
    z-index: inherit !important;
    position: static !important;
}

.unified-submenu-link:hover i {
    opacity: 1 !important;
    color: #3498db !important;
}

/* テキスト */
.unified-submenu-link span:first-of-type {
    flex: 1 !important;
    display: block !important;
    font-size: 13px !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    overflow: visible !important;
    opacity: 1 !important;
    visibility: visible !important;
    position: static !important;
}

/* ステータスバッジ（独立スタック） */
.status-badge {
    flex-shrink: 0 !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    z-index: 2147483647 !important;
    position: static !important;
    
    /* サイズ */
    height: 18px !important;
    min-width: 24px !important;
    padding: 2px 6px !important;
    
    /* スタイル */
    border-radius: 9px !important;
    font-size: 9px !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    line-height: 1 !important;
    white-space: nowrap !important;
    margin-left: 8px !important;
    
    /* 競合回避 */
    transform: none !important;
    animation: none !important;
    transition: none !important;
}

/* バッジカラー */
.status-ready { background: #10b981 !important; color: white !important; }
.status-new { background: #3b82f6 !important; color: white !important; }
.status-pending { background: #f59e0b !important; color: white !important; }

/* 🚨 メインコンテンツのスタッキング強制下位化 */
.main-content, .content, main, #mainContent,
.card, .product-card, .inventory__card,
.modal-content, .n3-modal__container {
    z-index: 1 !important;
    position: relative !important;
    isolation: auto !important;
}

/* 🚨 他の高z-index要素の下位化 */
.modal, .n3-modal {
    z-index: 1000 !important;
}

.modal-backdrop {
    z-index: 999 !important;
}

/* ヘッダーとサイドバーは維持 */
.unified-sidebar, .sidebar {
    z-index: 2000 !important;
}

header, .header, .navbar {
    z-index: 2000 !important;
}

/* 🔥 デバッグ用（問題解決確認） */
body::before {
    content: "第二階層メニュー競合回避CSS適用済み - z-index: 2147483647";
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0, 255, 0, 0.8);
    color: white;
    padding: 4px 8px;
    font-size: 10px;
    border-radius: 4px;
    z-index: 2147483647;
    pointer-events: none;
}