# ============================================
# 🚀 修正後の動作確認ガイド
# ============================================

## ステップ1: サーバー起動

```bash
cd /Users/aritahiroaki/n3-frontend_new
npm run dev
```

サーバーが起動したら → http://localhost:3000/tools/editing

---

## ステップ2: データ確認

### 2-1. HTMLテンプレートの確認
ブラウザで以下にアクセス:
http://localhost:3000/api/debug/html-templates

**期待される結果:**
```json
{
  "success": true,
  "data": {
    "templates": {
      "count": 1以上,
      "items": [...],
      "error": null
    },
    "defaultTemplate": {
      "exists": true,  ← これが true であること！
      "data": {...},
      "error": null
    }
  }
}
```

**もし `defaultTemplate.exists` が `false` の場合:**
1. http://localhost:3000/tools/html-editor を開く
2. 新しいテンプレートを作成
3. 「★ モーダルのデフォルト表示に設定」にチェック
4. 保存

### 2-2. 商品データの確認
Editingページでデータが表示されることを確認:
http://localhost:3000/tools/editing

**期待される結果:**
- 商品一覧が表示される
- 選択可能である

---

## ステップ3: ボタン動作テスト

### テスト1: カテゴリ分析
1. 商品を1件選択
2. 「カテゴリ」ボタンをクリック
3. **成功:** 「カテゴリ分析完了」のトースト表示
4. **失敗:** コンソールエラーを確認 → TROUBLESHOOTING.mdを参照

### テスト2: 送料計算
1. 商品を1件選択
2. 「送料」ボタンをクリック
3. **成功:** 「送料計算完了」のトースト表示
4. **確認:** 商品の `listing_data` に送料情報が追加される

### テスト3: 利益計算
1. 商品を1件選択（重量と仕入れ価格がある商品）
2. 「利益計算」ボタンをクリック
3. **成功:** 「利益計算完了」のトースト表示
4. **確認:** 利益率・利益額が表示される

### テスト4: SM分析
1. 商品を1件選択（英語タイトルがある商品）
2. 「SM分析」ボタンをクリック
3. **成功:** 「SellerMirror分析完了」のトースト表示
4. **確認:** 出品用データが取得される

### テスト5: HTML生成
1. 商品を1件選択
2. 「HTML」ボタンをクリック
3. **成功:** 「HTML生成完了」のトースト表示

### テスト6: モーダルのHTMLタブ
1. 商品をダブルクリック
2. 「HTML」タブをクリック
3. **成功:** HTMLプレビューが表示される
4. **確認:** エラーメッセージが表示されない

### テスト7: 一括実行
1. 商品を2-3件選択
2. 「一括実行」ボタンをクリック
3. **成功:** 全ての処理が順番に実行される
4. **確認:** 各ステップのトースト表示

---

## ステップ4: トラブルシューティング

### エラーが出た場合
1. ブラウザのコンソールを開く (F12)
2. エラーメッセージをコピー
3. `/docs/TROUBLESHOOTING.md` を参照

### よくあるエラー

#### エラー: "Cannot coerce the result to a single JSON object"
→ デフォルトテンプレートが存在しない
→ ステップ2-1を実行

#### エラー: "商品が見つかりませんでした"
→ products_master にデータがない
→ トリガーを確認

#### エラー: "Type mismatch"
→ UUID/INTEGER型の不一致
→ 修正は完了しているはず、それでも出る場合は報告

---

## ✅ 全テスト完了チェックリスト

- [ ] サーバー起動成功
- [ ] HTMLテンプレート確認（defaultTemplate.exists = true）
- [ ] 商品一覧表示OK
- [ ] カテゴリボタン動作OK
- [ ] 送料ボタン動作OK
- [ ] 利益計算ボタン動作OK
- [ ] SM分析ボタン動作OK
- [ ] HTMLボタン動作OK
- [ ] モーダルのHTMLタブ動作OK
- [ ] 一括実行ボタン動作OK

---

## 🎉 全てOKなら完了！

全てのボタンが正常に動作すれば、修正完了です。
お疲れ様でした！

---

## 📝 次のステップ（オプション）

1. **一括リサーチ機能の確認**
   - `/api/bulk-research` の実装確認
   
2. **CSVアップロード機能の確認**
   - CSVアップロードボタンの動作確認

3. **AI強化機能の確認**
   - AI商品データ強化の動作確認

4. **フィルターチェック機能の確認**
   - `/api/filter-check` の動作確認

これらの機能も必要に応じて同様の修正を行います。
