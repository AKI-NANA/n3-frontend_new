# スコアシステム評価依頼（Gemini相談用）

## 相談内容

越境EC（日本→eBay）の商品出品優先順位を決定する「唯一無二のスコアリングシステム (Ui)」を設計しました。
このスコア計算ロジックの妥当性、改善点、より効果的なアプローチについてアドバイスをお願いします。

---

## システム概要

### 目的
数千件の商品から、**最も出品すべき商品を自動的に優先順位付け**するスコアシステム

### 前提条件
- 商品データ：Yahoo!オークションなどから仕入れた商品
- 販売先：eBay（国際マーケットプレイス）
- SellerMirrorによる競合分析データあり（競合数、利益率、最安値など）
- 新品・中古の混在
- 廃盤品・希少品の検知が重要

---

## 現在のスコア計算式

### 最終スコア (Ui)

```
Ui = (ΣWk × Sk) × M_Profit × M_Penalty + R

Wk: 重み（カテゴリごと、合計100点）
Sk: 基本点（項目ごと）
M_Profit: 利益乗数（1.0〜3.0）
M_Penalty: ペナルティ乗数（0.5〜1.0）
R: 微細な乱数（0.001未満、重複防止用）
```

### 重み設定 (Wk) - 合計100点

| カテゴリ | デフォルト重み | 説明 |
|---------|--------------|------|
| 利益スコア (P) | 40点 | 純利益額が大きいほど高スコア |
| 競合スコア (C) | 30点 | 競合が少ないほど高スコア |
| トレンドスコア (T) | 10点 | 分析が新しいほど高スコア |
| 希少性スコア (S) | 10点 | 廃盤・限定品にボーナス |
| 実績スコア (R) | 10点 | SellerMirror利益率が高いほど高スコア |

---

## 詳細な計算ロジック

### 1. 利益スコア (P)

#### P1: 純利益スコア
```
P1 = (純利益額 / 1000) × 100点

純利益額 = 販売価格(JPY) - 仕入価格(JPY)
```

**設定可能パラメータ：**
- `score_profit_per_1000_jpy`: 1000円あたりの加点（デフォルト: 100点）

**例：**
- 純利益 3,000円 → P1 = 300点
- 純利益 5,000円 → P1 = 500点

---

### 2. 競合スコア (C)

#### C1: 飽和度ペナルティ
```
新品: C1 = 競合数 × (-50点) × 0.3
中古: C1 = 競合数 × (-50点)
```

**理由：**
- 新品は競合が多くても差別化しやすい（ペナルティ30%）
- 中古は競合の影響が大きい（ペナルティ100%）

**設定可能パラメータ：**
- `score_competitor_penalty`: 競合1件あたりの減点（デフォルト: -50点）

**例：**
- 新品、競合10件 → C1 = 10 × (-50) × 0.3 = -150点
- 中古、競合10件 → C1 = 10 × (-50) = -500点

#### C5: 最安値競争力ボーナス（新品のみ）
```
条件:
1. 新品である
2. 自社価格 ≤ SellerMirror最安値 × 1.05
3. 自社価格 > SellerMirror最安値 × 0.5

達成時: C5 = +500点
```

**理由：**
最安値付近で出品すると売れやすいが、極端な安値は避ける

---

### 3. トレンドスコア (T)

#### T1: 鮮度スコア
```
分析からの経過日数:
- 7日以内: T1 = +50点（100%）
- 8〜30日: T1 = +25点（50%）
- 31日以上: T1 = 0点
```

**設定可能パラメータ：**
- `score_trend_boost`: トレンドブーストの基準点（デフォルト: 50点）

**理由：**
市場状況は変化するため、新しい分析データを優先

---

### 4. 希少性スコア (S)

#### S1: 廃盤品ボーナス
```
タイトルに以下のキーワードが含まれる場合:
"廃盤", "生産終了", "限定", "discontinued", "rare", "limited"

S1 = +100点
```

**設定可能パラメータ：**
- `score_discontinued_bonus`: 廃盤品ボーナス（デフォルト: 100点）

#### S4: コレクターアイテムボーナス
```
タイトルに以下のキーワードが含まれる場合:
"コレクター", "レア", "希少", "collector", "vintage"

S4 = +50点
```

**理由：**
廃盤品・希少品は競合が少なく、高値で売れる可能性が高い

---

### 5. 実績スコア (R)

#### R1: SellerMirror実績スコア
```
SellerMirror利益率:
- 20%以上: R1 = +10点（100%）
- 10〜20%: R1 = +5点（50%）
- 10%未満: R1 = 0点
```

**設定可能パラメータ：**
- `score_success_rate_bonus`: 成功率ボーナス（デフォルト: 10点）

**理由：**
他のセラーが高利益率を達成している商品は、自社も成功しやすい

---

## 乗数システム

### M_Profit: 利益乗数（高利益を大幅優遇）

```
M_Profit = 基本倍率 + floor(純利益額 / 基準額) × 増加率

最小: 1.0倍
最大: 3.0倍
```

**デフォルト設定：**
- `profit_multiplier_base`: 1.0（基本倍率）
- `profit_multiplier_threshold`: 1,000円（基準額）
- `profit_multiplier_increment`: 0.1（増加率）

**例：**
- 純利益 500円 → M_Profit = 1.0倍
- 純利益 3,000円 → M_Profit = 1.0 + floor(3000/1000) × 0.1 = 1.3倍
- 純利益 10,000円 → M_Profit = 1.0 + floor(10000/1000) × 0.1 = 2.0倍
- 純利益 30,000円 → M_Profit = 3.0倍（上限）

**理由：**
高利益商品を圧倒的に優先することで、効率的なビジネス運営を実現

---

### M_Penalty: ペナルティ乗数（リスク商品を抑制）

```
条件1: 純利益 < 500円 → ×0.5
条件2: 競合 > 50件 → ×0.8

両方該当: ×0.4（0.5 × 0.8）
```

**デフォルト設定：**
- `penalty_low_profit_threshold`: 500円
- `penalty_multiplier`: 0.5

**理由：**
- 低利益商品は作業コストに見合わない
- 高競合商品は売れにくい

---

### R: 乱数（重複防止）

```
R = Math.random() × 0.001

範囲: 0.000000 〜 0.000999
```

**理由：**
同じスコアの商品が大量にある場合、ランダム性を微量追加して順序を決定
（0.001未満なので実質的な影響はほぼゼロ）

---

## 計算例

### 例1: 高利益・低競合の新品

**商品データ：**
- 販売価格: 10,000円
- 仕入価格: 5,000円
- 純利益: 5,000円
- 競合: 5件
- 新品
- SellerMirror最安値: 9,500円
- 分析: 3日前
- タイトル: 「限定品 Nintendo Switch」

**計算：**

1. **利益スコア (P)**
   - P1 = (5000 / 1000) × 100 = 500点

2. **競合スコア (C)**
   - C1 = 5 × (-50) × 0.3 = -75点
   - C5 = +500点（最安値条件クリア）
   - 合計: 425点

3. **トレンドスコア (T)**
   - T1 = +50点（7日以内）

4. **希少性スコア (S)**
   - S1 = +100点（「限定」キーワード）

5. **実績スコア (R)**
   - R1 = 0点（データなし）

**重み付け合計：**
```
ΣWk × Sk = 40×500 + 30×425 + 10×50 + 10×100 + 10×0
         = 20,000 + 12,750 + 500 + 1,000 + 0
         = 34,250点
```

**乗数適用：**
```
M_Profit = 1.0 + floor(5000/1000) × 0.1 = 1.5倍
M_Penalty = 1.0倍（ペナルティなし）
```

**最終スコア：**
```
Ui = 34,250 × 1.5 × 1.0 + 0.0005 = 51,375点
```

---

### 例2: 低利益・高競合の中古

**商品データ：**
- 販売価格: 1,500円
- 仕入価格: 1,200円
- 純利益: 300円
- 競合: 60件
- 中古
- 分析: 45日前

**計算：**

1. **利益スコア (P)**
   - P1 = (300 / 1000) × 100 = 30点

2. **競合スコア (C)**
   - C1 = 60 × (-50) = -3,000点

3. **トレンドスコア (T)**
   - T1 = 0点（31日以上）

**重み付け合計：**
```
ΣWk × Sk = 40×30 + 30×(-3000) + 0 + 0 + 0
         = 1,200 - 90,000
         = -88,800点
```

**乗数適用：**
```
M_Profit = 1.0倍（利益が小さい）
M_Penalty = 0.5 × 0.8 = 0.4倍（低利益 & 高競合）
```

**最終スコア：**
```
Ui = -88,800 × 1.0 × 0.4 + 0.0003 = -35,520点
```

**結果：** マイナススコア → 出品すべきでない商品

---

## 質問・懸念点

### 1. スコアの範囲について
- 現状：上限なし（数万点〜マイナスまで可能）
- **質問：満点を100点にすべきか？それとも無制限でよいか？**
  - メリット（100点満点）: 直感的、パーセンテージ表現可能
  - メリット（無制限）: 利益額の差が明確、調整の自由度が高い

### 2. 重み配分の妥当性
- 利益40%、競合30%の配分は適切か？
- ビジネスフェーズによって変更すべきか？
  - 初期：競合を重視（勝てる市場を選ぶ）
  - 成長期：利益を重視（売上最大化）

### 3. 乗数の妥当性
- 利益乗数が最大3倍は適切か？
- ペナルティが×0.4まで下がるのは厳しすぎないか？

### 4. 項目の過不足
- 追加すべき要素はあるか？
  - 在庫回転率
  - 季節性
  - 送料負担の大きさ
  - 返品リスク
- 不要な要素はあるか？

### 5. 実運用での調整方法
- ユーザー（非技術者）が調整しやすい設計か？
- 各パラメータの調整指針は明確か？

---

## 期待するアドバイス

1. **スコアリングロジックの妥当性評価**
   - 計算式は合理的か？
   - 見落としている重要な要素はないか？

2. **スケールの最適化**
   - 100点満点にすべきか？
   - 各項目の点数配分は適切か？

3. **重み配分の改善提案**
   - より効果的な配分はあるか？
   - 動的に変更すべき要素は？

4. **乗数システムの妥当性**
   - 利益乗数・ペナルティ乗数の設計は適切か？
   - 別のアプローチはあるか？

5. **ユーザビリティ改善**
   - 非技術者が理解・調整しやすくするには？
   - どのような説明・UI が必要か？

6. **代替アプローチの提案**
   - 機械学習を使うべきか？
   - よりシンプルな方法はあるか？

---

## 補足情報

### システムの制約
- 技術スタック：Next.js + Supabase
- スコアは手動調整可能（設定UI あり）
- リアルタイム更新は不要（バッチ処理でOK）

### ビジネス制約
- 商品数：数千〜数万点
- 月間出品数：数百点
- 利益率目標：20%以上
- 回転率重視（在庫は持ちたくない）

### 現在の運用フロー
1. 商品データ取り込み（Yahoo!オークション等）
2. SellerMirrorで競合分析
3. スコア計算（自動）
4. スコア上位から出品作業
5. 月次で重み調整

---

以上のスコアシステムについて、改善提案をお願いします。
