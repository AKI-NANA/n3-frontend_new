💻 Claudeへの最終統合指示書
1. 🎯 依頼の目的とスコープ
あなたは、これまでGeminiが開発してきた全ての個別機能（DBマイグレーション、AIリサーチ機能拡張、HTS判定ロジック）を統合し、「完全版開発指示書」に記載されたAmazon自動取得、HTS判定、AIリサーチの最適化システムを完成させます。

2. 📂 全てのコードの統合と適用（最優先）
以下のフェーズに従い、コードの新規作成、既存ファイルの修正、およびDBマイグレーションの適用を厳密に行ってください。

I. データベースマイグレーションの適用
以下の4つのSQLファイルを作成し、データベースに順序通り適用してください。これにより、Amazonスコア、原産国、HTS判定ソース、バリエーション可否を格納する土台が整います。

database/migrations/001_add_ebay_variation_support.sql

database/migrations/002_create_amazon_products_queue.sql

database/migrations/003_create_amazon_config.sql

database/migrations/004_add_amazon_data_fields.sql

II. フェーズ 2 & 3: ロジック層の実装（サービスとAPI）
HTS判定サービス (/services/htsService.ts): DB内の過去データ優先 → Claude KDL連携の階層的なHTS判定ロジックを完成させます。

Amazonサービス (/services/amazonService.ts): **calculateAcquisitionScoreとprocessTopScoredItem**を実装し、スコアリング、キュー処理、products_masterへのデータ同期の中核ロジックを完成させます。

Amazon設定API (/app/api/amazon/config/route.ts): amazon_configテーブルとの連携を確立します。

Cron API (/app/api/cron/run-amazon-queue/route.ts): Amazon自動取得を定期実行するためのトリガーAPIを実装します。

III. フェーズ 4: UIとAIロジックの統合
型定義 (/types/product.ts): ResearchPromptTypeとEbayCategory型を指示書通りに更新します。

プロンプト生成 (/lib/gemini-api.ts): 全てのResearchPromptType（IMAGE_ONLY, HTS_MANUAL_MCPなど）に対応できるよう、プロンプト生成ロジックを強化・修正します。

IV. フェーズ 5: UI連携の完成
データタブUI (/components/ProductModal/components/Tabs/TabData.tsx):

「市場調査」ボタンを、すべてのResearchPromptTypeに対応するドロップダウンメニューに置換します。

HTS自動判定ボタン（/services/htsService.tsに連動）とHTS手動プロンプト生成ボタン（プロンプトをクリップボードにコピー）を実装します。

データ編集UI (/app/tools/editing/page.tsx): リスト表示に、amazon_score（編集優先度）に基づくソート機能と、取得元や価格帯によるフィルター機能を追加します。

新規UIページ (/app/tools/amazon-config/page.tsx): Amazon自動取得の閾値（BSR、最小評価など）を設定・管理できるUIページを実装します。

3. 🔗 最終確認
全てのインポートパスが正しく解決され、モックになっていた**外部API連携（特にeBay API、Claude KDLツール）**が、プロジェクトの既存のクライアントライブラリを使用して実装されていることを確認し、システム全体を動作検証してください。