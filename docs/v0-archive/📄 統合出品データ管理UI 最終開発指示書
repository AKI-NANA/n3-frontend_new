📄 統合出品データ管理UI 最終開発指示書I. 🎯 目標多販路の出品状況を単一のUIで正確に把握し、**在庫・価格ロジック（第1層/第4層）と出品データ（第3層）**の操作を論理的に分離した「販売戦略の中枢」を確立する。II. 💾 バックエンド APIとデータ連携（Claude/MCP 担当）Geminiが定義した/types/listing.tsのデータ構造に基づいて、すべてのフロントエンドコンポーネントにデータを提供する実働するバックエンドAPIを実装します。1. データ取得・集約 API (最重要)APIエンドポイント: /api/listing/integrated/route.ts実装内容:DB結合: 在庫マスター（第1層）、価格ロジック（第4層のログ）、および**各モール出品データ（第3層）**の情報を結合し、ListingItem型に整形してレスポンスとして返す。計算ロジック: total_stock_countは、自社有在庫と無在庫仕入れ先（優先度順）の合計数を計算して格納する。ステータス集約: mall_statuses内の情報を集約し、パフォーマンススコア（performance_score）を計算して格納する。2. アクションAPI機能エンドポイント役割データ編集/api/listing/edit/route.tsフロントエンドから受け取った第3層データ（タイトル、バリエーションなど）のみを更新する。在庫や価格ロジックのDBは触らない。モード切替/api/listing/mode-switch/route.tsListingMode（中古/新品優先）の変更を受け取り、**価格調整ロジック（第4層）**に対し、新しいモードでの価格再計算をトリガーする。ログ取得/api/listing/logs/[sku]/route.tsIV. 履歴データ表示のため、価格調整ログ、在庫変動ログなどの時系列データを取得する。III. 🖥️ フロントエンド UI実装と動的制御（Claude/MCP 担当）Geminiが作成した /components/listing/IntegratedListingTable.tsx および /components/listing/ListingEditModal.tsx を完成させます。1. 統合管理テーブルの完成UI結合: /api/listing/integrated/route.tsからデータを取得し、テーブルに表示。IV. 履歴データパネル: テーブルのSKU列をクリックした際に、サイドパネルまたはモーダル（例: /components/listing/ListingDetailPanel.tsx）を起動し、/api/listing/logs/[sku]/route.tsから取得した価格変動履歴や在庫変動ログを表示する。III. 動的フィルタリング:テーブル上部のフィルタリングエリアでモールが選択された際、選択されたモールでのみ取得可能な項目（例：eBayの出品カテゴリー、バリエーション数）をフィルターオプションに動的に追加表示するロジックを実装する。2. 出品データ編集モーダルの完成VERO対策連携: Item Specifics内の「ブランド名」フィールドに対し、在庫マスターのVERO対策ロジックから自動で「正式名」を補完・挿入する機能を実装する。バリエーションUI: バリエーション管理セクションに、画像（最大24枚）のアップロードと紐づけ、および子SKUの追加・削除ができるUIを実装し、/api/listing/edit/route.tsに連携させる。3. 在庫数の明確化（UIの詳細）総在庫数（固定表示）: テーブルにはtotal_stock_countを単一の数字で表示する。仕入れ先別詳細: 詳細パネル内で、stock_detailsを表示し、価格変動が現在どの仕入れ先の原価に基づいているかを色やタグで明示するUIを実装する。IV. ✅ 最終連携と品質保証他ツールへのリンク: 「棚卸しUIへの遷移」「受注履歴詳細への遷移」など、V. 他ツールとの連携で指定された動的なリンクを実装する。型安全性: 全てのコンポーネントとAPIで/types/listing.tsが正しく使用され、型安全性が確保されていることを確認する。