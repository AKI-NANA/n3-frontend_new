# 📝 Claude Code 開発環境構築・実行指示書（改訂版）

## 目的
Claude Code（CLI）のWeb統合およびGitHub連携機能を活用し、開発を加速するための環境設定とタスク実行を行う。

---

## ステップ1: 環境のセットアップと確認（初回のみ）

### 1-1. ステータス確認
現在のClaude Codeのログイン状態、使用しているプラン（Max推奨）、および利用可能なトークン枠（5時間ごと）の状況を報告してください。

**実行コマンド:** `/status`

### 1-2. Webアクセス機能の有効化
Claudeが最新のWeb検索ツールやWeb統合機能を利用できる状態にあるかを確認し、有効化してください。

**指示:** 「Web検索と外部Webアクセスツールが有効になっているか確認し、有効化してください。」

### 1-3. GitHub連携のインストール（自動セットアップ）
GitHubとの連携に必要なAppのインストールと、認証トークンの設定を対話形式で開始してください。

**実行コマンド:** `/install-github-app`

*注意: このプロセスで指示される手順（ブラウザでの許可、シークレットの設定など）は、私（ユーザー）が実行します。完了したら報告します。*

### 1-4. 最終環境報告
セットアップ完了後、`@github` などのGitHub連携ツールが利用可能になったことを確認し、その旨を報告してください。

---

## ステップ2: 開発タスクの指示（Web検索とGitHub連携の活用）

環境設定が完了したことを確認したら、以下のフォーマットに従って具体的な開発タスクを依頼してください。

---

### 開発タスク指示書：[タスク名]

#### タスクの目的
今回実装したい機能の目的を具体的に記述してください。

**例:** ユーザーが自分のプロフィール画像をアップロードできる機能の追加

---

#### ステップ1: Web調査と計画（外部情報の活用）

タスクに関連する以下の外部情報を調査し、実装計画を立案してください。

1. **Web検索:** 「[具体的な調査キーワード。例：Supabase Storage で画像をセキュアにアップロードする方法]」を検索し、最適な実装パターンを見つけてください。

2. **計画立案:** 調査結果に基づき、以下の項目を含む詳細な実装計画を立ててください。
   - 関わるファイル一覧と、それぞれのファイルで加える具体的な変更点（関数名、クラス名など）
   - 必要なGitHub Actionsの変更（もしあれば）
   - Supabaseとの連携に必要な具体的な操作（テーブル変更、RLSポリシーの追加など）

---

#### ステップ2: GitHub Actionsを活用したコード実装

立案した計画に基づき、以下の手順でコードを実装し、GitHubにプッシュしてください。

1. **ブランチの作成:** 変更用の新しいGitブランチを作成してください。
   **実行コマンド:** `/git checkout -b feature/new-image-upload`

2. **コードの変更:** 計画に沿って、関連する全てのファイルを一括で変更してください。
   **指示:** 「ステップ1で作成した計画に基づき、ファイルを修正・追加してください。」

3. **動作確認:** ローカルで動作確認を行ってください。
   ```bash
   npm run dev
   ```

4. **差分確認（重要）:** 変更内容を確認してください。
   - Git & デプロイ管理ページで「差分確認」ボタンをクリック
   - GitHubに未取得の変更がないか確認

5. **Git Pull（必要に応じて）:** 差分があれば、GitHubの変更を取り込んでください。
   - 「Git Pull」ボタンをクリック

6. **コミットメッセージ作成:** 以下の規約に従ってコミットメッセージを作成してください。

   **コミットメッセージ規約:**
   ```
   <type>: <subject>
   
   タイプ一覧:
   - feat: 新機能追加
   - fix: バグ修正
   - docs: ドキュメント変更
   - style: コードスタイル変更
   - refactor: リファクタリング
   - test: テスト追加
   - chore: ビルド・設定変更
   
   例:
   feat: ユーザー画像アップロード機能の追加
   fix: ログインエラーを修正
   docs: READMEを更新
   ```

7. **コミットとPR作成:** 変更をコミットし、GitHubにプッシュしてください。
   - Git & デプロイ管理ページで：
     1. コミットメッセージを入力
     2. 「Git Push 実行」ボタンをクリック
   - 自動的に以下が実行されます：
     - `git pull origin main` （最新取得）
     - `git add .` （ステージング）
     - `git commit -m "メッセージ"` （コミット）
     - `git push origin main` （プッシュ）

---

#### ステップ3: VPSデプロイ

PR作成後、本番環境にデプロイしてください。

1. **VPSデプロイ実行:**
   - 「VPSデプロイ実行」ボタンをクリック
   - VPSで以下が自動実行されます：
     - `git pull origin main`
     - `npm install`
     - `npm run build`
     - `pm2 restart n3-frontend`

2. **本番確認:**
   - https://n3.emverze.com を開いて動作確認

---

#### ステップ4: セルフレビュー（自己修正）

デプロイ完了後、Claude Code自身に以下のレビューを行わせてください。

1. **コードレビュー:** 
   - セキュリティ（特にSupabaseのRLS）
   - 可読性
   - ベストプラクティスに従っているか
   
2. **問題があれば修正提案:**
   - 直接修正を提案してください

---

#### 最終指示

全てのステップを完了したら、その結果（デプロイURL、問題点の有無）を報告し、追加の改善点があれば提案してください。

---

## 🚨 トラブルシューティング

### コンフリクトが発生した場合

**表示例:**
```
❌ Git pullに失敗しました

CONFLICT (content): Merge conflict in app/research/ebay-research/page.tsx
```

**対処法:**
1. コンフリクトファイルを開く
2. `<<<<<<<`, `=======`, `>>>>>>>` のマーカーを見つける
3. どちらの変更を残すか決定
4. マーカーを削除
5. 以下を実行:
   ```bash
   git add <ファイル名>
   git commit -m "fix: コンフリクト解決"
   git push origin main
   ```

---

## 📚 参考資料

### 詳細マニュアル
- **Git & デプロイ完全マニュアル:** `docs/GIT_DEPLOY_MANUAL.md`
- **コミットメッセージ規約:** 上記マニュアル参照
- **コンフリクト解決方法:** 上記マニュアル参照

### 環境情報
- **本番URL:** https://n3.emverze.com
- **VPSサーバー:** tk2-236-27682.vs.sakura.ne.jp
- **GitHubリポジトリ:** https://github.com/AKI-NANA/n3-frontend_new

---

作成日: 2025年10月21日
最終更新: 2025年10月21日（Git & デプロイ手順を詳細化）
