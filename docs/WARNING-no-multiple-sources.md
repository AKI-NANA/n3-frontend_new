# ⚠️ VPS + Vercel 両方使用の危険性

## 🚨 結論：両方使うのは絶対ダメ！

既にVPSを契約しているなら、**VPSのみ**を使用してください。

---

## ❌ なぜダメなのか？

### あなたの考え（間違い）
```
VPS使用    → 12時間ごとにチェック
Vercel使用 → 12時間ごとにチェック

冗長化できて安全！👍
```

### 実際の結果（危険）
```
Yahoo側の視点：
同じ商品に6時間ごとアクセスが来る

0:00  - VPS からアクセス
6:00  - Vercel からアクセス（6時間後）
12:00 - VPS からアクセス（6時間後）
18:00 - Vercel からアクセス（6時間後）

→ ロボット認定！
→ IPブロック！
→ アカウント停止のリスク！
```

---

## ✅ 正しい使い方

### VPS契約済みなら

**VPSのLinux Cronのみ使用**

```bash
# 12時間ごと（推奨）
0 0,12 * * * ~/monitoring.sh

# または1日1回
0 9 * * * ~/monitoring.sh
```

### これから始めるなら

**Vercelのみ使用**

```json
{
  "crons": [{
    "path": "/api/cron/inventory-monitoring",
    "schedule": "0 */12 * * *"
  }]
}
```

---

## 📊 比較表

| 使用方法 | アクセス間隔 | ロボット検知リスク | 推奨度 |
|---------|------------|-----------------|--------|
| VPSのみ（12h） | 12時間 | 低い | ✅ |
| Vercelのみ（12h） | 12時間 | 低い | ✅ |
| VPS + Vercel | 6時間 | **非常に高い** | ❌ |
| VPSのみ（2h） | 2時間 | 高い | ❌ |

---

## 💡 冗長化したい場合

### 正しい方法

**週次交代制**
```cron
# メインVPS: 月・水・金
0 9 * * 1,3,5 ~/monitoring.sh

# バックアップVPS: 火・木・土
0 9 * * 2,4,6 ~/monitoring.sh
```

これなら：
- ✅ 1日1回のアクセス頻度を維持
- ✅ 片方が止まっても検知可能

---

## 🎯 ベストプラクティス

### VPS契約済みの場合

1. **VPSのみで実装**
2. **12時間ごと or 1日1回**
3. **リトライ機能実装**
4. **失敗時の通知設定**

### 設定例

```bash
#!/bin/bash
MAX_RETRIES=3

for i in $(seq 1 $MAX_RETRIES); do
  curl -X POST https://your-domain.com/api/inventory-monitoring/execute
  if [ $? -eq 0 ]; then
    exit 0
  fi
  sleep 300  # 5分待機
done

# 失敗通知
curl -X POST $DISCORD_WEBHOOK \
  -d '{"content": "Monitoring failed!"}'
```

---

## ⚠️ 重要な注意事項

1. **複数の実行元を使わない**
2. **監視頻度は12時間以上空ける**
3. **デフォルト設定と実際の実行頻度を一致させる**
4. **ログで実行状況を確認**

---

## 🆘 よくある質問

### Q: なぜ両方使うとダメなの？

A: スクレイピング元（Yahoo等）は**IPやアクセス元を見ていない**。
   **同じ商品へのアクセス間隔**だけを見ています。
   VPSとVercel両方から来ても、Yahooには「短時間に複数回アクセス」と見えます。

### Q: IPが違えば大丈夫では？

A: いいえ。
   - Yahooは商品ごとのアクセス頻度を監視
   - IPが違っても同じ商品に頻繁アクセス = ロボット
   - Cookie、User-Agent、アクセスパターン等も見ている

### Q: じゃあ冗長化できないの？

A: できます。
   - 週次交代制を使う
   - メインが失敗した時だけサブを動かす
   - 監視スクリプトにリトライ機能を付ける

---

## 📝 まとめ

```
✅ やること
- VPSのみ使用（既に契約済みなら）
- 12時間ごと or 1日1回
- リトライ機能を実装
- ログ監視を設定

❌ やらないこと
- VPS + Vercel 同時使用
- 6時間以下の頻繁な監視
- 複数の実行元の併用
```

**既にVPS契約済み → VPSのみ使用！**
**これから始める → Vercelのみ使用！**

シンプルが一番安全です！
