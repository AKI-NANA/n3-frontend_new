# 🚀 運用開始手順書

最終更新: 2025-11-03 17:45

## ✅ 事前準備（5分）

### 1. データベースマイグレーション実行

Supabaseダッシュボードで以下を実行:

```sql
-- pricing_strategyカラム追加
ALTER TABLE products_master 
ADD COLUMN IF NOT EXISTS pricing_strategy JSONB;

-- インデックス作成
CREATE INDEX IF NOT EXISTS idx_products_pricing_strategy 
ON products_master((pricing_strategy IS NOT NULL));
```

**確認方法**:
```sql
-- カラムが追加されたか確認
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'products_master' 
AND column_name = 'pricing_strategy';
```

### 2. 環境変数確認

`.env.local` ファイルを確認:

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://zdzfpucdyxdlavkgrvil.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...

# eBay API
EBAY_APP_ID=...
EBAY_CERT_ID=...
EBAY_DEV_ID=...
EBAY_USER_TOKEN=...

# その他
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

---

## 📋 初期設定（10分）

### ステップ1: デフォルト価格戦略の設定

1. **在庫監視ページを開く**
   ```
   http://localhost:3000/inventory-monitoring
   ```

2. **デフォルト設定タブをクリック**

3. **推奨設定を入力**:
   - **対象マーケット**: eBay
   - **価格戦略タイプ**: 最安値追従（最低利益確保）
   - **最低利益額**: $10
   - **価格調整率**: -5%
   - **在庫切れ対応**: 在庫を0に設定
   - **監視頻度**: 1日1回

4. **「設定を保存」をクリック**

### ステップ2: 自動化機能の有効化

**デフォルト設定タブの下部**:

✅ チェックを入れる項目:
- [ ] 複数仕入れ元管理
- [ ] 仕入れ元自動入れ替え
- [ ] 季節・時期変動
- [ ] SOLD数ベース値上げ
- [ ] ウォッチャー連動値上げ

**保存をクリック**

### ステップ3: スケジュール設定

1. **スケジュール設定タブをクリック**

2. **デフォルトスケジュールを確認**:
   - 在庫・価格監視: 毎日0時
   - 価格最適化: 6時間ごと

3. **必要に応じて調整**

---

## 🎯 監視対象商品の登録（5分/商品）

### 方法1: 編集ツールで設定

1. **編集ツールを開く**
   ```
   http://localhost:3000/tools/editing
   ```

2. **商品を選択**

3. **商品モーダルを開く**

4. **監視設定を入力**:
   - 在庫監視を有効化: ✅
   - 仕入れ元URL: Yahoo!オークションURLなど
   - eBay Listing ID: 既存の出品ID

5. **保存**

### 方法2: データベースで一括設定

```sql
-- 既存商品を監視対象に一括変更
UPDATE products_master
SET 
  inventory_monitoring_enabled = true,
  store_url = '仕入れ元URL'
WHERE 
  ebay_listing_id IS NOT NULL
  AND store_url IS NOT NULL;
```

---

## ✅ 動作確認（10分）

### 1. 手動監視実行

1. **在庫監視ページを開く**

2. **「今すぐ監視実行」ボタンをクリック**

3. **実行履歴タブで結果を確認**:
   - 処理した商品数
   - 検知した変動数
   - エラー数

### 2. 変動の確認

1. **統合変動管理タブをクリック**

2. **検知された変動を確認**:
   - 在庫変動
   - 価格変動
   - ページエラー

3. **テスト適用**:
   - 1つの変動を選択
   - 「eBayに適用」をクリック
   - 成功を確認

### 3. 価格ルール実行

1. **価格自動更新タブをクリック**

2. **「一括実行」をクリック**

3. **各ルールの実行結果を確認**

---

## 📊 日常運用（5分/日）

### 毎朝のルーチン

1. **統合変動管理を確認** (2分)
   ```
   http://localhost:3000/inventory-monitoring
   ```
   - 保留中の変動を確認
   - 必要なものを選択してeBayに適用

2. **実行履歴を確認** (1分)
   - エラーの有無
   - 処理数の確認

3. **価格最適化の確認** (2分)
   - 価格自動更新タブ
   - 必要に応じて手動で追加実行

### 週次のルーチン

1. **パフォーマンス分析** (10分)
   - SOLD数の増加確認
   - ウォッチャー数の推移
   - 利益率の確認

2. **戦略の調整** (10分)
   - 低パフォーマンス商品の特定
   - 個別価格戦略の見直し
   - フィルター設定の更新

---

## 🔧 トラブルシューティング

### 問題: 変動が検知されない

**確認項目**:
- [ ] `inventory_monitoring_enabled = true`になっているか
- [ ] `store_url`が設定されているか
- [ ] 仕入れ元URLが有効か

**解決方法**:
```sql
-- 監視状態の確認
SELECT 
  sku, 
  title, 
  inventory_monitoring_enabled,
  store_url
FROM products_master
WHERE id = '問題の商品ID';

-- 手動で有効化
UPDATE products_master
SET inventory_monitoring_enabled = true
WHERE id = '商品ID';
```

### 問題: eBayに適用できない

**確認項目**:
- [ ] eBay Listing IDが正しいか
- [ ] OAuth認証が有効か
- [ ] APIキーが正しいか

**解決方法**:
1. `.env.local`のeBay設定を確認
2. eBay Listing IDを確認
3. 手動でAPI実行テスト

### 問題: 価格が更新されない

**確認項目**:
- [ ] 該当ルールが有効になっているか
- [ ] 最低利益額が高すぎないか
- [ ] 競合データがあるか

**解決方法**:
1. デフォルト設定タブでルールを確認
2. 最低利益額を下げてテスト
3. 実行履歴でエラーログを確認

---

## 📈 パフォーマンス指標

### 監視すべき指標

| 指標 | 目標値 | 確認場所 |
|-----|--------|---------|
| 在庫監視カバー率 | 95%以上 | 実行履歴 |
| 変動検知率 | 5-10% | 統合変動管理 |
| eBay適用成功率 | 98%以上 | 実行履歴 |
| エラー率 | 2%以下 | 実行履歴 |
| 平均レスポンス時間 | 5秒以内 | ログ |

### 改善サイクル

```
1. データ収集（1週間）
   ↓
2. 分析（パフォーマンス指標確認）
   ↓
3. 改善策実施（設定調整）
   ↓
4. 効果測定（1週間）
   ↓
5. 最適化
```

---

## 🎊 運用開始完了チェックリスト

**事前準備**
- [ ] データベースマイグレーション実行完了
- [ ] 環境変数設定完了
- [ ] eBay OAuth設定完了

**初期設定**
- [ ] デフォルト価格戦略設定完了
- [ ] 自動化機能有効化完了
- [ ] スケジュール設定完了

**商品登録**
- [ ] 監視対象商品登録完了（最低10商品）
- [ ] 仕入れ元URL設定完了
- [ ] eBay Listing ID設定完了

**動作確認**
- [ ] 手動監視実行成功
- [ ] 変動検知成功
- [ ] eBay適用成功
- [ ] 価格ルール実行成功

**運用体制**
- [ ] 日次チェックルーチン確立
- [ ] 週次分析ルーチン確立
- [ ] エラー対応フロー確立

---

## 🚀 運用開始！

すべてのチェックが完了したら、システムは完全に自動運用されます。

**おめでとうございます！** 🎉

毎日のルーチンチェック（5分）を続けることで、在庫と価格は自動最適化されます。
