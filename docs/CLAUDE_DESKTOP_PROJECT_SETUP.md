# 🚀 Claude Desktop 専用プロジェクト - セットアップ手順書

## 📋 概要

この手順書では、Claude Desktopに「n3-frontend 市場調査」専用プロジェクトを作成し、自動データ更新を有効化する方法を説明します。

---

## ✅ 前提条件

1. Claude Desktop がインストール済み
2. Supabase MCPサーバーが設定済み
3. `claude_desktop_config.json` が正しく設定されている

---

## 🔧 ステップ1: 新しいプロジェクトを作成

### 1-1. Claude Desktop を開く

### 1-2. 新しいプロジェクトを作成

1. 左サイドバーの **「Projects」** をクリック
2. **「New Project」** をクリック
3. プロジェクト名: **「n3-frontend 市場調査」**
4. **「Create」** をクリック

---

## 📚 ステップ2: プロジェクトナレッジを追加

### 2-1. ナレッジファイルを追加

1. プロジェクト設定を開く
2. **「Knowledge」** タブをクリック
3. **「Add Files」** をクリック
4. 以下のファイルを追加:
   - `/Users/aritahiroaki/n3-frontend_new/docs/CLAUDE_PROJECT_KNOWLEDGE.md`

### 2-2. ナレッジの内容確認

以下の情報が含まれていることを確認：

- ✅ Supabaseデータベース構造
- ✅ 処理手順（ステップ1-3）
- ✅ 自動実行指示
- ✅ 出力フォーマット
- ✅ 重要な注意事項

---

## 🔐 ステップ3: Supabase接続確認

### 3-1. MCPツールが有効か確認

Claude Desktopで以下を実行:

```
Supabaseに接続できますか？productsテーブルを確認してください。
```

**期待される応答:**
```
✅ Supabase接続成功
productsテーブルが見つかりました。
```

### 3-2. エラーが出た場合

`claude_desktop_config.json` を確認:

```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server",
        "postgres://postgres:[PASSWORD]@[HOST]:5432/postgres"
      ]
    }
  }
}
```

---

## 🎯 ステップ4: 動作テスト

### 4-1. テストプロンプトを実行

以下のCSVデータでテスト:

```
SKU,商品ID,商品名(日本語),英語タイトル,仕入価格(円),定価(円),発売日,カテゴリ名,カテゴリID,長さ(cm),幅(cm),高さ(cm),重さ(g),状態,画像URL,ブランド
TEST-001,test-uuid-1,"テスト商品","Test Product",1000,1000,不明,"Toys & Hobbies",,,,,,"新品","",""

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
上記の商品データを処理してください。
処理完了後、Supabaseに自動保存してください。
```

### 4-2. 期待される出力

```
✅ 【ステップ1】基本商品情報の取得
✅ 英語タイトル生成完了
✅ HTSコード判定完了
✅ 原産国判定完了

✅ 【ステップ2】市場調査データ取得
✅ プレミア率算出完了
✅ コミュニティスコア算出完了

✅ Supabase更新完了: 1件
```

---

## 📱 ステップ5: n3-frontendから使用

### 5-1. ブラウザで編集画面を開く

```
http://localhost:3000/tools/editing
```

### 5-2. 商品を選択

1-3件の商品を選択

### 5-3. 「🔍 市場調査」ボタンをクリック

### 5-4. プロンプトをコピー

「コピー」ボタンをクリック

### 5-5. Claude Desktop（プロジェクト内）に貼り付け

**重要**: 必ず「n3-frontend 市場調査」プロジェクト内で実行

### 5-6. 結果を確認

```
✅ Supabase更新完了: 3件
```

### 5-7. モーダルで「処理完了」をクリック

データが自動的に再読み込みされる

---

## 🎨 UI改善内容

### Before（削除されたもの）
- ❌ 「Claude Web を開く」ボタン
- ❌ Claude Web への言及

### After（新しいUI）
- ✅ 「次へ」ボタン（ステップ2 → ステップ3）
- ✅ Claude Desktop専用の説明
- ✅ 6ステップの明確な手順

---

## 🔍 トラブルシューティング

### Q1: 「Supabase接続エラー」と表示される

**A**: `claude_desktop_config.json` の設定を確認
1. ファイルの場所を確認
2. 接続文字列が正しいか確認
3. Claude Desktopを再起動

### Q2: データが更新されない

**A**: 以下を確認
1. プロンプトの最後まで貼り付けられているか
2. 「自動実行指示」が含まれているか
3. Claude Desktopのログを確認

### Q3: 「✅ Supabase更新完了」が表示されない

**A**: 
1. MCPツール `supabase` が有効か確認
2. プロジェクトナレッジが正しく読み込まれているか確認
3. 手動で更新を依頼:
   ```
   上記の結果をSupabaseに保存してください
   ```

---

## 📊 期待される処理時間

| 商品数 | 処理時間 |
|--------|----------|
| 1-5件 | 2-5分 |
| 6-20件 | 5-10分 |
| 21-50件 | 10-20分 |
| 51-100件 | 20-40分 |

---

## ✅ セットアップ完了チェックリスト

- [ ] Claude Desktopに「n3-frontend 市場調査」プロジェクト作成済み
- [ ] プロジェクトナレッジ追加済み
- [ ] Supabase接続確認済み
- [ ] テストプロンプトで動作確認済み
- [ ] n3-frontendからの実行確認済み
- [ ] データが正しくSupabaseに保存されることを確認済み

---

**セットアップ完了日**: ___________  
**確認者**: ___________
