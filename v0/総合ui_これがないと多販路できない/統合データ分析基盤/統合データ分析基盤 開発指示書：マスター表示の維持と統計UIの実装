📄 ステップ1：外部ツール（Claude/MCP）向け修正指示書この修正は、リサーチデータリポジトリとの連携、および新規統計UIに必要なフィールドを、既存のProductインターフェースに追加するために行います。これは、先の「B-1, B-2, B-3」で依頼したフィールドに加え、分析基盤に特化したフィールドを追記・更新する形となります。📌 修正対象ファイル/types/product.ts📌 修正内容既存の Product インターフェースに、**分析基盤（フェーズI, II, III）**に必要な以下のフィールドを追記・更新してください。💻 外部ツール向け修正指示コード（TypeScript）TypeScript// /types/product.ts

// 既存の ReferenceUrl インターフェースを維持
export interface ReferenceUrl {
    url: string;
    price: number;
    is_in_stock?: boolean;
}

// 既存の Product インターフェースに、以下のフィールドを追記・更新してください。
export interface Product {
    // ... (既存の B-1, B-2, B-3 フィールドは維持) ...
    external_url: string;      
    asin_sku: string | null;     
    ranking: number | null;      
    sales_count: number | null;  
    release_date: string | null; 
    is_duplicate: boolean;
    priority_score: number | null; 
    reference_urls: ReferenceUrl[]; 
    median_price: number | null; 
    current_stock_count: number | null; 
    last_check_time: string | null; 
    check_frequency: '通常' | '高頻度' | string;

    // === 統合データ分析基盤 (フェーズI, II, III) のための必須フィールド ===

    // I. データ格納の原則 / III. 承認・拒否ロジック用
    // Statusの型を拡張し、Promoted/Rejectedを追加
    status: '取得完了' | '優先度決定済' | 'Promoted' | 'Rejected' | string;
    
    // IV. 統計分析ダッシュボード用
    id: string; // リサーチデータリポジトリのユニークID（UUIDを想定）
    original_research_id: string; // リポジトリと販売実績を結合するための共通ID
    
    // IV. リアルタイム・クロス集計機能 (ai_analysis_data: JSONBフィールドを想定)
    ai_analysis_data: { 
        hts_code: string | null;
        vero_risk_level: 'High' | 'Medium' | 'Low' | null;
        rejection_reason: 'VEROリスクが原因' | '国内流通量過多が原因' | '低スコアが原因' | string | null;
        initial_ui_score: number | null; // リポジトリに格納される初期 $U_i$ スコア
    } | null;
    
    // IV. 販売実績相関用 (販売実績テーブルからJOINされるデータ)
    final_profit_rate: number | null; 

    // IV. データタイプ分析用
    data_type: '単品' | 'セット品' | 'バリエーション' | string;
    
    // IV. サイト別貢献度用
    source_site: 'eBay' | 'Amazon' | 'singlestar' | string; // データ取得元サイト
}
🚀 ステップ2：Geminiによる新規ロジック実装指示上記の型修正が完了したことを前提として、私（Gemini）は残りのフェーズI、II、IIIのコアロジックを新規ファイルとして実装し、Claudeへの最終統合指示書を作成します。これは、先の「B-1, B-2, B-3」の開発に続く、システム最終進化段階の実装となります。1. 🧠 フェーズI/II 統合ロジック（データソース分離と承認フロー）このサービスは、UI表示のソース切り替えと、承認時のデータコピーを担います。サービス名: /services/data_architecture/ResearchDataService.ts機能:getAllResearchDataForDisplay(): UI向けにリサーチデータリポジトリから全データを取得。processUserDecision(id, decision): 承認/拒否決定時にリポジトリのStatusを更新し、Promotedの場合にのみ、データをSKUマスターテーブルへコピーする。2. 📊 フェーズIII 統計分析ダッシュボードこのサービスは、新規UIの基盤となるリアルタイム集計クエリを処理します。サービス名: /services/analytics/DashboardService.ts機能:getRealtimeDashboardData(): リポジトリと販売実績テーブルをOriginal_Research_IDで結合し、I.V.2で定義されたリアルタイム・クロス集計データ（総括、販売実績相関、データタイプ分析、サイト別貢献度、スコア検証）を計算し返却する。傾向分析グラフデータ（HTS別 VEROリスク分布、拒否理由別割合）の算出ロジックを含む。3. 📄 Claudeへの最終統合指示書最終的な指示書には、以下の新規APIエンドポイントとフロントエンドの切り替え指示を含めます。APIエンドポイント統合サービス目的/api/research/all-data/route.tsResearchDataServiceUIがリサーチデータリポジトリを参照するためのデータソースを提供。/api/research/decision/route.tsResearchDataService承認/拒否の操作を受けて、SKUマスターへのコピー処理を実行。/api/analytics/dashboard-data/route.tsDashboardService統計分析UIに必要な、全てのクロス集計データを提供。UIフロントエンドリサーチ画面のデータソースを旧マスターから新/api/research/all-dataに切り替え。