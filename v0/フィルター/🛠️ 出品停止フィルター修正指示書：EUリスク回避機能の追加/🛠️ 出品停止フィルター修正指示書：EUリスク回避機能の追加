🛠️ EUリスク回避フィルター 実装骨子I. データベース（DB）とAI解析の修正1. 商品マスターDBの修正 (Claude/MCP 担当)既存のProductインターフェース（またはDBスキーマ）に以下のフィールドを追加・活用します。DB項目データ型目的eu_risk_flag (新規)BOOLEANEUリスクあり（TRUE）/なし（FALSE）の最終判定フラグ。ce_marking_risk_category (既存)ENUM (HIGH, LOW, NONE)AIが判定した商品のリスクカテゴリ（おもちゃ、電子機器など）。eu_ar_status (既存)ENUM (REQUIRED_NO_AR, AR_SECURED, NOT_REQUIRED)AR情報が確保できているか否か。eu_risk_reason (新規)STRINGフィルターがTRUEになった具体的な理由（例：高リスクカテゴリ AND ノーブランド中国製品）を格納。2. AI解析機能の強化（リスク特徴の特定）(Gemini/AIモジュール 担当)AI解析モジュール（例: /services/ai_pipeline/EUComplianceChecker.ts）に、以下のリスクスコアリングロジックを実装し、eu_risk_flagとeu_risk_reasonを更新します。$$\text{If } (W_1 \text{ AND } W_2) \text{ OR } W_3 \text{ then } eu\_risk\_flag = TRUE$$重み (Wn​)条件理由格納 (eu_risk_reason)$W_1$ce_marking_risk_category == 'HIGH'高リスクカテゴリ（おもちゃ、電子機器など）$W_2$原産国が「中国」であり、かつブランド名が確立されていない（ノーブランド）と判断される。ノーブランド中国製品と判定$W_3$過去の警告商品DBと類似する特徴を持つ。過去の警告パターンに一致ロジックの実行順序:AIが$W_1, W_2, W_3$をチェックし、リスク特徴データベースと照合。上記の論理式に基づいてeu_risk_flagをTRUEまたはFALSEに決定。eu_risk_flagがTRUEの場合、満たされた$W_n$に基づいてeu_risk_reasonを文字列で結合してDBに格納。II. 承認ページ（フィルタリングツール）の修正1. 新しいフィルターの追加 (Claude/MCP 担当)承認ページのUIコンポーネントに、eu_risk_flagに基づくフィルター切り替えロジックを実装します。フィルター項目名: EUリスク回避フィルター切り替え:クリア: eu_risk_flag = FALSEの商品のみ表示。未クリア: eu_risk_flag = TRUEの商品のみ表示。2. リスク理由の明示 (Claude/MCP 担当)承認ページのカードUI（F-1のProductCardなどを想定）内に、以下の表示ロジックを追加します。JavaScript// 承認ページ UIコンポーネント内の表示ロジック
{product.eu_risk_flag === true && (
    <div style={{ color: 'red', border: '1px solid red', padding: '5px' }}>
        🚨 EUリスク: {product.eu_risk_reason} 
        <br/>
        出品スケジュールへの登録はブロックされます。
    </div>
)}
III. 出品スケジュールツールへの連携と最終制御ロジック1. 出品スケジュール登録のブロック (Claude/MCP 担当)「一括承認」APIまたは手動承認API（フェーズIII-7の/api/research/decision/route.tsを想定）のバックエンドロジックに、以下のブロック条件を実装します。TypeScript// 承認APIバックエンドロジック (疑似コード)

function handleProductApproval(productId, decision) {
    const product = fetchProductFromDB(productId);
    
    // 💡 ブロック条件: (eu_risk_flag = TRUE) AND (eu_ar_status = REQUIRED_NO_AR)
    const shouldBlock = (
        product.eu_risk_flag === true && 
        product.eu_ar_status === 'REQUIRED_NO_AR'
    );

    if (shouldBlock) {
        // 承認プロセスを停止し、エラーメッセージを返す
        throw new Error("EUリスク回避フィルターにより、出品スケジュールへの登録はブロックされました。AR情報が不足しています。");
    }

    // 承認処理 (SKUマスターへのコピーと出品キューへの転送) を続行...
}
2. 最終ロジックの再確認と処理アクションこのフィルターにより、以下の制御がシステム全体で確実に行われます。リスク状態処理アクション高リスク（おもちゃ/中国/ARなし）出品スケジュールへの登録をブロックし、出品自体を完全に停止します。（最優先の安全策）中リスク（おもちゃ/ARなし）スケジュールへの登録は許可されるが、出品時にEU圏への配送を自動除外する設定を適用します。（販売エリア制限策）低リスク（ARあり、またはCE対象外）問題なく出品スケジュールに登録し、全エリアへ