🛠️ 最終統合タスクリスト (Claude/MCP 実行パート)以下のタスクを、提供されたサービスファイル（/services/.../*.ts）と既存のプロジェクト構造に追加・統合します。1. ⚙️ DB統合とスケジューラ設定（全タスク共通）No.実行タスクファイル/ターゲット目的1.1DBクライアント参照の置き換え全ての /services/.../*.ts ファイルGeminiのモックコード内のDBクライアント（supabaseなど）を、プロジェクトの実際のDB接続モジュールに置き換え、DBの読み書きが正しく行われるようにします。1.2外部取得関数の置き換え/services/data_ingestion/DuplicateEngine.ts /services/inventory_management/StockFollower.tsfindProductInDbやcheckUrlStatusなどのモック関数を、既存のスクレイピング/APIクライアントサービスへの呼び出しに置き換えます。2. B-1. 商品データ取得と重複排除エンジン目的: スケジューラ実行時、新規取得データをDBに効率的に取り込む。No.実行タスク処理フローの統合先2.1取得・重複排除フローの作成/tasks/dailyDataIngestion.ts (新規スケジューラタスク)3. B-2. AI処理優先度決定ロジック目的: AI分類（外注）に投入するデータ順序を最適化する。No.実行タスク処理フローの統合先3.1優先度スコア計算バッチ/tasks/calculatePriorityScore.ts (新規スケジューラタスク)3.2ソートキー提供API/api/products/sorted-by-priority/route.ts (新規APIルート)4. B-3. 在庫・価格追従システム (回転率対策)目的: 高回転商品の在庫切れリスクを最小化し、価格変動に対応する。No.実行タスク処理フローの統合先4.1在庫・価格追従バッチ/tasks/checkStockFrequency.ts (新規高頻度スケジューラタスク)4.2複数URL登録の検証/api/products/update-reference-urls/route.ts (既存または新規API)
🕒 各機能の作動時点開発項目トリガー（作動時点）作動頻度（想定）目的B-1. 重複排除エンジンデータ取得スケジューラ実行時定期的（例：1日1回、数時間ごと）外部サイトからデータを取得し、DBに取り込む初回プロセス。B-2. 優先度決定ロジック優先度計算スケジューラ実行時定期的（例：1日1回）新規に取り込まれた商品（status: '取得完了'）に対する優先度スコアを決定する時。B-2. ソートキー提供外注UIからのAPIリクエスト時随時（外注スタッフが画面を開く/リロードする度）スコア順のリストを外注スタッフの画面に表示する時。B-3. 在庫・価格追従システム在庫チェックスケジューラ実行時定期的かつ頻度可変（例：通常は1時間ごと、高頻度設定時は10分ごと）既存商品の在庫切れチェック、価格の再計算、仕入先URLの自動切替を行う時。⚙️ 作動の具体的な流れシステムが作動する主なパイプラインは以下の通りです。データ取得フェーズ（B-1 作動）スケジューラが起動し、Amazonやシングルスターなどの外部サイトからデータを取得します。取得データは、B-1 重複排除エンジンによってDB内の既存レコードと照合され、新規登録されるか、既存レコードが更新されます。レコードはstatus: '取得完了'となります。AI処理準備フェーズ（B-2 作動）別のスケジューラが起動し、status: '取得完了'のレコードを抽出します。B-2 優先度決定ロジックが実行され、Sold数やランキングに基づき**priority_score**が算出・格納されます。レコードはstatus: '優先度決定済'となり、AI分類や外注作業の対象となります。在庫追従フェーズ（B-3 作動）高頻度で動作する在庫追従スケジューラが起動します。このスケジューラは、B-3 在庫・価格追従システムを実行し、登録された参照URLをチェックし、在庫切れの自動切替や価格中央値の計算を行います。特に、Shopeeセール時のようにcheck_frequencyが「高頻度」に設定されている商品は、より短い間隔でチェックが作動します。