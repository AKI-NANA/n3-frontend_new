// app/api/gemini-prompt/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)

type DataType = 'basic' | 'customs' | 'market' | 'both'

/**
 * Geminiãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”ŸæˆAPIï¼ˆ3ç¨®é¡å¯¾å¿œï¼šåŸºæœ¬ãƒ‡ãƒ¼ã‚¿ãƒ»å¸‚å ´èª¿æŸ»ãƒ»ä¸¡æ–¹ï¼‰
 */
export async function POST(request: NextRequest) {
  try {
    const { productIds, dataType = 'both' }: { productIds: number[], dataType?: DataType } = await request.json()

    if (!productIds || !Array.isArray(productIds)) {
      return NextResponse.json(
        { success: false, error: 'å•†å“IDãŒå¿…è¦ã§ã™' },
        { status: 400 }
      )
    }

    console.log('ğŸ“ Geminiãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ:', productIds.length, 'ä»¶, ã‚¿ã‚¤ãƒ—:', dataType)

    // å•†å“æƒ…å ±ã‚’å–å¾—
    const { data: products, error: fetchError } = await supabase
      .from('products_master')
      .select('*')
      .in('id', productIds)

    if (fetchError || !products || products.length === 0) {
      return NextResponse.json(
        { success: false, error: 'å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' },
        { status: 404 }
      )
    }

    // å•†å“ãƒªã‚¹ãƒˆç”Ÿæˆ
    const productList = products.map((p: any, index) => `
${index + 1}. **${p.sku || p.id}**
   - å•†å“å: ${p.title || 'ï¼ˆãªã—ï¼‰'}
   - ä¾¡æ ¼: Â¥${p.price_jpy?.toLocaleString() || 'ä¸æ˜'}
   - ç”»åƒURL: ${p.primary_image_url || p.image_url || 'ï¼ˆãªã—ï¼‰'}
   - æ—¢å­˜HTS: ${p.hts_code || 'æœªè¨­å®š'}
   - æ—¢å­˜åŸç”£å›½: ${p.origin_country || 'æœªè¨­å®š'}
   - æ—¢å­˜ç´ æ: ${p.material || 'æœªè¨­å®š'}
`).join('\n')

    // ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
    let prompt: string
    
    if (dataType === 'basic') {
      prompt = generateBasicDataPrompt(products, productList)
    } else if (dataType === 'customs') {
      prompt = generateCustomsDataPrompt(products, productList)
    } else if (dataType === 'market') {
      prompt = generateMarketResearchPrompt(products, productList)
    } else {
      prompt = generateBothPrompt(products, productList)
    }

    return NextResponse.json({
      success: true,
      prompt,
      product_count: products.length,
      data_type: dataType,
      format: 'JSON',
      clipboard_ready: true
    })

  } catch (error: any) {
    console.error('âŒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error)
    return NextResponse.json(
      { success: false, error: error.message },
      { status: 500 }
    )
  }
}

/**
 * åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®ã¿ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
function generateBasicDataPrompt(products: any[], productList: string): string {
  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš¡ å•†å“åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¿ã‚¹ã‚¯ï¼ˆ${products.length}ä»¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»¥ä¸‹ã®å•†å“ã«ã¤ã„ã¦ã€åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»æ¨å®šã—ã¦ãã ã•ã„ã€‚

ğŸ“¦ å¯¾è±¡å•†å“
${productList}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å®Ÿè¡Œã‚¿ã‚¹ã‚¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å„å•†å“ã«ã¤ã„ã¦ä»¥ä¸‹ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š

âœ… **1. HTSã‚³ãƒ¼ãƒ‰åˆ¤å®šï¼ˆ10æ¡ï¼‰**
   - å•†å“åã€ç”»åƒã€ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ç±³å›½è¼¸å…¥ç”¨HTSã‚³ãƒ¼ãƒ‰(10æ¡)ã‚’æ¨å®š
   - å½¢å¼: 9504.40.00.00ï¼ˆãƒ‰ãƒƒãƒˆä»˜ã10æ¡ï¼‰
   - ä¿¡é ¼åº¦: high / medium / low / uncertain

âœ… **2. åŸç”£å›½ç‰¹å®šï¼ˆ2æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼‰**
   - å•†å“åã€ãƒ–ãƒ©ãƒ³ãƒ‰åã€ç”»åƒã‹ã‚‰åˆ¤å®š
   - å½¢å¼: JP / CN / US / KR / TW ç­‰ã®2æ–‡å­—ã‚³ãƒ¼ãƒ‰

âœ… **3. ç´ æç‰¹å®š**
   - å•†å“åã€ç”»åƒã€ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ä¸»è¦ç´ æã‚’ç‰¹å®š
   - ä¾‹:
     * ã‚«ãƒ¼ãƒ‰é¡ â†’ Paper, Cardboard
     * ãƒ•ã‚£ã‚®ãƒ¥ã‚¢ â†’ PVC, ABS Resin, Metal
     * è¡£é¡ â†’ Cotton, Polyester, Leather
     * ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ â†’ Metal, Glass, Ceramic
     * é›»å­æ©Ÿå™¨ â†’ Plastic, Metal, Glass

âœ… **4. ã‚µã‚¤ã‚ºãƒ»é‡é‡æ¨å®š**
   - é•·ã•ãƒ»å¹…ãƒ»é«˜ã•ï¼ˆcmï¼‰ã€é‡é‡ï¼ˆgï¼‰ã‚’æ¨å®š
   - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ç¢ºèªã—ã€æ˜ã‚‰ã‹ã«é–“é•ã£ã¦ã„ã‚‹å ´åˆã®ã¿ä¿®æ­£

âœ… **5. è‹±èªã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ**
   - eBay SEOæœ€é©åŒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ80æ–‡å­—ä»¥å†…ï¼‰
   - ä¸­å¤å•†å“ã®å ´åˆã¯ "Used" ã‚’æ˜è¨˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONé…åˆ—ã®ã¿ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**é‡è¦**: ä»¥ä¸‹ã®å½¢å¼ã§ **JSONé…åˆ—ã®ã¿** ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
èª¬æ˜æ–‡ã‚„SQLã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚

\`\`\`json
[
  {
    "sku": "YAH-409933",
    "english_title": "Pokemon TCG Japanese Dark Gengar Old Back Holo Vintage Card Used",
    "hts_code": "9504.40.00.00",
    "hts_confidence": "high",
    "origin_country": "JP",
    "material": "Paper, Cardboard",
    "length_cm": 8.8,
    "width_cm": 6.3,
    "height_cm": 0.01,
    "weight_g": 2.0
  }
]
\`\`\`

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. **JSONé…åˆ—ã®ã¿å‡ºåŠ›**: èª¬æ˜æ–‡ã€SQLã€market_researchç­‰ã¯ä¸è¦
2. **å…¨å•†å“ã‚’å«ã‚€**: ä¸Šè¨˜ã®${products.length}ä»¶ã™ã¹ã¦ã‚’é…åˆ—ã«å«ã‚ã‚‹
3. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå³å®ˆ**: sku, english_title, hts_code ç­‰
4. **æ•°å€¤ã¯æ•°å€¤å‹**: length_cm, weight_g ç­‰ã¯æ•°å€¤å‹ã§å‡ºåŠ›
5. **ç©ºæ¬„ã®æ‰±ã„**: ãƒ‡ãƒ¼ã‚¿ä¸æ˜ã®å ´åˆã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è‡ªä½“ã‚’çœç•¥

ãã‚Œã§ã¯åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼`
}

/**
 * é–¢ç¨æƒ…å ±ã®ã¿ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
function generateCustomsDataPrompt(products: any[], productList: string): string {
  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å•†å“é–¢ç¨æƒ…å ±å–å¾—ã‚¿ã‚¹ã‚¯ï¼ˆ${products.length}ä»¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»¥ä¸‹ã®å•†å“ã«ã¤ã„ã¦ã€é–¢ç¨æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

ğŸ“¦ å¯¾è±¡å•†å“
${productList}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å®Ÿè¡Œã‚¿ã‚¹ã‚¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å„å•†å“ã«ã¤ã„ã¦ä»¥ä¸‹ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š

âœ… **1. HTSã‚³ãƒ¼ãƒ‰åˆ¤å®šï¼ˆ10æ¡ï¼‰**
   - å•†å“åã€ç”»åƒã€ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ç±³å›½è¼¸å…¥ç”¨HTSã‚³ãƒ¼ãƒ‰(10æ¡)ã‚’æ¨å®š
   - å½¢å¼: 9504.40.00.00ï¼ˆãƒ‰ãƒƒãƒˆä»˜ã10æ¡ï¼‰
   - ä¿¡é ¼åº¦: high / medium / low / uncertain

âœ… **2. åŸç”£å›½ç‰¹å®šï¼ˆ2æ–‡å­—ã‚³ãƒ¼ãƒ‰ï¼‰**
   - å•†å“åã€ãƒ–ãƒ©ãƒ³ãƒ‰åã€ç”»åƒã‹ã‚‰åˆ¤å®š
   - å½¢å¼: JP / CN / US / KR / TW ç­‰ã®2æ–‡å­—ã‚³ãƒ¼ãƒ‰

âœ… **3. ç´ æç‰¹å®š**
   - å•†å“åã€ç”»åƒã€ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ä¸»è¦ç´ æã‚’ç‰¹å®š
   - ä¾‹ï¼š
     * ã‚«ãƒ¼ãƒ‰é¡ â†’ Paper, Cardboard
     * ãƒ•ã‚£ã‚®ãƒ¥ã‚¢ â†’ PVC, ABS Resin, Metal
     * è¡£é¡ â†’ Cotton, Polyester, Leather
     * ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ â†’ Metal, Glass, Ceramic
     * é›»å­æ©Ÿå™¨ â†’ Plastic, Metal, Glass

âœ… **4. é–¢ç¨ç‡æ¨å®š**
   - HTSã‚³ãƒ¼ãƒ‰ã¨åŸç”£å›½ã‹ã‚‰é–¢ç¨ç‡ã‚’æ¨å®šï¼ˆ%ï¼‰
   - ä¾‹ï¼šãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆJPè£½ï¼‰â†’ 0%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONé…åˆ—ã®ã¿ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**é‡è¦**: ä»¥ä¸‹ã®å½¢å¼ã§ **JSONé…åˆ—ã®ã¿** ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
èª¬æ˜æ–‡ã‚„SQLã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚

\`\`\`json
[
  {
    "sku": "YAH-409933",
    "hts_code": "9504.40.00.00",
    "hts_confidence": "high",
    "origin_country": "JP",
    "material": "Paper, Cardboard",
    "hts_duty_rate": 0,
    "origin_country_duty_rate": 0,
    "material_duty_rate": 0
  }
]
\`\`\`

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. **JSONé…åˆ—ã®ã¿å‡ºåŠ›**: èª¬æ˜æ–‡ã€SQLã¯ä¸è¦
2. **å…¨å•†å“ã‚’å«ã‚€**: ä¸Šè¨˜ã®${products.length}ä»¶ã™ã¹ã¦ã‚’é…åˆ—ã«å«ã‚ã‚‹
3. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå³å®ˆ**: sku, hts_code, origin_country ç­‰
4. **æ•°å€¤ã¯æ•°å€¤å‹**: hts_duty_rate ç­‰ã¯æ•°å€¤å‹ã§å‡ºåŠ›
5. **ç©ºæ¬„ã®æ‰±ã„**: ãƒ‡ãƒ¼ã‚¿ä¸æ˜ã®å ´åˆã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è‡ªä½“ã‚’çœç•¥

ãã‚Œã§ã¯åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼`
}

/**
 * å¸‚å ´èª¿æŸ»ã®ã¿ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
function generateMarketResearchPrompt(products: any[], productList: string): string {
  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å•†å“å¸‚å ´èª¿æŸ»ã‚¿ã‚¹ã‚¯ï¼ˆ${products.length}ä»¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»¥ä¸‹ã®å•†å“ã«ã¤ã„ã¦ã€å¸‚å ´èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

ğŸ“¦ å¯¾è±¡å•†å“
${productList}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å®Ÿè¡Œã‚¿ã‚¹ã‚¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å„å•†å“ã«ã¤ã„ã¦ä»¥ä¸‹ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š

ğŸ“ˆ **1. ãƒ—ãƒ¬ãƒŸã‚¢ç‡åˆ†æ (f_price_premium)**
   - å®šä¾¡ï¼ˆã¾ãŸã¯å–å¾—ä¾¡æ ¼ï¼‰ã«å¯¾ã™ã‚‹å¸‚å ´ä¾¡æ ¼ã®æ¯”ç‡ï¼ˆ%ï¼‰
   - ä¾‹: å®šä¾¡Â¥1000ã€å¸‚å ´ä¾¡æ ¼Â¥1500 â†’ 150.0

ğŸŒŸ **2. ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¹ã‚³ã‚¢ (f_community_score)**
   - ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼äººæ°—åº¦ï¼ˆ1-10ï¼‰
   - é«˜ã„ã»ã©éœ€è¦ãŒå¼·ã„

ğŸ“¦ **3. æ—¥æœ¬å›½å†…ä¾›çµ¦æ•° (c_supply_japan)**
   - Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒ¡ãƒ«ã‚«ãƒªç­‰ã§ã®å‡ºå“æ•°
   - æ¦‚ç®—å€¤ã§OK

ğŸ“Š **4. ä¾›çµ¦ãƒˆãƒ¬ãƒ³ãƒ‰ (c_supply_trend)**
   - increasing / stable / decreasing

ğŸš« **5. å»ƒç›¤ãƒ•ãƒ©ã‚° (s_flag_discontinued)**
   - discontinued / active / unknown

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONé…åˆ—ã®ã¿ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

\`\`\`json
[
  {
    "sku": "YAH-409933",
    "f_price_premium": 150.0,
    "f_community_score": 8,
    "c_supply_japan": 40,
    "c_supply_trend": "stable",
    "s_flag_discontinued": "discontinued"
  }
]
\`\`\`

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. **JSONé…åˆ—ã®ã¿å‡ºåŠ›**: èª¬æ˜æ–‡ã‚„SQLã¯ä¸è¦
2. **å…¨å•†å“ã‚’å«ã‚€**: ä¸Šè¨˜ã®${products.length}ä»¶ã™ã¹ã¦
3. **æ•°å€¤ã¯æ•°å€¤å‹**: f_price_premium, c_supply_japan ç­‰
4. **æ–‡å­—åˆ—ã¯æ–‡å­—åˆ—å‹**: c_supply_trend, s_flag_discontinued ç­‰

ãã‚Œã§ã¯åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼`
}

/**
 * ä¸¡æ–¹ï¼ˆåŸºæœ¬ãƒ‡ãƒ¼ã‚¿ + å¸‚å ´èª¿æŸ»ï¼‰ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
function generateBothPrompt(products: any[], productList: string): string {
  return `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ å•†å“ç·åˆåˆ†æã‚¿ã‚¹ã‚¯ï¼ˆ${products.length}ä»¶ï¼‰- åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ + å¸‚å ´èª¿æŸ»
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»¥ä¸‹ã®å•†å“ã«ã¤ã„ã¦ã€åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã¨å¸‚å ´èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚’åŒæ™‚ã«å–å¾—ã—ã¦ãã ã•ã„ã€‚

ğŸ“¦ å¯¾è±¡å•†å“
${productList}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å®Ÿè¡Œã‚¿ã‚¹ã‚¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### A. åŸºæœ¬ãƒ‡ãƒ¼ã‚¿

âœ… **1. HTSã‚³ãƒ¼ãƒ‰åˆ¤å®š**: 9504.40.00.00 å½¢å¼ï¼ˆ10æ¡ï¼‰
âœ… **2. åŸç”£å›½**: JP / CN / US ç­‰ï¼ˆ2æ–‡å­—ï¼‰
âœ… **3. ç´ æ**: Paper, PVC, Cotton ç­‰
âœ… **4. ã‚µã‚¤ã‚ºãƒ»é‡é‡**: length_cm, width_cm, height_cm, weight_g
âœ… **5. è‹±èªã‚¿ã‚¤ãƒˆãƒ«**: eBay SEOæœ€é©åŒ–ï¼ˆ80æ–‡å­—ä»¥å†…ï¼‰

### B. å¸‚å ´èª¿æŸ»ãƒ‡ãƒ¼ã‚¿

ğŸ“ˆ **6. ãƒ—ãƒ¬ãƒŸã‚¢ç‡**: å®šä¾¡æ¯”ï¼ˆ%ï¼‰
ğŸŒŸ **7. ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¹ã‚³ã‚¢**: 1-10
ğŸ“¦ **8. æ—¥æœ¬å›½å†…ä¾›çµ¦æ•°**: æ¦‚ç®—å€¤
ğŸ“Š **9. ä¾›çµ¦ãƒˆãƒ¬ãƒ³ãƒ‰**: increasing / stable / decreasing
ğŸš« **10. å»ƒç›¤ãƒ•ãƒ©ã‚°**: discontinued / active / unknown

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONé…åˆ—ã®ã¿ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**é‡è¦**: ä»¥ä¸‹ã®å½¢å¼ã§ **JSONé…åˆ—ã®ã¿** ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ•ãƒ©ãƒƒãƒˆã«å«ã‚ã¦ãã ã•ã„ã€‚

\`\`\`json
[
  {
    "sku": "YAH-409933",
    "english_title": "Pokemon TCG Japanese Dark Gengar Old Back Holo Vintage Card Used",
    "hts_code": "9504.40.00.00",
    "hts_confidence": "high",
    "origin_country": "JP",
    "material": "Paper, Cardboard",
    "length_cm": 8.8,
    "width_cm": 6.3,
    "height_cm": 0.01,
    "weight_g": 2.0,
    "f_price_premium": 150.0,
    "f_community_score": 8,
    "c_supply_japan": 40,
    "c_supply_trend": "stable",
    "s_flag_discontinued": "discontinued"
  }
]
\`\`\`

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. **JSONé…åˆ—ã®ã¿å‡ºåŠ›**: èª¬æ˜æ–‡ã€SQLã€ãƒã‚¹ãƒˆæ§‹é€ ï¼ˆbasic_infoç­‰ï¼‰ã¯ä¸è¦
2. **ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€ **: ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åŒã˜éšå±¤ã«
3. **å…¨å•†å“ã‚’å«ã‚€**: ä¸Šè¨˜ã®${products.length}ä»¶ã™ã¹ã¦
4. **æ•°å€¤ã¯æ•°å€¤å‹**: length_cm, f_price_premium ç­‰
5. **æ–‡å­—åˆ—ã¯æ–‡å­—åˆ—å‹**: origin_country, c_supply_trend ç­‰

ãã‚Œã§ã¯åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ï¼`
}
