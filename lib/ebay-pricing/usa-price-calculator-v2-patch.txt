418è¡Œç›®ã‹ã‚‰428è¡Œç›®ã‚’ä»¥ä¸‹ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼š

console.log('\nğŸ“‹ STEP 1: æœ€å®‰é€æ–™ã§åŸºæº–ç·å£²ä¸Šã‚’æ±ºå®š')

// å•†å“ä¾¡æ ¼ã‚’æ¨å®š
const estimatedProductPrice = costUSD * 1.5
console.log(`  ğŸ’° æ¨å®šå•†å“ä¾¡æ ¼: $${estimatedProductPrice.toFixed(2)}`)

const { data: minPolicy, error: minError } = await supabase
  .from('usa_ddp_rates')
  .select('*')
  .lte('weight_min_kg', weight_kg)
  .gt('weight_max_kg', weight_kg)
  .lte('product_price_usd', estimatedProductPrice)
  .order('product_price_usd', { ascending: false })
  .limit(1)
  .maybeSingle()

console.log(`  ğŸ“¦ æ¤œç´¢çµæœ:`, { 
  found: !!minPolicy, 
  price: minPolicy?.product_price_usd,
  shipping: minPolicy?.total_shipping_usd 
})

if (minError || !minPolicy) {
  console.error('âŒ é‡é‡å¸¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', weight_kg, minError)
  return {
    success: false,
    error: `é‡é‡${weight_kg}kgã€ä¾¡æ ¼$${estimatedProductPrice.toFixed(2)}ã«å¯¾å¿œã™ã‚‹é…é€ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`
  } as UsaPricingResultV2
}

const minShipping = minPolicy.total_shipping_usd
const minBaseShipping = minPolicy.base_shipping_usd
