    document.querySelectorAll('.nostalgic-img').forEach(img => {
      fadeInOnScroll.observe(img);
    });

    // ====================================
    // レパートリータブ切り替え
    // ====================================
    function showRepertoire(type) {
      // タブ切り替え時は音楽を停止しない（継続再生）
      
      document.querySelectorAll('.repertoire-list').forEach(list => {
        list.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });

      if (type === 'classic') {
        document.getElementById('classic-list').classList.add('active');
        document.querySelector('.tab-button:nth-child(1)').classList.add('active');
      } else {
        document.getElementById('popular-list').classList.add('active');
        document.querySelector('.tab-button:nth-child(2)').classList.add('active');
      }
    }

    // ====================================
    // 曲の詳細モーダル
    // ====================================
    function showPieceModal(pieceKey) {
      const piece = piecesDatabase[pieceKey];
      if (!piece) {
        alert('この曲の詳細情報は準備中です。');
        return;
      }

      const modal = document.getElementById('pieceModal');
      const modalContent = document.getElementById('modalContent');
      const playBtn = document.getElementById('modalPlayBtn');

      // モーダルコンテンツの構築
      modalContent.innerHTML = `
        <h3>${piece.title}</h3>
        <h4>${piece.composer}</h4>
        <p><strong>時代:</strong> ${piece.era}</p>
        
        <div class="section-heading">曲の概要</div>
        <p>${piece.description}</p>
        
        <div class="section-heading">時代背景</div>
        <p>${piece.background}</p>
        
        <div class="section-heading">曲の特徴</div>
        <p>${piece.features}</p>
        
        <div class="section-heading">演奏難易度</div>
        <p>${piece.difficulty}</p>
      `;

      // 再生ボタンの設定
      if (piece.audio) {
        playBtn.style.display = 'inline-block';
        playBtn.onclick = () => playPiece(piece.audio, piece.title);
      } else {
        playBtn.style.display = 'none';
      }

      modal.classList.add('active');
    }

    function closePieceModal() {
      document.getElementById('pieceModal').classList.remove('active');
    }

    // 曲を再生する関数(排他制御付き)
    function playPiece(audioSrc, title) {
      // BGMを停止
      stopBGM();
      
      // 既存の音楽を停止
      if (currentAudio && !currentAudio.paused) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }

      // 新しい音楽を再生
      currentAudio = new Audio(audioSrc);
      currentAudio.volume = 0.5;
      currentAudio.play().catch(e => console.log('Audio play failed:', e));

      // 再生終了時の処理
      currentAudio.onended = () => {
        currentAudio = null;
        // BGMを再開
        resumeBGM();
      };

      closePieceModal();
    }

    // レパートリーアイテムクリック
    document.querySelectorAll('.repertoire-item').forEach(item => {
      item.addEventListener('click', function() {
        const pieceKey = this.getAttribute('data-piece');
        
        if (pieceKey && pieceKey !== 'none') {
          showPieceModal(pieceKey);
        } else {
          alert('この曲の詳細情報は準備中です。');
        }
      });
    });

    // モーダル外クリックで閉じる
    document.getElementById('pieceModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closePieceModal();
      }
    });

    // ====================================
    // EmailJS設定とフォーム送信
    // ====================================
    
    // ⚠️ EmailJS設定が必要 ⚠️
    // 以下のステップでEmailJSを設定してください:
    //
    // 1. EmailJSアカウントを作成 (https://www.emailjs.com/)
    // 2. Email ServiceとEmail Templateを作成
    // 3. 以下の3つの値を取得して置き換えてください:
    //    - YOUR_PUBLIC_KEY_HERE → あなたのPublic Key
    //    - YOUR_SERVICE_ID → あなたのService ID
    //    - YOUR_TEMPLATE_ID → あなたのTemplate ID
    //
    // 詳細な設定方法は site/piano/EMAILJS_SETUP.md を参照してください
    
    // EmailJS初期化
    (function() {
      // ⚠️ ここにあなたのEmailJS Public Keyを入力してください
      emailjs.init("YOUR_PUBLIC_KEY_HERE");
    })();

    const contactForm = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const formMessage = document.getElementById('formMessage');

    contactForm.addEventListener('submit', function(e) {
      e.preventDefault();

      // ボタンを無効化
      submitBtn.disabled = true;
      submitBtn.textContent = '送信中...';
      formMessage.style.display = 'none';

      // フォームデータ取得
      const formData = {
        inquiry_type: document.getElementById('inquiryType').value,
        from_name: document.getElementById('name').value,
        from_email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        message: document.getElementById('message').value
      };

      // ⚠️ EmailJS送信 - Service IDとTemplate IDを設定してください
      emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', formData)
        .then(function() {
          formMessage.className = 'form-message success';
          formMessage.textContent = 'お問い合わせありがとうございます。2営業日以内にご返信いたします。';
          formMessage.style.display = 'block';
          contactForm.reset();
        })
        .catch(function(error) {
          formMessage.className = 'form-message error';
          formMessage.textContent = '送信に失敗しました。お手数ですが、直接メールまたはお電話でお問い合わせください。';
          formMessage.style.display = 'block';
          console.error('EmailJS Error:', error);
        })
        .finally(function() {
          submitBtn.disabled = false;
          submitBtn.textContent = '送信する';
        });
    });

    // ⚠️ Googleカレンダー設定が必要 ⚠️
    // レッスンカレンダーセクションのiframe srcを、あなたのGoogleカレンダーIDに置き換えてください
    // 
    // 設定方法:
    // 1. Googleカレンダーを開く
    // 2. 該当カレンダーの「設定と共有」を開く
    // 3. 「一般公開して誰でも利用できるようにする」をチェック
    // 4. 「統合カレンダー」セクションから埋め込みコードを取得
    // 5. 上記のiframe src URLをコピーして貼り付けてください
  </script>
</body>
</html>