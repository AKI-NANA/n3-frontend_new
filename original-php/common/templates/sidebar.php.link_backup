<?php
/**
 * NAGANO-3 統一サイドバー（競合解決版・統合デバッグダッシュボード追加）
 * common/templates/sidebar_unified.php
 * 
 * ✅ CSS競合完全解決
 * ✅ マウスオーバーで第二階層表示
 * ✅ 単一実装・重複排除
 * ✅ レスポンシブ対応
 * ✅ 統合デバッグダッシュボード追加（システム管理内）
 */

// 現在のページを正確に判定
$current_url = $_SERVER['REQUEST_URI'] ?? '';
$current_page_param = $_GET['page'] ?? 'dashboard';

// アクティブページ判定関数
function isCurrentPage($page_name) {
    global $current_page_param, $current_url;
    
    if ($current_page_param === $page_name) {
        return true;
    }
    
    if (strpos($current_url, $page_name) !== false) {
        return true;
    }
    
    if ($page_name === 'dashboard') {
        if ($current_page_param === '' || 
            $current_page_param === 'index' || 
            $current_page_param === 'home' ||
            $current_url === '/' || 
            $current_url === '/index.php' ||
            $current_url === '') {
            return true;
        }
    }
    
    return false;
}

// アクティブなサブメニューの判定
function isActiveSubmenu($pages) {
    foreach ($pages as $page) {
        if (isCurrentPage($page)) {
            return true;
        }
    }
    return false;
}

// 実装済みページリスト
$implemented_pages = [
    'dashboard',
    'shohin_content', 
    'zaiko_content',
    'juchu_kanri_content',
    'kicho_content',
    'apikey_content'
];

function getPageUrl($page) {
    return "/?page={$page}";
}
?>

<!-- ===== 統一サイドバーCSS（競合解決版） ===== -->
<style>
/* ===== CSS変数定義 ===== */
:root {
    --sidebar-width: 220px;
    --sidebar-collapsed: 60px;
    --header-height: 80px;
    --submenu-width: 280px;
    
    /* Z-index階層（明確に分離） */
    --z-content: 1;
    --z-sidebar: 2000;
    --z-submenu: 2500;
    --z-header: 3000;
    
    /* カラーパレット */
    --sidebar-bg: #2c3e50;
    --sidebar-hover: rgba(52, 152, 219, 0.3);
    --sidebar-active: linear-gradient(135deg, #3498db, #8b5cf6);
    --submenu-bg: #34495e;
    --submenu-border: #3498db;
    --text-white: rgba(255, 255, 255, 0.9);
    --text-white-dim: rgba(255, 255, 255, 0.7);
    
    /* アニメーション */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
}

/* ===== 基本レイアウト修正 ===== */
body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding-top: var(--header-height);
    overflow-x: hidden;
}

/* ===== 🔥 重要：既存CSS完全上書き（競合解決） ===== */
.sidebar,
.navigation,
.navigation__submenu,
.submenu-overlay,
.submenu {
    all: unset !important;
}

/* ===== メインコンテンツ調整 ===== */
.content,
.main-content {
    margin-left: var(--sidebar-width) !important;
    padding: 20px !important;
    background: var(--bg-primary, #f8f9fa) !important;
    min-height: calc(100vh - var(--header-height)) !important;
    transition: margin-left var(--transition-normal) !important;
    position: relative !important;
    z-index: var(--z-content) !important;
    max-width: calc(100vw - var(--sidebar-width)) !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
}

/* ===== サイドバー本体（統一版） ===== */
.unified-sidebar {
    position: fixed !important;
    top: var(--header-height) !important;
    left: 0 !important;
    width: var(--sidebar-width) !important;
    height: calc(100vh - var(--header-height)) !important;
    background: var(--sidebar-bg) !important;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1) !important;
    overflow: hidden !important;
    z-index: var(--z-sidebar) !important;
    display: flex !important;
    flex-direction: column !important;
    transition: width var(--transition-normal) !important;
    border-right: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* ===== サイドバーリスト ===== */
.unified-sidebar-list {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    flex: 1 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

.unified-sidebar-list::-webkit-scrollbar {
    width: 6px !important;
}

.unified-sidebar-list::-webkit-scrollbar-track {
    background: transparent !important;
}

.unified-sidebar-list::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

/* ===== サイドバーアイテム ===== */
.unified-sidebar-item {
    position: relative !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
}

/* ===== サイドバーリンク ===== */
.unified-sidebar-link {
    display: flex !important;
    align-items: center !important;
    padding: 15px 20px !important;
    color: var(--text-white-dim) !important;
    text-decoration: none !important;
    transition: all var(--transition-fast) !important;
    white-space: nowrap !important;
    min-height: 54px !important;
    box-sizing: border-box !important;
    position: relative !important;
    cursor: pointer !important;
    border: none !important;
    background: none !important;
}

.unified-sidebar-link:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
    transform: translateX(2px) !important;
}

.unified-sidebar-link--active {
    background: var(--sidebar-active) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    box-shadow: inset -3px 0 0 0 rgba(255, 255, 255, 0.3) !important;
}

.unified-sidebar-link--active::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 4px !important;
    background: white !important;
    opacity: 0.8 !important;
}

/* ===== サブメニューラベル ===== */
.unified-submenu-label {
    display: flex !important;
    align-items: center !important;
    padding: 15px 20px !important;
    color: var(--text-white-dim) !important;
    transition: all var(--transition-fast) !important;
    white-space: nowrap !important;
    cursor: pointer !important;
    position: relative !important;
    min-height: 54px !important;
    box-sizing: border-box !important;
    user-select: none !important;
}

.unified-submenu-label:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
    transform: translateX(2px) !important;
}

.unified-submenu-label--active {
    background: var(--sidebar-active) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    box-shadow: inset -3px 0 0 0 rgba(255, 255, 255, 0.3) !important;
}

/* ===== アイコン・テキスト・矢印 ===== */
.unified-sidebar-icon {
    margin-right: 12px !important;
    font-size: 16px !important;
    width: 20px !important;
    text-align: center !important;
    flex-shrink: 0 !important;
}

.unified-sidebar-text {
    flex: 1 !important;
    font-size: 14px !important;
    font-weight: 500 !important;
}

.unified-arrow {
    margin-left: auto !important;
    font-size: 12px !important;
    opacity: 0.6 !important;
    transition: all var(--transition-fast) !important;
    transform-origin: center !important;
}

/* ===== 🔥 重要：マウスオーバー第二階層制御（競合解決版） ===== */
.unified-submenu {
    position: fixed !important;
    width: var(--submenu-width) !important;
    background: var(--submenu-bg) !important;
    border-radius: 0 12px 12px 0 !important;
    box-shadow: 4px 0 25px rgba(0,0,0,0.3) !important;
    z-index: var(--z-submenu) !important;
    
    /* 初期状態：完全非表示 */
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translateX(-20px) scale(0.95) !important;
    transition: all var(--transition-normal) !important;
    pointer-events: none !important;
    
    /* 高さ制限 */
    max-height: calc(100vh - var(--header-height) - 20px) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    
    /* スクロールバー */
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

.unified-submenu::-webkit-scrollbar {
    width: 6px !important;
}

.unified-submenu::-webkit-scrollbar-track {
    background: transparent !important;
}

.unified-submenu::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

/* ===== 🔥 マウスオーバーで第二階層表示（統一版） ===== */
.unified-sidebar-item:hover .unified-submenu {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateX(0) scale(1) !important;
    pointer-events: auto !important;
}

/* ホバー時に矢印回転 */
.unified-sidebar-item:hover .unified-arrow {
    transform: rotate(90deg) !important;
    opacity: 1 !important;
    color: var(--submenu-border) !important;
}

/* ===== サブメニュー位置設定（線形調整版） ===== */
.unified-submenu--1 { top: calc(var(--header-height) + 54px * 1 + 1px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--2 { top: calc(var(--header-height) + 54px * 2 + 2px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--3 { top: calc(var(--header-height) + 54px * 3 + 3px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--4 { top: calc(var(--header-height) + 54px * 4 + 4px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--5 { top: calc(var(--header-height) + 54px * 5 + 5px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--6 { top: calc(var(--header-height) + 54px * 6 + 6px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--7 { top: calc(var(--header-height) + 54px * 7 + 7px) !important; left: var(--sidebar-width) !important; }

/* ===== サブメニューリンク ===== */
.unified-submenu-link {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    padding: 12px 20px !important;
    color: var(--text-white-dim) !important;
    text-decoration: none !important;
    font-size: 14px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
    transition: all var(--transition-fast) !important;
    min-height: 44px !important;
    box-sizing: border-box !important;
}

.unified-submenu-link i {
    margin-right: 12px !important;
    font-size: 14px !important;
    width: 16px !important;
    text-align: center !important;
    flex-shrink: 0 !important;
    opacity: 0.7 !important;
}

.unified-submenu-link:hover {
    background: rgba(52, 152, 219, 0.3) !important;
    color: var(--text-white) !important;
    padding-left: 25px !important;
    transform: translateX(2px) !important;
}

.unified-submenu-link:hover i {
    opacity: 1 !important;
    color: var(--submenu-border) !important;
}

.unified-submenu-link--active {
    background: var(--submenu-border) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    padding-left: 25px !important;
}

.unified-submenu-link--active i {
    opacity: 1 !important;
    color: white !important;
}

/* ===== ステータス表示 ===== */
.status-ready {
    color: #28a745 !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    margin-left: auto !important;
    flex-shrink: 0 !important;
}

.status-pending {
    color: #ffc107 !important;
    font-size: 11px !important;
    font-weight: 500 !important;
    margin-left: auto !important;
    background: rgba(255, 193, 7, 0.2) !important;
    padding: 2px 6px !important;
    border-radius: 10px !important;
    flex-shrink: 0 !important;
}

/* ===== トグルボタン ===== */
.unified-toggle-container {
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
}

.unified-toggle-button {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 15px 20px !important;
    background: rgba(0, 0, 0, 0.2) !important;
    border: none !important;
    color: var(--text-white-dim) !important;
    transition: all var(--transition-fast) !important;
    cursor: pointer !important;
    width: 100% !important;
    box-sizing: border-box !important;
    min-height: 54px !important;
}

.unified-toggle-button:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
}

.unified-toggle-icon {
    font-size: 16px !important;
    margin-right: 8px !important;
}

.unified-toggle-text {
    font-size: 14px !important;
    font-weight: 500 !important;
}

/* ===== サイドバー折りたたみ状態 ===== */
.unified-sidebar--collapsed {
    width: var(--sidebar-collapsed) !important;
}

.unified-sidebar--collapsed .unified-sidebar-text,
.unified-sidebar--collapsed .unified-toggle-text,
.unified-sidebar--collapsed .unified-arrow {
    display: none !important;
}

.unified-sidebar--collapsed .unified-sidebar-link,
.unified-sidebar--collapsed .unified-submenu-label {
    justify-content: center !important;
    padding: 15px 10px !important;
}

.unified-sidebar--collapsed .unified-sidebar-icon {
    margin-right: 0 !important;
    font-size: 18px !important;
}

.unified-sidebar--collapsed .unified-submenu {
    display: none !important;
}

.unified-sidebar--collapsed + .content,
.unified-sidebar--collapsed + .main-content {
    margin-left: var(--sidebar-collapsed) !important;
    max-width: calc(100vw - var(--sidebar-collapsed)) !important;
}

/* ===== レスポンシブ対応 ===== */
@media (max-width: 1024px) {
    .unified-sidebar {
        width: var(--sidebar-collapsed) !important;
    }
    
    .unified-sidebar .unified-sidebar-text,
    .unified-sidebar .unified-toggle-text,
    .unified-sidebar .unified-arrow {
        display: none !important;
    }
    
    .unified-sidebar .unified-sidebar-link,
    .unified-sidebar .unified-submenu-label {
        justify-content: center !important;
        padding: 15px 10px !important;
    }
    
    .unified-sidebar .unified-sidebar-icon {
        margin-right: 0 !important;
        font-size: 18px !important;
    }
    
    .content,
    .main-content {
        margin-left: var(--sidebar-collapsed) !important;
        max-width: calc(100vw - var(--sidebar-collapsed)) !important;
    }
    
    .unified-submenu--1, .unified-submenu--2, .unified-submenu--3, .unified-submenu--4, 
    .unified-submenu--5, .unified-submenu--6, .unified-submenu--7 {
        left: var(--sidebar-collapsed) !important;
    }
}

@media (max-width: 768px) {
    .unified-sidebar {
        transform: translateX(-100%) !important;
        transition: transform var(--transition-normal) !important;
        width: var(--sidebar-width) !important;
        z-index: 10000 !important;
    }
    
    .unified-sidebar--mobile-open {
        transform: translateX(0) !important;
    }
    
    .content,
    .main-content {
        margin-left: 0 !important;
        max-width: 100vw !important;
        padding: 15px !important;
    }
    
    .unified-submenu {
        display: none !important;
    }
}

/* ===== アクセシビリティ ===== */
@media (prefers-reduced-motion: reduce) {
    * {
        transition: none !important;
        animation: none !important;
    }
}

/* ===== 印刷対応 ===== */
@media print {
    .unified-sidebar,
    .unified-submenu {
        display: none !important;
    }
    
    .content,
    .main-content {
        margin-left: 0 !important;
        max-width: 100% !important;
        padding: 0 !important;
    }
}
</style>

<!-- ===== 統一サイドバー本体 ===== -->
<nav class="unified-sidebar" id="unifiedSidebar">
    <ul class="unified-sidebar-list">
        
        <!-- ダッシュボード -->
        <li class="unified-sidebar-item">
            <a href="<?php echo getPageUrl('dashboard'); ?>" 
               class="unified-sidebar-link <?php echo isCurrentPage('dashboard') ? 'unified-sidebar-link--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-home"></i>
                <span class="unified-sidebar-text">ダッシュボード</span>
            </a>
        </li>
        
        <!-- 商品管理 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['shohin_content', 'shohin_add', 'view_shohin_touroku', 'asin_upload_content', 'shohin_category']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-cube"></i>
                <span class="unified-sidebar-text">商品管理</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー1 -->
            <div class="unified-submenu unified-submenu--1">
                <a href="<?php echo getPageUrl('shohin_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('shohin_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-list"></i>商品一覧</span>
                    <?php if (in_array('shohin_content', $implemented_pages)): ?>
                        <span class="status-ready">✓</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('shohin_add'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('shohin_add') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-plus"></i>商品登録</span>
                    <?php if (!in_array('shohin_add', $implemented_pages)): ?>
                        <span class="status-pending">開発中</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('view_shohin_touroku'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-edit"></i>商品登録画面</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('asin_upload_content'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fab fa-amazon"></i>Amazon商品登録</span>
                    <span class="status-pending">開発中</span>
                </a>
                <a href="<?php echo getPageUrl('shohin_category'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-tags"></i>カテゴリ管理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('kakaku_kanri'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-yen-sign"></i>価格管理</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- 在庫管理 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['zaiko_content', 'zaiko_input', 'zaiko_output', 'tanaoroshi']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-warehouse"></i>
                <span class="unified-sidebar-text">在庫管理</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー2 -->
            <div class="unified-submenu unified-submenu--2">
                <a href="<?php echo getPageUrl('zaiko_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('zaiko_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-boxes"></i>在庫一覧</span>
                    <?php if (in_array('zaiko_content', $implemented_pages)): ?>
                        <span class="status-ready">✓</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('zaiko_input'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-arrow-down"></i>入庫処理</span>
                    <span class="status-pending">開発中</span>
                </a>
                <a href="<?php echo getPageUrl('zaiko_output'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-arrow-up"></i>出庫処理</span>
                    <span class="status-pending">開発中</span>
                </a>
                <a href="<?php echo getPageUrl('tanaoroshi'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-clipboard-check"></i>棚卸し処理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('zaiko_report'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-chart-line"></i>在庫レポート</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('hacchu_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shopping-bag"></i>発注管理</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- 受注管理 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['juchu_kanri_content', 'shukka_renkei', 'toiawase']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-shopping-cart"></i>
                <span class="unified-sidebar-text">受注管理</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー3 -->
            <div class="unified-submenu unified-submenu--3">
                <a href="<?php echo getPageUrl('juchu_kanri_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('juchu_kanri_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-list-alt"></i>受注一覧</span>
                    <?php if (in_array('juchu_kanri_content', $implemented_pages)): ?>
                        <span class="status-ready">✓</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('juchu_shori'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-cogs"></i>受注処理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('shukka_renkei'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-truck"></i>出荷連携</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('toiawase'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-comments"></i>問い合わせ</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('haisou_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shipping-fast"></i>配送管理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('ebay_api'); ?>" class="unified-submenu-link">
                    <span><i class="fab fa-ebay"></i>eBay API</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- AI制御システム -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label">
                <i class="unified-sidebar-icon fas fa-robot"></i>
                <span class="unified-sidebar-text">AI制御システム</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー4 -->
            <div class="unified-submenu unified-submenu--4">
                <a href="<?php echo getPageUrl('ai_control_deck'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-tachometer-alt"></i>AI ダッシュボード</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('ai_predictor_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-crystal-ball"></i>予測分析</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('filters_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-filter"></i>フィルター管理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('jidouka_settei'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-magic"></i>自動化設定</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('ml_model'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-brain"></i>機械学習モデル</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('saitekika_engine'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-rocket"></i>最適化エンジン</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- 記帳・会計 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['kicho_content', 'ebay_kicho_content', 'kicho_auto', 'kaikei_kanri']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-calculator"></i>
                <span class="unified-sidebar-text">記帳・会計</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー5 -->
            <div class="unified-submenu unified-submenu--5">
                <a href="<?php echo getPageUrl('kicho_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('kicho_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-book"></i>記帳メイン</span>
                    <?php if (in_array('kicho_content', $implemented_pages)): ?>
                        <span class="status-ready">✓</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('ebay_kicho_content'); ?>" class="unified-submenu-link">
                    <span><i class="fab fa-ebay"></i>eBay売上記帳</span>
                    <span class="status-pending">開発中</span>
                </a>
                <a href="<?php echo getPageUrl('kicho_auto'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-magic"></i>自動記帳</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('kaikei_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-chart-pie"></i>会計管理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('zeimu_shori'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-file-invoice-dollar"></i>税務処理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('choubo_shutsuryoku'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-download"></i>帳簿出力</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- システム管理 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['apikey_content', 'working_system', 'settings_content', 'test_tool']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-cogs"></i>
                <span class="unified-sidebar-text">システム管理</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー6 -->
            <div class="unified-submenu unified-submenu--6">
                <a href="<?php echo getPageUrl('apikey_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('apikey_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-key"></i>APIキー管理</span>
                    <?php if (in_array('apikey_content', $implemented_pages)): ?>
                        <span class="status-ready">✓</span>
                    <?php endif; ?>
                </a>
                
                <!-- 🎯 新規追加：統合デバッグダッシュボード（独立アクセス） -->
                <a href="?page=debug_dashboard" class="unified-submenu-link">
                    <span><i class="fas fa-search"></i>統合デバッグ</span>
                    <span class="status-ready">✓</span>
                </a>

                <!-- 🎯 CAIDS Hook統合管理システム -->
                <a href="hooks/caids_systems/ui_monitor/caids_dashboard.php" class="unified-submenu-link" target="_blank">
                    <span><i class="fas fa-sitemap"></i>CAIDS Hook統合管理</span>
                    <span class="status-ready">✓</span>
                </a>
                
                <!-- 📁 Claude Hooks統合サンプル -->
                <a href="<?php echo getPageUrl('sample_file_manager'); ?>" class="unified-submenu-link">
                <span><i class="fas fa-folder-open"></i>ファイルマネージャーサンプル</span>
                <span class="status-ready">✓</span>
                </a>
                
                <a href="<?php echo getPageUrl('working_system'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-server"></i>実動システム</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('settings_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-sliders-h"></i>基本設定</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('test_tool'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-vial"></i>システムテスト</span>
                    <span class="status-ready">✓</span>
                </a>
                <a href="<?php echo getPageUrl('dev_support'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-code"></i>開発補助</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('manual_main_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-book-open"></i>マニュアル</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('auth_login'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shield-alt"></i>認証設定</span>
                    <span class="status-pending">準備中</span>
                </a>
            </div>
        </li>
        
        <!-- その他 -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label">
                <i class="unified-sidebar-icon fas fa-tools"></i>
                <span class="unified-sidebar-text">その他</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- サブメニュー7 -->
            <div class="unified-submenu unified-submenu--7">
                <a href="<?php echo getPageUrl('task_calendar'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-calendar-alt"></i>タスクカレンダー</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('image_management'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-images"></i>画像管理</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('notification_center'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-bell"></i>通知センター</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('help_support'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-question-circle"></i>ヘルプ・サポート</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('backup_system'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-database"></i>バックアップ</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('log_viewer'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-file-alt"></i>ログ表示</span>
                    <span class="status-pending">準備中</span>
                </a>
                <a href="<?php echo getPageUrl('complete_web_tool'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-tools"></i>統合Webツール</span>
                    <span class="status-ready">✓</span>
                </a>
            </div>
        </li>
        
    </ul>
    
    <!-- トグルボタン -->
    <div class="unified-toggle-container">
        <button class="unified-toggle-button" onclick="toggleUnifiedSidebar()">
            <i class="unified-toggle-icon fas fa-arrows-alt-h"></i>
            <span class="unified-toggle-text">サイドバー切替</span>
        </button>
    </div>
</nav>

<!-- 統一サイドバー制御JavaScript -->
<script>
function toggleUnifiedSidebar() {
    const sidebar = document.querySelector('.unified-sidebar');
    const content = document.querySelector('.content, .main-content');
    
    if (!sidebar) {
        console.warn('❌ 統一サイドバー要素が見つかりません');
        return;
    }
    
    const isCollapsed = sidebar.classList.contains('unified-sidebar--collapsed');
    
    if (isCollapsed) {
        // 展開
        sidebar.classList.remove('unified-sidebar--collapsed');
        if (content) {
            content.style.marginLeft = 'var(--sidebar-width)';
            content.style.maxWidth = 'calc(100vw - var(--sidebar-width))';
        }
        console.log('🔄 統一サイドバー展開');
    } else {
        // 折りたたみ
        sidebar.classList.add('unified-sidebar--collapsed');
        if (content) {
            content.style.marginLeft = 'var(--sidebar-collapsed)';
            content.style.maxWidth = 'calc(100vw - var(--sidebar-collapsed))';
        }
        console.log('🔄 統一サイドバー折りたたみ');
    }
}

// 初期化
document.addEventListener('DOMContentLoaded', function() {
    console.log('✅ 統一サイドバー初期化完了（統合デバッグダッシュボード対応）');
    
    // レスポンシブ対応
    function handleResize() {
        const sidebar = document.querySelector('.unified-sidebar');
        const content = document.querySelector('.content, .main-content');
        
        if (window.innerWidth <= 1024) {
            if (sidebar) sidebar.classList.add('unified-sidebar--collapsed');
            if (content) {
                content.style.marginLeft = 'var(--sidebar-collapsed)';
                content.style.maxWidth = 'calc(100vw - var(--sidebar-collapsed))';
            }
        }
    }
    
    window.addEventListener('resize', handleResize);
    handleResize(); // 初期実行
});
</script>