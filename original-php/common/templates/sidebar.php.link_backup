<?php
/**
 * NAGANO-3 çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆç«¶åˆè§£æ±ºç‰ˆãƒ»çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¿½åŠ ï¼‰
 * common/templates/sidebar_unified.php
 * 
 * âœ… CSSç«¶åˆå®Œå…¨è§£æ±º
 * âœ… ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§ç¬¬äºŒéšå±¤è¡¨ç¤º
 * âœ… å˜ä¸€å®Ÿè£…ãƒ»é‡è¤‡æ’é™¤
 * âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
 * âœ… çµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¿½åŠ ï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†å†…ï¼‰
 */

// ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚’æ­£ç¢ºã«åˆ¤å®š
$current_url = $_SERVER['REQUEST_URI'] ?? '';
$current_page_param = $_GET['page'] ?? 'dashboard';

// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒšãƒ¼ã‚¸åˆ¤å®šé–¢æ•°
function isCurrentPage($page_name) {
    global $current_page_param, $current_url;
    
    if ($current_page_param === $page_name) {
        return true;
    }
    
    if (strpos($current_url, $page_name) !== false) {
        return true;
    }
    
    if ($page_name === 'dashboard') {
        if ($current_page_param === '' || 
            $current_page_param === 'index' || 
            $current_page_param === 'home' ||
            $current_url === '/' || 
            $current_url === '/index.php' ||
            $current_url === '') {
            return true;
        }
    }
    
    return false;
}

// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¤å®š
function isActiveSubmenu($pages) {
    foreach ($pages as $page) {
        if (isCurrentPage($page)) {
            return true;
        }
    }
    return false;
}

// å®Ÿè£…æ¸ˆã¿ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆ
$implemented_pages = [
    'dashboard',
    'shohin_content', 
    'zaiko_content',
    'juchu_kanri_content',
    'kicho_content',
    'apikey_content'
];

function getPageUrl($page) {
    return "/?page={$page}";
}
?>

<!-- ===== çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼CSSï¼ˆç«¶åˆè§£æ±ºç‰ˆï¼‰ ===== -->
<style>
/* ===== CSSå¤‰æ•°å®šç¾© ===== */
:root {
    --sidebar-width: 220px;
    --sidebar-collapsed: 60px;
    --header-height: 80px;
    --submenu-width: 280px;
    
    /* Z-indexéšå±¤ï¼ˆæ˜ç¢ºã«åˆ†é›¢ï¼‰ */
    --z-content: 1;
    --z-sidebar: 2000;
    --z-submenu: 2500;
    --z-header: 3000;
    
    /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
    --sidebar-bg: #2c3e50;
    --sidebar-hover: rgba(52, 152, 219, 0.3);
    --sidebar-active: linear-gradient(135deg, #3498db, #8b5cf6);
    --submenu-bg: #34495e;
    --submenu-border: #3498db;
    --text-white: rgba(255, 255, 255, 0.9);
    --text-white-dim: rgba(255, 255, 255, 0.7);
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
}

/* ===== åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ ===== */
body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding-top: var(--header-height);
    overflow-x: hidden;
}

/* ===== ğŸ”¥ é‡è¦ï¼šæ—¢å­˜CSSå®Œå…¨ä¸Šæ›¸ãï¼ˆç«¶åˆè§£æ±ºï¼‰ ===== */
.sidebar,
.navigation,
.navigation__submenu,
.submenu-overlay,
.submenu {
    all: unset !important;
}

/* ===== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„èª¿æ•´ ===== */
.content,
.main-content {
    margin-left: var(--sidebar-width) !important;
    padding: 20px !important;
    background: var(--bg-primary, #f8f9fa) !important;
    min-height: calc(100vh - var(--header-height)) !important;
    transition: margin-left var(--transition-normal) !important;
    position: relative !important;
    z-index: var(--z-content) !important;
    max-width: calc(100vw - var(--sidebar-width)) !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
}

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼æœ¬ä½“ï¼ˆçµ±ä¸€ç‰ˆï¼‰ ===== */
.unified-sidebar {
    position: fixed !important;
    top: var(--header-height) !important;
    left: 0 !important;
    width: var(--sidebar-width) !important;
    height: calc(100vh - var(--header-height)) !important;
    background: var(--sidebar-bg) !important;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1) !important;
    overflow: hidden !important;
    z-index: var(--z-sidebar) !important;
    display: flex !important;
    flex-direction: column !important;
    transition: width var(--transition-normal) !important;
    border-right: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒªã‚¹ãƒˆ ===== */
.unified-sidebar-list {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    flex: 1 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

.unified-sidebar-list::-webkit-scrollbar {
    width: 6px !important;
}

.unified-sidebar-list::-webkit-scrollbar-track {
    background: transparent !important;
}

.unified-sidebar-list::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ãƒ†ãƒ  ===== */
.unified-sidebar-item {
    position: relative !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
}

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒªãƒ³ã‚¯ ===== */
.unified-sidebar-link {
    display: flex !important;
    align-items: center !important;
    padding: 15px 20px !important;
    color: var(--text-white-dim) !important;
    text-decoration: none !important;
    transition: all var(--transition-fast) !important;
    white-space: nowrap !important;
    min-height: 54px !important;
    box-sizing: border-box !important;
    position: relative !important;
    cursor: pointer !important;
    border: none !important;
    background: none !important;
}

.unified-sidebar-link:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
    transform: translateX(2px) !important;
}

.unified-sidebar-link--active {
    background: var(--sidebar-active) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    box-shadow: inset -3px 0 0 0 rgba(255, 255, 255, 0.3) !important;
}

.unified-sidebar-link--active::before {
    content: '' !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
    width: 4px !important;
    background: white !important;
    opacity: 0.8 !important;
}

/* ===== ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ™ãƒ« ===== */
.unified-submenu-label {
    display: flex !important;
    align-items: center !important;
    padding: 15px 20px !important;
    color: var(--text-white-dim) !important;
    transition: all var(--transition-fast) !important;
    white-space: nowrap !important;
    cursor: pointer !important;
    position: relative !important;
    min-height: 54px !important;
    box-sizing: border-box !important;
    user-select: none !important;
}

.unified-submenu-label:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
    transform: translateX(2px) !important;
}

.unified-submenu-label--active {
    background: var(--sidebar-active) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    box-shadow: inset -3px 0 0 0 rgba(255, 255, 255, 0.3) !important;
}

/* ===== ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ»çŸ¢å° ===== */
.unified-sidebar-icon {
    margin-right: 12px !important;
    font-size: 16px !important;
    width: 20px !important;
    text-align: center !important;
    flex-shrink: 0 !important;
}

.unified-sidebar-text {
    flex: 1 !important;
    font-size: 14px !important;
    font-weight: 500 !important;
}

.unified-arrow {
    margin-left: auto !important;
    font-size: 12px !important;
    opacity: 0.6 !important;
    transition: all var(--transition-fast) !important;
    transform-origin: center !important;
}

/* ===== ğŸ”¥ é‡è¦ï¼šãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ç¬¬äºŒéšå±¤åˆ¶å¾¡ï¼ˆç«¶åˆè§£æ±ºç‰ˆï¼‰ ===== */
.unified-submenu {
    position: fixed !important;
    width: var(--submenu-width) !important;
    background: var(--submenu-bg) !important;
    border-radius: 0 12px 12px 0 !important;
    box-shadow: 4px 0 25px rgba(0,0,0,0.3) !important;
    z-index: var(--z-submenu) !important;
    
    /* åˆæœŸçŠ¶æ…‹ï¼šå®Œå…¨éè¡¨ç¤º */
    opacity: 0 !important;
    visibility: hidden !important;
    transform: translateX(-20px) scale(0.95) !important;
    transition: all var(--transition-normal) !important;
    pointer-events: none !important;
    
    /* é«˜ã•åˆ¶é™ */
    max-height: calc(100vh - var(--header-height) - 20px) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

.unified-submenu::-webkit-scrollbar {
    width: 6px !important;
}

.unified-submenu::-webkit-scrollbar-track {
    background: transparent !important;
}

.unified-submenu::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

/* ===== ğŸ”¥ ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§ç¬¬äºŒéšå±¤è¡¨ç¤ºï¼ˆçµ±ä¸€ç‰ˆï¼‰ ===== */
.unified-sidebar-item:hover .unified-submenu {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateX(0) scale(1) !important;
    pointer-events: auto !important;
}

/* ãƒ›ãƒãƒ¼æ™‚ã«çŸ¢å°å›è»¢ */
.unified-sidebar-item:hover .unified-arrow {
    transform: rotate(90deg) !important;
    opacity: 1 !important;
    color: var(--submenu-border) !important;
}

/* ===== ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½ç½®è¨­å®šï¼ˆç·šå½¢èª¿æ•´ç‰ˆï¼‰ ===== */
.unified-submenu--1 { top: calc(var(--header-height) + 54px * 1 + 1px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--2 { top: calc(var(--header-height) + 54px * 2 + 2px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--3 { top: calc(var(--header-height) + 54px * 3 + 3px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--4 { top: calc(var(--header-height) + 54px * 4 + 4px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--5 { top: calc(var(--header-height) + 54px * 5 + 5px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--6 { top: calc(var(--header-height) + 54px * 6 + 6px) !important; left: var(--sidebar-width) !important; }
.unified-submenu--7 { top: calc(var(--header-height) + 54px * 7 + 7px) !important; left: var(--sidebar-width) !important; }

/* ===== ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯ ===== */
.unified-submenu-link {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    padding: 12px 20px !important;
    color: var(--text-white-dim) !important;
    text-decoration: none !important;
    font-size: 14px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
    transition: all var(--transition-fast) !important;
    min-height: 44px !important;
    box-sizing: border-box !important;
}

.unified-submenu-link i {
    margin-right: 12px !important;
    font-size: 14px !important;
    width: 16px !important;
    text-align: center !important;
    flex-shrink: 0 !important;
    opacity: 0.7 !important;
}

.unified-submenu-link:hover {
    background: rgba(52, 152, 219, 0.3) !important;
    color: var(--text-white) !important;
    padding-left: 25px !important;
    transform: translateX(2px) !important;
}

.unified-submenu-link:hover i {
    opacity: 1 !important;
    color: var(--submenu-border) !important;
}

.unified-submenu-link--active {
    background: var(--submenu-border) !important;
    color: var(--text-white) !important;
    font-weight: 600 !important;
    padding-left: 25px !important;
}

.unified-submenu-link--active i {
    opacity: 1 !important;
    color: white !important;
}

/* ===== ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º ===== */
.status-ready {
    color: #28a745 !important;
    font-size: 12px !important;
    font-weight: 600 !important;
    margin-left: auto !important;
    flex-shrink: 0 !important;
}

.status-pending {
    color: #ffc107 !important;
    font-size: 11px !important;
    font-weight: 500 !important;
    margin-left: auto !important;
    background: rgba(255, 193, 7, 0.2) !important;
    padding: 2px 6px !important;
    border-radius: 10px !important;
    flex-shrink: 0 !important;
}

/* ===== ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ ===== */
.unified-toggle-container {
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
}

.unified-toggle-button {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 15px 20px !important;
    background: rgba(0, 0, 0, 0.2) !important;
    border: none !important;
    color: var(--text-white-dim) !important;
    transition: all var(--transition-fast) !important;
    cursor: pointer !important;
    width: 100% !important;
    box-sizing: border-box !important;
    min-height: 54px !important;
}

.unified-toggle-button:hover {
    background: var(--sidebar-hover) !important;
    color: var(--text-white) !important;
}

.unified-toggle-icon {
    font-size: 16px !important;
    margin-right: 8px !important;
}

.unified-toggle-text {
    font-size: 14px !important;
    font-weight: 500 !important;
}

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹ ===== */
.unified-sidebar--collapsed {
    width: var(--sidebar-collapsed) !important;
}

.unified-sidebar--collapsed .unified-sidebar-text,
.unified-sidebar--collapsed .unified-toggle-text,
.unified-sidebar--collapsed .unified-arrow {
    display: none !important;
}

.unified-sidebar--collapsed .unified-sidebar-link,
.unified-sidebar--collapsed .unified-submenu-label {
    justify-content: center !important;
    padding: 15px 10px !important;
}

.unified-sidebar--collapsed .unified-sidebar-icon {
    margin-right: 0 !important;
    font-size: 18px !important;
}

.unified-sidebar--collapsed .unified-submenu {
    display: none !important;
}

.unified-sidebar--collapsed + .content,
.unified-sidebar--collapsed + .main-content {
    margin-left: var(--sidebar-collapsed) !important;
    max-width: calc(100vw - var(--sidebar-collapsed)) !important;
}

/* ===== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ ===== */
@media (max-width: 1024px) {
    .unified-sidebar {
        width: var(--sidebar-collapsed) !important;
    }
    
    .unified-sidebar .unified-sidebar-text,
    .unified-sidebar .unified-toggle-text,
    .unified-sidebar .unified-arrow {
        display: none !important;
    }
    
    .unified-sidebar .unified-sidebar-link,
    .unified-sidebar .unified-submenu-label {
        justify-content: center !important;
        padding: 15px 10px !important;
    }
    
    .unified-sidebar .unified-sidebar-icon {
        margin-right: 0 !important;
        font-size: 18px !important;
    }
    
    .content,
    .main-content {
        margin-left: var(--sidebar-collapsed) !important;
        max-width: calc(100vw - var(--sidebar-collapsed)) !important;
    }
    
    .unified-submenu--1, .unified-submenu--2, .unified-submenu--3, .unified-submenu--4, 
    .unified-submenu--5, .unified-submenu--6, .unified-submenu--7 {
        left: var(--sidebar-collapsed) !important;
    }
}

@media (max-width: 768px) {
    .unified-sidebar {
        transform: translateX(-100%) !important;
        transition: transform var(--transition-normal) !important;
        width: var(--sidebar-width) !important;
        z-index: 10000 !important;
    }
    
    .unified-sidebar--mobile-open {
        transform: translateX(0) !important;
    }
    
    .content,
    .main-content {
        margin-left: 0 !important;
        max-width: 100vw !important;
        padding: 15px !important;
    }
    
    .unified-submenu {
        display: none !important;
    }
}

/* ===== ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ ===== */
@media (prefers-reduced-motion: reduce) {
    * {
        transition: none !important;
        animation: none !important;
    }
}

/* ===== å°åˆ·å¯¾å¿œ ===== */
@media print {
    .unified-sidebar,
    .unified-submenu {
        display: none !important;
    }
    
    .content,
    .main-content {
        margin-left: 0 !important;
        max-width: 100% !important;
        padding: 0 !important;
    }
}
</style>

<!-- ===== çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼æœ¬ä½“ ===== -->
<nav class="unified-sidebar" id="unifiedSidebar">
    <ul class="unified-sidebar-list">
        
        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <li class="unified-sidebar-item">
            <a href="<?php echo getPageUrl('dashboard'); ?>" 
               class="unified-sidebar-link <?php echo isCurrentPage('dashboard') ? 'unified-sidebar-link--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-home"></i>
                <span class="unified-sidebar-text">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
            </a>
        </li>
        
        <!-- å•†å“ç®¡ç† -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['shohin_content', 'shohin_add', 'view_shohin_touroku', 'asin_upload_content', 'shohin_category']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-cube"></i>
                <span class="unified-sidebar-text">å•†å“ç®¡ç†</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼1 -->
            <div class="unified-submenu unified-submenu--1">
                <a href="<?php echo getPageUrl('shohin_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('shohin_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-list"></i>å•†å“ä¸€è¦§</span>
                    <?php if (in_array('shohin_content', $implemented_pages)): ?>
                        <span class="status-ready">âœ“</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('shohin_add'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('shohin_add') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-plus"></i>å•†å“ç™»éŒ²</span>
                    <?php if (!in_array('shohin_add', $implemented_pages)): ?>
                        <span class="status-pending">é–‹ç™ºä¸­</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('view_shohin_touroku'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-edit"></i>å•†å“ç™»éŒ²ç”»é¢</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('asin_upload_content'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fab fa-amazon"></i>Amazonå•†å“ç™»éŒ²</span>
                    <span class="status-pending">é–‹ç™ºä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('shohin_category'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-tags"></i>ã‚«ãƒ†ã‚´ãƒªç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('kakaku_kanri'); ?>" 
                   class="unified-submenu-link">
                    <span><i class="fas fa-yen-sign"></i>ä¾¡æ ¼ç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- åœ¨åº«ç®¡ç† -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['zaiko_content', 'zaiko_input', 'zaiko_output', 'tanaoroshi']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-warehouse"></i>
                <span class="unified-sidebar-text">åœ¨åº«ç®¡ç†</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼2 -->
            <div class="unified-submenu unified-submenu--2">
                <a href="<?php echo getPageUrl('zaiko_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('zaiko_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-boxes"></i>åœ¨åº«ä¸€è¦§</span>
                    <?php if (in_array('zaiko_content', $implemented_pages)): ?>
                        <span class="status-ready">âœ“</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('zaiko_input'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-arrow-down"></i>å…¥åº«å‡¦ç†</span>
                    <span class="status-pending">é–‹ç™ºä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('zaiko_output'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-arrow-up"></i>å‡ºåº«å‡¦ç†</span>
                    <span class="status-pending">é–‹ç™ºä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('tanaoroshi'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-clipboard-check"></i>æ£šå¸ã—å‡¦ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('zaiko_report'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-chart-line"></i>åœ¨åº«ãƒ¬ãƒãƒ¼ãƒˆ</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('hacchu_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shopping-bag"></i>ç™ºæ³¨ç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- å—æ³¨ç®¡ç† -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['juchu_kanri_content', 'shukka_renkei', 'toiawase']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-shopping-cart"></i>
                <span class="unified-sidebar-text">å—æ³¨ç®¡ç†</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼3 -->
            <div class="unified-submenu unified-submenu--3">
                <a href="<?php echo getPageUrl('juchu_kanri_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('juchu_kanri_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-list-alt"></i>å—æ³¨ä¸€è¦§</span>
                    <?php if (in_array('juchu_kanri_content', $implemented_pages)): ?>
                        <span class="status-ready">âœ“</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('juchu_shori'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-cogs"></i>å—æ³¨å‡¦ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('shukka_renkei'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-truck"></i>å‡ºè·é€£æº</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('toiawase'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-comments"></i>å•ã„åˆã‚ã›</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('haisou_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shipping-fast"></i>é…é€ç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('ebay_api'); ?>" class="unified-submenu-link">
                    <span><i class="fab fa-ebay"></i>eBay API</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- AIåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ  -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label">
                <i class="unified-sidebar-icon fas fa-robot"></i>
                <span class="unified-sidebar-text">AIåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ </span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼4 -->
            <div class="unified-submenu unified-submenu--4">
                <a href="<?php echo getPageUrl('ai_control_deck'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-tachometer-alt"></i>AI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('ai_predictor_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-crystal-ball"></i>äºˆæ¸¬åˆ†æ</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('filters_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-filter"></i>ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('jidouka_settei'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-magic"></i>è‡ªå‹•åŒ–è¨­å®š</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('ml_model'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-brain"></i>æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('saitekika_engine'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-rocket"></i>æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- è¨˜å¸³ãƒ»ä¼šè¨ˆ -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['kicho_content', 'ebay_kicho_content', 'kicho_auto', 'kaikei_kanri']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-calculator"></i>
                <span class="unified-sidebar-text">è¨˜å¸³ãƒ»ä¼šè¨ˆ</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼5 -->
            <div class="unified-submenu unified-submenu--5">
                <a href="<?php echo getPageUrl('kicho_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('kicho_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-book"></i>è¨˜å¸³ãƒ¡ã‚¤ãƒ³</span>
                    <?php if (in_array('kicho_content', $implemented_pages)): ?>
                        <span class="status-ready">âœ“</span>
                    <?php endif; ?>
                </a>
                <a href="<?php echo getPageUrl('ebay_kicho_content'); ?>" class="unified-submenu-link">
                    <span><i class="fab fa-ebay"></i>eBayå£²ä¸Šè¨˜å¸³</span>
                    <span class="status-pending">é–‹ç™ºä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('kicho_auto'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-magic"></i>è‡ªå‹•è¨˜å¸³</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('kaikei_kanri'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-chart-pie"></i>ä¼šè¨ˆç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('zeimu_shori'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-file-invoice-dollar"></i>ç¨å‹™å‡¦ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('choubo_shutsuryoku'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-download"></i>å¸³ç°¿å‡ºåŠ›</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç† -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label <?php echo isActiveSubmenu(['apikey_content', 'working_system', 'settings_content', 'test_tool']) ? 'unified-submenu-label--active' : ''; ?>">
                <i class="unified-sidebar-icon fas fa-cogs"></i>
                <span class="unified-sidebar-text">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼6 -->
            <div class="unified-submenu unified-submenu--6">
                <a href="<?php echo getPageUrl('apikey_content'); ?>" 
                   class="unified-submenu-link <?php echo isCurrentPage('apikey_content') ? 'unified-submenu-link--active' : ''; ?>">
                    <span><i class="fas fa-key"></i>APIã‚­ãƒ¼ç®¡ç†</span>
                    <?php if (in_array('apikey_content', $implemented_pages)): ?>
                        <span class="status-ready">âœ“</span>
                    <?php endif; ?>
                </a>
                
                <!-- ğŸ¯ æ–°è¦è¿½åŠ ï¼šçµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆç‹¬ç«‹ã‚¢ã‚¯ã‚»ã‚¹ï¼‰ -->
                <a href="?page=debug_dashboard" class="unified-submenu-link">
                    <span><i class="fas fa-search"></i>çµ±åˆãƒ‡ãƒãƒƒã‚°</span>
                    <span class="status-ready">âœ“</span>
                </a>

                <!-- ğŸ¯ CAIDS Hookçµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  -->
                <a href="hooks/caids_systems/ui_monitor/caids_dashboard.php" class="unified-submenu-link" target="_blank">
                    <span><i class="fas fa-sitemap"></i>CAIDS Hookçµ±åˆç®¡ç†</span>
                    <span class="status-ready">âœ“</span>
                </a>
                
                <!-- ğŸ“ Claude Hooksçµ±åˆã‚µãƒ³ãƒ—ãƒ« -->
                <a href="<?php echo getPageUrl('sample_file_manager'); ?>" class="unified-submenu-link">
                <span><i class="fas fa-folder-open"></i>ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚µãƒ³ãƒ—ãƒ«</span>
                <span class="status-ready">âœ“</span>
                </a>
                
                <a href="<?php echo getPageUrl('working_system'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-server"></i>å®Ÿå‹•ã‚·ã‚¹ãƒ†ãƒ </span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('settings_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-sliders-h"></i>åŸºæœ¬è¨­å®š</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('test_tool'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-vial"></i>ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</span>
                    <span class="status-ready">âœ“</span>
                </a>
                <a href="<?php echo getPageUrl('dev_support'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-code"></i>é–‹ç™ºè£œåŠ©</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('manual_main_content'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-book-open"></i>ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('auth_login'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-shield-alt"></i>èªè¨¼è¨­å®š</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
            </div>
        </li>
        
        <!-- ãã®ä»– -->
        <li class="unified-sidebar-item">
            <div class="unified-submenu-label">
                <i class="unified-sidebar-icon fas fa-tools"></i>
                <span class="unified-sidebar-text">ãã®ä»–</span>
                <i class="unified-arrow fas fa-chevron-right"></i>
            </div>
            <!-- ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼7 -->
            <div class="unified-submenu unified-submenu--7">
                <a href="<?php echo getPageUrl('task_calendar'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-calendar-alt"></i>ã‚¿ã‚¹ã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('image_management'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-images"></i>ç”»åƒç®¡ç†</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('notification_center'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-bell"></i>é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('help_support'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-question-circle"></i>ãƒ˜ãƒ«ãƒ—ãƒ»ã‚µãƒãƒ¼ãƒˆ</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('backup_system'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-database"></i>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('log_viewer'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-file-alt"></i>ãƒ­ã‚°è¡¨ç¤º</span>
                    <span class="status-pending">æº–å‚™ä¸­</span>
                </a>
                <a href="<?php echo getPageUrl('complete_web_tool'); ?>" class="unified-submenu-link">
                    <span><i class="fas fa-tools"></i>çµ±åˆWebãƒ„ãƒ¼ãƒ«</span>
                    <span class="status-ready">âœ“</span>
                </a>
            </div>
        </li>
        
    </ul>
    
    <!-- ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
    <div class="unified-toggle-container">
        <button class="unified-toggle-button" onclick="toggleUnifiedSidebar()">
            <i class="unified-toggle-icon fas fa-arrows-alt-h"></i>
            <span class="unified-toggle-text">ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ‡æ›¿</span>
        </button>
    </div>
</nav>

<!-- çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ¶å¾¡JavaScript -->
<script>
function toggleUnifiedSidebar() {
    const sidebar = document.querySelector('.unified-sidebar');
    const content = document.querySelector('.content, .main-content');
    
    if (!sidebar) {
        console.warn('âŒ çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }
    
    const isCollapsed = sidebar.classList.contains('unified-sidebar--collapsed');
    
    if (isCollapsed) {
        // å±•é–‹
        sidebar.classList.remove('unified-sidebar--collapsed');
        if (content) {
            content.style.marginLeft = 'var(--sidebar-width)';
            content.style.maxWidth = 'calc(100vw - var(--sidebar-width))';
        }
        console.log('ğŸ”„ çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼å±•é–‹');
    } else {
        // æŠ˜ã‚ŠãŸãŸã¿
        sidebar.classList.add('unified-sidebar--collapsed');
        if (content) {
            content.style.marginLeft = 'var(--sidebar-collapsed)';
            content.style.maxWidth = 'calc(100vw - var(--sidebar-collapsed))';
        }
        console.log('ğŸ”„ çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼æŠ˜ã‚ŠãŸãŸã¿');
    }
}

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('âœ… çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆæœŸåŒ–å®Œäº†ï¼ˆçµ±åˆãƒ‡ãƒãƒƒã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å¯¾å¿œï¼‰');
    
    // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
    function handleResize() {
        const sidebar = document.querySelector('.unified-sidebar');
        const content = document.querySelector('.content, .main-content');
        
        if (window.innerWidth <= 1024) {
            if (sidebar) sidebar.classList.add('unified-sidebar--collapsed');
            if (content) {
                content.style.marginLeft = 'var(--sidebar-collapsed)';
                content.style.maxWidth = 'calc(100vw - var(--sidebar-collapsed))';
            }
        }
    }
    
    window.addEventListener('resize', handleResize);
    handleResize(); // åˆæœŸå®Ÿè¡Œ
});
</script>