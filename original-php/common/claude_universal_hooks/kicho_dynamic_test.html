<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_approval_required Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_limit Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… development_control Hook loaded');
</script>
<script>
// CAIDS error_handling Hook

// CAIDS ã‚¨ãƒ©ãƒ¼å‡¦ç†Hook - å®Œå…¨å®Ÿè£…
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('âš ï¸ CAIDS ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åˆæœŸåŒ–');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('ğŸš¨ CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">ğŸš¨</span>
                <div>
                    <strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»é€ä¿¡ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('ğŸ“‹ CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<!-- ğŸ§ª kichoå‹•çš„åŒ–ãƒ†ã‚¹ãƒˆç”¨HTML -->
<!-- æ—¢å­˜ã®kicho_content.phpã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãƒ†ã‚¹ãƒˆ -->

<div class="kicho-dynamic-test-panel" style="margin: 20px; padding: 20px; border: 2px solid #007cba; border-radius: 8px; background: #f0f8ff;">
    <h3>ğŸ§ª å‹•çš„åŒ–ãƒ†ã‚¹ãƒˆãƒ‘ãƒãƒ«</h3>
    <p>æ—¢å­˜ã®data-actionå¯¾å¿œç¢ºèªã¨Ajaxé€šä¿¡ãƒ†ã‚¹ãƒˆ</p>
    
    <!-- æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h4>âœ… æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h4>
        
        <!-- Modalç³»ï¼ˆæ—¢å­˜å¯¾å¿œæ¸ˆã¿ï¼‰ -->
        <button type="button" data-modal-open="test-modal" class="btn btn-primary">
            ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜å¯¾å¿œï¼‰
        </button>
        
        <!-- Ajaxç³»ï¼ˆè¦ç¢ºèªï¼‰ -->
        <button type="button" data-action="health_check" data-page="kicho_content" class="btn btn-success">
            ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆAjaxï¼‰
        </button>
        
        <button type="button" data-action="get_statistics" data-page="kicho_content" class="btn btn-info">
            çµ±è¨ˆå–å¾—ï¼ˆAjaxï¼‰
        </button>
        
        <button type="button" data-action="refresh-all" data-page="kicho_content" class="btn btn-warning">
            å…¨ä½“æ›´æ–°ï¼ˆAjaxï¼‰
        </button>
    </div>
    
    <!-- è¿½åŠ å‹•çš„åŒ–ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ccc;">
        <h4>ğŸš€ è¿½åŠ å‹•çš„åŒ–ãƒ†ã‚¹ãƒˆ</h4>
        
        <button type="button" data-action="add-entry" data-page="kicho_content" class="btn btn-primary">
            ğŸ“ æ–°è¦ã‚¨ãƒ³ãƒˆãƒªè¿½åŠ 
        </button>
        
        <button type="button" data-action="calculate-totals" data-page="kicho_content" class="btn btn-secondary">
            ğŸ§® åˆè¨ˆå†è¨ˆç®—
        </button>
        
        <button type="button" data-action="export-data" data-page="kicho_content" class="btn btn-success">
            ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        </button>
    </div>
</div>

<!-- ãƒ†ã‚¹ãƒˆç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="test-modal" class="kicho__modal" style="display: none;">
    <div class="kicho__modal-content">
        <h4>ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«</h4>
        <p>æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒå‹•ä½œã—ã¦ã„ã¾ã™ï¼</p>
        <button type="button" data-modal-close class="btn btn-secondary">é–‰ã˜ã‚‹</button>
    </div>
</div>

<!-- ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="test-results" style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 4px;">
    <h4>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h4>
    <div id="test-log">
        <p>ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰ã§ãƒ†ã‚¹ãƒˆçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
    </div>
</div>

<style>
.kicho-dynamic-test-panel {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.test-section {
    margin: 15px 0;
}

.btn {
    display: inline-block;
    padding: 8px 16px;
    margin: 5px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
}

.btn-primary { background: #007cba; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-info { background: #17a2b8; color: white; }
.btn-warning { background: #ffc107; color: black; }
.btn-secondary { background: #6c757d; color: white; }

.btn:hover {
    opacity: 0.8;
    transform: translateY(-1px);
}

.kicho__modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.kicho__modal-content {
    background: white;
    padding: 30px;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
}
</style>

<script>
// ãƒ†ã‚¹ãƒˆç”¨JavaScriptï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºç¢ºèªï¼‰
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ§ª å‹•çš„åŒ–ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
    
    // data-action ã‚¯ãƒªãƒƒã‚¯ç›£è¦–
    document.addEventListener('click', function(e) {
        const target = e.target.closest('[data-action]');
        if (target) {
            const action = target.getAttribute('data-action');
            const page = target.getAttribute('data-page');
            
            console.log(`ğŸ”„ data-actionæ¤œå‡º: ${action} (page: ${page})`);
            
            // æ—¢å­˜ã®kicho.jsãŒå‡¦ç†ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (window.NAGANO3_KICHO && window.NAGANO3_KICHO.initialized) {
                console.log('âœ… æ—¢å­˜KICHOã‚·ã‚¹ãƒ†ãƒ å‹•ä½œä¸­');
            } else {
                console.log('âš ï¸ æ—¢å­˜KICHOã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–');
            }
        }
    });
});
</script>
