<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ API ãƒ‡ãƒãƒƒã‚°</title>
</head>
<body>
    <h1>ğŸ”§ HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ API ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div>
        <h3>Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
        <button onclick="testDatabaseConnection()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª</button>
        <div id="dbResult"></div>
    </div>
    
    <div style="margin-top: 2rem;">
        <h3>Step 2: HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ãƒ†ã‚¹ãƒˆ</h3>
        <button onclick="testHTMLTemplateSave()">ğŸ’¾ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
        <div id="saveResult"></div>
    </div>
    
    <div style="margin-top: 2rem;">
        <h3>Step 3: ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°è¡¨ç¤º</h3>
        <pre id="detailedResponse" style="background: #f5f5f5; padding: 1rem; border-radius: 4px;"></pre>
    </div>

    <script>
        async function testDatabaseConnection() {
            const resultDiv = document.getElementById('dbResult');
            resultDiv.innerHTML = 'â³ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...';
            
            try {
                const response = await fetch('yahoo_auction_content.php?action=get_dashboard_stats');
                const result = await response.json();
                
                resultDiv.innerHTML = `
                    <div style="padding: 1rem; border: 1px solid #ccc; border-radius: 4px; margin-top: 0.5rem;">
                        <strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š:</strong> ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}<br>
                        <strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${result.message || 'ãªã—'}<br>
                        <strong>ãƒ‡ãƒ¼ã‚¿:</strong> ${JSON.stringify(result.data || {}, null, 2)}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function testHTMLTemplateSave() {
            const resultDiv = document.getElementById('saveResult');
            const detailedDiv = document.getElementById('detailedResponse');
            
            resultDiv.innerHTML = 'â³ HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ãƒ†ã‚¹ãƒˆä¸­...';
            
            const testData = {
                action: 'save_html_template',
                template_data: {
                    name: 'debug_test_template_' + Date.now(),
                    category: 'general',
                    description: 'ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ',
                    html_content: '<h1>{{TITLE}}</h1><p>ä¾¡æ ¼: ${{PRICE}}</p>',
                    created_by: 'debug_test'
                }
            };
            
            try {
                console.log('ğŸš€ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', testData);
                
                const response = await fetch('yahoo_auction_content.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(testData)
                });
                
                console.log('ğŸ“¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹:', response.status, response.statusText);
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦å–å¾—ã—ã¦ãƒ­ã‚°å‡ºåŠ›
                const responseText = await response.text();
                console.log('ğŸ“„ ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹:', responseText);
                
                detailedDiv.textContent = `ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆ:\n${responseText}`;
                
                // JSONãƒ‘ãƒ¼ã‚¹è©¦è¡Œ
                try {
                    const result = JSON.parse(responseText);
                    console.log('âœ… JSONãƒ‘ãƒ¼ã‚¹æˆåŠŸ:', result);
                    
                    resultDiv.innerHTML = `
                        <div style="padding: 1rem; border: 1px solid #ccc; border-radius: 4px; margin-top: 0.5rem;">
                            <strong>ä¿å­˜çµæœ:</strong> ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}<br>
                            <strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${result.message || 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã—'}<br>
                            <strong>ãƒ‡ãƒ¼ã‚¿:</strong> ${JSON.stringify(result.data || {}, null, 2)}
                        </div>
                    `;
                } catch (jsonError) {
                    console.error('âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', jsonError);
                    resultDiv.innerHTML = `<div style="color: red;">âŒ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${jsonError.message}</div>`;
                }
                
            } catch (error) {
                console.error('âŒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.innerHTML = `<div style="color: red;">âŒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        console.log('ğŸ”§ HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
    </script>
</body>
</html>