<!-- 🎯 既存タブナビゲーションに追加する新機能タブボタン -->
<!-- yahoo_auction_tool_content.php の既存タブナビゲーション部分に追加 -->

<!-- 既存のタブボタンの後に追加 -->
<button class="tab-btn" data-tab="html-templates" onclick="switchTab('html-templates')">
    <i class="fas fa-code"></i>
    HTMLテンプレート
</button>

<button class="tab-btn" data-tab="csv-manual" onclick="switchTab('csv-manual')">
    <i class="fas fa-book"></i>
    CSVマニュアル
</button>

<button class="tab-btn" data-tab="csv-management" onclick="switchTab('csv-management')">
    <i class="fas fa-file-csv"></i>
    CSV管理
</button>

<!-- 🔧 CSS外部ファイル読み込み（head内に追加） -->
<link rel="stylesheet" href="css/yahoo_auction_tool_complete.css">

<!-- 🔧 JavaScript外部ファイル読み込み（body終了前に追加） -->
<script src="js/html_template_manager.js"></script>

<style>
/* 新規タブボタンの追加スタイル（既存スタイルと統合） */
.tab-btn[data-tab="html-templates"],
.tab-btn[data-tab="csv-manual"],
.tab-btn[data-tab="csv-management"] {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    position: relative;
    overflow: hidden;
}

.tab-btn[data-tab="html-templates"]:before,
.tab-btn[data-tab="csv-manual"]:before,
.tab-btn[data-tab="csv-management"]:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.tab-btn[data-tab="html-templates"]:hover:before,
.tab-btn[data-tab="csv-manual"]:hover:before,
.tab-btn[data-tab="csv-management"]:hover:before {
    left: 100%;
}

.tab-btn[data-tab="html-templates"].active,
.tab-btn[data-tab="csv-manual"].active,
.tab-btn[data-tab="csv-management"].active {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
}

/* 新機能ラベル */
.tab-btn[data-tab="html-templates"]:after {
    content: 'NEW';
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    font-size: 8px;
    padding: 2px 4px;
    border-radius: 8px;
    font-weight: bold;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .tab-btn[data-tab="html-templates"],
    .tab-btn[data-tab="csv-manual"],
    .tab-btn[data-tab="csv-management"] {
        min-width: 120px;
        font-size: 0.75rem;
    }
    
    .tab-btn i {
        display: block;
        margin-bottom: 2px;
    }
}
</style>

<script>
// 新規タブ対応のswitchTab関数拡張
function switchTabExtended(targetTab) {
    console.log('タブ切り替え:', targetTab);
    
    // 既存のswitchTab機能を維持
    if (typeof switchTab === 'function') {
        switchTab(targetTab);
    }
    
    // 新規タブの特別処理
    switch(targetTab) {
        case 'html-templates':
            // HTMLテンプレート管理タブ初期化
            if (window.htmlTemplateManager) {
                console.log('HTMLテンプレート管理システム準備完了');
            }
            break;
            
        case 'csv-manual':
            // 動的マニュアル初期化
            if (window.dynamicManualGenerator) {
                window.dynamicManualGenerator.loadFieldDocumentation();
            }
            break;
            
        case 'csv-management':
            // CSV管理システム初期化
            loadCSVManagementData();
            break;
    }
}

// CSV管理データ読み込み
function loadCSVManagementData() {
    fetch('database_csv_handler_ebay_complete_v2.php?action=get_csv_structure')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('CSV構造データ読み込み完了:', data.data);
                updateCSVStats(data.data);
            }
        })
        .catch(error => {
            console.error('CSV管理データ読み込みエラー:', error);
        });
}

// CSV統計更新
function updateCSVStats(csvStructure) {
    const totalFields = Object.keys(csvStructure).length;
    const requiredFields = Object.values(csvStructure).filter(field => field.required).length;
    const optionalFields = totalFields - requiredFields;
    
    // 統計表示更新
    const totalFieldsElement = document.getElementById('totalFields');
    const requiredFieldsElement = document.getElementById('requiredFields');
    const optionalFieldsElement = document.getElementById('optionalFields');
    
    if (totalFieldsElement) totalFieldsElement.textContent = totalFields;
    if (requiredFieldsElement) requiredFieldsElement.textContent = requiredFields;
    if (optionalFieldsElement) optionalFieldsElement.textContent = optionalFields;
}

// 新規タブコンテンツの動的読み込み
function loadTabContent(tabId) {
    const tabContent = document.getElementById(tabId);
    
    if (tabContent && !tabContent.dataset.loaded) {
        switch(tabId) {
            case 'html-templates':
                fetch('html/html_template_management_tab.html')
                    .then(response => response.text())
                    .then(html => {
                        tabContent.innerHTML = html;
                        tabContent.dataset.loaded = 'true';
                        console.log('HTMLテンプレート管理タブ読み込み完了');
                    })
                    .catch(error => {
                        console.error('HTMLテンプレート管理タブ読み込みエラー:', error);
                        tabContent.innerHTML = '<div class="error">タブの読み込みに失敗しました</div>';
                    });
                break;
                
            case 'csv-manual':
                fetch('html/dynamic_manual_tab.html')
                    .then(response => response.text())
                    .then(html => {
                        tabContent.innerHTML = html;
                        tabContent.dataset.loaded = 'true';
                        console.log('動的マニュアルタブ読み込み完了');
                    })
                    .catch(error => {
                        console.error('動的マニュアルタブ読み込みエラー:', error);
                        tabContent.innerHTML = '<div class="error">タブの読み込みに失敗しました</div>';
                    });
                break;
        }
    }
}

// システム統合確認
function checkSystemIntegration() {
    const checks = [
        { name: 'HTML Template Manager', check: () => window.htmlTemplateManager },
        { name: 'Dynamic Manual Generator', check: () => window.dynamicManualGenerator },
        { name: 'CSS Complete', check: () => document.querySelector('link[href*="yahoo_auction_tool_complete.css"]') },
        { name: 'Database Handler', check: () => checkDatabaseHandler() }
    ];
    
    const results = checks.map(item => ({
        name: item.name,
        status: item.check() ? '✅' : '❌'
    }));
    
    console.table(results);
    return results;
}

// データベースハンドラー確認
function checkDatabaseHandler() {
    return fetch('database_csv_handler_ebay_complete_v2.php?action=health_check')
        .then(response => response.json())
        .then(data => data.success)
        .catch(() => false);
}

// 通知システム
function showSystemNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `system-notification system-notification--${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">×</button>
    `;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        max-width: 400px;
        animation: slideInRight 0.3s ease-out;
    `;
    
    document.body.appendChild(notification);
    
    // 5秒後に自動削除
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

// アニメーション追加
const animationStyles = document.createElement('style');
animationStyles.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(animationStyles);

// システム初期化確認
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const integrationResults = checkSystemIntegration();
        const successCount = integrationResults.filter(r => r.status === '✅').length;
        
        if (successCount === integrationResults.length) {
            showSystemNotification('🎉 Yahoo Auction Tool 完全版システム初期化完了！', 'success');
        } else {
            showSystemNotification(`⚠️ システム初期化: ${successCount}/${integrationResults.length} 完了`, 'warning');
        }
    }, 2000);
});

console.log('🚀 Yahoo Auction Tool 拡張システム統合完了');
</script>