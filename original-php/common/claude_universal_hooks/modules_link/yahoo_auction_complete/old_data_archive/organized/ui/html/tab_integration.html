<!-- ğŸ¯ æ—¢å­˜ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã™ã‚‹æ–°æ©Ÿèƒ½ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
<!-- yahoo_auction_tool_content.php ã®æ—¢å­˜ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³éƒ¨åˆ†ã«è¿½åŠ  -->

<!-- æ—¢å­˜ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®å¾Œã«è¿½åŠ  -->
<button class="tab-btn" data-tab="html-templates" onclick="switchTab('html-templates')">
    <i class="fas fa-code"></i>
    HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
</button>

<button class="tab-btn" data-tab="csv-manual" onclick="switchTab('csv-manual')">
    <i class="fas fa-book"></i>
    CSVãƒãƒ‹ãƒ¥ã‚¢ãƒ«
</button>

<button class="tab-btn" data-tab="csv-management" onclick="switchTab('csv-management')">
    <i class="fas fa-file-csv"></i>
    CSVç®¡ç†
</button>

<!-- ğŸ”§ CSSå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆheadå†…ã«è¿½åŠ ï¼‰ -->
<link rel="stylesheet" href="css/yahoo_auction_tool_complete.css">

<!-- ğŸ”§ JavaScriptå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆbodyçµ‚äº†å‰ã«è¿½åŠ ï¼‰ -->
<script src="js/html_template_manager.js"></script>

<style>
/* æ–°è¦ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ã¨çµ±åˆï¼‰ */
.tab-btn[data-tab="html-templates"],
.tab-btn[data-tab="csv-manual"],
.tab-btn[data-tab="csv-management"] {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    position: relative;
    overflow: hidden;
}

.tab-btn[data-tab="html-templates"]:before,
.tab-btn[data-tab="csv-manual"]:before,
.tab-btn[data-tab="csv-management"]:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.tab-btn[data-tab="html-templates"]:hover:before,
.tab-btn[data-tab="csv-manual"]:hover:before,
.tab-btn[data-tab="csv-management"]:hover:before {
    left: 100%;
}

.tab-btn[data-tab="html-templates"].active,
.tab-btn[data-tab="csv-manual"].active,
.tab-btn[data-tab="csv-management"].active {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
}

/* æ–°æ©Ÿèƒ½ãƒ©ãƒ™ãƒ« */
.tab-btn[data-tab="html-templates"]:after {
    content: 'NEW';
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    font-size: 8px;
    padding: 2px 4px;
    border-radius: 8px;
    font-weight: bold;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .tab-btn[data-tab="html-templates"],
    .tab-btn[data-tab="csv-manual"],
    .tab-btn[data-tab="csv-management"] {
        min-width: 120px;
        font-size: 0.75rem;
    }
    
    .tab-btn i {
        display: block;
        margin-bottom: 2px;
    }
}
</style>

<script>
// æ–°è¦ã‚¿ãƒ–å¯¾å¿œã®switchTabé–¢æ•°æ‹¡å¼µ
function switchTabExtended(targetTab) {
    console.log('ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ:', targetTab);
    
    // æ—¢å­˜ã®switchTabæ©Ÿèƒ½ã‚’ç¶­æŒ
    if (typeof switchTab === 'function') {
        switchTab(targetTab);
    }
    
    // æ–°è¦ã‚¿ãƒ–ã®ç‰¹åˆ¥å‡¦ç†
    switch(targetTab) {
        case 'html-templates':
            // HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚¿ãƒ–åˆæœŸåŒ–
            if (window.htmlTemplateManager) {
                console.log('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
            }
            break;
            
        case 'csv-manual':
            // å‹•çš„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«åˆæœŸåŒ–
            if (window.dynamicManualGenerator) {
                window.dynamicManualGenerator.loadFieldDocumentation();
            }
            break;
            
        case 'csv-management':
            // CSVç®¡ç†ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            loadCSVManagementData();
            break;
    }
}

// CSVç®¡ç†ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
function loadCSVManagementData() {
    fetch('database_csv_handler_ebay_complete_v2.php?action=get_csv_structure')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('CSVæ§‹é€ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', data.data);
                updateCSVStats(data.data);
            }
        })
        .catch(error => {
            console.error('CSVç®¡ç†ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        });
}

// CSVçµ±è¨ˆæ›´æ–°
function updateCSVStats(csvStructure) {
    const totalFields = Object.keys(csvStructure).length;
    const requiredFields = Object.values(csvStructure).filter(field => field.required).length;
    const optionalFields = totalFields - requiredFields;
    
    // çµ±è¨ˆè¡¨ç¤ºæ›´æ–°
    const totalFieldsElement = document.getElementById('totalFields');
    const requiredFieldsElement = document.getElementById('requiredFields');
    const optionalFieldsElement = document.getElementById('optionalFields');
    
    if (totalFieldsElement) totalFieldsElement.textContent = totalFields;
    if (requiredFieldsElement) requiredFieldsElement.textContent = requiredFields;
    if (optionalFieldsElement) optionalFieldsElement.textContent = optionalFields;
}

// æ–°è¦ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å‹•çš„èª­ã¿è¾¼ã¿
function loadTabContent(tabId) {
    const tabContent = document.getElementById(tabId);
    
    if (tabContent && !tabContent.dataset.loaded) {
        switch(tabId) {
            case 'html-templates':
                fetch('html/html_template_management_tab.html')
                    .then(response => response.text())
                    .then(html => {
                        tabContent.innerHTML = html;
                        tabContent.dataset.loaded = 'true';
                        console.log('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚¿ãƒ–èª­ã¿è¾¼ã¿å®Œäº†');
                    })
                    .catch(error => {
                        console.error('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚¿ãƒ–èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                        tabContent.innerHTML = '<div class="error">ã‚¿ãƒ–ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                    });
                break;
                
            case 'csv-manual':
                fetch('html/dynamic_manual_tab.html')
                    .then(response => response.text())
                    .then(html => {
                        tabContent.innerHTML = html;
                        tabContent.dataset.loaded = 'true';
                        console.log('å‹•çš„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚¿ãƒ–èª­ã¿è¾¼ã¿å®Œäº†');
                    })
                    .catch(error => {
                        console.error('å‹•çš„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚¿ãƒ–èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                        tabContent.innerHTML = '<div class="error">ã‚¿ãƒ–ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                    });
                break;
        }
    }
}

// ã‚·ã‚¹ãƒ†ãƒ çµ±åˆç¢ºèª
function checkSystemIntegration() {
    const checks = [
        { name: 'HTML Template Manager', check: () => window.htmlTemplateManager },
        { name: 'Dynamic Manual Generator', check: () => window.dynamicManualGenerator },
        { name: 'CSS Complete', check: () => document.querySelector('link[href*="yahoo_auction_tool_complete.css"]') },
        { name: 'Database Handler', check: () => checkDatabaseHandler() }
    ];
    
    const results = checks.map(item => ({
        name: item.name,
        status: item.check() ? 'âœ…' : 'âŒ'
    }));
    
    console.table(results);
    return results;
}

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèª
function checkDatabaseHandler() {
    return fetch('database_csv_handler_ebay_complete_v2.php?action=health_check')
        .then(response => response.json())
        .then(data => data.success)
        .catch(() => false);
}

// é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
function showSystemNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `system-notification system-notification--${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">Ã—</button>
    `;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        max-width: 400px;
        animation: slideInRight 0.3s ease-out;
    `;
    
    document.body.appendChild(notification);
    
    // 5ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
const animationStyles = document.createElement('style');
animationStyles.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(animationStyles);

// ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ç¢ºèª
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const integrationResults = checkSystemIntegration();
        const successCount = integrationResults.filter(r => r.status === 'âœ…').length;
        
        if (successCount === integrationResults.length) {
            showSystemNotification('ğŸ‰ Yahoo Auction Tool å®Œå…¨ç‰ˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†ï¼', 'success');
        } else {
            showSystemNotification(`âš ï¸ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–: ${successCount}/${integrationResults.length} å®Œäº†`, 'warning');
        }
    }, 2000);
});

console.log('ğŸš€ Yahoo Auction Tool æ‹¡å¼µã‚·ã‚¹ãƒ†ãƒ çµ±åˆå®Œäº†');
</script>