<!-- ğŸ¨ HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚¿ãƒ– - æ–°è¦è¿½åŠ  -->
<!-- æ—¢å­˜ã‚¿ãƒ–ã«è¿½åŠ ã™ã‚‹æ–°ã—ã„ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->

<div id="html-templates" class="tab-content fade-in">
    <div class="html-template-management">
        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="section-header">
            <div class="section-title">
                <i class="fas fa-code"></i>
                HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
            </div>
            <div class="section-actions">
                <button class="btn btn--primary" onclick="saveCurrentTemplate()">
                    <i class="fas fa-save"></i> ä¿å­˜
                </button>
                <button class="btn btn--secondary" onclick="exportTemplate()">
                    <i class="fas fa-download"></i> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="btn btn--success" onclick="importTemplate()">
                    <i class="fas fa-upload"></i> ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                </button>
            </div>
        </div>

        <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠã‚¨ãƒªã‚¢ -->
        <div class="template-selector">
            <h3>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ</h3>
            <div class="template-cards">
                <div class="template-card active" data-template="premium">
                    <div class="template-preview">
                        <div style="padding: 10px; font-size: 12px; line-height: 1.4;">
                            <div style="font-weight: bold; margin-bottom: 5px;">{{TITLE}}</div>
                            <div style="background: #f0f0f0; height: 30px; margin-bottom: 5px;"></div>
                            <div style="font-size: 10px; color: #666;">{{DESCRIPTION}}</div>
                        </div>
                    </div>
                    <h4>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                    <p>é«˜ç´šå•†å“å‘ã‘ãƒ»ç”»åƒå¤§ãƒ»è©³ç´°æƒ…å ±</p>
                </div>
                
                <div class="template-card" data-template="standard">
                    <div class="template-preview">
                        <div style="padding: 10px; font-size: 12px; line-height: 1.4;">
                            <div style="font-weight: bold; margin-bottom: 5px;">{{TITLE}}</div>
                            <div style="display: flex; gap: 5px;">
                                <div style="background: #f0f0f0; width: 40px; height: 30px;"></div>
                                <div style="flex: 1; font-size: 10px;">{{DESCRIPTION}}</div>
                            </div>
                        </div>
                    </div>
                    <h4>ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                    <p>ä¸€èˆ¬å•†å“å‘ã‘ãƒ»ãƒãƒ©ãƒ³ã‚¹é‡è¦–</p>
                </div>
                
                <div class="template-card" data-template="minimal">
                    <div class="template-preview">
                        <div style="padding: 10px; font-size: 12px; line-height: 1.4;">
                            <div style="font-weight: bold; margin-bottom: 3px;">{{TITLE}}</div>
                            <div style="font-size: 10px; color: #666;">{{PRICE}}</div>
                            <div style="background: #f0f0f0; height: 20px; margin: 3px 0;"></div>
                        </div>
                    </div>
                    <h4>ãƒŸãƒ‹ãƒãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                    <p>ã‚·ãƒ³ãƒ—ãƒ«ãƒ»é«˜é€Ÿèª­ã¿è¾¼ã¿</p>
                </div>
            </div>
        </div>

        <!-- HTMLç·¨é›†ã‚¨ãƒªã‚¢ -->
        <div class="html-editor-section">
            <div class="editor-container">
                <div class="editor-toolbar">
                    <button onclick="insertVariable('{{TITLE}}')">
                        <i class="fas fa-tag"></i> ã‚¿ã‚¤ãƒˆãƒ«
                    </button>
                    <button onclick="insertVariable('{{BRAND}}')">
                        <i class="fas fa-certificate"></i> ãƒ–ãƒ©ãƒ³ãƒ‰
                    </button>
                    <button onclick="insertVariable('{{PRICE}}')">
                        <i class="fas fa-dollar-sign"></i> ä¾¡æ ¼
                    </button>
                    <button onclick="insertVariable('{{CONDITION}}')">
                        <i class="fas fa-star"></i> çŠ¶æ…‹
                    </button>
                    <button onclick="insertVariable('{{DESCRIPTION}}')">
                        <i class="fas fa-align-left"></i> èª¬æ˜
                    </button>
                    <button onclick="insertVariable('{{IMAGES}}')">
                        <i class="fas fa-images"></i> ç”»åƒ
                    </button>
                    <button onclick="insertVariable('{{SPECIFICATIONS}}')">
                        <i class="fas fa-list"></i> ã‚¹ãƒšãƒƒã‚¯
                    </button>
                    <button onclick="insertVariable('{{SHIPPING_INFO}}')">
                        <i class="fas fa-truck"></i> é…é€
                    </button>
                    <button onclick="insertVariable('{{RETURN_POLICY}}')">
                        <i class="fas fa-undo"></i> è¿”å“
                    </button>
                    <button onclick="insertVariable('{{SELLER_INFO}}')">
                        <i class="fas fa-user"></i> è²©å£²è€…
                    </button>
                </div>
                <textarea id="htmlEditor" class="html-editor" placeholder="HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...

åˆ©ç”¨å¯èƒ½ãªå¤‰æ•°:
{{TITLE}} - å•†å“ã‚¿ã‚¤ãƒˆãƒ«
{{BRAND}} - ãƒ–ãƒ©ãƒ³ãƒ‰å
{{PRICE}} - ä¾¡æ ¼
{{CONDITION}} - å•†å“çŠ¶æ…‹
{{DESCRIPTION}} - å•†å“èª¬æ˜
{{IMAGES}} - ç”»åƒä¸€è¦§
{{SPECIFICATIONS}} - ã‚¹ãƒšãƒƒã‚¯è¡¨
{{SHIPPING_INFO}} - é…é€æƒ…å ±
{{RETURN_POLICY}} - è¿”å“ãƒãƒªã‚·ãƒ¼
{{SELLER_INFO}} - è²©å£²è€…æƒ…å ±

ä¾‹:
<div class='product-listing'>
    <h1>{{TITLE}}</h1>
    <div class='price'>{{PRICE}}</div>
    <div class='images'>{{IMAGES}}</div>
    <div class='description'>{{DESCRIPTION}}</div>
</div>"></textarea>
            </div>

            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="preview-section">
                <div class="preview-controls">
                    <button onclick="updatePreview()">
                        <i class="fas fa-sync"></i> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                    </button>
                    <select id="previewDevice" onchange="changePreviewDevice(this.value)">
                        <option value="desktop">ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—</option>
                        <option value="mobile">ãƒ¢ãƒã‚¤ãƒ«</option>
                        <option value="tablet">ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ</option>
                    </select>
                </div>
                <iframe id="previewFrame" class="html-preview"></iframe>
            </div>
        </div>

        <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† -->
        <div class="template-management">
            <div class="section-header">
                <h3>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</h3>
                <button class="btn btn--primary" onclick="showNewTemplateModal()">
                    <i class="fas fa-plus"></i> æ–°è¦ä½œæˆ
                </button>
            </div>
            
            <div class="template-list">
                <div class="template-item">
                    <div class="template-info">
                        <h4>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                        <p>é«˜ç´šå•†å“å‘ã‘ãƒ»è©³ç´°æƒ…å ±è¡¨ç¤º</p>
                        <small>ä½œæˆæ—¥: 2025-09-11 | ä½¿ç”¨å›æ•°: 127å›</small>
                    </div>
                    <div class="template-actions">
                        <button class="btn btn--sm btn--secondary" onclick="editTemplate('premium')">
                            <i class="fas fa-edit"></i> ç·¨é›†
                        </button>
                        <button class="btn btn--sm btn--warning" onclick="duplicateTemplate('premium')">
                            <i class="fas fa-copy"></i> è¤‡è£½
                        </button>
                        <button class="btn btn--sm btn--danger" onclick="deleteTemplate('premium')">
                            <i class="fas fa-trash"></i> å‰Šé™¤
                        </button>
                    </div>
                </div>
                
                <div class="template-item">
                    <div class="template-info">
                        <h4>ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                        <p>ä¸€èˆ¬å•†å“å‘ã‘ãƒ»ãƒãƒ©ãƒ³ã‚¹é‡è¦–</p>
                        <small>ä½œæˆæ—¥: 2025-09-11 | ä½¿ç”¨å›æ•°: 89å›</small>
                    </div>
                    <div class="template-actions">
                        <button class="btn btn--sm btn--secondary" onclick="editTemplate('standard')">
                            <i class="fas fa-edit"></i> ç·¨é›†
                        </button>
                        <button class="btn btn--sm btn--warning" onclick="duplicateTemplate('standard')">
                            <i class="fas fa-copy"></i> è¤‡è£½
                        </button>
                        <button class="btn btn--sm btn--danger" onclick="deleteTemplate('standard')">
                            <i class="fas fa-trash"></i> å‰Šé™¤
                        </button>
                    </div>
                </div>
                
                <div class="template-item">
                    <div class="template-info">
                        <h4>ãƒŸãƒ‹ãƒãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h4>
                        <p>ã‚·ãƒ³ãƒ—ãƒ«ãƒ»é«˜é€Ÿèª­ã¿è¾¼ã¿</p>
                        <small>ä½œæˆæ—¥: 2025-09-11 | ä½¿ç”¨å›æ•°: 45å›</small>
                    </div>
                    <div class="template-actions">
                        <button class="btn btn--sm btn--secondary" onclick="editTemplate('minimal')">
                            <i class="fas fa-edit"></i> ç·¨é›†
                        </button>
                        <button class="btn btn--sm btn--warning" onclick="duplicateTemplate('minimal')">
                            <i class="fas fa-copy"></i> è¤‡è£½
                        </button>
                        <button class="btn btn--sm btn--danger" onclick="deleteTemplate('minimal')">
                            <i class="fas fa-trash"></i> å‰Šé™¤
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="template-stats">
            <div class="section-header">
                <h3>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçµ±è¨ˆ</h3>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">3</div>
                    <div class="stat-label">ç·ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">261</div>
                    <div class="stat-label">ç·ä½¿ç”¨å›æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">premium</div>
                    <div class="stat-label">æœ€å¤šä½¿ç”¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">2.3åˆ†</div>
                    <div class="stat-label">å¹³å‡ç·¨é›†æ™‚é–“</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="newTemplateModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">
                <i class="fas fa-plus-circle"></i>
                æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
            </h2>
            <button class="modal-close" onclick="closeNewTemplateModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-section">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-tag"></i>
                        ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå <span class="required-mark">*</span>
                    </label>
                    <input type="text" class="form-input" id="newTemplateName" placeholder="ä¾‹: ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ " required>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-align-left"></i>
                        èª¬æ˜
                    </label>
                    <input type="text" class="form-input" id="newTemplateDescription" placeholder="ä¾‹: é«˜ç´šãƒ–ãƒ©ãƒ³ãƒ‰å•†å“å‘ã‘ã®è©³ç´°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-copy"></i>
                        ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                    </label>
                    <select class="form-select" id="baseTemplate">
                        <option value="">ç©ºã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é–‹å§‹</option>
                        <option value="premium">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼</option>
                        <option value="standard">ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼</option>
                        <option value="minimal">ãƒŸãƒ‹ãƒãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-palette"></i>
                        ã‚«ãƒ†ã‚´ãƒª
                    </label>
                    <select class="form-select" id="templateCategory">
                        <option value="general">ä¸€èˆ¬å•†å“</option>
                        <option value="luxury">é«˜ç´šå“</option>
                        <option value="electronics">é›»å­æ©Ÿå™¨</option>
                        <option value="fashion">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</option>
                        <option value="collectible">ã‚³ãƒ¬ã‚¯ã‚¿ãƒ–ãƒ«</option>
                        <option value="custom">ã‚«ã‚¹ã‚¿ãƒ </option>
                    </select>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <div class="modal-footer-left">
                <div class="notification notification--info">
                    <i class="fas fa-info-circle"></i>
                    <span>ä½œæˆå¾Œã€HTMLã‚¨ãƒ‡ã‚£ã‚¿ã§è©³ç´°ã‚’ç·¨é›†ã§ãã¾ã™</span>
                </div>
            </div>
            <div class="modal-footer-right">
                <button class="btn btn--secondary" onclick="closeNewTemplateModal()">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button class="btn btn--success" onclick="createNewTemplate()">
                    <i class="fas fa-plus"></i>
                    ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†é–¢æ•°
function showNewTemplateModal() {
    const modal = document.getElementById('newTemplateModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeNewTemplateModal() {
    const modal = document.getElementById('newTemplateModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

function createNewTemplate() {
    const name = document.getElementById('newTemplateName').value;
    const description = document.getElementById('newTemplateDescription').value;
    const baseTemplate = document.getElementById('baseTemplate').value;
    const category = document.getElementById('templateCategory').value;
    
    if (!name) {
        alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    // æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆå‡¦ç†
    const templateId = 'custom_' + Date.now();
    
    if (window.htmlTemplateManager) {
        let htmlContent = '';
        
        if (baseTemplate) {
            const baseTemplateData = window.htmlTemplateManager.templates.get(baseTemplate);
            htmlContent = baseTemplateData ? baseTemplateData.html : '';
        }
        
        window.htmlTemplateManager.saveTemplate(templateId, name, description, htmlContent);
        window.htmlTemplateManager.selectTemplate(templateId);
    }
    
    closeNewTemplateModal();
    
    // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('newTemplateName').value = '';
    document.getElementById('newTemplateDescription').value = '';
    document.getElementById('baseTemplate').value = '';
    document.getElementById('templateCategory').value = 'general';
}

function editTemplate(templateId) {
    if (window.htmlTemplateManager) {
        window.htmlTemplateManager.selectTemplate(templateId);
    }
    console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†:', templateId);
}

function duplicateTemplate(templateId) {
    if (window.htmlTemplateManager) {
        const template = window.htmlTemplateManager.templates.get(templateId);
        if (template) {
            const newId = templateId + '_copy_' + Date.now();
            const newName = template.name + ' (ã‚³ãƒ”ãƒ¼)';
            window.htmlTemplateManager.saveTemplate(newId, newName, template.description, template.html);
            console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¤‡è£½å®Œäº†:', newId);
        }
    }
}

function deleteTemplate(templateId) {
    if (window.htmlTemplateManager) {
        window.htmlTemplateManager.deleteTemplate(templateId);
    }
}

function saveCurrentTemplate() {
    const htmlEditor = document.getElementById('htmlEditor');
    if (!htmlEditor || !window.htmlTemplateManager) return;
    
    if (window.htmlTemplateManager.currentTemplate) {
        const template = window.htmlTemplateManager.templates.get(window.htmlTemplateManager.currentTemplate);
        if (template) {
            window.htmlTemplateManager.saveTemplate(
                window.htmlTemplateManager.currentTemplate,
                template.name,
                template.description,
                htmlEditor.value
            );
        }
    } else {
        alert('ä¿å­˜ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
    }
}

function exportTemplate() {
    if (!window.htmlTemplateManager || !window.htmlTemplateManager.currentTemplate) {
        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
    }
    
    const template = window.htmlTemplateManager.templates.get(window.htmlTemplateManager.currentTemplate);
    if (template) {
        const exportData = {
            name: template.name,
            description: template.description,
            html: template.html,
            exported_at: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `template_${window.htmlTemplateManager.currentTemplate}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
    }
}

function importTemplate() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const templateData = JSON.parse(event.target.result);
                const templateId = 'imported_' + Date.now();
                
                if (window.htmlTemplateManager) {
                    window.htmlTemplateManager.saveTemplate(
                        templateId,
                        templateData.name + ' (ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)',
                        templateData.description,
                        templateData.html
                    );
                    console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†:', templateId);
                }
            } catch (error) {
                alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        };
        reader.readAsText(file);
    };
    
    input.click();
}

console.log('âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚¿ãƒ–åˆæœŸåŒ–å®Œäº†');
</script>