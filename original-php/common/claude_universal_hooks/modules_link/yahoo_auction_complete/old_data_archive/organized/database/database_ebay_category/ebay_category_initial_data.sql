-- eBay„Ç´„ÉÜ„Ç¥„É™„ÉºËá™ÂãïÂà§ÂÆö„Ç∑„Çπ„ÉÜ„É† ÂàùÊúü„Éá„Éº„ÇøÊäïÂÖ•
-- Âü∫Êú¨„Ç´„ÉÜ„Ç¥„É™„Éº„Éª„Ç≠„Éº„ÉØ„Éº„Éâ„Éû„ÉÉ„Éî„É≥„Ç∞„ÉªË®≠ÂÆö„Éá„Éº„Çø
-- ‰ΩúÊàêÊó•: 2025-09-14

-- üè∑Ô∏è ‰∏ªË¶ÅeBay„Ç´„ÉÜ„Ç¥„É™„ÉºÂàùÊúü„Éá„Éº„ÇøÔºà‰∫∫Ê∞ó‰∏ä‰Ωç50„Ç´„ÉÜ„Ç¥„É™„ÉºÔºâ
INSERT INTO ebay_categories_master (category_id, category_name, parent_id, marketplace_id, is_leaf, is_active, confidence_threshold) VALUES 

-- Electronics & Technology
('9355', 'Cell Phones & Smartphones', '15032', 0, TRUE, TRUE, 95),
('625', 'Cameras & Photo', '293', 0, TRUE, TRUE, 90),
('177', 'Computers/Tablets & Networking', '58058', 0, TRUE, TRUE, 88),
('293', 'Consumer Electronics', '293', 0, FALSE, TRUE, 85),
('171485', 'Video Games & Consoles', '1249', 0, TRUE, TRUE, 90),
('14111', 'Laptop & Desktop Accessories', '177', 0, TRUE, TRUE, 80),

-- Collectibles & Trading Cards
('2536', 'Trading Card Games', '1', 0, TRUE, TRUE, 92),
('220', 'Toys & Hobbies', '220', 0, FALSE, TRUE, 87),
('4', 'Computers, Tablets & Network Hardware', '58058', 0, TRUE, TRUE, 85),
('20081', 'Antiques', '20081', 0, FALSE, TRUE, 70),
('1', 'Collectibles', '1', 0, FALSE, TRUE, 75),
('11450', 'Coins & Paper Money', '11450', 0, FALSE, TRUE, 80),

-- Fashion & Accessories
('31387', 'Wristwatches', '281', 0, TRUE, TRUE, 85),
('169291', 'Women''s Bags & Handbags', '15687', 0, TRUE, TRUE, 89),
('95672', 'Athletic Shoes', '15709', 0, TRUE, TRUE, 91),
('15709', 'Shoes', '11450', 0, FALSE, TRUE, 85),
('1059', 'Jewelry & Watches', '281', 0, FALSE, TRUE, 82),
('281', 'Jewelry & Watches', '281', 0, FALSE, TRUE, 82),

-- Automotive
('6000', 'eBay Motors', '6000', 0, FALSE, TRUE, 78),
('31521', 'Car & Truck Parts', '6030', 0, TRUE, TRUE, 83),
('10063', 'Motorcycle Parts', '10063', 0, TRUE, TRUE, 80),
('33700', 'Car Electronics', '6030', 0, TRUE, TRUE, 85),

-- Home & Garden
('11700', 'Home & Garden', '11700', 0, FALSE, TRUE, 75),
('20518', 'Kitchen, Dining & Bar', '11700', 0, TRUE, TRUE, 80),
('153135', 'Home D√©cor', '11700', 0, TRUE, TRUE, 77),
('159912', 'Furniture', '11700', 0, TRUE, TRUE, 78),

-- Sports & Outdoors
('888', 'Sporting Goods', '888', 0, FALSE, TRUE, 80),
('1513', 'Golf', '888', 0, TRUE, TRUE, 85),
('26395', 'Outdoor Sports', '888', 0, TRUE, TRUE, 82),
('64482', 'Exercise & Fitness', '888', 0, TRUE, TRUE, 78),

-- Books, Music & Movies
('267', 'Books, Comics & Magazines', '267', 0, FALSE, TRUE, 88),
('11233', 'Music', '11233', 0, FALSE, TRUE, 85),
('11232', 'DVDs & Movies', '11232', 0, TRUE, TRUE, 87),
('1', 'Everything Else', '99999', 0, FALSE, TRUE, 30),

-- Health & Beauty
('26395', 'Health & Beauty', '26395', 0, FALSE, TRUE, 80),
('11358', 'Makeup', '26395', 0, TRUE, TRUE, 85),
('1355', 'Fragrances', '26395', 0, TRUE, TRUE, 82),

-- Tools & Industrial
('631', 'Crafts', '631', 0, FALSE, TRUE, 75),
('12576', 'Business & Industrial', '12576', 0, FALSE, TRUE, 70),
('469', 'Power Tools', '631', 0, TRUE, TRUE, 83),

-- Default/Other Categories
('99999', '„Åù„ÅÆ‰ªñ', NULL, 0, TRUE, TRUE, 30)

ON CONFLICT (category_id) DO UPDATE SET
    category_name = EXCLUDED.category_name,
    is_active = EXCLUDED.is_active,
    confidence_threshold = EXCLUDED.confidence_threshold,
    updated_at = NOW();

-- üì± ‰∏ªË¶Å„Ç´„ÉÜ„Ç¥„É™„Éº„ÅÆÂøÖÈ†àÈ†ÖÁõÆÂÆöÁæ©
INSERT INTO ebay_item_aspects (category_id, aspect_name, is_required, data_type, cardinality, entry_mode, allowed_values, default_value, confidence_score) VALUES 

-- Cell Phones & Smartphones (9355)
('9355', 'Brand', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Apple", "Samsung", "Google", "Sony", "Huawei", "Xiaomi", "OnePlus", "LG", "Motorola", "Other"]', 'Unknown', 95),
('9355', 'Model', TRUE, 'STRING', 'SINGLE', 'FREE_TEXT', NULL, 'Unknown', 90),
('9355', 'Storage Capacity', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["16GB", "32GB", "64GB", "128GB", "256GB", "512GB", "1TB"]', '64GB', 85),
('9355', 'Condition', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["New", "Like New", "Very Good", "Good", "Fair", "Poor"]', 'Used', 100),
('9355', 'Network', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Unlocked", "Verizon", "AT&T", "T-Mobile", "Sprint"]', 'Unlocked', 80),

-- Cameras & Photo (625)
('625', 'Brand', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Canon", "Nikon", "Sony", "Fujifilm", "Panasonic", "Olympus", "Pentax", "Leica", "Other"]', 'Unknown', 95),
('625', 'Type', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Digital Camera", "Film Camera", "Action Camera", "Lens", "Accessories"]', 'Digital Camera', 90),
('625', 'Resolution', FALSE, 'STRING', 'SINGLE', 'FREE_TEXT', NULL, 'Unknown', 75),
('625', 'Condition', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["New", "Like New", "Very Good", "Good", "Fair", "Poor"]', 'Used', 100),

-- Trading Card Games (2536)
('2536', 'Game', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Pok√©mon", "Magic: The Gathering", "Yu-Gi-Oh!", "Dragon Ball Super", "One Piece", "Other"]', 'Pok√©mon', 95),
('2536', 'Card Type', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Single", "Booster Pack", "Booster Box", "Deck", "Other"]', 'Single', 90),
('2536', 'Condition', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Mint", "Near Mint", "Lightly Played", "Moderately Played", "Heavily Played", "Damaged"]', 'Near Mint', 100),
('2536', 'Language', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["English", "Japanese", "Korean", "Chinese", "German", "French", "Spanish", "Other"]', 'English', 85),

-- Wristwatches (31387)
('31387', 'Brand', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Rolex", "Omega", "Seiko", "Casio", "Citizen", "TAG Heuer", "Breitling", "Tissot", "Other"]', 'Unknown', 95),
('31387', 'Movement', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Automatic", "Quartz", "Manual", "Digital", "Kinetic"]', 'Quartz', 80),
('31387', 'Case Material', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Stainless Steel", "Gold", "Silver", "Titanium", "Ceramic", "Plastic", "Other"]', 'Stainless Steel', 75),
('31387', 'Condition', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["New", "Like New", "Very Good", "Good", "Fair", "Poor"]', 'Used', 100),

-- Women's Bags & Handbags (169291)
('169291', 'Brand', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Louis Vuitton", "Chanel", "Gucci", "Herm√®s", "Prada", "Coach", "Michael Kors", "Kate Spade", "Other"]', 'Unknown', 95),
('169291', 'Material', FALSE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["Leather", "Canvas", "Nylon", "Suede", "Fabric", "Synthetic", "Other"]', 'Leather', 80),
('169291', 'Color', FALSE, 'STRING', 'SINGLE', 'FREE_TEXT', NULL, 'Brown', 70),
('169291', 'Condition', TRUE, 'STRING', 'SINGLE', 'SELECTION_ONLY', '["New", "Like New", "Very Good", "Good", "Fair", "Poor"]', 'Used', 100)

ON CONFLICT (category_id, aspect_name) DO UPDATE SET
    is_required = EXCLUDED.is_required,
    allowed_values = EXCLUDED.allowed_values,
    confidence_score = EXCLUDED.confidence_score;

-- üóæ Êó•Ëã±„Ç≠„Éº„ÉØ„Éº„Éâ„Éû„ÉÉ„Éî„É≥„Ç∞ÔºàÂü∫Êú¨„Çª„ÉÉ„ÉàÔºâ
INSERT INTO category_keyword_mapping (japanese_keyword, english_keywords, pattern_type, ebay_category_id, confidence_score, data_source) VALUES 

-- Electronics
('Êê∫Â∏ØÈõªË©±', '["smartphone", "cell phone", "mobile phone", "iPhone", "Android"]', 'partial', '9355', 95, 'manual'),
('„Çπ„Éû„Éõ', '["smartphone", "phone", "mobile", "iPhone", "Android"]', 'partial', '9355', 90, 'manual'),
('„Ç¢„Ç§„Éï„Ç©„É≥', '["iPhone", "Apple phone", "smartphone"]', 'partial', '9355', 98, 'manual'),
('„Ç¢„É≥„Éâ„É≠„Ç§„Éâ', '["Android", "smartphone", "mobile phone"]', 'partial', '9355', 95, 'manual'),

('„Ç´„É°„É©', '["camera", "digital camera", "photo", "photography"]', 'partial', '625', 90, 'manual'),
('„Éá„Ç∏„Ç´„É°', '["digital camera", "camera", "photo"]', 'partial', '625', 92, 'manual'),
('‰∏ÄÁúº„É¨„Éï', '["DSLR", "SLR", "camera", "Canon", "Nikon"]', 'partial', '625', 95, 'manual'),
('„É¨„É≥„Ç∫', '["lens", "camera lens", "photo lens"]', 'partial', '625', 88, 'manual'),

('„Éë„ÇΩ„Ç≥„É≥', '["computer", "PC", "laptop", "desktop"]', 'partial', '177', 88, 'manual'),
('„Éé„Éº„Éà„Éë„ÇΩ„Ç≥„É≥', '["laptop", "notebook", "computer"]', 'partial', '177', 90, 'manual'),
('MacBook', '["MacBook", "Apple laptop", "laptop"]', 'partial', '177', 95, 'manual'),

-- Gaming & Collectibles
('„Éù„Ç±„É¢„É≥„Ç´„Éº„Éâ', '["Pokemon card", "trading card", "Pok√©mon"]', 'partial', '2536', 95, 'manual'),
('ÈÅäÊàØÁéã', '["Yu-Gi-Oh", "trading card", "card game"]', 'partial', '2536', 93, 'manual'),
('„Éû„Ç∏„ÉÉ„ÇØ', '["Magic The Gathering", "MTG", "trading card"]', 'partial', '2536', 90, 'manual'),
('„Éà„É¨„Ç´', '["trading card", "card game", "collectible card"]', 'partial', '2536', 85, 'manual'),

('„Ç≤„Éº„É†', '["video game", "game", "console", "gaming"]', 'partial', '171485', 85, 'manual'),
('„Éó„É¨„Çπ„ÉÜ', '["PlayStation", "PS5", "PS4", "Sony"]', 'partial', '171485', 90, 'manual'),
('‰ªªÂ§©Â†Ç', '["Nintendo", "Switch", "gaming", "console"]', 'partial', '171485', 92, 'manual'),
('Xbox', '["Xbox", "Microsoft", "gaming", "console"]', 'partial', '171485', 90, 'manual'),

-- Fashion & Accessories
('ÊôÇË®à', '["watch", "wristwatch", "timepiece", "clock"]', 'partial', '31387', 85, 'manual'),
('ËÖïÊôÇË®à', '["wristwatch", "watch", "timepiece"]', 'partial', '31387', 90, 'manual'),
('„É≠„É¨„ÉÉ„ÇØ„Çπ', '["Rolex", "watch", "luxury watch"]', 'partial', '31387', 98, 'manual'),
('„Çª„Ç§„Ç≥„Éº', '["Seiko", "watch", "Japanese watch"]', 'partial', '31387', 95, 'manual'),
('„Ç´„Ç∑„Ç™', '["Casio", "watch", "G-Shock"]', 'partial', '31387', 93, 'manual'),

('„Éê„ÉÉ„Ç∞', '["bag", "handbag", "purse", "tote"]', 'partial', '169291', 80, 'manual'),
('„Éè„É≥„Éâ„Éê„ÉÉ„Ç∞', '["handbag", "bag", "purse", "tote"]', 'partial', '169291', 85, 'manual'),
('„É´„Ç§„É¥„Ç£„Éà„É≥', '["Louis Vuitton", "LV", "luxury bag", "designer bag"]', 'partial', '169291', 98, 'manual'),
('„Ç∑„É£„Éç„É´', '["Chanel", "luxury bag", "designer bag"]', 'partial', '169291', 98, 'manual'),
('„Ç∞„ÉÉ„ÉÅ', '["Gucci", "luxury bag", "designer bag"]', 'partial', '169291', 98, 'manual'),

('Èù¥', '["shoes", "footwear", "sneakers", "boots"]', 'partial', '95672', 80, 'manual'),
('„Çπ„Éã„Éº„Ç´„Éº', '["sneakers", "athletic shoes", "shoes"]', 'partial', '95672', 90, 'manual'),
('„Éä„Ç§„Ç≠', '["Nike", "sneakers", "athletic shoes"]', 'partial', '95672', 95, 'manual'),
('„Ç¢„Éá„Ç£„ÉÄ„Çπ', '["Adidas", "sneakers", "athletic shoes"]', 'partial', '95672', 95, 'manual'),

-- Automotive
('Ëªä', '["car", "vehicle", "automobile", "auto"]', 'partial', '6000', 70, 'manual'),
('Ëá™ÂãïËªä', '["automobile", "car", "vehicle"]', 'partial', '6000', 75, 'manual'),
('„Éê„Ç§„ÇØ', '["motorcycle", "bike", "motorbike"]', 'partial', '10063', 85, 'manual'),
('„Ç™„Éº„Éà„Éê„Ç§', '["motorcycle", "motorbike", "bike"]', 'partial', '10063', 88, 'manual'),

-- Books & Media
('Êú¨', '["book", "books", "publication"]', 'partial', '267', 80, 'manual'),
('„Éû„É≥„Ç¨', '["manga", "comic", "Japanese comic"]', 'partial', '267', 85, 'manual'),
('Â∞èË™¨', '["novel", "book", "fiction"]', 'partial', '267', 82, 'manual'),
('DVD', '["DVD", "movie", "film", "video"]', 'partial', '11232', 90, 'manual'),
('CD', '["CD", "music", "album", "disc"]', 'partial', '11233', 88, 'manual'),

-- Sports & Outdoors
('„Ç¥„É´„Éï', '["golf", "sport", "club", "golfing"]', 'partial', '1513', 90, 'manual'),
('Èá£„Çä', '["fishing", "angling", "rod", "reel"]', 'partial', '888', 85, 'manual'),
('„Çπ„Éù„Éº„ÉÑ', '["sport", "sports", "athletic", "fitness"]', 'partial', '888', 70, 'manual'),

-- Default patterns
('„Åù„ÅÆ‰ªñ', '["other", "miscellaneous", "various"]', 'exact', '99999', 30, 'manual'),
('‰∏çÊòé', '["unknown", "unidentified", "misc"]', 'exact', '99999', 25, 'manual')

ON CONFLICT (japanese_keyword, ebay_category_id) DO UPDATE SET
    english_keywords = EXCLUDED.english_keywords,
    confidence_score = EXCLUDED.confidence_score,
    usage_count = category_keyword_mapping.usage_count,
    updated_at = NOW();

-- üìä ÂàùÊúü„Ç∑„Çπ„ÉÜ„É†Áµ±Ë®à
INSERT INTO ebay_category_system_stats (
    stat_date, 
    total_categories, 
    supported_categories, 
    daily_detections, 
    daily_api_calls, 
    avg_confidence, 
    success_rate,
    top_categories,
    system_performance
) VALUES (
    CURRENT_DATE,
    (SELECT COUNT(*) FROM ebay_categories_master WHERE is_active = TRUE),
    (SELECT COUNT(DISTINCT ebay_category_id) FROM category_keyword_mapping WHERE is_active = TRUE),
    0,
    0,
    87.5,
    0.95,
    '[
        {"name": "Cell Phones & Smartphones", "count": 0, "category_id": "9355"},
        {"name": "Trading Card Games", "count": 0, "category_id": "2536"},
        {"name": "Cameras & Photo", "count": 0, "category_id": "625"},
        {"name": "Wristwatches", "count": 0, "category_id": "31387"},
        {"name": "Womens Bags & Handbags", "count": 0, "category_id": "169291"}
    ]'::jsonb,
    '{
        "avg_response_time": 150,
        "cache_hit_rate": 0.95,
        "api_success_rate": 1.0,
        "local_detection_rate": 0.92
    }'::jsonb
);

-- üîß „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„É≠„Ç∞
INSERT INTO ebay_api_usage_log (
    api_type, 
    success, 
    request_data, 
    response_data,
    processing_time,
    daily_count
) VALUES (
    'system_initialization',
    TRUE,
    '{"action": "initial_data_setup", "version": "1.0", "categories": 35, "keywords": 45}'::jsonb,
    '{"status": "success", "message": "Initial data loaded successfully"}'::jsonb,
    0,
    0
);

-- ‚úÖ „Éá„Éº„ÇøÊäïÂÖ•Á¢∫Ë™ç
DO $$ 
DECLARE
    category_count INTEGER;
    keyword_count INTEGER;
    aspect_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO category_count FROM ebay_categories_master WHERE is_active = TRUE;
    SELECT COUNT(*) INTO keyword_count FROM category_keyword_mapping WHERE is_active = TRUE;
    SELECT COUNT(*) INTO aspect_count FROM ebay_item_aspects;
    
    RAISE NOTICE '‚úÖ ÂàùÊúü„Éá„Éº„ÇøÊäïÂÖ•ÂÆå‰∫Ü:';
    RAISE NOTICE '   - „Ç´„ÉÜ„Ç¥„É™„Éº: % ‰ª∂', category_count;
    RAISE NOTICE '   - „Ç≠„Éº„ÉØ„Éº„Éâ„Éû„ÉÉ„Éî„É≥„Ç∞: % ‰ª∂', keyword_count;
    RAISE NOTICE '   - ÂøÖÈ†àÈ†ÖÁõÆ: % ‰ª∂', aspect_count;
    
    IF category_count > 30 AND keyword_count > 40 THEN
        RAISE NOTICE '‚úÖ „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÊàêÂäü - eBay„Ç´„ÉÜ„Ç¥„É™„ÉºËá™ÂãïÂà§ÂÆö„Ç∑„Çπ„ÉÜ„É†Ê∫ñÂÇôÂÆå‰∫Ü';
    ELSE
        RAISE WARNING '‚ö†Ô∏è „Éá„Éº„ÇøÊäïÂÖ•„Åå‰∏çÂÆåÂÖ®„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô';
    END IF;
END $$;
