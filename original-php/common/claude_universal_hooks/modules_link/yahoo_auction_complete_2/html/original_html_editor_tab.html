<!-- ğŸ¨ ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLä¿å­˜UIï¼ˆå·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œï¼‰ -->
<div id="html-editor" class="tab-content fade-in">
    <div class="section">
        <div class="section-header">
            <i class="fas fa-code"></i>
            <h3 class="section-title">HTMLç·¨é›†ãƒ»ä¿å­˜ã‚·ã‚¹ãƒ†ãƒ </h3>
            <div style="margin-left: auto; display: flex; gap: var(--space-sm);">
                <button class="btn btn-success" onclick="saveHTMLTemplate()">
                    <i class="fas fa-save"></i> ä¿å­˜
                </button>
                <button class="btn btn-info" onclick="previewHTMLWithData()">
                    <i class="fas fa-eye"></i> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                </button>
                <button class="btn btn-warning" onclick="showInsertWords()">
                    <i class="fas fa-list"></i> å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰
                </button>
            </div>
        </div>

        <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ãƒãƒ¼ -->
        <div class="template-management-bar">
            <div class="template-selector">
                <label class="form-label">
                    <i class="fas fa-folder-open"></i>
                    ä¿å­˜æ¸ˆã¿HTML:
                </label>
                <select id="savedTemplateSelect" class="form-select" onchange="loadSavedHTML(this.value)">
                    <option value="">æ–°è¦ä½œæˆ</option>
                    <!-- ä¿å­˜æ¸ˆã¿HTMLãƒªã‚¹ãƒˆï¼ˆJavaScript ã§å‹•çš„ç”Ÿæˆï¼‰ -->
                </select>
            </div>
            
            <div class="template-name-input">
                <label class="form-label">HTMLå:</label>
                <input type="text" id="templateNameInput" class="form-input" placeholder="ãƒã‚¤HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ" style="width: 200px;">
            </div>
        </div>

        <!-- å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰å‚ç…§ãƒ‘ãƒãƒ« -->
        <div class="insert-words-panel" id="insertWordsPanel" style="display: none;">
            <div class="panel-header">
                <h4><i class="fas fa-tags"></i> å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æŒ¿å…¥ï¼‰</h4>
                <button class="panel-close" onclick="hideInsertWords()">Ã—</button>
            </div>
            
            <div class="words-categories">
                <div class="words-category">
                    <h5>ğŸ“¦ åŸºæœ¬å•†å“æƒ…å ±</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{TITLE}}')" title="å•†å“ã‚¿ã‚¤ãƒˆãƒ«">{{TITLE}}</span>
                        <span class="word-item" onclick="insertWord('{{PRICE}}')" title="è²©å£²ä¾¡æ ¼($99.99å½¢å¼)">{{PRICE}}</span>
                        <span class="word-item" onclick="insertWord('{{BRAND}}')" title="ãƒ–ãƒ©ãƒ³ãƒ‰å">{{BRAND}}</span>
                        <span class="word-item" onclick="insertWord('{{CONDITION}}')" title="å•†å“çŠ¶æ…‹(New/Usedç­‰)">{{CONDITION}}</span>
                        <span class="word-item" onclick="insertWord('{{DESCRIPTION}}')" title="å•†å“èª¬æ˜æ–‡">{{DESCRIPTION}}</span>
                        <span class="word-item" onclick="insertWord('{{SKU}}')" title="eBay SKU">{{SKU}}</span>
                    </div>
                </div>

                <div class="words-category">
                    <h5>ğŸ–¼ï¸ ç”»åƒé–¢é€£</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{MAIN_IMAGE}}')" title="ãƒ¡ã‚¤ãƒ³ç”»åƒURL">{{MAIN_IMAGE}}</span>
                        <span class="word-item" onclick="insertWord('{{IMAGE_1}}')" title="è¿½åŠ ç”»åƒ1">{{IMAGE_1}}</span>
                        <span class="word-item" onclick="insertWord('{{IMAGE_2}}')" title="è¿½åŠ ç”»åƒ2">{{IMAGE_2}}</span>
                        <span class="word-item" onclick="insertWord('{{IMAGE_3}}')" title="è¿½åŠ ç”»åƒ3">{{IMAGE_3}}</span>
                        <span class="word-item" onclick="insertWord('{{IMAGE_GALLERY_HTML}}')" title="ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼(è‡ªå‹•ç”ŸæˆHTML)">{{IMAGE_GALLERY_HTML}}</span>
                    </div>
                </div>

                <div class="words-category">
                    <h5>ğŸ“‹ å•†å“è©³ç´°ãƒ»ä»•æ§˜</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{MODEL_NUMBER}}')" title="å‹ç•ªãƒ»ãƒ¢ãƒ‡ãƒ«ç•ªå·">{{MODEL_NUMBER}}</span>
                        <span class="word-item" onclick="insertWord('{{COLOR}}')" title="è‰²">{{COLOR}}</span>
                        <span class="word-item" onclick="insertWord('{{WEIGHT}}')" title="é‡é‡(0.5 kgå½¢å¼)">{{WEIGHT}}</span>
                        <span class="word-item" onclick="insertWord('{{DIMENSIONS}}')" title="å¯¸æ³•(15.0 x 7.5 x 1.0 cmå½¢å¼)">{{DIMENSIONS}}</span>
                        <span class="word-item" onclick="insertWord('{{SPECIFICATIONS_TABLE}}')" title="ä»•æ§˜è¡¨(è‡ªå‹•ç”Ÿæˆãƒ†ãƒ¼ãƒ–ãƒ«)">{{SPECIFICATIONS_TABLE}}</span>
                        <span class="word-item" onclick="insertWord('{{UPC}}')" title="UPCã‚³ãƒ¼ãƒ‰">{{UPC}}</span>
                    </div>
                </div>

                <div class="words-category">
                    <h5>ğŸšš é…é€ãƒ»ä¾¡æ ¼æƒ…å ±</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{SHIPPING_COST}}')" title="é€æ–™($25.00å½¢å¼)">{{SHIPPING_COST}}</span>
                        <span class="word-item" onclick="insertWord('{{SHIPPING_INFO_HTML}}')" title="é…é€æƒ…å ±(è‡ªå‹•ç”ŸæˆHTML)">{{SHIPPING_INFO_HTML}}</span>
                        <span class="word-item" onclick="insertWord('{{FREE_SHIPPING}}')" title="é€æ–™ç„¡æ–™è¡¨ç¤º(é€æ–™0ã®å ´åˆã®ã¿)">{{FREE_SHIPPING}}</span>
                        <span class="word-item" onclick="insertWord('{{PROFIT_MARGIN}}')" title="åˆ©ç›Šç‡(25.5%å½¢å¼)">{{PROFIT_MARGIN}}</span>
                        <span class="word-item" onclick="insertWord('{{ORIGINAL_PRICE_JPY}}')" title="å…ƒä¾¡æ ¼(æ—¥æœ¬å††)">{{ORIGINAL_PRICE_JPY}}</span>
                    </div>
                </div>

                <div class="words-category">
                    <h5>ğŸª è²©å£²è€…ãƒ»ãƒãƒªã‚·ãƒ¼æƒ…å ±</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{SELLER_INFO_HTML}}')" title="è²©å£²è€…æƒ…å ±(è‡ªå‹•ç”ŸæˆHTML)">{{SELLER_INFO_HTML}}</span>
                        <span class="word-item" onclick="insertWord('{{RETURN_POLICY_HTML}}')" title="è¿”å“ãƒãƒªã‚·ãƒ¼(è‡ªå‹•ç”ŸæˆHTML)">{{RETURN_POLICY_HTML}}</span>
                        <span class="word-item" onclick="insertWord('{{WARRANTY_HTML}}')" title="ä¿è¨¼æƒ…å ±(è‡ªå‹•ç”ŸæˆHTML)">{{WARRANTY_HTML}}</span>
                    </div>
                </div>

                <div class="words-category">
                    <h5>ğŸ“… æ—¥æ™‚ãƒ»åœ°åŸŸæƒ…å ±</h5>
                    <div class="words-grid">
                        <span class="word-item" onclick="insertWord('{{CURRENT_DATE}}')" title="ç¾åœ¨æ—¥ä»˜(2025-09-11å½¢å¼)">{{CURRENT_DATE}}</span>
                        <span class="word-item" onclick="insertWord('{{LOCATION}}')" title="ç™ºé€å…ƒåœ°åŸŸ(Japan)">{{LOCATION}}</span>
                        <span class="word-item" onclick="insertWord('{{CURRENCY_SYMBOL}}')" title="é€šè²¨è¨˜å·($)">{{CURRENCY_SYMBOL}}</span>
                        <span class="word-item" onclick="insertWord('{{COUNTRY_FLAG}}')" title="å›½æ——çµµæ–‡å­—(ğŸ‡¯ğŸ‡µ)">{{COUNTRY_FLAG}}</span>
                    </div>
                </div>
            </div>

            <div class="usage-example">
                <h5>ğŸ’¡ ä½¿ç”¨ä¾‹</h5>
                <pre><code>&lt;div class="product-listing"&gt;
    &lt;h1&gt;{{TITLE}}&lt;/h1&gt;
    &lt;div class="price"&gt;${{PRICE}}&lt;/div&gt;
    &lt;img src="{{MAIN_IMAGE}}" alt="{{TITLE}}"&gt;
    &lt;p&gt;{{DESCRIPTION}}&lt;/p&gt;
    &lt;div class="specs"&gt;{{SPECIFICATIONS_TABLE}}&lt;/div&gt;
    &lt;div class="shipping"&gt;{{SHIPPING_INFO_HTML}}&lt;/div&gt;
&lt;/div&gt;</code></pre>
            </div>
        </div>

        <!-- HTMLã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ -->
        <div class="html-editor-container">
            <div class="editor-header">
                <div class="editor-info">
                    <span class="editor-label">ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLç·¨é›†</span>
                    <span class="editor-hint">å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦è‡ªç”±ã«HTMLã‚’ä½œæˆã—ã¦ãã ã•ã„</span>
                </div>
                <div class="editor-actions">
                    <button class="btn btn-sm btn-secondary" onclick="clearEditor()">
                        <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                    </button>
                    <button class="btn btn-sm btn-info" onclick="formatHTML()">
                        <i class="fas fa-magic"></i> æ•´å½¢
                    </button>
                </div>
            </div>
            
            <textarea 
                id="htmlEditor" 
                class="html-editor-textarea" 
                placeholder="ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLã‚’ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„...

ä¾‹:
<div class='my-product'>
    <h1>{{TITLE}}</h1>
    <div class='price-display'>${{PRICE}}</div>
    <img src='{{MAIN_IMAGE}}' alt='{{TITLE}}' style='width: 100%; max-width: 500px;'>
    <div class='description'>{{DESCRIPTION}}</div>
    <div class='specifications'>{{SPECIFICATIONS_TABLE}}</div>
    <div class='shipping-info'>{{SHIPPING_INFO_HTML}}</div>
</div>

<style>
.my-product {
    max-width: 800px;
    margin: 0 auto;
    font-family: Arial, sans-serif;
}
.price-display {
    font-size: 2rem;
    color: #0066cc;
    font-weight: bold;
}
</style>"></textarea>
        </div>

        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div class="preview-section" id="previewSection" style="display: none;">
            <div class="preview-header">
                <h4><i class="fas fa-eye"></i> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ï¼‰</h4>
                <div class="preview-controls">
                    <select id="sampleDataSelect" onchange="updatePreviewWithSample()">
                        <option value="iphone">iPhone 15 Pro ã‚µãƒ³ãƒ—ãƒ«</option>
                        <option value="camera">ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ¡ãƒ© ã‚µãƒ³ãƒ—ãƒ«</option>
                        <option value="watch">è…•æ™‚è¨ˆ ã‚µãƒ³ãƒ—ãƒ«</option>
                    </select>
                    <button class="btn btn-sm btn-primary" onclick="updatePreviewWithSample()">
                        <i class="fas fa-refresh"></i> æ›´æ–°
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="hidePreview()">
                        <i class="fas fa-times"></i> é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>
            <div class="preview-frame" id="previewFrame">
                <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- ä¿å­˜æ¸ˆã¿HTMLä¸€è¦§ -->
        <div class="saved-html-list">
            <div class="section-header">
                <h4><i class="fas fa-folder"></i> ä¿å­˜æ¸ˆã¿HTMLä¸€è¦§</h4>
                <button class="btn btn-sm btn-primary" onclick="refreshHTMLList()">
                    <i class="fas fa-sync"></i> æ›´æ–°
                </button>
            </div>
            
            <div class="html-list-container" id="htmlListContainer">
                <div class="loading-placeholder">ä¿å­˜æ¸ˆã¿HTMLã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ¨ å°‚ç”¨CSS -->
<style>
/* === ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ãƒãƒ¼ === */
.template-management-bar {
    background: var(--bg-tertiary, #f1f5f9);
    padding: var(--space-md, 1rem);
    border-radius: var(--radius-lg, 0.5rem);
    margin-bottom: var(--space-lg, 1.5rem);
    display: flex;
    align-items: center;
    gap: var(--space-lg, 1.5rem);
    flex-wrap: wrap;
}

.template-selector {
    display: flex;
    align-items: center;
    gap: var(--space-sm, 0.5rem);
}

.template-name-input {
    display: flex;
    align-items: center;
    gap: var(--space-sm, 0.5rem);
}

/* === å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ãƒ‘ãƒãƒ« === */
.insert-words-panel {
    background: var(--bg-secondary, #ffffff);
    border: 2px solid var(--color-primary, #3b82f6);
    border-radius: var(--radius-lg, 0.5rem);
    margin-bottom: var(--space-lg, 1.5rem);
    box-shadow: var(--shadow-lg, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    max-height: 60vh;
    overflow-y: auto;
}

.panel-header {
    background: var(--color-primary, #3b82f6);
    color: white;
    padding: var(--space-md, 1rem);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 10;
}

.panel-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 1.5rem;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
}

.panel-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

.words-categories {
    padding: var(--space-md, 1rem);
    display: grid;
    gap: var(--space-lg, 1.5rem);
}

.words-category h5 {
    color: var(--color-primary, #3b82f6);
    font-size: 0.875rem;
    font-weight: 700;
    margin-bottom: var(--space-sm, 0.5rem);
    padding-bottom: var(--space-xs, 0.25rem);
    border-bottom: 2px solid var(--color-primary, #3b82f6);
}

.words-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: var(--space-xs, 0.25rem);
}

.word-item {
    background: var(--bg-tertiary, #f1f5f9);
    border: 1px solid var(--border-color, #e2e8f0);
    padding: var(--space-xs, 0.25rem) var(--space-sm, 0.5rem);
    border-radius: var(--radius-sm, 0.25rem);
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
    color: var(--color-primary, #3b82f6);
    font-weight: 600;
}

.word-item:hover {
    background: var(--color-primary, #3b82f6);
    color: white;
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm, 0 1px 2px 0 rgba(0, 0, 0, 0.05));
}

.usage-example {
    background: var(--bg-tertiary, #f1f5f9);
    padding: var(--space-md, 1rem);
    border-top: 1px solid var(--border-color, #e2e8f0);
}

.usage-example h5 {
    margin-bottom: var(--space-sm, 0.5rem);
    color: var(--text-primary, #1e293b);
}

.usage-example pre {
    background: var(--bg-secondary, #ffffff);
    padding: var(--space-sm, 0.5rem);
    border-radius: var(--radius-sm, 0.25rem);
    border: 1px solid var(--border-color, #e2e8f0);
    overflow-x: auto;
    font-size: 0.75rem;
    line-height: 1.4;
}

/* === HTMLã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ === */
.html-editor-container {
    background: var(--bg-secondary, #ffffff);
    border: 1px solid var(--border-color, #e2e8f0);
    border-radius: var(--radius-lg, 0.5rem);
    overflow: hidden;
    margin-bottom: var(--space-lg, 1.5rem);
}

.editor-header {
    background: var(--bg-tertiary, #f1f5f9);
    padding: var(--space-md, 1rem);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color, #e2e8f0);
}

.editor-label {
    font-weight: 600;
    color: var(--text-primary, #1e293b);
}

.editor-hint {
    font-size: 0.75rem;
    color: var(--text-secondary, #475569);
    margin-left: var(--space-sm, 0.5rem);
}

.editor-actions {
    display: flex;
    gap: var(--space-xs, 0.25rem);
}

.html-editor-textarea {
    width: 100%;
    height: 400px;
    border: none;
    background: var(--bg-secondary, #ffffff);
    color: var(--text-primary, #1e293b);
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.5;
    resize: vertical;
    padding: var(--space-md, 1rem);
    outline: none;
}

/* === ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ === */
.preview-section {
    background: var(--bg-secondary, #ffffff);
    border: 1px solid var(--border-color, #e2e8f0);
    border-radius: var(--radius-lg, 0.5rem);
    overflow: hidden;
    margin-bottom: var(--space-lg, 1.5rem);
}

.preview-header {
    background: var(--bg-tertiary, #f1f5f9);
    padding: var(--space-md, 1rem);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color, #e2e8f0);
}

.preview-controls {
    display: flex;
    align-items: center;
    gap: var(--space-sm, 0.5rem);
}

.preview-frame {
    padding: var(--space-md, 1rem);
    min-height: 300px;
    background: white;
    overflow-y: auto;
    max-height: 500px;
}

/* === ä¿å­˜æ¸ˆã¿HTMLä¸€è¦§ === */
.saved-html-list {
    background: var(--bg-tertiary, #f1f5f9);
    border-radius: var(--radius-lg, 0.5rem);
    padding: var(--space-lg, 1.5rem);
}

.html-list-container {
    margin-top: var(--space-md, 1rem);
}

.html-item {
    background: var(--bg-secondary, #ffffff);
    border: 1px solid var(--border-color, #e2e8f0);
    border-radius: var(--radius-md, 0.375rem);
    padding: var(--space-md, 1rem);
    margin-bottom: var(--space-sm, 0.5rem);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.html-item:hover {
    border-color: var(--color-primary, #3b82f6);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm, 0 1px 2px 0 rgba(0, 0, 0, 0.05));
}

.html-item-info h5 {
    margin: 0 0 var(--space-xs, 0.25rem) 0;
    color: var(--text-primary, #1e293b);
    font-size: 0.875rem;
}

.html-item-info p {
    margin: 0;
    font-size: 0.75rem;
    color: var(--text-secondary, #475569);
}

.html-item-actions {
    display: flex;
    gap: var(--space-xs, 0.25rem);
}

.html-item-actions button {
    padding: 0.25rem 0.5rem;
    border: none;
    background: var(--bg-tertiary, #f1f5f9);
    color: var(--text-secondary, #475569);
    border-radius: var(--radius-sm, 0.25rem);
    cursor: pointer;
    font-size: 0.75rem;
    transition: all 0.2s ease;
}

.html-item-actions button:hover {
    background: var(--color-primary, #3b82f6);
    color: white;
}

/* === ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  === */
.form-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary, #1e293b);
    display: flex;
    align-items: center;
    gap: var(--space-xs, 0.25rem);
    margin: 0;
}

.form-input, .form-select {
    padding: 0.5rem;
    border: 1px solid var(--border-color, #e2e8f0);
    border-radius: var(--radius-sm, 0.25rem);
    background: var(--bg-secondary, #ffffff);
    font-size: 0.875rem;
    color: var(--text-primary, #1e293b);
    transition: all 0.2s ease;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: var(--color-primary, #3b82f6);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
}

.loading-placeholder {
    text-align: center;
    color: var(--text-muted, #64748b);
    font-style: italic;
    padding: var(--space-xl, 2rem);
}

/* === ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– === */
@media (max-width: 768px) {
    .template-management-bar {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-md, 1rem);
    }
    
    .words-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
    
    .html-editor-textarea {
        height: 300px;
    }
    
    .html-item {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm, 0.5rem);
    }
    
    .html-item-actions {
        justify-content: center;
    }
}
</style>

<script>
// ğŸ¨ ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLä¿å­˜ã‚·ã‚¹ãƒ†ãƒ  JavaScript
let currentHTMLId = null;
let htmlProcessor = null;

// ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ¨ ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
    
    // HTMLProcessoråˆæœŸåŒ–
    if (typeof HTMLTemplateProcessor !== 'undefined') {
        htmlProcessor = new HTMLTemplateProcessor();
        console.log('âœ… HTMLProcessor åˆæœŸåŒ–å®Œäº†');
    }
    
    // ä¿å­˜æ¸ˆã¿HTMLèª­ã¿è¾¼ã¿
    loadHTMLList();
});

// å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ãƒ‘ãƒãƒ«è¡¨ç¤º
function showInsertWords() {
    const panel = document.getElementById('insertWordsPanel');
    panel.style.display = 'block';
    console.log('ğŸ“‹ å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
}

// å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ãƒ‘ãƒãƒ«éè¡¨ç¤º
function hideInsertWords() {
    const panel = document.getElementById('insertWordsPanel');
    panel.style.display = 'none';
}

// ãƒ¯ãƒ¼ãƒ‰æŒ¿å…¥
function insertWord(word) {
    const editor = document.getElementById('htmlEditor');
    const startPos = editor.selectionStart;
    const endPos = editor.selectionEnd;
    const currentValue = editor.value;
    
    const newValue = currentValue.substring(0, startPos) + word + currentValue.substring(endPos);
    editor.value = newValue;
    
    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’å¤‰æ•°ã®å¾Œã«ç§»å‹•
    const newCursorPos = startPos + word.length;
    editor.setSelectionRange(newCursorPos, newCursorPos);
    editor.focus();
    
    console.log(`ğŸ“ ãƒ¯ãƒ¼ãƒ‰ ${word} ã‚’æŒ¿å…¥ã—ã¾ã—ãŸ`);
    
    // æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    const wordElement = event.target;
    const originalBg = wordElement.style.background;
    wordElement.style.background = '#10b981';
    wordElement.style.color = 'white';
    setTimeout(() => {
        wordElement.style.background = '';
        wordElement.style.color = '';
    }, 300);
}

// HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
function saveHTMLTemplate() {
    const htmlContent = document.getElementById('htmlEditor').value;
    const templateName = document.getElementById('templateNameInput').value.trim();
    
    if (!htmlContent.trim()) {
        alert('ä¿å­˜ã™ã‚‹HTMLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
    }
    
    const finalTemplateName = templateName || `HTML_${new Date().getTime()}`;
    
    const templateData = {
        template_id: currentHTMLId || finalTemplateName,
        name: finalTemplateName,
        description: `ã‚ªãƒªã‚¸ãƒŠãƒ«HTML - ${new Date().toLocaleDateString()}`,
        html_content: htmlContent,
        category: 'original'
    };
    
    // APIã§ä¿å­˜
    const formData = new FormData();
    formData.append('action', 'save_html_template');
    formData.append('template_id', templateData.template_id);
    formData.append('name', templateData.name);
    formData.append('description', templateData.description);
    formData.append('html_content', templateData.html_content);
    formData.append('category', templateData.category);
    
    fetch('database_csv_handler_ebay_complete_v2.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('âœ… HTMLãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ');
            currentHTMLId = templateData.template_id;
            loadHTMLList(); // ä¸€è¦§æ›´æ–°
        } else {
            alert('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
        }
    })
    .catch(error => {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
    });
}

// ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
function previewHTMLWithData() {
    const htmlContent = document.getElementById('htmlEditor').value;
    
    if (!htmlContent.trim()) {
        alert('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹HTMLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
    }
    
    document.getElementById('previewSection').style.display = 'block';
    updatePreviewWithSample();
}

// ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
function updatePreviewWithSample() {
    const htmlContent = document.getElementById('htmlEditor').value;
    const sampleType = document.getElementById('sampleDataSelect').value;
    
    if (!htmlProcessor) {
        document.getElementById('previewFrame').innerHTML = '<p>HTMLProcessor ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
        return;
    }
    
    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
    const sampleData = getSampleData(sampleType);
    
    try {
        // HTMLç”Ÿæˆ
        const processedHtml = htmlProcessor.processTemplate(htmlContent, sampleData);
        document.getElementById('previewFrame').innerHTML = processedHtml;
        console.log('ğŸ”„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
    } catch (error) {
        console.error('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('previewFrame').innerHTML = `<p style="color: red;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
    }
}

// ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
function getSampleData(type) {
    const samples = {
        iphone: {
            title: 'iPhone 15 Pro 128GB Natural Titanium Unlocked',
            start_price: 650.00,
            brand: 'Apple',
            condition_id: 1000,
            description: 'Brand new iPhone 15 Pro in Natural Titanium. Factory unlocked, works with any carrier worldwide.',
            pic_url: 'https://via.placeholder.com/500x500/333/fff?text=iPhone+15+Pro',
            mpn: 'A2848',
            color: 'Natural Titanium',
            weight_kg: 0.187,
            shipping_international_usd: 25.00
        },
        camera: {
            title: 'Canon EOS R6 Mark II Mirrorless Camera',
            start_price: 1200.00,
            brand: 'Canon',
            condition_id: 1000,
            description: 'Professional mirrorless camera with advanced features.',
            pic_url: 'https://via.placeholder.com/500x500/222/fff?text=Canon+R6',
            weight_kg: 0.588,
            shipping_international_usd: 35.00
        },
        watch: {
            title: 'Rolex Submariner Date Black Dial',
            start_price: 8500.00,
            brand: 'Rolex',
            condition_id: 3000,
            description: 'Authentic Rolex Submariner with box and papers.',
            pic_url: 'https://via.placeholder.com/500x500/000/fff?text=Rolex',
            weight_kg: 0.15,
            shipping_international_usd: 50.00
        }
    };
    
    return samples[type] || samples.iphone;
}

// ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼éè¡¨ç¤º
function hidePreview() {
    document.getElementById('previewSection').style.display = 'none';
}

// ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚¯ãƒªã‚¢
function clearEditor() {
    if (confirm('HTMLã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        document.getElementById('htmlEditor').value = '';
        document.getElementById('templateNameInput').value = '';
        currentHTMLId = null;
    }
}

// HTMLæ•´å½¢ï¼ˆç°¡æ˜“ç‰ˆï¼‰
function formatHTML() {
    const editor = document.getElementById('htmlEditor');
    let html = editor.value;
    
    // ç°¡æ˜“HTMLæ•´å½¢
    html = html.replace(/></g, '>\n<');
    html = html.replace(/\n\s*\n/g, '\n');
    
    editor.value = html;
    console.log('ğŸ¨ HTMLã‚’æ•´å½¢ã—ã¾ã—ãŸ');
}

// ä¿å­˜æ¸ˆã¿HTMLä¸€è¦§èª­ã¿è¾¼ã¿
function loadHTMLList() {
    fetch('database_csv_handler_ebay_complete_v2.php?action=get_all_templates')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayHTMLList(data.data);
                updateSavedTemplateSelect(data.data);
            } else {
                console.error('HTMLèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', data.error);
            }
        })
        .catch(error => {
            console.error('HTMLèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        });
}

// HTMLä¸€è¦§è¡¨ç¤º
function displayHTMLList(htmlList) {
    const container = document.getElementById('htmlListContainer');
    
    if (!htmlList || htmlList.length === 0) {
        container.innerHTML = '<div class="loading-placeholder">ä¿å­˜æ¸ˆã¿HTMLãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
    }
    
    const htmlItems = htmlList.map(html => `
        <div class="html-item" onclick="loadHTMLById('${html.template_id}')">
            <div class="html-item-info">
                <h5>${html.name || html.template_id}</h5>
                <p>${html.description || 'HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ'} - æ›´æ–°: ${new Date(html.updated_at || html.created_at).toLocaleDateString()}</p>
            </div>
            <div class="html-item-actions">
                <button onclick="event.stopPropagation(); loadHTMLById('${html.template_id}')">èª­è¾¼</button>
                <button onclick="event.stopPropagation(); deleteHTML('${html.template_id}')">å‰Šé™¤</button>
            </div>
        </div>
    `).join('');
    
    container.innerHTML = htmlItems;
}

// ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹æ›´æ–°
function updateSavedTemplateSelect(htmlList) {
    const select = document.getElementById('savedTemplateSelect');
    
    // æ—¢å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆæœ€åˆã®ã€Œæ–°è¦ä½œæˆã€ã¯ä¿æŒï¼‰
    while (select.children.length > 1) {
        select.removeChild(select.lastChild);
    }
    
    // ä¿å­˜æ¸ˆã¿HTMLã‚’è¿½åŠ 
    htmlList.forEach(html => {
        const option = document.createElement('option');
        option.value = html.template_id;
        option.textContent = html.name || html.template_id;
        select.appendChild(option);
    });
}

// HTMLèª­ã¿è¾¼ã¿
function loadHTMLById(templateId) {
    fetch(`database_csv_handler_ebay_complete_v2.php?action=get_html_template&template_id=${encodeURIComponent(templateId)}`)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.data) {
                document.getElementById('htmlEditor').value = data.data.html_content || '';
                document.getElementById('templateNameInput').value = data.data.name || '';
                currentHTMLId = templateId;
                console.log(`ğŸ“„ HTML "${templateId}" ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
            } else {
                alert('âŒ HTMLã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        })
        .catch(error => {
            console.error('HTMLèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ HTMLã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        });
}

// ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰HTMLèª­ã¿è¾¼ã¿
function loadSavedHTML(templateId) {
    if (templateId) {
        loadHTMLById(templateId);
    } else {
        // æ–°è¦ä½œæˆ
        clearEditor();
    }
}

// HTMLå‰Šé™¤
function deleteHTML(templateId) {
    if (confirm('ã“ã®HTMLã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        const formData = new FormData();
        formData.append('action', 'delete_html_template');
        formData.append('template_id', templateId);
        
        fetch('database_csv_handler_ebay_complete_v2.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('âœ… HTMLãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
                loadHTMLList();
            } else {
                alert('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
            }
        })
        .catch(error => {
            console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        });
    }
}

// HTMLä¸€è¦§æ›´æ–°
function refreshHTMLList() {
    loadHTMLList();
    console.log('ğŸ”„ HTMLä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
}

console.log('ğŸ¨ ã‚ªãƒªã‚¸ãƒŠãƒ«HTMLä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
</script>