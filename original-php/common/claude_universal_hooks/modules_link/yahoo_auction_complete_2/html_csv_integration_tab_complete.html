<!-- ğŸ¯ HTMLã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ CSVè‡ªå‹•çµ±åˆã‚¿ãƒ–ï¼ˆå®Œå…¨ç‰ˆï¼‰ -->

<!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã®éš£ï¼‰ -->
<button class="tab-btn" data-tab="html-csv-integration" onclick="switchTab('html-csv-integration')">
    <i class="fas fa-code"></i>
    HTMLç·¨é›†
</button>

<!-- HTMLã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ CSVè‡ªå‹•çµ±åˆã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div id="html-csv-integration" class="tab-content">
    <div class="section">
        <div class="section-header">
            <h3 class="section-title">
                <i class="fas fa-code"></i>
                HTML â†’ CSVè‡ªå‹•çµ±åˆã‚·ã‚¹ãƒ†ãƒ 
            </h3>
            <div style="display: flex; gap: var(--space-sm);">
                <button class="btn btn-success" onclick="processAllProductsWithHTML()">
                    <i class="fas fa-magic"></i> å…¨å•†å“ä¸€æ‹¬å‡¦ç†
                </button>
                <button class="btn btn-info" onclick="downloadHTMLUpdatedCSV()">
                    <i class="fas fa-download"></i> HTMLçµ±åˆCSVå–å¾—
                </button>
                <button class="btn btn-warning" onclick="resetHTMLProcessing()">
                    <i class="fas fa-undo"></i> ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>
        </div>

        <!-- å‡¦ç†çŠ¶æ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-bottom: var(--space-lg);">
            <div class="card" style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);" id="totalProductsHTML">0</div>
                <div style="color: var(--text-muted); font-size: 0.8rem;">ç·å•†å“æ•°</div>
            </div>
            <div class="card" style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);" id="processedProductsHTML">0</div>
                <div style="color: var(--text-muted); font-size: 0.8rem;">HTMLç”Ÿæˆæ¸ˆã¿</div>
            </div>
            <div class="card" style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--warning-color);" id="templateUploadedCount">0</div>
                <div style="color: var(--text-muted); font-size: 0.8rem;">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç™»éŒ²</div>
            </div>
            <div class="card" style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--info-color);" id="csvReadyCount">0</div>
                <div style="color: var(--text-muted); font-size: 0.8rem;">CSVå‡ºåŠ›æº–å‚™å®Œäº†</div>
            </div>
        </div>

        <!-- HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div style="background: var(--bg-tertiary); padding: var(--space-lg); border-radius: var(--radius-lg); margin-bottom: var(--space-lg);">
            <h4 style="margin-bottom: var(--space-md);">
                <i class="fas fa-palette"></i> HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
            </h4>
            
            <!-- HTMLã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-md);">
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                        <i class="fas fa-upload"></i> HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ç·¨é›†
                    </label>
                    <div style="position: relative;">
                        <textarea 
                            id="htmlTemplateInput" 
                            placeholder="<!DOCTYPE html>
<html>
<head>
    <title>{{PRODUCT_TITLE}}</title>
</head>
<body>
    <h1>{{PRODUCT_TITLE}}</h1>
    <div>ä¾¡æ ¼: {{PRICE_USD}}</div>
    <div>ãƒ–ãƒ©ãƒ³ãƒ‰: {{IF_HAS_BRAND}}{{BRAND_NAME}}{{ELSE}}ä¸æ˜{{END_IF}}</div>
    
    <!-- ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
    {{IMAGE_GALLERY}}
    
    <!-- ä»•æ§˜è¡¨ -->
    {{SPECIFICATIONS_TABLE}}
    
    <!-- é…é€æƒ…å ± -->
    {{SHIPPING_INFO}}
</body>
</html>"
                            style="width: 100%; min-height: 250px; padding: var(--space-sm); border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: 'Courier New', monospace; font-size: 0.85rem; resize: vertical; background: #1e293b; color: #e2e8f0;"
                        ></textarea>
                        <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="formatHTML()">
                                <i class="fas fa-magic"></i> æ•´å½¢
                            </button>
                            <button class="btn btn-info" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="clearHTMLTemplate()">
                                <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ -->
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">
                        <i class="fas fa-tags"></i> å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æŒ¿å…¥ï¼‰
                    </label>
                    <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--space-sm); max-height: 250px; overflow-y: auto;">
                        
                        <!-- åŸºæœ¬æƒ…å ± -->
                        <div style="margin-bottom: var(--space-sm);">
                            <div style="font-weight: 600; font-size: 0.8rem; color: var(--primary-color); margin-bottom: 0.25rem;">åŸºæœ¬æƒ…å ±</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <span class="variable-tag" onclick="insertVariable('{{PRODUCT_TITLE}}')">{{PRODUCT_TITLE}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{PRICE_USD}}')">{{PRICE_USD}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{BRAND_NAME}}')">{{BRAND_NAME}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{MODEL_NAME}}')">{{MODEL_NAME}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{CONDITION}}')">{{CONDITION}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{CATEGORY}}')">{{CATEGORY}}</span>
                            </div>
                        </div>
                        
                        <!-- ç”»åƒãƒ»ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
                        <div style="margin-bottom: var(--space-sm);">
                            <div style="font-weight: 600; font-size: 0.8rem; color: var(--success-color); margin-bottom: 0.25rem;">ç”»åƒãƒ»ã‚®ãƒ£ãƒ©ãƒªãƒ¼</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <span class="variable-tag" onclick="insertVariable('{{MAIN_IMAGE}}')">{{MAIN_IMAGE}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IMAGE_GALLERY}}')">{{IMAGE_GALLERY}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IMAGE_COUNT}}')">{{IMAGE_COUNT}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IMAGE_1}}')">{{IMAGE_1}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IMAGE_2}}')">{{IMAGE_2}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IMAGE_3}}')">{{IMAGE_3}}</span>
                            </div>
                        </div>
                        
                        <!-- å•†å“è©³ç´°ãƒ»ä»•æ§˜ -->
                        <div style="margin-bottom: var(--space-sm);">
                            <div style="font-weight: 600; font-size: 0.8rem; color: var(--warning-color); margin-bottom: 0.25rem;">å•†å“è©³ç´°ãƒ»ä»•æ§˜</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <span class="variable-tag" onclick="insertVariable('{{SPECIFICATIONS_TABLE}}')">{{SPECIFICATIONS_TABLE}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{DESCRIPTION_TEXT}}')">{{DESCRIPTION_TEXT}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{WEIGHT}}')">{{WEIGHT}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{DIMENSIONS}}')">{{DIMENSIONS}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{COLOR}}')">{{COLOR}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{SIZE}}')">{{SIZE}}</span>
                            </div>
                        </div>
                        
                        <!-- é…é€ãƒ»å–å¼• -->
                        <div style="margin-bottom: var(--space-sm);">
                            <div style="font-weight: 600; font-size: 0.8rem; color: var(--info-color); margin-bottom: 0.25rem;">é…é€ãƒ»å–å¼•</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <span class="variable-tag" onclick="insertVariable('{{SHIPPING_INFO}}')">{{SHIPPING_INFO}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{HANDLING_TIME}}')">{{HANDLING_TIME}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{RETURN_POLICY}}')">{{RETURN_POLICY}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{PAYMENT_METHODS}}')">{{PAYMENT_METHODS}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{SHIP_FROM_COUNTRY}}')">{{SHIP_FROM_COUNTRY}}</span>
                            </div>
                        </div>
                        
                        <!-- æ¡ä»¶åˆ†å² -->
                        <div>
                            <div style="font-weight: 600; font-size: 0.8rem; color: var(--danger-color); margin-bottom: 0.25rem;">æ¡ä»¶åˆ†å²</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                <span class="variable-tag" onclick="insertVariable('{{IF_HAS_BRAND}}')">{{IF_HAS_BRAND}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{ELSE}}')">{{ELSE}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{END_IF}}')">{{END_IF}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IF_NEW_CONDITION}}')">{{IF_NEW_CONDITION}}</span>
                                <span class="variable-tag" onclick="insertVariable('{{IF_HAS_IMAGES}}')">{{IF_HAS_IMAGES}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ -->
            <div style="display: flex; gap: var(--space-sm); align-items: center; margin-bottom: var(--space-md);">
                <input 
                    type="text" 
                    id="templateNameInput" 
                    placeholder="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåï¼ˆä¾‹: premium_templateï¼‰" 
                    style="flex: 1; padding: var(--space-sm); border: 1px solid var(--border-color); border-radius: var(--radius-md);"
                >
                <button class="btn btn-primary" onclick="saveHTMLTemplate()">
                    <i class="fas fa-save"></i> ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
                </button>
            </div>
        </div>

        <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-lg);">
            <h4 style="margin-bottom: var(--space-md);">
                <i class="fas fa-eye"></i> ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            </h4>
            
            <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿é¸æŠ -->
            <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-md);">
                <button class="btn btn-secondary" onclick="loadSampleData('iphone')">
                    <i class="fas fa-mobile"></i> iPhone ã‚µãƒ³ãƒ—ãƒ«
                </button>
                <button class="btn btn-secondary" onclick="loadSampleData('camera')">
                    <i class="fas fa-camera"></i> ã‚«ãƒ¡ãƒ© ã‚µãƒ³ãƒ—ãƒ«
                </button>
                <button class="btn btn-secondary" onclick="loadSampleData('watch')">
                    <i class="fas fa-clock"></i> æ™‚è¨ˆ ã‚µãƒ³ãƒ—ãƒ«
                </button>
                <button class="btn btn-info" onclick="generateHTMLPreview()">
                    <i class="fas fa-sync"></i> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                </button>
            </div>
            
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º -->
            <div id="htmlPreviewArea" style="border: 2px solid var(--border-color); border-radius: var(--radius-md); background: white; min-height: 200px; overflow: auto; max-height: 400px;">
                <div style="padding: var(--space-lg); text-align: center; color: var(--text-muted);">
                    <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: var(--space-sm);"></i>
                    <div>HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ã€Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
                </div>
            </div>
        </div>

        <!-- ä¿å­˜æ¸ˆã¿HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† -->
        <div style="background: var(--bg-tertiary); padding: var(--space-lg); border-radius: var(--radius-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                <h4>
                    <i class="fas fa-folder"></i> ä¿å­˜æ¸ˆã¿HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                </h4>
                <button class="btn btn-info" onclick="loadSavedTemplates()">
                    <i class="fas fa-sync"></i> ä¸€è¦§æ›´æ–°
                </button>
            </div>
            
            <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå</th>
                            <th>ä½œæˆæ—¥</th>
                            <th>ä½¿ç”¨å›æ•°</th>
                            <th>èª¬æ˜</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="savedTemplatesBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: var(--space-lg); color: var(--text-muted);">
                                ã€Œä¸€è¦§æ›´æ–°ã€ã‚’æŠ¼ã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- CSS ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ  -->
<style>
.variable-tag {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    padding: 0.25rem 0.5rem;
    font-size: 0.7rem;
    font-family: 'Courier New', monospace;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--primary-color);
    font-weight: 600;
    display: inline-block;
}

.variable-tag:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
}

.data-table th,
.data-table td {
    padding: var(--space-sm);
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    font-size: 0.8rem;
}

.data-table th {
    background: var(--bg-tertiary);
    font-weight: 600;
    color: var(--text-primary);
}
</style>

<!-- JavaScript æ©Ÿèƒ½è¿½åŠ  -->
<script>
// HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
let currentSampleData = {};
let savedTemplates = [];

// å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰æŒ¿å…¥æ©Ÿèƒ½
function insertVariable(variable) {
    const textarea = document.getElementById('htmlTemplateInput');
    const startPos = textarea.selectionStart;
    const endPos = textarea.selectionEnd;
    const currentValue = textarea.value;
    
    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã«å¤‰æ•°ã‚’æŒ¿å…¥
    const newValue = currentValue.substring(0, startPos) + variable + currentValue.substring(endPos);
    textarea.value = newValue;
    
    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’èª¿æ•´
    const newCursorPos = startPos + variable.length;
    textarea.setSelectionRange(newCursorPos, newCursorPos);
    textarea.focus();
    
    console.log('å¤‰æ•°æŒ¿å…¥:', variable);
}

// HTMLæ•´å½¢æ©Ÿèƒ½
function formatHTML() {
    const textarea = document.getElementById('htmlTemplateInput');
    let html = textarea.value;
    
    // ç°¡å˜ãªHTMLæ•´å½¢ï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã‚ˆã‚Šé«˜åº¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼‰
    html = html.replace(/></g, '>\n<');
    html = html.replace(/^\s+|\s+$/gm, '');
    
    // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè¿½åŠ 
    const lines = html.split('\n');
    let indentLevel = 0;
    const formattedLines = [];
    
    lines.forEach(line => {
        if (line.trim() === '') return;
        
        if (line.includes('</') && !line.includes('</'+ line.match(/<(\w+)/)?.[1] + '>')) {
            indentLevel--;
        }
        
        formattedLines.push('  '.repeat(Math.max(0, indentLevel)) + line.trim());
        
        if (line.includes('<') && !line.includes('</') && !line.endsWith('/>')) {
            indentLevel++;
        }
    });
    
    textarea.value = formattedLines.join('\n');
    console.log('HTMLæ•´å½¢å®Œäº†');
}

// HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¯ãƒªã‚¢
function clearHTMLTemplate() {
    if (confirm('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        document.getElementById('htmlTemplateInput').value = '';
        document.getElementById('htmlPreviewArea').innerHTML = `
            <div style="padding: var(--space-lg); text-align: center; color: var(--text-muted);">
                <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: var(--space-sm);"></i>
                <div>HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ã€Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
            </div>
        `;
    }
}

// ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
function loadSampleData(type) {
    const sampleDataSets = {
        iphone: {
            PRODUCT_TITLE: 'Apple iPhone 14 Pro 128GB Deep Purple - Unlocked',
            PRICE_USD: '899.00',
            BRAND_NAME: 'Apple',
            MODEL_NAME: 'iPhone 14 Pro',
            CONDITION: 'New',
            CATEGORY: 'Cell Phones & Smartphones',
            MAIN_IMAGE: 'https://example.com/iphone14pro.jpg',
            IMAGE_COUNT: '8',
            DESCRIPTION_TEXT: 'Brand new iPhone 14 Pro with Dynamic Island, A16 Bionic chip, and Pro camera system.',
            WEIGHT: '7.27 oz (206g)',
            DIMENSIONS: '6.07 x 2.81 x 0.31 inches',
            COLOR: 'Deep Purple',
            SIZE: '128GB'
        },
        camera: {
            PRODUCT_TITLE: 'Canon EOS R5 Mirrorless Camera Body',
            PRICE_USD: '2,499.00',
            BRAND_NAME: 'Canon',
            MODEL_NAME: 'EOS R5',
            CONDITION: 'Used - Excellent',
            CATEGORY: 'Digital Cameras',
            MAIN_IMAGE: 'https://example.com/canon-r5.jpg',
            IMAGE_COUNT: '12',
            DESCRIPTION_TEXT: 'Professional mirrorless camera with 45MP sensor and 8K video capability.',
            WEIGHT: '1.62 lbs (738g)',
            DIMENSIONS: '5.39 x 3.76 x 3.46 inches',
            COLOR: 'Black',
            SIZE: 'Body Only'
        },
        watch: {
            PRODUCT_TITLE: 'Vintage Seiko Automatic Watch 1970s',
            PRICE_USD: '295.00',
            BRAND_NAME: 'Seiko',
            MODEL_NAME: 'Automatic',
            CONDITION: 'Used - Very Good',
            CATEGORY: 'Watches',
            MAIN_IMAGE: 'https://example.com/seiko-vintage.jpg',
            IMAGE_COUNT: '6',
            DESCRIPTION_TEXT: 'Beautifully preserved vintage Seiko automatic watch from the 1970s.',
            WEIGHT: '0.25 lbs (115g)',
            DIMENSIONS: '1.57 x 1.57 x 0.39 inches',
            COLOR: 'Silver',
            SIZE: 'One Size'
        }
    };
    
    currentSampleData = sampleDataSets[type] || {};
    
    console.log('ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿:', type, currentSampleData);
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è‡ªå‹•æ›´æ–°
    generateHTMLPreview();
}

// HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
function generateHTMLPreview() {
    const htmlTemplate = document.getElementById('htmlTemplateInput').value;
    const previewArea = document.getElementById('htmlPreviewArea');
    
    if (!htmlTemplate.trim()) {
        previewArea.innerHTML = `
            <div style="padding: var(--space-lg); text-align: center; color: var(--text-muted);">
                <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: var(--space-sm);"></i>
                <div>HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>
        `;
        return;
    }
    
    // å·®ã—è¾¼ã¿ãƒ¯ãƒ¼ãƒ‰ã‚’ç½®æ›
    let processedHTML = htmlTemplate;
    
    // åŸºæœ¬çš„ãªç½®æ›
    Object.entries(currentSampleData).forEach(([key, value]) => {
        const regex = new RegExp(`{{${key}}}`, 'g');
        processedHTML = processedHTML.replace(regex, value);
    });
    
    // æ¡ä»¶åˆ†å²å‡¦ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰
    processedHTML = processedHTML.replace(/{{IF_HAS_BRAND}}(.*?){{ELSE}}(.*?){{END_IF}}/gs, (match, ifContent, elseContent) => {
        return currentSampleData.BRAND_NAME ? ifContent : elseContent;
    });
    
    processedHTML = processedHTML.replace(/{{IF_HAS_BRAND}}(.*?){{END_IF}}/gs, (match, content) => {
        return currentSampleData.BRAND_NAME ? content : '';
    });
    
    // ç‰¹åˆ¥ãªè¦ç´ ã®ç”Ÿæˆ
    processedHTML = processedHTML.replace(/{{IMAGE_GALLERY}}/g, `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 20px 0;">
            <img src="${currentSampleData.MAIN_IMAGE || 'https://via.placeholder.com/150'}" style="width: 100%; border-radius: 8px;" alt="å•†å“ç”»åƒ">
            <img src="https://via.placeholder.com/150" style="width: 100%; border-radius: 8px;" alt="å•†å“ç”»åƒ">
            <img src="https://via.placeholder.com/150" style="width: 100%; border-radius: 8px;" alt="å•†å“ç”»åƒ">
        </div>
    `);
    
    processedHTML = processedHTML.replace(/{{SPECIFICATIONS_TABLE}}/g, `
        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tr style="background: #f5f5f5;"><td style="padding: 8px; border: 1px solid #ddd;"><strong>ãƒ–ãƒ©ãƒ³ãƒ‰</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${currentSampleData.BRAND_NAME || '-'}</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>ãƒ¢ãƒ‡ãƒ«</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${currentSampleData.MODEL_NAME || '-'}</td></tr>
            <tr style="background: #f5f5f5;"><td style="padding: 8px; border: 1px solid #ddd;"><strong>çŠ¶æ…‹</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${currentSampleData.CONDITION || '-'}</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>é‡é‡</strong></td><td style="padding: 8px; border: 1px solid #ddd;">${currentSampleData.WEIGHT || '-'}</td></tr>
        </table>
    `);
    
    processedHTML = processedHTML.replace(/{{SHIPPING_INFO}}/g, `
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h4 style="margin: 0 0 10px 0; color: #2d5a2d;">ğŸšš é…é€æƒ…å ±</h4>
            <p style="margin: 5px 0;">ğŸ“¦ å‡¦ç†æ—¥æ•°: 1-2å–¶æ¥­æ—¥</p>
            <p style="margin: 5px 0;">ğŸŒ é…é€å…ˆ: ä¸–ç•Œå„å›½</p>
            <p style="margin: 5px 0;">ğŸ’° é€æ–™: $15.00ï¼ˆç„¡æ–™é…é€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿæ–½ä¸­ï¼‰</p>
        </div>
    `);
    
    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    previewArea.innerHTML = processedHTML;
    
    console.log('HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå®Œäº†');
}

// HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜
function saveHTMLTemplate() {
    const templateName = document.getElementById('templateNameInput').value.trim();
    const htmlContent = document.getElementById('htmlTemplateInput').value.trim();
    
    if (!templateName) {
        alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    if (!htmlContent) {
        alert('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆå®Ÿéš›ã®APIå‘¼ã³å‡ºã—ï¼‰
    const formData = new FormData();
    formData.append('action', 'save_html_template');
    formData.append('template_name', templateName);
    formData.append('html_content', htmlContent);
    
    fetch('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜çµæœ:', data);
        
        if (data.success) {
            alert('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼');
            document.getElementById('templateNameInput').value = '';
            updateTemplateUploadCount();
            loadSavedTemplates();
        } else {
            alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
        }
    })
    .catch(error => {
        console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    });
}

// ä¿å­˜æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§èª­ã¿è¾¼ã¿
function loadSavedTemplates() {
    fetch('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php?action=get_html_templates')
        .then(response => response.json())
        .then(data => {
            console.log('ä¿å­˜æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ:', data);
            
            if (data.success) {
                displaySavedTemplates(data.data || []);
                savedTemplates = data.data || [];
            } else {
                console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', data.error);
            }
        })
        .catch(error => {
            console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        });
}

// ä¿å­˜æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¡¨ç¤º
function displaySavedTemplates(templates) {
    const tbody = document.getElementById('savedTemplatesBody');
    
    if (templates.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: var(--space-lg); color: var(--text-muted);">
                    ä¿å­˜ã•ã‚ŒãŸHTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = templates.map(template => `
        <tr>
            <td style="font-weight: 600;">${template.template_name}</td>
            <td>${template.created_at}</td>
            <td>${template.usage_count || 0}</td>
            <td>${template.description || '-'}</td>
            <td>
                <button class="btn btn-info" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin: 0 0.25rem;" onclick="loadTemplate('${template.template_name}')">èª­ã¿è¾¼ã¿</button>
                <button class="btn btn-warning" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin: 0 0.25rem;" onclick="editTemplate('${template.template_name}')">ç·¨é›†</button>
                <button class="btn btn-danger" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin: 0 0.25rem;" onclick="deleteTemplate('${template.template_name}')">å‰Šé™¤</button>
            </td>
        </tr>
    `).join('');
}

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
function loadTemplate(templateName) {
    const template = savedTemplates.find(t => t.template_name === templateName);
    if (template) {
        document.getElementById('htmlTemplateInput').value = template.html_content || '';
        document.getElementById('templateNameInput').value = templateName;
        generateHTMLPreview();
        console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿:', templateName);
    }
}

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†
function editTemplate(templateName) {
    loadTemplate(templateName);
    alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ç·¨é›†å¾Œã«ã€Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿å­˜ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
}

// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤
function deleteTemplate(templateName) {
    if (!confirm(`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€Œ${templateName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
    }
    
    const formData = new FormData();
    formData.append('action', 'delete_html_template');
    formData.append('template_name', templateName);
    
    fetch('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤çµæœ:', data);
        
        if (data.success) {
            alert('HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
            loadSavedTemplates();
        } else {
            alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
        }
    })
    .catch(error => {
        console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        alert('å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    });
}

// å…¨å•†å“ä¸€æ‹¬HTMLå‡¦ç†
function processAllProductsWithHTML() {
    if (!confirm('å…¨å•†å“ã«HTMLã‚’é©ç”¨ã—ã¦ã€CSVã®ebay_description_htmlãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è‡ªå‹•æŒ¿å…¥ã—ã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
    }
    
    const templateName = document.getElementById('templateNameInput').value.trim();
    if (!templateName) {
        alert('ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    // å‡¦ç†é–‹å§‹
    const formData = new FormData();
    formData.append('action', 'process_all_products_html');
    formData.append('template_name', templateName);
    
    fetch('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('ä¸€æ‹¬HTMLå‡¦ç†çµæœ:', data);
        
        if (data.success) {
            alert(`æˆåŠŸï¼${data.processed_count}ä»¶ã®å•†å“ã«HTMLãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚`);
            updateHTMLProcessingStats();
        } else {
            alert('ä¸€æ‹¬å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
        }
    })
    .catch(error => {
        console.error('ä¸€æ‹¬HTMLå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
        alert('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    });
}

// HTMLçµ±åˆæ¸ˆã¿CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
function downloadHTMLUpdatedCSV() {
    window.open('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php?action=export_ebay_csv&html_ready=true', '_blank');
}

// å‡¦ç†çµ±è¨ˆæ›´æ–°
function updateHTMLProcessingStats() {
    // å®Ÿéš›ã®APIã§çµ±è¨ˆã‚’å–å¾—ã—ã¦æ›´æ–°
    fetch('/modules/yahoo_auction_complete/database_csv_handler_ebay_complete.php?action=get_html_processing_stats')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.stats) {
                document.getElementById('totalProductsHTML').textContent = data.stats.total_products || '0';
                document.getElementById('processedProductsHTML').textContent = data.stats.html_generated || '0';
                document.getElementById('templateUploadedCount').textContent = data.stats.templates_count || '0';
                document.getElementById('csvReadyCount').textContent = data.stats.csv_ready || '0';
            }
        })
        .catch(error => {
            console.error('çµ±è¨ˆæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        });
}

function updateTemplateUploadCount() {
    updateHTMLProcessingStats();
}

function resetHTMLProcessing() {
    if (confirm('HTMLå‡¦ç†ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿå…¨ã¦ã®ç”Ÿæˆæ¸ˆã¿HTMLãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        // ãƒªã‚»ãƒƒãƒˆå‡¦ç†
        console.log('HTMLå‡¦ç†ãƒªã‚»ãƒƒãƒˆ');
        // APIå‘¼ã³å‡ºã—ã‚’å®Ÿè£…
    }
}

// åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«HTMLã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸå ´åˆã®å‡¦ç†
    const htmlTab = document.querySelector('[data-tab="html-csv-integration"]');
    if (htmlTab) {
        htmlTab.addEventListener('click', function() {
            setTimeout(() => {
                loadSavedTemplates();
                updateHTMLProcessingStats();
            }, 100);
        });
    }
});

console.log('âœ… HTMLâ†’CSVçµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
</script>