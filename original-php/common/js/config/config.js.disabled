/**
 * 🔧 NAGANO-3 Core Configuration
 * common/js/core/config.js
 * 
 * ✅ 404エラー解消用設定ファイル
 * ✅ bootstrap.jsとの統合対応
 * 
 * @version 1.0.0-error-fix
 */

"use strict";

// 重複読み込み防止
if (window.NAGANO3_CONFIG_LOADED) {
    console.log('⚠️ config.js は既に読み込み済みです');
} else {
    window.NAGANO3_CONFIG_LOADED = true;

    // NAGANO3名前空間確保
    if (typeof window.NAGANO3 === 'undefined') {
        window.NAGANO3 = {};
    }

    // 基本設定（bootstrap.jsと統合）
    if (!window.NAGANO3.config) {
        window.NAGANO3.config = {
            // システム情報
            version: '4.0.1-config-integrated',
            environment: 'development',
            debug: true,
            
            // ページ設定
            current_page: 'dashboard',
            csrf_token: '',
            user_theme: 'light',
            user_name: 'NAGANO-3 User',
            user_role: 'standard',
            sidebar_state: 'expanded',
            
            // UI設定
            themes: ["light", "dark", "gentle", "vivid", "ocean"],
            animation_speed: 300,
            notification_duration: 5000,
            
            // Ajax設定
            ajax_timeout: 30000,
            ajax_retry_attempts: 3,
            ajax_endpoint: window.location.pathname,
            
            // モジュール設定
            page_modules: {
                'dashboard': [],
                'kicho_content': ['kicho'],
                'apikey_content': ['apikey'],
                'shohin_content': ['shohin'],
                'zaiko_content': ['zaiko'],
                'juchu_kanri_content': ['juchu_kanri']
            },
            
            // パフォーマンス設定
            cache_enabled: true,
            lazy_loading: true,
            prefetch_enabled: false,
            
            // セキュリティ設定
            csrf_validation: true,
            session_timeout: 3600,
            max_file_size: 10485760, // 10MB
            
            // API設定
            api_endpoints: {
                base: window.location.origin,
                ajax: window.location.pathname,
                upload: '/upload/',
                download: '/download/'
            }
        };
    }

    // 設定統合関数
    window.NAGANO3.extendConfig = function(additionalConfig) {
        if (typeof additionalConfig === 'object') {
            Object.assign(window.NAGANO3.config, additionalConfig);
            console.log('🔧 NAGANO3設定が拡張されました');
        }
    };

    // 設定取得関数
    window.NAGANO3.getConfig = function(key, defaultValue = null) {
        const keys = key.split('.');
        let value = window.NAGANO3.config;
        
        for (const k of keys) {
            if (value && typeof value === 'object' && k in value) {
                value = value[k];
            } else {
                return defaultValue;
            }
        }
        
        return value;
    };

    // 設定更新関数
    window.NAGANO3.setConfig = function(key, value) {
        const keys = key.split('.');
        let target = window.NAGANO3.config;
        
        for (let i = 0; i < keys.length - 1; i++) {
            const k = keys[i];
            if (!(k in target) || typeof target[k] !== 'object') {
                target[k] = {};
            }
            target = target[k];
        }
        
        target[keys[keys.length - 1]] = value;
        console.log(`🔧 設定更新: ${key} = ${value}`);
    };

    // 環境別設定の自動調整
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        window.NAGANO3.config.environment = 'development';
        window.NAGANO3.config.debug = true;
    } else {
        window.NAGANO3.config.environment = 'production';
        window.NAGANO3.config.debug = false;
    }

    // 分割ファイルシステムとの統合
    if (window.NAGANO3.splitFiles) {
        window.NAGANO3.splitFiles.markLoaded('config.js');
    }

    console.log('✅ NAGANO-3 Core Configuration 読み込み完了');
    console.log('🔧 Environment:', window.NAGANO3.config.environment);
    console.log('🎯 Current Page:', window.NAGANO3.config.current_page);
}