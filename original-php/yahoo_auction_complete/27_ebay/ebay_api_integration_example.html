<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay API統合ダッシュボード</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background: #f7f7f7;
            color: #191919;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00a650;
        }
        
        .status-indicator.error { background: #e53e3e; }
        .status-indicator.warning { background: #f5af02; }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #0064d2;
        }
        
        .refresh-btn {
            background: #0064d2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .refresh-btn:hover {
            background: #0053ba;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #707070;
            font-size: 14px;
        }
        
        .data-value {
            font-weight: 600;
            font-size: 16px;
            color: #191919;
        }
        
        .data-value.urgent {
            color: #e53e3e;
        }
        
        .action-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .action-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .action-info {
            flex: 1;
        }
        
        .action-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .action-desc {
            font-size: 12px;
            color: #707070;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: #0064d2;
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: #0064d2;
            border: 1px solid #0064d2;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .automation-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .automation-title {
            font-size: 20px;
            font-weight: 600;
            color: #0064d2;
            margin-bottom: 15px;
        }
        
        .automation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .automation-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .auto-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auto-desc {
            font-size: 13px;
            color: #707070;
            margin-bottom: 10px;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #00a650;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0064d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .log-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-item {
            font-size: 12px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
            color: #6c757d;
        }
        
        .log-item:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #0064d2;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- APIステータスヘッダー -->
        <div class="header">
            <h1>eBay API統合ダッシュボード</h1>
            <div class="api-status">
                <div class="status-indicator" id="apiStatus"></div>
                <span id="apiStatusText">API接続中...</span>
                <span id="lastUpdate"></span>
            </div>
        </div>

        <!-- リアルタイムデータ表示 -->
        <div class="grid">
            <!-- 売上データ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">売上データ</h3>
                    <button class="refresh-btn" onclick="refreshSalesData()">
                        <span id="salesLoader"></span>更新
                    </button>
                </div>
                <div class="data-row">
                    <span class="data-label">今日の売上</span>
                    <span class="data-value" id="todaySales">$--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">今月の売上</span>
                    <span class="data-value" id="monthSales">$--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">アクティブ出品数</span>
                    <span class="data-value" id="activeListings">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">ウォッチャー数</span>
                    <span class="data-value" id="watchers">--</span>
                </div>
            </div>

            <!-- 注文データ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">注文状況</h3>
                    <button class="refresh-btn" onclick="refreshOrderData()">
                        <span id="orderLoader"></span>更新
                    </button>
                </div>
                <div class="data-row">
                    <span class="data-label">支払い待ち</span>
                    <span class="data-value" id="awaitingPayment">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">発送待ち</span>
                    <span class="data-value urgent" id="awaitingShipment">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">未読メッセージ</span>
                    <span class="data-value urgent" id="unreadMessages">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">対応必要ケース</span>
                    <span class="data-value urgent" id="openCases">--</span>
                </div>
            </div>

            <!-- パフォーマンス -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">パフォーマンス</h3>
                    <button class="refresh-btn" onclick="refreshPerformanceData()">
                        <span id="perfLoader"></span>更新
                    </button>
                </div>
                <div class="data-row">
                    <span class="data-label">フィードバック率</span>
                    <span class="data-value" id="feedbackScore">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">欠陥率</span>
                    <span class="data-value" id="defectRate">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">遅延配送率</span>
                    <span class="data-value" id="lateShipmentRate">--</span>
                </div>
                <div class="data-row">
                    <span class="data-label">セラーレベル</span>
                    <span class="data-value" id="sellerLevel">--</span>
                </div>
            </div>
        </div>

        <!-- アクション可能な項目 -->
        <div class="action-section">
            <h2 style="margin-bottom: 20px; color: #0064d2;">API操作 + eBayページ連携</h2>
            
            <div class="action-item">
                <div class="action-info">
                    <div class="action-title">価格一括更新</div>
                    <div class="action-desc">競合より高い商品の価格を自動調整（API操作）</div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="updatePricesAPI()">
                        🔄 API実行
                    </button>
                    <a href="https://www.ebay.com/mys/listing" target="_blank" class="btn btn-secondary">
                        📝 eBayで編集
                    </a>
                </div>
            </div>

            <div class="action-item">
                <div class="action-info">
                    <div class="action-title">在庫数更新</div>
                    <div class="action-desc">在庫切れ商品の自動停止・復活（API操作）</div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="updateInventoryAPI()">
                        📦 API実行
                    </button>
                    <a href="https://www.ebay.com/mys/listing" target="_blank" class="btn btn-secondary">
                        📊 eBayで確認
                    </a>
                </div>
            </div>

            <div class="action-item">
                <div class="action-info">
                    <div class="action-title">追跡番号一括登録</div>
                    <div class="action-desc">CSVから追跡番号を一括登録（API操作）</div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="uploadTrackingAPI()">
                        🚚 API実行
                    </button>
                    <a href="https://www.ebay.com/mys/sold" target="_blank" class="btn btn-secondary">
                        📋 eBayで確認
                    </a>
                </div>
            </div>

            <div class="action-item">
                <div class="action-info">
                    <div class="action-title">ラベル印刷</div>
                    <div class="action-desc">発送ラベルの印刷（eBayサイト操作必須）</div>
                </div>
                <div class="action-buttons">
                    <span style="color: #707070; font-size: 12px;">APIでは不可</span>
                    <a href="https://www.ebay.com/mys/sold?filter=awaiting_shipment" target="_blank" class="btn btn-primary">
                        🖨️ eBayで印刷
                    </a>
                </div>
            </div>

            <div class="action-item">
                <div class="action-info">
                    <div class="action-title">メッセージ返信</div>
                    <div class="action-desc">買い手からのメッセージ対応（eBayサイト操作推奨）</div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="viewMessagesAPI()">
                        👁️ API確認
                    </button>
                    <a href="https://www.ebay.com/mys/messages" target="_blank" class="btn btn-primary">
                        💬 eBayで返信
                    </a>
                </div>
            </div>
        </div>

        <!-- 自動化設定 -->
        <div class="automation-section">
            <h2 class="automation-title">🤖 自動化設定</h2>
            <div class="automation-grid">
                <div class="automation-card">
                    <div class="auto-title">
                        <span>価格自動調整</span>
                        <div class="toggle-switch" onclick="toggleAutomation('priceAdjust')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="auto-desc">競合価格に基づく自動価格調整（1日1回）</div>
                </div>

                <div class="automation-card">
                    <div class="auto-title">
                        <span>在庫監視</span>
                        <div class="toggle-switch active" onclick="toggleAutomation('inventoryMonitor')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="auto-desc">在庫切れの自動検知・通知（リアルタイム）</div>
                </div>

                <div class="automation-card">
                    <div class="auto-title">
                        <span>メッセージ通知</span>
                        <div class="toggle-switch active" onclick="toggleAutomation('messageAlert')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="auto-desc">新着メッセージのSlack/メール通知</div>
                </div>

                <div class="automation-card">
                    <div class="auto-title">
                        <span>パフォーマンス監視</span>
                        <div class="toggle-switch active" onclick="toggleAutomation('perfMonitor')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="auto-desc">セラーレベル低下の早期警告</div>
                </div>
            </div>
        </div>

        <!-- ログセクション -->
        <div class="log-section">
            <h3 style="margin-bottom: 10px;">実行ログ</h3>
            <div id="logContainer">
                <div class="log-item">
                    <span class="log-time">2024-12-19 14:30:15</span> - 
                    価格自動調整: 15商品の価格を更新しました
                </div>
                <div class="log-item">
                    <span class="log-time">2024-12-19 14:25:08</span> - 
                    在庫監視: 3商品の在庫切れを検知しました
                </div>
                <div class="log-item">
                    <span class="log-time">2024-12-19 14:20:03</span> - 
                    新着メッセージ: 2件の未読メッセージを通知しました
                </div>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let automationSettings = {
            priceAdjust: false,
            inventoryMonitor: true,
            messageAlert: true,
            perfMonitor: true
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateAPIStatus('connecting');
            setTimeout(() => {
                updateAPIStatus('connected');
                loadAllData();
            }, 2000);
        });

        // APIステータス更新
        function updateAPIStatus(status) {
            const indicator = document.getElementById('apiStatus');
            const text = document.getElementById('apiStatusText');
            const lastUpdate = document.getElementById('lastUpdate');

            switch(status) {
                case 'connecting':
                    indicator.className = 'status-indicator warning';
                    text.textContent = 'API接続中...';
                    break;
                case 'connected':
                    indicator.className = 'status-indicator';
                    text.textContent = 'API接続済み';
                    lastUpdate.textContent = `最終更新: ${new Date().toLocaleTimeString('ja-JP')}`;
                    break;
                case 'error':
                    indicator.className = 'status-indicator error';
                    text.textContent = 'API接続エラー';
                    break;
            }
        }

        // 全データ読み込み
        function loadAllData() {
            refreshSalesData();
            refreshOrderData();
            refreshPerformanceData();
        }

        // 売上データ更新（模擬API）
        async function refreshSalesData() {
            showLoader('salesLoader');
            
            // 模擬API呼び出し
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            document.getElementById('todaySales').textContent = '$' + (Math.random() * 500 + 100).toFixed(2);
            document.getElementById('monthSales').textContent = '$' + (Math.random() * 5000 + 2000).toFixed(2);
            document.getElementById('activeListings').textContent = Math.floor(Math.random() * 50 + 200);
            document.getElementById('watchers').textContent = Math.floor(Math.random() * 100 + 300);
            
            hideLoader('salesLoader');
            addLog('売上データを更新しました');
        }

        // 注文データ更新（模擬API）
        async function refreshOrderData() {
            showLoader('orderLoader');
            
            await new Promise(resolve => setTimeout(resolve, 1200));
            
            document.getElementById('awaitingPayment').textContent = Math.floor(Math.random() * 5);
            document.getElementById('awaitingShipment').textContent = Math.floor(Math.random() * 15 + 5);
            document.getElementById('unreadMessages').textContent = Math.floor(Math.random() * 10);
            document.getElementById('openCases').textContent = Math.floor(Math.random() * 3);
            
            hideLoader('orderLoader');
            addLog('注文データを更新しました');
        }

        // パフォーマンスデータ更新（模擬API）
        async function refreshPerformanceData() {
            showLoader('perfLoader');
            
            await new Promise(resolve => setTimeout(resolve, 1800));
            
            document.getElementById('feedbackScore').textContent = (Math.random() * 5 + 95).toFixed(1) + '%';
            document.getElementById('defectRate').textContent = (Math.random() * 0.5).toFixed(2) + '%';
            document.getElementById('lateShipmentRate').textContent = (Math.random() * 3).toFixed(1) + '%';
            document.getElementById('sellerLevel').textContent = 'Top Rated';
            
            hideLoader('perfLoader');
            addLog('パフォーマンスデータを更新しました');
        }

        // API操作系関数
        async function updatePricesAPI() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> 実行中...';
            
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            btn.disabled = false;
            btn.innerHTML = '🔄 API実行';
            addLog('価格一括更新: 12商品の価格を調整しました');
            alert('価格更新完了: 12商品の価格を市場価格に合わせて調整しました');
        }

        async function updateInventoryAPI() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> 実行中...';
            
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            btn.disabled = false;
            btn.innerHTML = '📦 API実行';
            addLog('在庫更新: 8商品の在庫状態を更新しました');
            alert('在庫更新完了: 在庫切れ商品3件を停止、復活商品5件を再開しました');
        }

        async function uploadTrackingAPI() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> 実行中...';
            
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            btn.disabled = false;
            btn.innerHTML = '🚚 API実行';
            addLog('追跡番号登録: 25件の注文に追跡番号を登録しました');
            alert('追跡番号登録完了: 25件の注文に追跡番号を一括登録しました');
        }

        async function viewMessagesAPI() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> 取得中...';
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            btn.disabled = false;
            btn.innerHTML = '👁️ API確認';
            
            const messages = [
                '買い手: 商品の詳細サイズを教えてください',
                '買い手: 配送日数はどのくらいですか？',
                '買い手: まとめ買い割引はありますか？'
            ];
            
            alert('未読メッセージ一覧:\n\n' + messages.join('\n\n'));
            addLog('メッセージ確認: 3件の未読メッセージを取得しました');
        }

        // 自動化設定切り替え
        function toggleAutomation(type) {
            const toggle = event.currentTarget;
            const isActive = toggle.classList.contains('active');
            
            if (isActive) {
                toggle.classList.remove('active');
                automationSettings[type] = false;
            } else {
                toggle.classList.add('active');
                automationSettings[type] = true;
            }
            
            addLog(`自動化設定: ${type} を ${automationSettings[type] ? '有効' : '無効'} にしました`);
        }

        // ユーティリティ関数
        function showLoader(loaderId) {
            document.getElementById(loaderId).innerHTML = '<div class="loading"></div>';
        }

        function hideLoader(loaderId) {
            document.getElementById(loaderId).innerHTML = '';
        }

        function addLog(message) {
            const logContainer = document.getElementById('logContainer');
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `<span class="log-time">${new Date().toLocaleString('ja-JP')}</span> - ${message}`;
            
            logContainer.insertBefore(logItem, logContainer.firstChild);
            
            // 最大10件まで表示
            if (logContainer.children.length > 10) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // 自動更新（30秒ごと）
        setInterval(function() {
            if (automationSettings.inventoryMonitor || automationSettings.messageAlert) {
                refreshOrderData();
            }
        }, 30000);

        // 自動化実行（価格調整は1時間ごと）
        setInterval(function() {
            if (automationSettings.priceAdjust) {
                addLog('自動価格調整を実行しました');
            }
        }, 3600000);
    </script>
</body>
</html>