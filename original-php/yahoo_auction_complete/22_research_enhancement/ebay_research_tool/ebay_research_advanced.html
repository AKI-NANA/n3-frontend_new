<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay Advanced Product Research</title>
    <meta name="description" content="プロの転売ビジネス向け高度なeBayプロダクトリサーチツール">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --n3-color-primary: #2563eb;
            --n3-color-success: #10b981;
            --n3-color-danger: #ef4444;
            --n3-color-warning: #f59e0b;
            --n3-bg-primary: #ffffff;
            --n3-bg-secondary: #f8fafc;
            --n3-bg-tertiary: #f1f5f9;
            --n3-border-color: #e2e8f0;
            --n3-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --n3-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --n3-spacing-md: 1rem;
            --n3-spacing-lg: 1.5rem;
            --n3-text-primary: #1e293b;
            --n3-text-secondary: #475569;
            --n3-text-muted: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--n3-bg-secondary);
            color: var(--n3-text-primary);
            line-height: 1.6;
        }

        .n3-header {
            background: linear-gradient(135deg, var(--n3-color-primary), #1d4ed8);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--n3-shadow-lg);
        }

        .n3-header-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .n3-header-description {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .n3-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .n3-card {
            background: var(--n3-bg-primary);
            border: 1px solid var(--n3-border-color);
            border-radius: 12px;
            box-shadow: var(--n3-shadow-md);
            overflow: hidden;
        }

        /* Search Form Styles */
        .search-section {
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .search-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--n3-border-color);
        }

        .search-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            color: var(--n3-text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .search-tab.active {
            color: var(--n3-color-primary);
            border-bottom-color: var(--n3-color-primary);
            font-weight: 600;
        }

        .search-form {
            display: none;
        }

        .search-form.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--n3-text-primary);
        }

        .form-input, .form-select {
            padding: 0.75rem;
            border: 1px solid var(--n3-border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--n3-color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .main-search-input {
            grid-column: 1 / -1;
        }

        .main-search-input input {
            width: 100%;
            padding: 1rem;
            font-size: 1.2rem;
            border: 2px solid var(--n3-border-color);
            border-radius: 12px;
        }

        .search-button {
            background: var(--n3-color-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            grid-column: 1 / -1;
            justify-self: center;
            max-width: 300px;
        }

        .search-button:hover {
            background: #1d4ed8;
        }

        /* Filters Section */
        .filters-section {
            background: var(--n3-bg-tertiary);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            border: 1px solid var(--n3-border-color);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Results Controls */
        .results-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .view-toggle {
            display: flex;
            background: var(--n3-bg-primary);
            border: 1px solid var(--n3-border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--n3-color-primary);
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            padding: 0.75rem 1rem;
            background: var(--n3-bg-primary);
            border: 1px solid var(--n3-border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--n3-bg-tertiary);
        }

        /* Statistics Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--n3-bg-primary);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--n3-border-color);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--n3-color-primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--n3-text-secondary);
            font-size: 0.9rem;
        }

        /* Card View */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background: var(--n3-bg-primary);
            border: 1px solid var(--n3-border-color);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--n3-shadow-lg);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-content {
            padding: 1.5rem;
        }

        .product-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .product-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--n3-color-success);
        }

        .product-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-sold {
            background: rgba(16, 185, 129, 0.1);
            color: var(--n3-color-success);
        }

        .badge-active {
            background: rgba(37, 99, 235, 0.1);
            color: var(--n3-color-primary);
        }

        .badge-profit-high {
            background: rgba(16, 185, 129, 0.1);
            color: var(--n3-color-success);
        }

        .badge-profit-medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--n3-color-warning);
        }

        .badge-profit-low {
            background: rgba(239, 68, 68, 0.1);
            color: var(--n3-color-danger);
        }

        .product-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 1rem;
            background: var(--n3-bg-tertiary);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-weight: 700;
            color: var(--n3-color-primary);
        }

        .stat-text {
            font-size: 0.8rem;
            color: var(--n3-text-secondary);
        }

        .seller-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .country-flag {
            font-size: 1.2rem;
        }

        .seller-details {
            flex: 1;
        }

        .seller-name {
            font-weight: 600;
            color: var(--n3-color-primary);
        }

        .seller-rating {
            font-size: 0.8rem;
            color: var(--n3-text-secondary);
        }

        .profit-analysis {
            background: var(--n3-bg-tertiary);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .profit-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .profit-value {
            font-weight: 600;
            color: var(--n3-color-success);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-btn {
            flex: 1;
            padding: 0.75rem;
            background: var(--n3-color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .card-btn:hover {
            background: #1d4ed8;
        }

        .card-btn-secondary {
            background: var(--n3-bg-tertiary);
            color: var(--n3-text-primary);
            border: 1px solid var(--n3-border-color);
        }

        .card-btn-secondary:hover {
            background: var(--n3-border-color);
        }

        /* Table View */
        .results-table {
            background: var(--n3-bg-primary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--n3-border-color);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--n3-border-color);
        }

        .data-table th {
            background: var(--n3-bg-tertiary);
            font-weight: 600;
            color: var(--n3-text-primary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tbody tr:hover {
            background: var(--n3-bg-secondary);
        }

        .table-product {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .table-product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .table-product-info {
            flex: 1;
            min-width: 200px;
        }

        .table-product-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .table-product-meta {
            font-size: 0.8rem;
            color: var(--n3-text-secondary);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--n3-bg-primary);
            padding: 2rem;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--n3-text-secondary);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--n3-color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: var(--n3-bg-tertiary);
            color: var(--n3-text-primary);
            border: 1px solid var(--n3-border-color);
        }

        .btn-secondary:hover {
            background: var(--n3-border-color);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--n3-text-secondary);
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .n3-container {
                padding: 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .results-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .stats-dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.5rem;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <header class="n3-header">
        <h1 class="n3-header-title">
            <i class="fas fa-search-dollar"></i>
            eBay Advanced Product Research
        </h1>
        <p class="n3-header-description">プロの転売ビジネス向け高度なリサーチツール</p>
    </header>

    <main class="n3-container">
        <!-- Search Section -->
        <section class="n3-card search-section">
            <!-- Search Tabs -->
            <div class="search-tabs">
                <button class="search-tab active" data-tab="keyword">
                    <i class="fas fa-search"></i> キーワード検索
                </button>
                <button class="search-tab" data-tab="seller">
                    <i class="fas fa-user"></i> セラーリサーチ
                </button>
                <button class="search-tab" data-tab="category">
                    <i class="fas fa-tags"></i> カテゴリー分析
                </button>
            </div>

            <!-- Keyword Search Form -->
            <form class="search-form active" id="keyword-form">
                <div class="form-grid">
                    <div class="form-group main-search-input">
                        <label class="form-label">検索キーワード</label>
                        <input type="text" class="form-input" id="keyword-query" placeholder="商品名、ブランド、モデル名を入力..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">セラーの国</label>
                        <select class="form-select" id="seller-country">
                            <option value="">すべて</option>
                            <option value="JP">日本</option>
                            <option value="US">アメリカ</option>
                            <option value="GB">イギリス</option>
                            <option value="AU">オーストラリア</option>
                            <option value="CA">カナダ</option>
                            <option value="DE">ドイツ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">商品状態</label>
                        <select class="form-select" id="condition">
                            <option value="">すべて</option>
                            <option value="NEW">新品</option>
                            <option value="USED">中古</option>
                            <option value="REFURBISHED">再生品</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">最低価格 (USD)</label>
                        <input type="number" class="form-input" id="min-price" placeholder="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">最高価格 (USD)</label>
                        <input type="number" class="form-input" id="max-price" placeholder="1000" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">最低利益予想 (円)</label>
                        <input type="number" class="form-input" id="min-profit" placeholder="500" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">最低Sold数</label>
                        <input type="number" class="form-input" id="min-sold" placeholder="1" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">データ範囲</label>
                        <select class="form-select" id="data-scope">
                            <option value="all">すべて（売切れ+販売中）</option>
                            <option value="sold">売切れのみ</option>
                            <option value="active">販売中のみ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i> リサーチ開始
                    </button>
                </div>
            </form>

            <!-- Seller Research Form -->
            <form class="search-form" id="seller-form">
                <div class="form-grid">
                    <div class="form-group main-search-input">
                        <label class="form-label">セラーURL / セラーID</label>
                        <input type="text" class="form-input" id="seller-url" placeholder="https://www.ebay.com/usr/seller_name または seller_name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">取得データ</label>
                        <select class="form-select" id="seller-data-scope">
                            <option value="all">すべての出品</option>
                            <option value="sold">売切れ商品のみ</option>
                            <option value="active">販売中商品のみ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="search-button">
                        <i class="fas fa-user-search"></i> セラー分析開始
                    </button>
                </div>
            </form>

            <!-- Category Analysis Form -->
            <form class="search-form" id="category-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">メインカテゴリー</label>
                        <select class="form-select" id="main-category" onchange="updateSubCategories()">
                            <option value="">カテゴリーを選択</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Fashion">Fashion</option>
                            <option value="Home & Garden">Home & Garden</option>
                            <option value="Sports">Sports</option>
                            <option value="Toys">Toys</option>
                            <option value="Collectibles">Collectibles</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">サブカテゴリー</label>
                        <select class="form-select" id="sub-category">
                            <option value="">サブカテゴリーを選択</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">対象国</label>
                        <select class="form-select" id="category-country">
                            <option value="">すべて</option>
                            <option value="JP">日本</option>
                            <option value="US">アメリカ</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="search-button">
                        <i class="fas fa-chart-bar"></i> カテゴリー分析開始
                    </button>
                </div>
            </form>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="hidden">
            <!-- Statistics Dashboard -->
            <div class="stats-dashboard" id="stats-dashboard">
                <!-- Stats will be populated here -->
            </div>

            <!-- Results Controls -->
            <div class="results-controls">
                <div class="view-toggle">
                    <button class="view-btn active" data-view="card">
                        <i class="fas fa-th-large"></i> カード表示
                    </button>
                    <button class="view-btn" data-view="table">
                        <i class="fas fa-table"></i> Excel表示
                    </button>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="translateTitles()">
                        <i class="fas fa-language"></i> 日本語翻訳
                    </button>
                    <button class="action-btn" onclick="downloadCSV()">
                        <i class="fas fa-download"></i> CSV出力
                    </button>
                    <button class="action-btn" onclick="showFilters()">
                        <i class="fas fa-filter"></i> フィルター
                    </button>
                    <button class="action-btn" onclick="showSavedSellers()">
                        <i class="fas fa-bookmark"></i> 保存セラー
                    </button>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="filters-section hidden" id="filters-section">
                <div class="filters-header">
                    <h3>詳細フィルター</h3>
                    <button class="action-btn" onclick="resetFilters()">リセット</button>
                </div>
                <div class="filters-grid">
                    <div class="form-group">
                        <label class="form-label">利益レベル</label>
                        <select class="form-select" id="filter-profit">
                            <option value="">すべて</option>
                            <option value="high">高利益</option>
                            <option value="medium">中利益</option>
                            <option value="low">低利益</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">販売状況</label>
                        <select class="form-select" id="filter-status">
                            <option value="">すべて</option>
                            <option value="sold">売切れ</option>
                            <option value="active">販売中</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">最低閲覧数</label>
                        <input type="number" class="form-input" id="filter-views" placeholder="100" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">最低ウォッチ数</label>
                        <input type="number" class="form-input" id="filter-watchers" placeholder="5" min="0">
                    </div>
                </div>
            </div>

            <!-- Results Container -->
            <div id="results-container">
                <!-- Results will be populated here -->
            </div>
        </section>

        <!-- Loading State -->
        <div id="loading" class="hidden">
            <div class="loading">
                <i class="fas fa-spinner"></i>
                <h3>データを取得中...</h3>
                <p>eBayから商品情報を分析しています</p>
            </div>
        </div>

        <!-- No Results -->
        <div id="no-results" class="hidden">
            <div class="text-center" style="padding: 3rem;">
                <i class="fas fa-search" style="font-size: 3rem; color: var(--n3-text-secondary); margin-bottom: 1rem;"></i>
                <h3>検索結果が見つかりませんでした</h3>
                <p>検索条件を変更してお試しください</p>
            </div>
        </div>
    </main>

    <!-- Seller Save Modal -->
    <div class="modal" id="seller-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">セラー情報保存</h2>
                <button class="modal-close" onclick="closeModal('seller-modal')">&times;</button>
            </div>
            <form id="seller-save-form">
                <div class="form-group mb-2">
                    <label class="form-label">セラー名</label>
                    <input type="text" class="form-input" id="seller-display-name" readonly>
                </div>
                <div class="form-group mb-2">
                    <label class="form-label">お店の名前（覚えやすい名前）</label>
                    <input type="text" class="form-input" id="seller-nickname" placeholder="例：高利益電子機器店">
                </div>
                <div class="form-group mb-2">
                    <label class="form-label">特徴・メモ</label>
                    <textarea class="form-input" id="seller-memo" rows="3" placeholder="どんな特徴がある店舗か、取り扱い商品の傾向など"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('seller-modal')">キャンセル</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Saved Sellers Modal -->
    <div class="modal" id="saved-sellers-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">保存済みセラー一覧</h2>
                <button class="modal-close" onclick="closeModal('saved-sellers-modal')">&times;</button>
            </div>
            <div id="saved-sellers-list">
                <!-- Saved sellers will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentResults = [];
        let currentView = 'card';
        let savedSellers = JSON.parse(localStorage.getItem('ebay-saved-sellers') || '[]');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            loadSavedSellers();
        }

        function setupEventListeners() {
            // Search tab switching
            document.querySelectorAll('.search-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchSearchTab(this.dataset.tab);
                });
            });

            // View toggle
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchView(this.dataset.view);
                });
            });

            // Form submissions
            document.getElementById('keyword-form').addEventListener('submit', handleKeywordSearch);
            document.getElementById('seller-form').addEventListener('submit', handleSellerSearch);
            document.getElementById('category-form').addEventListener('submit', handleCategorySearch);
            document.getElementById('seller-save-form').addEventListener('submit', handleSellerSave);
        }

        function switchSearchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.search-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update forms
            document.querySelectorAll('.search-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        function switchView(viewType) {
            currentView = viewType;

            // Update buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${viewType}"]`).classList.add('active');

            // Re-render results
            if (currentResults.length > 0) {
                renderResults(currentResults);
            }
        }

        async function handleKeywordSearch(e) {
            e.preventDefault();
            
            const formData = {
                action: 'search_products',
                query: document.getElementById('keyword-query').value,
                sellerCountry: document.getElementById('seller-country').value,
                condition: document.getElementById('condition').value,
                minPrice: document.getElementById('min-price').value,
                maxPrice: document.getElementById('max-price').value,
                minProfit: document.getElementById('min-profit').value,
                minSold: document.getElementById('min-sold').value,
                dataScope: document.getElementById('data-scope').value
            };

            await performSearch(formData);
        }

        async function handleSellerSearch(e) {
            e.preventDefault();
            
            const formData = {
                action: 'get_seller_items',
                sellerUrl: document.getElementById('seller-url').value,
                dataScope: document.getElementById('seller-data-scope').value
            };

            await performSearch(formData);
        }

        async function handleCategorySearch(e) {
            e.preventDefault();
            
            const formData = {
                action: 'analyze_category',
                mainCategory: document.getElementById('main-category').value,
                subCategory: document.getElementById('sub-category').value,
                country: document.getElementById('category-country').value
            };

            await performSearch(formData);
        }

        async function performSearch(searchData) {
            showLoading();
            
            try {
                // In a real implementation, this would call the eBay API
                // For now, we'll simulate with sample data
                await simulateApiCall();
                const sampleResults = generateSampleData(searchData);
                
                currentResults = sampleResults;
                showResults();
                renderStats(sampleResults);
                renderResults(sampleResults);
                
            } catch (error) {
                console.error('Search error:', error);
                showNoResults();
            } finally {
                hideLoading();
            }
        }

        function simulateApiCall() {
            return new Promise(resolve => setTimeout(resolve, 2000));
        }

        function generateSampleData(searchData) {
            const sampleData = [];
            const itemCount = Math.floor(Math.random() * 50) + 20;

            for (let i = 0; i < itemCount; i++) {
                const price = Math.random() * 500 + 10;
                const profit = (price * 150) * 0.2 + Math.random() * 1000;
                const sold = Math.floor(Math.random() * 100);
                const views = Math.floor(Math.random() * 1000) + 100;
                const watchers = Math.floor(Math.random() * 50) + 5;

                sampleData.push({
                    id: `item_${i}`,
                    title: `Sample Product ${i + 1} - High Quality Item for Resale`,
                    titleJa: `サンプル商品 ${i + 1} - 転売向け高品質アイテム`,
                    price: price,
                    currency: 'USD',
                    condition: ['NEW', 'USED', 'REFURBISHED'][Math.floor(Math.random() * 3)],
                    image: `https://via.placeholder.com/300x300/4f46e5/ffffff?text=Product${i+1}`,
                    url: `https://ebay.com/itm/item_${i}`,
                    seller: {
                        name: `seller_${i % 10}`,
                        country: ['US', 'GB', 'AU', 'CA', 'DE', 'JP'][Math.floor(Math.random() * 6)],
                        rating: Math.floor(Math.random() * 1000) + 100,
                        positivePercent: 95 + Math.random() * 5
                    },
                    stats: {
                        sold: sold,
                        views: views,
                        watchers: watchers,
                        listingDate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        sellingDuration: Math.floor(Math.random() * 30) + 1
                    },
                    profit: {
                        estimated: Math.round(profit),
                        margin: Math.round((profit / (price * 150)) * 100),
                        level: profit > 2000 ? 'high' : profit > 1000 ? 'medium' : 'low'
                    },
                    status: Math.random() > 0.4 ? 'sold' : 'active'
                });
            }

            return sampleData;
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('no-results').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showResults() {
            document.getElementById('results-section').classList.remove('hidden');
            document.getElementById('no-results').classList.add('hidden');
        }

        function showNoResults() {
            document.getElementById('no-results').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
        }

        function renderStats(data) {
            const totalItems = data.length;
            const soldItems = data.filter(item => item.status === 'sold').length;
            const avgPrice = data.reduce((sum, item) => sum + item.price, 0) / totalItems;
            const totalProfit = data.reduce((sum, item) => sum + item.profit.estimated, 0);
            const highProfitItems = data.filter(item => item.profit.level === 'high').length;

            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-value">${totalItems.toLocaleString()}</div>
                    <div class="stat-label">総商品数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${soldItems.toLocaleString()}</div>
                    <div class="stat-label">売切れ商品</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">$${avgPrice.toFixed(0)}</div>
                    <div class="stat-label">平均価格</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">¥${totalProfit.toLocaleString()}</div>
                    <div class="stat-label">推定総利益</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${highProfitItems}</div>
                    <div class="stat-label">高利益商品</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${((soldItems/totalItems)*100).toFixed(1)}%</div>
                    <div class="stat-label">売上率</div>
                </div>
            `;

            document.getElementById('stats-dashboard').innerHTML = statsHtml;
        }

        function renderResults(data) {
            const container = document.getElementById('results-container');
            
            if (currentView === 'card') {
                container.innerHTML = '<div class="results-grid">' + 
                    data.map(item => createProductCard(item)).join('') + 
                    '</div>';
            } else {
                container.innerHTML = createResultsTable(data);
            }
        }

        function createProductCard(item) {
            const countryFlag = getCountryFlag(item.seller.country);
            
            return `
                <div class="product-card">
                    <img src="${item.image}" alt="${item.title}" class="product-image">
                    <div class="product-content">
                        <h3 class="product-title" title="${item.title}">${item.title}</h3>
                        
                        <div class="product-meta">
                            <div class="product-price">$${item.price.toFixed(2)}</div>
                            <div>約¥${Math.round(item.price * 150).toLocaleString()}</div>
                            <div>状態: ${item.condition}</div>
                            <div>${item.stats.listingDate}</div>
                        </div>

                        <div class="product-badges">
                            <span class="badge badge-${item.status}">${item.status === 'sold' ? '売切れ' : '販売中'}</span>
                            <span class="badge badge-profit-${item.profit.level}">${getProfitLabel(item.profit.level)}</span>
                        </div>

                        <div class="product-stats">
                            <div class="stat-item">
                                <div class="stat-number">${item.stats.sold}</div>
                                <div class="stat-text">販売数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${item.stats.views.toLocaleString()}</div>
                                <div class="stat-text">閲覧数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${item.stats.watchers}</div>
                                <div class="stat-text">ウォッチ</div>
                            </div>
                        </div>

                        <div class="seller-info">
                            <span class="country-flag">${countryFlag}</span>
                            <div class="seller-details">
                                <div class="seller-name">${item.seller.name}</div>
                                <div class="seller-rating">評価: ${item.seller.rating} (${item.seller.positivePercent.toFixed(1)}%)</div>
                            </div>
                        </div>

                        <div class="profit-analysis">
                            <div class="profit-row">
                                <span>推定利益:</span>
                                <span class="profit-value">¥${item.profit.estimated.toLocaleString()}</span>
                            </div>
                            <div class="profit-row">
                                <span>利益率:</span>
                                <span class="profit-value">${item.profit.margin}%</span>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="card-btn" onclick="window.open('${item.url}', '_blank')">
                                <i class="fas fa-external-link-alt"></i> eBayで見る
                            </button>
                            <button class="card-btn card-btn-secondary" onclick="openSellerModal('${item.seller.name}', '${item.seller.country}')">
                                <i class="fas fa-bookmark"></i> セラー保存
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function createResultsTable(data) {
            const headers = [
                '商品情報', '価格', '状態', '販売数', '閲覧数', 'ウォッチ', 
                'セラー', '推定利益', '利益率', '操作'
            ];

            const rows = data.map(item => `
                <tr>
                    <td>
                        <div class="table-product">
                            <img src="${item.image}" alt="${item.title}" class="table-product-image">
                            <div class="table-product-info">
                                <div class="table-product-title">${item.title}</div>
                                <div class="table-product-meta">${item.stats.listingDate} | ${item.condition}</div>
                            </div>
                        </div>
                    </td>
                    <td>$${item.price.toFixed(2)}<br><small>¥${Math.round(item.price * 150).toLocaleString()}</small></td>
                    <td><span class="badge badge-${item.status}">${item.status === 'sold' ? '売切れ' : '販売中'}</span></td>
                    <td>${item.stats.sold}</td>
                    <td>${item.stats.views.toLocaleString()}</td>
                    <td>${item.stats.watchers}</td>
                    <td>${getCountryFlag(item.seller.country)} ${item.seller.name}<br><small>${item.seller.rating} (${item.seller.positivePercent.toFixed(1)}%)</small></td>
                    <td class="profit-value">¥${item.profit.estimated.toLocaleString()}</td>
                    <td>${item.profit.margin}%</td>
                    <td>
                        <button class="btn btn-primary" onclick="window.open('${item.url}', '_blank')" style="font-size: 0.8rem; padding: 0.5rem;">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            return `
                <div class="results-table">
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                            </thead>
                            <tbody>
                                ${rows}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function getCountryFlag(country) {
            const flags = {
                'US': '🇺🇸', 'GB': '🇬🇧', 'AU': '🇦🇺', 'CA': '🇨🇦',
                'DE': '🇩🇪', 'FR': '🇫🇷', 'IT': '🇮🇹', 'JP': '🇯🇵'
            };
            return flags[country] || '🌍';
        }

        function getProfitLabel(level) {
            const labels = {
                'high': '高利益',
                'medium': '中利益',
                'low': '低利益'
            };
            return labels[level] || '不明';
        }

        function updateSubCategories() {
            const mainCategory = document.getElementById('main-category').value;
            const subSelect = document.getElementById('sub-category');
            
            const subCategories = {
                'Electronics': ['Smartphones', 'Computers', 'Cameras', 'Audio', 'Gaming'],
                'Fashion': ['Clothing', 'Shoes', 'Accessories', 'Bags', 'Jewelry'],
                'Home & Garden': ['Furniture', 'Kitchen', 'Tools', 'Garden', 'Decor'],
                'Sports': ['Fitness', 'Outdoor', 'Team Sports', 'Water Sports'],
                'Toys': ['Action Figures', 'Educational', 'Electronic Toys', 'Games'],
                'Collectibles': ['Coins', 'Stamps', 'Trading Cards', 'Vintage']
            };

            subSelect.innerHTML = '<option value="">サブカテゴリーを選択</option>';
            
            if (subCategories[mainCategory]) {
                subCategories[mainCategory].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subSelect.appendChild(option);
                });
            }
        }

        function translateTitles() {
            // In a real implementation, this would call a translation API
            alert('日本語翻訳機能は開発中です。実装時にはGoogle Translate APIなどと連携します。');
        }

        function downloadCSV() {
            if (currentResults.length === 0) {
                alert('出力するデータがありません。');
                return;
            }

            const headers = [
                'タイトル', '価格(USD)', '推定利益(円)', '利益率(%)', '販売数',
                '閲覧数', 'ウォッチ数', 'セラー名', 'セラー国', '商品状態', '出品日'
            ];

            const csvContent = [
                headers.join(','),
                ...currentResults.map(item => [
                    `"${item.title.replace(/"/g, '""')}"`,
                    item.price,
                    item.profit.estimated,
                    item.profit.margin,
                    item.stats.sold,
                    item.stats.views,
                    item.stats.watchers,
                    item.seller.name,
                    item.seller.country,
                    item.condition,
                    item.stats.listingDate
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ebay_research_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function showFilters() {
            const filtersSection = document.getElementById('filters-section');
            filtersSection.classList.toggle('hidden');
        }

        function resetFilters() {
            document.querySelectorAll('#filters-section input, #filters-section select').forEach(input => {
                input.value = '';
            });
            // Re-render results without filters
            renderResults(currentResults);
        }

        function openSellerModal(sellerName, country) {
            document.getElementById('seller-display-name').value = sellerName;
            document.getElementById('seller-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function handleSellerSave(e) {
            e.preventDefault();
            
            const sellerData = {
                id: Date.now(),
                name: document.getElementById('seller-display-name').value,
                nickname: document.getElementById('seller-nickname').value,
                memo: document.getElementById('seller-memo').value,
                savedDate: new Date().toISOString().split('T')[0]
            };

            savedSellers.push(sellerData);
            localStorage.setItem('ebay-saved-sellers', JSON.stringify(savedSellers));
            
            alert('セラー情報を保存しました！');
            closeModal('seller-modal');
            
            // Reset form
            document.getElementById('seller-save-form').reset();
        }

        function showSavedSellers() {
            const modal = document.getElementById('saved-sellers-modal');
            const listContainer = document.getElementById('saved-sellers-list');
            
            if (savedSellers.length === 0) {
                listContainer.innerHTML = '<p class="text-center">保存されたセラーがありません。</p>';
            } else {
                listContainer.innerHTML = savedSellers.map(seller => `
                    <div class="n3-card" style="margin-bottom: 1rem; padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h4>${seller.nickname || seller.name}</h4>
                                <p><strong>セラー名:</strong> ${seller.name}</p>
                                <p><strong>保存日:</strong> ${seller.savedDate}</p>
                                ${seller.memo ? `<p><strong>メモ:</strong> ${seller.memo}</p>` : ''}
                            </div>
                            <button class="btn btn-secondary" onclick="deleteSeller(${seller.id})" style="font-size: 0.8rem;">
                                <i class="fas fa-trash"></i> 削除
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.add('active');
        }

        function deleteSeller(sellerId) {
            if (confirm('このセラーを削除しますか？')) {
                savedSellers = savedSellers.filter(seller => seller.id !== sellerId);
                localStorage.setItem('ebay-saved-sellers', JSON.stringify(savedSellers));
                showSavedSellers(); // Refresh the list
            }
        }

        function loadSavedSellers() {
            // Already loaded in global variable initialization
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>