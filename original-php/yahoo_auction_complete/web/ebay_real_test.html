<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>eBayå®Ÿéš›ã®API ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</title>
</head>
<body style="font-family: Arial, sans-serif; margin: 20px; background-color: #f8f9fa; padding: 0;">
    <div style="max-width: 1200px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <h1 style="color: #333; text-align: center; margin-bottom: 10px; font-size: 28px;">ğŸ”¥ eBayå®Ÿéš›ã®API ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 16px;">æœ¬ç‰©ã®eBay APIã‹ã‚‰å®Ÿéš›ã®å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ä¿å­˜</p>
        
        <!-- è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div style="background-color: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #ffc107;">
            <h3 style="color: #856404; margin-top: 0;">âš ï¸ å®Ÿéš›ã®APIä½¿ç”¨ã«ã¤ã„ã¦</h3>
            <p style="color: #856404; margin-bottom: 0;">
                ã“ã®ãƒ†ã‚¹ãƒˆã¯å®Ÿéš›ã®eBay APIã‚’ä½¿ç”¨ã—ã¾ã™ã€‚APIåˆ¶é™ã‚„ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒåˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
                <strong>Finding API</strong>ï¼ˆæ¤œç´¢ï¼‰ã¯åˆ©ç”¨å¯èƒ½ã§ã™ãŒã€<strong>Browse API</strong>ï¼ˆè©³ç´°ï¼‰ã¯æ¨©é™åˆ¶é™ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            </p>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: å®Ÿéš›ã®å•†å“æ¤œç´¢ -->
        <div style="background-color: #e7f3ff; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #007bff;">
            <h3 style="color: #0056b3; margin-top: 0;">Step 1: å®Ÿéš›ã®å•†å“æ¤œç´¢ï¼ˆFinding APIï¼‰</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #333;">æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</label>
                <input type="text" id="real-search-term" value="iphone" style="width: 300px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;">
                <button onclick="searchRealProducts()" style="padding: 10px 20px; margin-left: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: bold; background-color: #007bff; color: white;">
                    ğŸ” å®Ÿéš›ã®eBayæ¤œç´¢
                </button>
            </div>
            <p style="color: #0056b3; font-size: 14px; margin-bottom: 0;">
                <strong>ä½¿ç”¨API:</strong> eBay Finding Service v1.0 - å®Ÿéš›ã®å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™
            </p>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: å®Ÿéš›ã®å•†å“é¸æŠ -->
        <div style="background-color: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #ffc107;">
            <h3 style="color: #856404; margin-top: 0;">Step 2: å®Ÿéš›ã®å•†å“é¸æŠ</h3>
            <div id="real-products-list" style="margin-bottom: 15px;">
                <p style="color: #666;">ã¾ãšå®Ÿéš›ã®eBayæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</p>
            </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: å®Ÿéš›ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾— -->
        <div style="background-color: #d1ecf1; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #17a2b8;">
            <h3 style="color: #0c5460; margin-top: 0;">Step 3: å®Ÿéš›ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ä¿å­˜</h3>
            <div id="real-detailed-actions" style="margin-bottom: 15px;">
                <button id="real-get-details-btn" onclick="getRealProductDetails()" disabled style="padding: 12px 24px; margin: 5px; border: none; border-radius: 5px; cursor: not-allowed; font-size: 14px; font-weight: bold; background-color: #6c757d; color: white;">
                    ğŸ“Š å®Ÿéš›ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—
                </button>
                <button id="real-save-data-btn" onclick="saveRealData()" disabled style="padding: 12px 24px; margin: 5px; border: none; border-radius: 5px; cursor: not-allowed; font-size: 14px; font-weight: bold; background-color: #6c757d; color: white;">
                    ğŸ’¾ å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’DBä¿å­˜
                </button>
            </div>
            <p style="color: #0c5460; font-size: 14px; margin-bottom: 0;">
                <strong>ä½¿ç”¨API:</strong> eBay Browse API v1 (åˆ¶é™ã‚ã‚Š) â†’ Finding API (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
            </p>
        </div>
        
        <!-- APIçŠ¶æ³è¡¨ç¤º -->
        <div id="api-status" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 25px; border: 1px solid #dee2e6;">
            <h4 style="color: #333; margin-top: 0;">ğŸ”Œ APIæ¥ç¶šçŠ¶æ³</h4>
            <div id="api-status-content">
                <p style="color: #666; margin-bottom: 0;">APIãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¥ç¶šçŠ¶æ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
        </div>
        
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div id="real-loading" style="display: none; color: #007bff; font-weight: bold; text-align: center; font-size: 18px; margin: 20px 0;">
            ğŸ”„ å®Ÿéš›ã®eBay APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...
        </div>
        
        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="real-result" style="margin-top: 25px; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 2px solid #ddd; background-color: #f8f9fa; font-size: 12px; line-height: 1.4;"></div>
        
        <!-- å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="real-detailed-display" style="margin-top: 25px;"></div>
    </div>

    <script>
        let selectedRealItemId = '';
        let currentRealProductData = null;
        
        function showRealLoading() {
            document.getElementById('real-loading').style.display = 'block';
        }
        
        function hideRealLoading() {
            document.getElementById('real-loading').style.display = 'none';
        }
        
        async function makeRealRequest(action, data = {}) {
            try {
                const formData = new FormData();
                formData.append('action', action);
                
                for (const [key, value] of Object.entries(data)) {
                    formData.append(key, value);
                }
                
                const response = await fetch('ebay_real_api_test.php', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                
                try {
                    return JSON.parse(text);
                } catch (e) {
                    return {
                        success: false,
                        error: 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ',
                        raw_response: text.substring(0, 500)
                    };
                }
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function displayRealResult(result) {
            const resultElement = document.getElementById('real-result');
            
            if (result.success) {
                resultElement.style.backgroundColor = '#d4edda';
                resultElement.style.color = '#155724';
                resultElement.style.borderColor = '#c3e6cb';
            } else {
                resultElement.style.backgroundColor = '#f8d7da';
                resultElement.style.color = '#721c24';
                resultElement.style.borderColor = '#f5c6cb';
            }
            
            resultElement.innerHTML = JSON.stringify(result, null, 2);
        }
        
        function updateApiStatus(result) {
            const statusContent = document.getElementById('api-status-content');
            
            if (result.success) {
                statusContent.innerHTML = `
                    <p style="color: #28a745; margin: 5px 0;"><strong>âœ… APIæ¥ç¶šæˆåŠŸ</strong></p>
                    <p style="color: #333; margin: 5px 0;">æ¤œç´¢çµæœ: ${result.returned_items || 0}ä»¶</p>
                    <p style="color: #333; margin: 5px 0;">APIå¿œç­”æ™‚é–“: ${result.timestamp}</p>
                    <p style="color: #333; margin: 5px 0;">ä½¿ç”¨API: eBay Finding Service</p>
                `;
            } else {
                statusContent.innerHTML = `
                    <p style="color: #dc3545; margin: 5px 0;"><strong>âŒ APIæ¥ç¶šã‚¨ãƒ©ãƒ¼</strong></p>
                    <p style="color: #333; margin: 5px 0;">ã‚¨ãƒ©ãƒ¼: ${result.error}</p>
                    <p style="color: #333; margin: 5px 0;">è©³ç´°: ${JSON.stringify(result.debug_info || {})}</p>
                `;
            }
        }
        
        async function searchRealProducts() {
            const searchTerm = document.getElementById('real-search-term').value;
            showRealLoading();
            
            const result = await makeRealRequest('search_products_real', { search_term: searchTerm });
            hideRealLoading();
            
            displayRealResult(result);
            updateApiStatus(result);
            
            if (result.success && result.items) {
                displayRealProductsList(result.items);
            }
        }
        
        function displayRealProductsList(items) {
            const productsList = document.getElementById('real-products-list');
            
            let html = `<h4 style="margin-bottom: 15px; color: #333;">å®Ÿéš›ã®eBayæ¤œç´¢çµæœï¼ˆ${items.length}ä»¶ï¼‰:</h4>`;
            
            items.forEach((item, index) => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; background-color: white;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="radio" name="real-selected-product" value="${item.itemId}" onchange="selectRealProduct('${item.itemId}')" style="margin-right: 10px;">
                            <strong style="color: #333; font-size: 16px;">${item.title}</strong>
                        </div>
                        <div style="margin-left: 25px; color: #666; font-size: 14px;">
                            <p style="margin: 3px 0;"><strong>ä¾¡æ ¼:</strong> $${item.price} ${item.currency}</p>
                            <p style="margin: 3px 0;"><strong>çŠ¶æ…‹:</strong> ${item.condition}</p>
                            <p style="margin: 3px 0;"><strong>è²©å£²è€…:</strong> ${item.seller_username} (è©•ä¾¡: ${item.seller_feedback_score}, ${item.seller_positive_feedback}%)</p>
                            <p style="margin: 3px 0;"><strong>å ´æ‰€:</strong> ${item.location}, ${item.country}</p>
                            <p style="margin: 3px 0;"><strong>é€æ–™:</strong> $${item.shipping_cost}</p>
                            <p style="margin: 3px 0;"><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${item.category_name}</p>
                            <p style="margin: 3px 0;"><strong>å•†å“ID:</strong> ${item.itemId}</p>
                            <p style="margin: 3px 0;"><strong>ã‚¦ã‚©ãƒƒãƒæ•°:</strong> ${item.watch_count}</p>
                            ${item.view_item_url ? `<p style="margin: 3px 0;"><a href="${item.view_item_url}" target="_blank" style="color: #007bff;">eBayã§è¦‹ã‚‹</a></p>` : ''}
                        </div>
                    </div>
                `;
            });
            
            productsList.innerHTML = html;
        }
        
        function selectRealProduct(itemId) {
            selectedRealItemId = itemId;
            
            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            const getDetailsBtn = document.getElementById('real-get-details-btn');
            getDetailsBtn.disabled = false;
            getDetailsBtn.style.cursor = 'pointer';
            getDetailsBtn.style.backgroundColor = '#17a2b8';
            
            console.log('é¸æŠã•ã‚ŒãŸå®Ÿéš›ã®å•†å“ID:', itemId);
        }
        
        async function getRealProductDetails() {
            if (!selectedRealItemId) {
                alert('ã¾ãšå•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            showRealLoading();
            
            const result = await makeRealRequest('get_real_product_details', { item_id: selectedRealItemId });
            hideRealLoading();
            
            displayRealResult(result);
            
            if (result.success && result.detailed_data) {
                currentRealProductData = result;
                displayRealDetailedData(result.detailed_data);
                
                // ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                const saveBtn = document.getElementById('real-save-data-btn');
                saveBtn.disabled = false;
                saveBtn.style.cursor = 'pointer';
                saveBtn.style.backgroundColor = '#28a745';
            }
        }
        
        function displayRealDetailedData(detailedData) {
            const detailedDisplay = document.getElementById('real-detailed-display');
            
            let html = '<h3 style="color: #333; margin-bottom: 20px; text-align: center;">ğŸ“‹ å®Ÿéš›ã®eBayã‹ã‚‰å–å¾—ã—ãŸè©³ç´°ãƒ‡ãƒ¼ã‚¿</h3>';
            
            // å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            const sections = [
                { key: 'basic_info', title: 'åŸºæœ¬æƒ…å ±', color: '#007bff' },
                { key: 'pricing', title: 'ä¾¡æ ¼æƒ…å ±', color: '#ffc107' },
                { key: 'seller_info', title: 'è²©å£²è€…æƒ…å ±', color: '#28a745' },
                { key: 'item_specifics', title: 'å•†å“ä»•æ§˜', color: '#17a2b8' },
                { key: 'listing_details', title: 'ãƒªã‚¹ãƒˆè©³ç´°', color: '#6f42c1' },
                { key: 'shipping_info', title: 'é…é€æƒ…å ±', color: '#fd7e14' },
                { key: 'images', title: 'ç”»åƒæƒ…å ±', color: '#20c997' }
            ];
            
            sections.forEach(section => {
                if (detailedData[section.key] && Object.keys(detailedData[section.key]).length > 0) {
                    html += `<div style="background-color: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 5px; border-left: 4px solid ${section.color};">`;
                    html += `<h4 style="color: ${section.color}; margin-top: 0;">${section.title}</h4>`;
                    html += '<table style="width: 100%; border-collapse: collapse;">';
                    
                    const sectionData = detailedData[section.key];
                    for (const [key, value] of Object.entries(sectionData)) {
                        let displayValue = value;
                        
                        // å€¤ã®å‹ã«å¿œã˜ã¦è¡¨ç¤ºã‚’èª¿æ•´
                        if (typeof value === 'object' && value !== null) {
                            displayValue = JSON.stringify(value, null, 2);
                        } else if (typeof value === 'boolean') {
                            displayValue = value ? 'âœ… ã¯ã„' : 'âŒ ã„ã„ãˆ';
                        } else if (typeof value === 'string' && value.startsWith('http')) {
                            displayValue = `<a href="${value}" target="_blank" style="color: #007bff;">${value}</a>`;
                        }
                        
                        html += `<tr><td style="padding: 5px; border-bottom: 1px solid #ddd; font-weight: bold; width: 30%; vertical-align: top;">${key}</td><td style="padding: 5px; border-bottom: 1px solid #ddd; word-break: break-all;">${displayValue}</td></tr>`;
                    }
                    html += '</table></div>';
                }
            });
            
            // ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼
            const totalFields = Object.keys(detailedData).reduce((total, section) => {
                const sectionData = detailedData[section];
                return total + (typeof sectionData === 'object' && sectionData !== null ? Object.keys(sectionData).length : 1);
            }, 0);
            
            html += `<div style="background-color: #e2e3e5; padding: 15px; border-radius: 5px; text-align: center;">
                <strong>ğŸ“Š å®Ÿãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼: ${Object.keys(detailedData).length}ã‚»ã‚¯ã‚·ãƒ§ãƒ³, ${totalFields}å€‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—</strong><br>
                <strong>APIæƒ…å ±:</strong> ${currentRealProductData.api_source || 'eBay API'}
            </div>`;
            
            detailedDisplay.innerHTML = html;
        }
        
        async function saveRealData() {
            if (!currentRealProductData) {
                alert('ã¾ãšå®Ÿéš›ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„');
                return;
            }
            
            showRealLoading();
            
            const result = await makeRealRequest('save_real_data', { 
                item_data: JSON.stringify(currentRealProductData) 
            });
            hideRealLoading();
            
            displayRealResult(result);
            
            if (result.success) {
                alert('å®Ÿéš›ã®eBayãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜æˆåŠŸï¼');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            console.log('ğŸš€ eBayå®Ÿéš›ã®API ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆèµ·å‹•å®Œäº†');
            
            const resultElement = document.getElementById('real-result');
            resultElement.style.backgroundColor = '#e7f3ff';
            resultElement.style.color = '#0c5460';
            resultElement.style.borderColor = '#bee5eb';
            resultElement.innerHTML = 'ğŸ‰ eBayå®Ÿéš›ã®API ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼\n\nğŸ”¥ ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å®Ÿéš›ã®eBay APIã‚’ä½¿ç”¨ã—ã¾ã™\n\nStep 1: å®Ÿéš›ã®eBayå•†å“æ¤œç´¢ï¼ˆFinding APIï¼‰\nStep 2: æ¤œç´¢çµæœã‹ã‚‰å®Ÿéš›ã®å•†å“ã‚’1ã¤é¸æŠ\nStep 3: å®Ÿéš›ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—â†’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜\n\nâš ï¸ APIåˆ¶é™ã«ã‚ˆã‚Šã€ä¸€éƒ¨ãƒ‡ãƒ¼ã‚¿å–å¾—ã«åˆ¶é™ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™';
        };
    </script>
</body>
</html>
