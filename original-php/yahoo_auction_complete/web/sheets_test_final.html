<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Google Sheetså®Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ - å®Œå…¨ä¿®æ­£ç‰ˆ</title>
</head>
<body style="font-family: Arial, sans-serif; margin: 20px; background-color: #f8f9fa; padding: 0;">
    <div style="max-width: 1000px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <h1 style="color: #333; text-align: center; margin-bottom: 10px; font-size: 28px;">ğŸ“Š Google Sheetså®Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 16px;">å®Œå…¨ä¿®æ­£ç‰ˆ - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CSSä½¿ç”¨</p>
        
        <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div style="background-color: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid #007bff;">
            <strong style="color: #0056b3;">âœ… APIæ¥ç¶šç¢ºèªæ¸ˆã¿</strong><br>
            <span style="color: #333;">Google Sheets APIã¨ã®æ¥ç¶šãŒç¢ºèªã§ãã¾ã—ãŸã€‚ä¿®æ­£ç‰ˆã§å†ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</span>
        </div>
        
        <!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
        <div style="text-align: center; margin-bottom: 30px;">
            <button onclick="getSheetsData()" style="padding: 15px 30px; margin: 10px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; background-color: #007bff; color: white; transition: background-color 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" onmouseover="this.style.backgroundColor='#0056b3'" onmouseout="this.style.backgroundColor='#007bff'">
                ğŸ“¥ Sheetsãƒ‡ãƒ¼ã‚¿å–å¾—
            </button>
            <button onclick="writeToSheets()" style="padding: 15px 30px; margin: 10px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; background-color: #28a745; color: white; transition: background-color 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" onmouseover="this.style.backgroundColor='#1e7e34'" onmouseout="this.style.backgroundColor='#28a745'">
                ğŸ“¤ Sheetsã«ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿
            </button>
        </div>
        
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <div id="loading" style="display: none; color: #007bff; font-weight: bold; text-align: center; font-size: 18px; margin: 20px 0;">
            ğŸ”„ å‡¦ç†ä¸­...
        </div>
        
        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="result" style="margin-top: 25px; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 2px solid #ddd; background-color: #f8f9fa; font-size: 12px; line-height: 1.4;"></div>
        
        <!-- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="data-display" style="margin-top: 25px;"></div>
    </div>

    <script>
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        async function makeRequest(action) {
            try {
                const formData = new FormData();
                formData.append('action', action);
                
                const response = await fetch('google_sheets_fixed.php', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                
                try {
                    return JSON.parse(text);
                } catch (e) {
                    return {
                        success: false,
                        error: 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ',
                        raw_response: text.substring(0, 500)
                    };
                }
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function displayResult(result) {
            const resultElement = document.getElementById('result');
            
            if (result.success) {
                resultElement.style.backgroundColor = '#d4edda';
                resultElement.style.color = '#155724';
                resultElement.style.borderColor = '#c3e6cb';
                resultElement.style.borderWidth = '2px';
            } else {
                resultElement.style.backgroundColor = '#f8d7da';
                resultElement.style.color = '#721c24';
                resultElement.style.borderColor = '#f5c6cb';
                resultElement.style.borderWidth = '2px';
            }
            
            resultElement.innerHTML = JSON.stringify(result, null, 2);
        }
        
        function displayDataTable(values) {
            const dataDisplay = document.getElementById('data-display');
            
            if (!values || values.length === 0) {
                dataDisplay.innerHTML = '<p style="color: #666; text-align: center; font-size: 16px; padding: 20px;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            let html = '<h3 style="color: #333; margin-bottom: 15px; font-size: 20px; text-align: center;">ğŸ“‹ å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿</h3>';
            html += '<div style="max-height: 350px; overflow-y: auto; border: 2px solid #007bff; border-radius: 8px; background-color: white;">';
            html += '<table style="width: 100%; border-collapse: collapse; margin: 0;">';
            
            // ãƒ‡ãƒ¼ã‚¿è¡Œ
            html += '<tbody>';
            values.forEach((row, rowIndex) => {
                html += '<tr style="' + (rowIndex % 2 === 0 ? 'background-color: #f8f9fa;' : 'background-color: white;') + '">';
                row.forEach((cell, cellIndex) => {
                    const isHeader = rowIndex === 0;
                    const style = isHeader 
                        ? "border: 1px solid #dee2e6; padding: 12px 8px; text-align: left; background-color: #007bff; color: white; font-weight: bold; font-size: 14px;"
                        : "border: 1px solid #dee2e6; padding: 10px 8px; text-align: left; font-size: 13px;";
                    html += `<${isHeader ? 'th' : 'td'} style="${style}">${cell || '<span style="color: #999; font-style: italic;">ç©º</span>'}</${isHeader ? 'th' : 'td'}>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table></div>';
            
            html += `<p style="margin-top: 15px; color: #666; font-size: 14px; text-align: center;"><strong>â€» ${values.length}è¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­</strong></p>`;
            
            dataDisplay.innerHTML = html;
        }
        
        async function getSheetsData() {
            showLoading();
            const result = await makeRequest('get_sheets_data');
            hideLoading();
            
            displayResult(result);
            
            if (result.success && result.values) {
                displayDataTable(result.values);
            }
        }
        
        async function writeToSheets() {
            showLoading();
            const result = await makeRequest('write_to_sheets');
            hideLoading();
            
            displayResult(result);
            
            if (result.success) {
                // æ›¸ãè¾¼ã¿å¾Œã€ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¦è¡¨ç¤º
                setTimeout(() => {
                    getSheetsData();
                }, 1500);
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            console.log('ğŸš€ Google Sheetså®Œå…¨ä¿®æ­£ç‰ˆãƒ†ã‚¹ãƒˆèµ·å‹•å®Œäº†');
            
            // èµ·å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
            const resultElement = document.getElementById('result');
            resultElement.style.backgroundColor = '#e7f3ff';
            resultElement.style.color = '#0c5460';
            resultElement.style.borderColor = '#bee5eb';
            resultElement.innerHTML = 'ğŸ‰ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†ï¼\n\nä¸Šè¨˜ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Google Sheetsã¨ã®é€£æºã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚';
        };
    </script>
</body>
</html>
