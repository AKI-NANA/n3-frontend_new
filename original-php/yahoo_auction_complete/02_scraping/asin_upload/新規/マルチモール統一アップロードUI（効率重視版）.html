<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ«çµ±ä¸€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  - NAGANO-3</title>

    <!-- ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      /* ===== NAGANO-3çµ±ä¸€CSSå¤‰æ•°ï¼ˆé€æ–™HTMLãƒ«ãƒ¼ãƒ«æº–æ‹ ï¼‰ ===== */
      :root {
        /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
        --color-primary: #3b82f6;
        --color-secondary: #8b5cf6;
        --color-success: #10b981;
        --color-warning: #f59e0b;
        --color-danger: #ef4444;
        --color-info: #06b6d4;

        /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
        --accent-blue: #06b6d4;
        --accent-purple: #8b5cf6;
        --accent-green: #10b981;
        --accent-orange: #f97316;

        /* èƒŒæ™¯ã‚«ãƒ©ãƒ¼ */
        --bg-primary: #f8fafc;
        --bg-secondary: #ffffff;
        --bg-tertiary: #f1f5f9;
        --bg-hover: #e2e8f0;
        --bg-active: #cbd5e1;

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ */
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --text-tertiary: #64748b;
        --text-muted: #94a3b8;
        --text-white: #ffffff;

        /* ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»ã‚·ãƒ£ãƒ‰ã‚¦ */
        --border-color: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);

        /* ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚° */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;

        /* ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ã‚¸ã‚¢ã‚¹ */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-2xl: 1.25rem;

        /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
        --text-xs: 0.75rem;
        --text-sm: 0.875rem;
        --text-base: 1rem;
        --text-lg: 1.125rem;
        --text-xl: 1.25rem;
        --text-2xl: 1.5rem;
        --text-3xl: 1.875rem;

        /* ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
        --transition-fast: all 0.15s ease;
        --transition-normal: all 0.3s ease;
      }

      /* ===== ãƒªã‚»ãƒƒãƒˆãƒ»ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« ===== */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        height: 100%;
        scroll-behavior: smooth;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        font-size: var(--text-sm);
      }

      /* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--space-4);
      }

      /* ===== ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨CSSï¼ˆBEMæº–æ‹ ï¼‰ ===== */

      /* ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .upload__page-header {
        background: linear-gradient(
          135deg,
          var(--color-primary),
          var(--color-secondary)
        );
        border-radius: var(--radius-xl);
        padding: var(--space-6);
        margin-bottom: var(--space-6);
        color: var(--text-white);
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .upload__page-header::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -10%;
        width: 150px;
        height: 150px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: rotate(45deg);
      }

      .upload__header-content {
        position: relative;
        z-index: 2;
      }

      .upload__page-title {
        font-size: var(--text-2xl);
        font-weight: 700;
        margin-bottom: var(--space-2);
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .upload__title-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-xl);
      }

      .upload__page-subtitle {
        font-size: var(--text-base);
        opacity: 0.9;
        margin: 0;
      }

      /* ãƒ¡ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
      .upload__main-section {
        background: var(--bg-secondary);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        overflow: hidden;
        margin-bottom: var(--space-6);
      }

      /* å…±é€šæ©Ÿèƒ½ã‚¨ãƒªã‚¢ */
      .upload__common-area {
        padding: var(--space-6);
      }

      /* ãƒ¢ãƒ¼ãƒ«é¸æŠï¼ˆæ”¹è‰¯ç‰ˆï¼šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */
      .upload__mall-selector {
        margin-bottom: var(--space-6);
      }

      .upload__mall-title {
        font-size: var(--text-base);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-3);
      }

      /* ã€è¿½åŠ ã€‘æ–°ã—ã„ãƒ¢ãƒ¼ãƒ«ãƒœã‚¿ãƒ³CSS */
      .mall-btn {
        background: var(--bg-tertiary);
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-2);
        text-align: center;
        cursor: pointer;
        transition: var(--transition-fast);
        font-size: var(--text-xs);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-1);
        min-height: 70px;
        position: relative;
      }

      .mall-btn:hover {
        border-color: var(--color-primary);
        background: var(--bg-hover);
        transform: translateY(-1px);
      }

      .mall-btn.selected {
        border-color: var(--color-primary);
        background: rgba(59, 130, 246, 0.1);
      }

      .mall-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .mall-icon {
        font-size: 1.2rem;
      }

      .mall-name {
        font-weight: 500;
        text-align: center;
        line-height: 1.2;
      }

      .mall-status {
        position: absolute;
        top: 2px;
        right: 2px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }

      .mall-status.active {
        background: var(--color-success);
      }
      .mall-status.beta {
        background: var(--color-warning);
      }
      .mall-status.coming {
        background: var(--text-muted);
      }

      /* ã€ä¿®æ­£ã€‘ã‚°ãƒªãƒƒãƒ‰ã‚µã‚¤ã‚ºã‚’å°ã•ãå¤‰æ›´ */
      .upload__mall-grid {
        display: grid;
        grid-template-columns: repeat(
          auto-fill,
          minmax(100px, 1fr)
        ); /* 200px â†’ 100px */
        gap: var(--space-2); /* space-4 â†’ space-2 */
        max-height: 300px;
        overflow-y: auto;
        padding: var(--space-2);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        background: var(--bg-primary);
      }

      .upload__mall-option {
        position: relative;
      }

      .upload__mall-checkbox {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .upload__mall-label {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-3);
        background: var(--bg-tertiary);
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-fast);
        font-size: var(--text-sm);
        font-weight: 500;
        text-align: center;
        min-height: 48px;
        user-select: none;
      }

      .upload__mall-checkbox:checked ~ .upload__mall-label {
        background: var(--color-primary);
        color: var(--text-white);
        border-color: var(--color-primary);
        box-shadow: var(--shadow-md);
      }

      .upload__mall-label:hover {
        background: var(--bg-hover);
        transform: translateY(-1px);
      }

      .upload__mall-checkbox:checked ~ .upload__mall-label:hover {
        background: var(--color-primary);
        filter: brightness(1.1);
      }

      /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .upload__section-header {
        background: var(--bg-tertiary);
        padding: var(--space-4);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .upload__section-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .upload__selected-mall {
        background: var(--color-primary);
        color: var(--text-white);
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
      }

      /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
      .upload__tabs {
        display: flex;
        background: var(--bg-tertiary);
        border-bottom: 1px solid var(--border-color);
      }

      .upload__tab-button {
        flex: 1;
        padding: var(--space-4) var(--space-6);
        border: none;
        background: transparent;
        color: var(--text-secondary);
        font-size: var(--text-sm);
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition-fast);
        border-bottom: 3px solid transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
      }

      .upload__tab-button:hover {
        background: var(--bg-hover);
        color: var(--text-primary);
      }

      .upload__tab-button--active {
        background: var(--bg-secondary);
        color: var(--color-primary);
        border-bottom-color: var(--color-primary);
      }

      /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
      .upload__tab-content {
        padding: var(--space-6);
        display: none;
      }

      .upload__tab-content--active {
        display: block;
      }

      /* æ¤œè¨¼ãƒ«ãƒ¼ãƒ«è¡¨ç¤º */
      .upload__validation-rules {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-bottom: var(--space-6);
      }

      .upload__rules-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-3);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .upload__rules-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .upload__rules-list li {
        padding: var(--space-2) 0;
        color: var(--text-secondary);
        font-size: var(--text-sm);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .upload__rules-list li::before {
        content: "âœ“";
        color: var(--color-success);
        font-weight: bold;
        width: 16px;
        text-align: center;
      }

      /* CSVã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º */
      .upload__sample-section {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin-bottom: var(--space-4);
      }

      .upload__sample-title {
        font-size: var(--text-base);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-2);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .upload__sample-code {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        font-family: "Courier New", monospace;
        font-size: var(--text-xs);
        color: var(--text-secondary);
        white-space: pre;
        overflow-x: auto;
      }

      /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
      .upload__form-group {
        margin-bottom: var(--space-4);
      }

      .upload__form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-4);
      }

      .upload__label {
        display: block;
        font-size: var(--text-sm);
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: var(--space-2);
      }

      .upload__input {
        width: 100%;
        padding: var(--space-3);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        color: var(--text-primary);
        background: var(--bg-secondary);
        transition: var(--transition-fast);
      }

      .upload__input:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .upload__textarea {
        min-height: 120px;
        resize: vertical;
      }

      /* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
      .upload__file-area {
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--space-6);
        text-align: center;
        cursor: pointer;
        transition: var(--transition-fast);
        background: var(--bg-tertiary);
        margin-bottom: var(--space-4);
        position: relative;
      }

      .upload__file-area:hover {
        border-color: var(--color-primary);
        background: var(--bg-hover);
      }

      .upload__file-area--dragover {
        border-color: var(--color-primary);
        background: rgba(59, 130, 246, 0.1);
      }

      .upload__file-icon {
        font-size: var(--text-2xl);
        margin-bottom: var(--space-2);
        color: var(--text-muted);
      }

      .upload__file-text {
        font-size: var(--text-base);
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: var(--space-1);
      }

      .upload__file-subtext {
        font-size: var(--text-sm);
        color: var(--text-secondary);
      }

      .upload__hidden-input {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      /* å°‚ç”¨æ©Ÿèƒ½ã‚¨ãƒªã‚¢ */
      .upload__specific-area {
        background: var(--bg-tertiary);
        border-top: 1px solid var(--border-color);
        padding: var(--space-6);
        display: none;
      }

      .upload__specific-area--show {
        display: block;
      }

      .upload__specific-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-4);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      /* å–å¾—ä»¶æ•°åˆ¶é™ï¼ˆæ•°å€¤å…¥åŠ›å¯¾å¿œï¼‰ */
      .upload__limit-group {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-2);
      }

      .upload__limit-checkbox {
        margin: 0;
      }

      .upload__limit-input {
        width: 80px;
        padding: var(--space-1) var(--space-2);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        text-align: center;
        font-size: var(--text-sm);
      }

      .upload__limit-label {
        font-size: var(--text-sm);
        color: var(--text-secondary);
        margin: 0;
      }

      /* ãƒœã‚¿ãƒ³ã‚·ã‚¹ãƒ†ãƒ  */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        padding: var(--space-3) var(--space-5);
        border: 1px solid transparent;
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        transition: var(--transition-fast);
        user-select: none;
        font-family: inherit;
      }

      .btn--primary {
        background: var(--color-primary);
        color: var(--text-white);
        border-color: var(--color-primary);
        box-shadow: var(--shadow-sm);
      }

      .btn--primary:hover {
        background: #2563eb;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn--secondary {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border-color: var(--border-color);
      }

      .btn--secondary:hover {
        background: var(--bg-hover);
      }

      .btn--success {
        background: var(--color-success);
        color: var(--text-white);
        border-color: var(--color-success);
      }

      .btn--large {
        padding: var(--space-4) var(--space-6);
        font-size: var(--text-base);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
      .upload__progress {
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        overflow: hidden;
        margin-bottom: var(--space-4);
        display: none;
      }

      .upload__progress--show {
        display: block;
      }

      .upload__progress-bar {
        height: 20px;
        background: linear-gradient(
          90deg,
          var(--color-primary),
          var(--color-secondary)
        );
        border-radius: var(--radius-md);
        transition: width 0.3s ease;
        width: 0%;
        position: relative;
      }

      .upload__progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--text-white);
        font-size: var(--text-xs);
        font-weight: 600;
      }

      /* çµæœè¡¨ç¤º */
      .upload__results {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        padding: var(--space-5);
        margin-top: var(--space-6);
        display: none;
      }

      .upload__results--show {
        display: block;
      }

      .upload__results-title {
        font-size: var(--text-lg);
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-4);
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .upload__results-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--space-4);
        margin-bottom: var(--space-4);
      }

      .upload__stat-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        text-align: center;
      }

      .upload__stat-number {
        font-size: var(--text-xl);
        font-weight: 700;
        color: var(--color-primary);
        display: block;
      }

      .upload__stat-label {
        font-size: var(--text-xs);
        color: var(--text-secondary);
        margin-top: var(--space-1);
      }

      /* é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: var(--space-3) var(--space-4);
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        max-width: 350px;
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .notification--show {
        transform: translateX(0);
      }

      .notification--success {
        background: var(--color-success);
        color: var(--text-white);
      }

      .notification--error {
        background: var(--color-danger);
        color: var(--text-white);
      }

      .notification--info {
        background: var(--color-info);
        color: var(--text-white);
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
      @media (max-width: 768px) {
        .container {
          padding: var(--space-3);
        }

        .upload__page-header {
          padding: var(--space-4);
        }

        .upload__page-title {
          font-size: var(--text-xl);
          flex-direction: column;
          text-align: center;
        }

        .upload__form-row {
          grid-template-columns: 1fr;
        }

        .upload__mall-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .upload__results-summary {
          grid-template-columns: repeat(2, 1fr);
        }

        .upload__tabs {
          flex-direction: column;
        }

        .upload__tab-button {
          border-bottom: 1px solid var(--border-color);
          border-right: none;
        }

        .upload__tab-button--active {
          border-bottom-color: var(--border-color);
          border-left: 3px solid var(--color-primary);
        }
      }

      @media (max-width: 480px) {
        .upload__mall-grid {
          grid-template-columns: 1fr;
        }

        .upload__results-summary {
          grid-template-columns: 1fr;
        }
      }

      /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç† */
      *:focus {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
      }

      /* é¸æŠãƒ†ã‚­ã‚¹ãƒˆ */
      ::selection {
        background-color: rgba(59, 130, 246, 0.3);
        color: var(--text-primary);
      }
    </style>
  <script>
// CAIDS error_handling Hook

// CAIDS ã‚¨ãƒ©ãƒ¼å‡¦ç†Hook - å®Œå…¨å®Ÿè£…
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('âš ï¸ CAIDS ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åˆæœŸåŒ–');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('ğŸš¨ CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">ğŸš¨</span>
                <div>
                    <strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»é€ä¿¡ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('ğŸ“‹ CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<script>
// CAIDS user_feedback Hook
// CAIDS user_feedback Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_feedback Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_limit Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… development_control Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_monitoring Hook
// CAIDS character_monitoring Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_monitoring Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS processing_capacity_monitoring Hook
// CAIDS processing_capacity_monitoring Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… processing_capacity_monitoring Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_approval_required Hook loaded');
</script>
<script>
// CAIDS timeout_management Hook
// CAIDS timeout_management Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… timeout_management Hook loaded');
</script>
</head>
  <body>
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="container">
      <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="upload__page-header">
        <div class="upload__header-content">
          <h1 class="upload__page-title">
            <div class="upload__title-icon">
              <i class="fas fa-upload"></i>
            </div>
            ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ«çµ±ä¸€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 
          </h1>
          <p class="upload__page-subtitle">
            åŠ¹ç‡é‡è¦–ã®SaaSä¼æ¥­ã‚¹ã‚¿ã‚¤ãƒ« - å…¨ãƒ¢ãƒ¼ãƒ«å¯¾å¿œãƒ»å®Œå…¨çµ±åˆç‰ˆ
          </p>
        </div>
      </header>

      <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <main class="upload__main-section">
        <!-- å…±é€šæ©Ÿèƒ½ã‚¨ãƒªã‚¢ï¼ˆä¸Šéƒ¨ï¼‰ -->
        <div class="upload__common-area">
          <!-- ãƒ¢ãƒ¼ãƒ«é¸æŠï¼ˆæ”¹è‰¯ç‰ˆï¼šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ -->
          <div class="upload__mall-selector">
            <div class="upload__mall-title">å¯¾è±¡ãƒ¢ãƒ¼ãƒ«é¸æŠ</div>
            <!-- ã€è¿½åŠ ã€‘æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ -->
            <div style="margin-bottom: var(--space-4)">
              <input
                type="text"
                id="searchInput"
                placeholder="ãƒ¢ãƒ¼ãƒ«åã§æ¤œç´¢..."
                style="
                  width: 100%;
                  max-width: 400px;
                  padding: var(--space-2) var(--space-3);
                  border: 1px solid var(--border-color);
                  border-radius: var(--radius-md);
                  font-size: var(--text-sm);
                "
                onkeyup="filterMalls()"
              />
            </div>
            <!-- ã€ç½®ãæ›ãˆã€‘ãƒ¢ãƒ¼ãƒ«ã‚°ãƒªãƒƒãƒ‰ -->
            <div class="upload__mall-grid" id="mallGrid">
              <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="upload__section-header">
          <h2 class="upload__section-title">
            <i class="fas fa-database"></i>
            ãƒ‡ãƒ¼ã‚¿å…¥åŠ›æ–¹æ³•ã‚’é¸æŠ
          </h2>
          <span class="upload__selected-mall" id="selectedMallDisplay"
            >Amazon</span
          >
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="upload__tabs">
          <button
            class="upload__tab-button upload__tab-button--active"
            onclick="switchTab('csv-upload')"
          >
            <i class="fas fa-file-csv"></i>
            CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          </button>
          <button
            class="upload__tab-button"
            onclick="switchTab('manual-input')"
          >
            <i class="fas fa-edit"></i>
            æ‰‹å‹•å…¥åŠ›
          </button>
          <button class="upload__tab-button" onclick="switchTab('bulk-paste')">
            <i class="fas fa-clipboard"></i>
            ä¸€æ‹¬è²¼ã‚Šä»˜ã‘
          </button>
          <button
            class="upload__tab-button"
            onclick="switchTab('url-auto-collect')"
          >
            <i class="fas fa-magic"></i>
            URLè‡ªå‹•å–å¾—
          </button>
        </nav>

        <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¿ãƒ– -->
        <div
          id="csv-upload"
          class="upload__tab-content upload__tab-content--active"
        >
          <!-- æ¤œè¨¼ãƒ«ãƒ¼ãƒ«è¡¨ç¤º -->
          <div class="upload__validation-rules">
            <div class="upload__rules-title">
              <i class="fas fa-check-circle"></i>
              CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼è¦ä»¶
            </div>
            <ul class="upload__rules-list">
              <li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: .csv, .xlsxå¯¾å¿œ</li>
              <li>æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 10MB</li>
              <li>æœ€å¤§è¡Œæ•°: 10,000è¡Œ</li>
              <li>æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: UTF-8æ¨å¥¨</li>
              <li>åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼: ASIN, URL, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰, SKU (ä»»æ„)</li>
            </ul>
          </div>

          <!-- ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º -->
          <div class="upload__sample-section">
            <div class="upload__sample-title">
              <i class="fas fa-code"></i>
              CSVã‚µãƒ³ãƒ—ãƒ«å½¢å¼ <span id="currentMallName">(Amazon)</span>
            </div>
            <div class="upload__sample-code" id="csvSample">
              ASIN,URL,å•†å“å,ä¾¡æ ¼
              B08N5WRWNW,https://amazon.co.jp/dp/B08N5WRWNW,Echo Dot,3980
              B09B8RRQT5,https://amazon.co.jp/dp/B09B8RRQT5,Fire Stick,4980
            </div>
          </div>

          <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
          <div class="upload__form-group">
            <div
              class="upload__file-area"
              onclick="document.getElementById('csvFile').click()"
            >
              <div class="upload__file-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="upload__file-text">
                CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
              </div>
              <div class="upload__file-subtext">
                ã¾ãŸã¯ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
              </div>
              <input
                type="file"
                id="csvFile"
                class="upload__hidden-input"
                accept=".csv,.xlsx,.xls"
              />
            </div>
          </div>

          <!-- å‡¦ç†ãƒœã‚¿ãƒ³ -->
          <div class="upload__form-group">
            <button
              class="btn btn--primary btn--large"
              onclick="processCsvFile()"
              disabled
              id="processCsvBtn"
            >
              <i class="fas fa-cogs"></i>
              CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
            </button>
          </div>
        </div>

        <!-- æ‰‹å‹•å…¥åŠ›ã‚¿ãƒ– -->
        <div id="manual-input" class="upload__tab-content">
          <div class="upload__form-group">
            <label class="upload__label" for="asinInput">
              <i class="fas fa-barcode"></i>
              <span id="asinLabel">ASIN</span>
            </label>
            <input
              type="text"
              id="asinInput"
              class="upload__input"
              placeholder="ä¾‹: B08N5WRWNW"
            />
          </div>

          <div class="upload__form-group">
            <label class="upload__label" for="urlInput">
              <i class="fas fa-link"></i>
              å•†å“URL
            </label>
            <input
              type="url"
              id="urlInput"
              class="upload__input"
              placeholder="ä¾‹: https://amazon.co.jp/dp/B08N5WRWNW"
            />
          </div>

          <div class="upload__form-group">
            <button
              class="btn btn--primary btn--large"
              onclick="processManualInput()"
            >
              <i class="fas fa-search"></i>
              å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            </button>
          </div>
        </div>

        <!-- ä¸€æ‹¬è²¼ã‚Šä»˜ã‘ã‚¿ãƒ– -->
        <div id="bulk-paste" class="upload__tab-content">
          <div class="upload__form-group">
            <label class="upload__label" for="bulkInput">
              <i class="fas fa-clipboard-list"></i>
              <span id="bulkLabel">ASINãƒ»URLä¸€æ‹¬å…¥åŠ›</span>
            </label>
            <textarea
              id="bulkInput"
              class="upload__input upload__textarea"
              placeholder="ASINã¾ãŸã¯URLã‚’1è¡Œãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;&#10;ä¾‹:&#10;B08N5WRWNW&#10;https://amazon.co.jp/dp/B09B8RRQT5&#10;B07YNM3GJG"
            ></textarea>
          </div>

          <div class="upload__form-group">
            <button
              class="btn btn--primary btn--large"
              onclick="processBulkInput()"
            >
              <i class="fas fa-list-check"></i>
              ä¸€æ‹¬å‡¦ç†ã‚’é–‹å§‹
            </button>
          </div>
        </div>

        <!-- URLè‡ªå‹•å–å¾—ã‚¿ãƒ– -->
        <div id="url-auto-collect" class="upload__tab-content">
          <div class="upload__validation-rules">
            <div class="upload__rules-title">
              <i class="fas fa-magic"></i>
              URLè‡ªå‹•å–å¾—æ©Ÿèƒ½
            </div>
            <ul class="upload__rules-list">
              <li>æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã®URLã‚’æŒ‡å®š</li>
              <li>ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•é€²è¡Œ</li>
              <li>æŒ‡å®šä»¶æ•°ã¾ã§å•†å“URLã‚’è‡ªå‹•åé›†</li>
              <li>æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§çµã‚Šè¾¼ã¿å¯èƒ½</li>
            </ul>
          </div>

          <div class="upload__form-group">
            <label class="upload__label" for="startUrlInput">
              <i class="fas fa-link"></i>
              é–‹å§‹URLï¼ˆæ¤œç´¢çµæœãƒšãƒ¼ã‚¸ï¼‰
            </label>
            <input
              type="url"
              id="startUrlInput"
              class="upload__input"
              placeholder="ä¾‹: https://amazon.co.jp/s?k=ã‚¹ãƒãƒ¼ãƒˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼"
            />
          </div>

          <div class="upload__form-row">
            <div class="upload__form-group">
              <label class="upload__label" for="maxCountInput">
                <i class="fas fa-hashtag"></i>
                å–å¾—ä»¶æ•°
              </label>
              <select id="maxCountInput" class="upload__input">
                <option value="50">50ä»¶</option>
                <option value="100" selected>100ä»¶</option>
                <option value="200">200ä»¶</option>
                <option value="500">500ä»¶</option>
                <option value="1000">1000ä»¶</option>
              </select>
            </div>

            <div class="upload__form-group">
              <label class="upload__label" for="priceRangeInput">
                <i class="fas fa-yen-sign"></i>
                ä¾¡æ ¼å¸¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
              </label>
              <select id="priceRangeInput" class="upload__input">
                <option value="">åˆ¶é™ãªã—</option>
                <option value="0-1000">1,000å††ä»¥ä¸‹</option>
                <option value="1000-5000">1,000å††-5,000å††</option>
                <option value="5000-10000">5,000å††-10,000å††</option>
                <option value="10000-50000">10,000å††-50,000å††</option>
                <option value="50000-">50,000å††ä»¥ä¸Š</option>
              </select>
            </div>
          </div>

          <div class="upload__form-group">
            <button
              class="btn btn--primary btn--large"
              onclick="processUrlAutoCollect()"
            >
              <i class="fas fa-magic"></i>
              è‡ªå‹•å–å¾—ã‚’é–‹å§‹
            </button>
          </div>
        </div>

        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
        <div class="upload__progress" id="progressBar">
          <div class="upload__progress-bar" id="progressBarFill">
            <div class="upload__progress-text" id="progressText">0%</div>
          </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="upload__results" id="resultsArea">
          <div class="upload__results-title">
            <i class="fas fa-chart-line"></i>
            å‡¦ç†çµæœ
          </div>

          <div class="upload__results-summary">
            <div class="upload__stat-card">
              <span class="upload__stat-number" id="totalCount">0</span>
              <div class="upload__stat-label">ç·ä»¶æ•°</div>
            </div>
            <div class="upload__stat-card">
              <span class="upload__stat-number" id="successCount">0</span>
              <div class="upload__stat-label">æˆåŠŸ</div>
            </div>
            <div class="upload__stat-card">
              <span class="upload__stat-number" id="errorCount">0</span>
              <div class="upload__stat-label">ã‚¨ãƒ©ãƒ¼</div>
            </div>
            <div class="upload__stat-card">
              <span class="upload__stat-number" id="processingTime">0s</span>
              <div class="upload__stat-label">å‡¦ç†æ™‚é–“</div>
            </div>
          </div>

          <div class="upload__form-group">
            <button
              class="btn btn--success"
              onclick="downloadResults()"
              disabled
              id="downloadBtn"
            >
              <i class="fas fa-download"></i>
              çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </button>
            <button
              class="btn btn--secondary"
              onclick="resetForm()"
              style="margin-left: var(--space-3)"
            >
              <i class="fas fa-redo"></i>
              ãƒªã‚»ãƒƒãƒˆ
            </button>
          </div>
        </div>

        <!-- å°‚ç”¨æ©Ÿèƒ½ã‚¨ãƒªã‚¢ï¼ˆä¸‹éƒ¨é…ç½®ï¼‰ -->
        <div class="upload__specific-area" id="specificArea">
          <h3 class="upload__specific-title">
            <i class="fas fa-cog"></i>
            <span id="specificMallName">Amazon</span> å°‚ç”¨æ©Ÿèƒ½
          </h3>

          <!-- å–å¾—ä»¶æ•°åˆ¶é™ï¼ˆæ•°å€¤å…¥åŠ›å¯¾å¿œï¼‰ -->
          <div class="upload__form-group">
            <label class="upload__label">å–å¾—ä»¶æ•°åˆ¶é™</label>
            <div class="upload__limit-group">
              <input
                type="checkbox"
                class="upload__limit-checkbox"
                id="enableLimit"
                onchange="toggleLimitInput()"
              />
              <label for="enableLimit" class="upload__limit-label">æœ€å¤§</label>
              <input
                type="number"
                class="upload__limit-input"
                id="limitValue"
                value="100"
                min="1"
                max="10000"
                disabled
              />
              <label class="upload__limit-label">ä»¶ã¾ã§</label>
            </div>
          </div>

          <!-- ãƒ¢ãƒ¼ãƒ«åˆ¥å°‚ç”¨æ©Ÿèƒ½ -->
          <div class="upload__form-row">
            <!-- Amazonå°‚ç”¨ -->
            <div
              class="upload__form-group"
              id="amazon-features"
              style="display: none"
            >
              <label class="upload__label">Amazonå°‚ç”¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: var(--space-2);
                "
              >
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--space-2);
                    font-size: var(--text-sm);
                  "
                >
                  <input type="checkbox" id="amazon-fba" /> FBAå¯¾å¿œå•†å“ã®ã¿
                </label>
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--space-2);
                    font-size: var(--text-sm);
                  "
                >
                  <input type="checkbox" id="amazon-prime" /> Primeå¯¾è±¡å•†å“ã®ã¿
                </label>
              </div>
            </div>

            <!-- æ¥½å¤©å°‚ç”¨ -->
            <div
              class="upload__form-group"
              id="rakuten-features"
              style="display: none"
            >
              <label class="upload__label">æ¥½å¤©å¸‚å ´å°‚ç”¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: var(--space-2);
                "
              >
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--space-2);
                    font-size: var(--text-sm);
                  "
                >
                  <input type="checkbox" id="rakuten-points" /> ãƒã‚¤ãƒ³ãƒˆæƒ…å ±å–å¾—
                </label>
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--space-2);
                    font-size: var(--text-sm);
                  "
                >
                  <input type="checkbox" id="rakuten-shop" /> ã‚·ãƒ§ãƒƒãƒ—è©•ä¾¡å–å¾—
                </label>
              </div>
            </div>

            <!-- eBayå°‚ç”¨ -->
            <div
              class="upload__form-group"
              id="ebay-features"
              style="display: none"
            >
              <label class="upload__label">eBayå°‚ç”¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: var(--space-2);
                "
              >
                <div class="upload__form-group">
                  <label class="upload__label">å¯¾è±¡åœ°åŸŸ</label>
                  <select class="upload__input">
                    <option value="us">ã‚¢ãƒ¡ãƒªã‚«</option>
                    <option value="uk">ã‚¤ã‚®ãƒªã‚¹</option>
                    <option value="de">ãƒ‰ã‚¤ãƒ„</option>
                    <option value="au">ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢</option>
                  </select>
                </div>
                <label
                  style="
                    display: flex;
                    align-items: center;
                    gap: var(--space-2);
                    font-size: var(--text-sm);
                  "
                >
                  <input type="checkbox" id="ebay-shipping" /> é€æ–™æƒ…å ±å–å¾—
                </label>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- é€šçŸ¥ã‚¨ãƒªã‚¢ -->
    <div id="notificationArea"></div>

    <!-- JavaScript -->
    <script>
      // ===== ãƒ¢ãƒ¼ãƒ«è¨­å®šï¼ˆåŠ¹ç‡é‡è¦–ç‰ˆï¼‰ =====
      // ã€å‰Šé™¤ã€‘mallConfigså®šç¾©ã€selectedMalls, updateMallSelection, updateUIForMallé–¢æ•°

      let isProcessing = false;
      let currentFile = null;

      // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ =====
      function switchTab(tabId) {
        // å…¨ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
        document.querySelectorAll(".upload__tab-button").forEach((btn) => {
          btn.classList.remove("upload__tab-button--active");
        });

        // å…¨ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
        document.querySelectorAll(".upload__tab-content").forEach((content) => {
          content.classList.remove("upload__tab-content--active");
        });

        // å¯¾è±¡ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
        document
          .querySelector(`[onclick="switchTab('${tabId}')"]`)
          .classList.add("upload__tab-button--active");
        document
          .getElementById(tabId)
          .classList.add("upload__tab-content--active");

        // çµæœã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
        hideResults();
      }

      // ===== å–å¾—ä»¶æ•°åˆ¶é™ãƒˆã‚°ãƒ« =====
      function toggleLimitInput() {
        const checkbox = document.getElementById("enableLimit");
        const input = document.getElementById("limitValue");
        input.disabled = !checkbox.checked;
      }

      // ===== ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç† =====
      function setupFileUpload() {
        const fileInput = document.getElementById("csvFile");
        const uploadArea = document.querySelector(".upload__file-area");
        const processBtn = document.getElementById("processCsvBtn");

        fileInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            handleFileSelection(file);
          }
        });

        uploadArea.addEventListener("dragover", function (e) {
          e.preventDefault();
          uploadArea.classList.add("upload__file-area--dragover");
        });

        uploadArea.addEventListener("dragleave", function (e) {
          e.preventDefault();
          uploadArea.classList.remove("upload__file-area--dragover");
        });

        uploadArea.addEventListener("drop", function (e) {
          e.preventDefault();
          uploadArea.classList.remove("upload__file-area--dragover");

          const files = e.dataTransfer.files;
          if (files.length > 0) {
            fileInput.files = files;
            handleFileSelection(files[0]);
          }
        });
      }

      function handleFileSelection(file) {
        // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
        const allowedTypes = [
          "text/csv",
          "application/vnd.ms-excel",
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        ];
        const fileExtension = "." + file.name.split(".").pop().toLowerCase();
        const allowedExtensions = [".csv", ".xlsx", ".xls"];

        if (
          !allowedTypes.includes(file.type) &&
          !allowedExtensions.includes(fileExtension)
        ) {
          showNotification(
            "ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚CSVã€XLSã€XLSXãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚",
            "error"
          );
          return;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ (10MB)
        const maxSize = 10 * 1024 * 1024;
        if (file.size > maxSize) {
          showNotification(
            "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚10MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
            "error"
          );
          return;
        }

        currentFile = file;
        document.getElementById("processCsvBtn").disabled = false;
        showNotification(
          `ãƒ•ã‚¡ã‚¤ãƒ« "${file.name}" ãŒé¸æŠã•ã‚Œã¾ã—ãŸã€‚å‡¦ç†ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¶šè¡Œã—ã¦ãã ã•ã„ã€‚`,
          "success"
        );
      }

      // ===== å‡¦ç†æ©Ÿèƒ½ =====
      async function processCsvFile() {
        if (!currentFile || isProcessing) return;

        isProcessing = true;
        showProgress(true);
        updateProgress(0, "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æä¸­...");

        try {
          await simulateProcessing();

          showResults({
            total: 1000,
            success: 950,
            error: 50,
            processingTime: 32,
          });

          showNotification("CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚", "success");
        } catch (error) {
          showNotification(
            "å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message,
            "error"
          );
        } finally {
          isProcessing = false;
          showProgress(false);
        }
      }

      async function processManualInput() {
        if (isProcessing) return;

        const asinValue = document.getElementById("asinInput").value.trim();
        const url = document.getElementById("urlInput").value.trim();

        if (!asinValue && !url) {
          const config = mallConfigs[selectedMalls[0]];
          showNotification(
            `${config.asinLabel}ã¾ãŸã¯URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`,
            "error"
          );
          return;
        }

        isProcessing = true;
        showProgress(true);
        updateProgress(0, "å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...");

        try {
          await simulateProcessing();

          showResults({
            total: 1,
            success: 1,
            error: 0,
            processingTime: 2,
          });

          showNotification(
            `${
              mallConfigs[selectedMalls[0]].name
            }ã®å•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`,
            "success"
          );
        } catch (error) {
          showNotification(
            "ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message,
            "error"
          );
        } finally {
          isProcessing = false;
          showProgress(false);
        }
      }

      async function processBulkInput() {
        if (isProcessing) return;

        const bulkData = document.getElementById("bulkInput").value.trim();
        if (!bulkData) {
          const config = mallConfigs[selectedMalls[0]];
          showNotification(
            `${config.bulkLabel.replace("ä¸€æ‹¬å…¥åŠ›", "")}ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`,
            "error"
          );
          return;
        }

        const lines = bulkData.split("\n").filter((line) => line.trim());
        if (lines.length === 0) {
          showNotification("æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", "error");
          return;
        }

        isProcessing = true;
        showProgress(true);
        updateProgress(
          0,
          `${mallConfigs[selectedMalls[0]].name}: ${
            lines.length
          }ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ä¸­...`
        );

        try {
          await simulateProcessing();

          const successCount = Math.floor(lines.length * 0.95);
          const errorCount = lines.length - successCount;

          showResults({
            total: lines.length,
            success: successCount,
            error: errorCount,
            processingTime: Math.ceil(lines.length / 10),
          });

          showNotification(
            `${mallConfigs[selectedMalls[0]].name}: ${
              lines.length
            }ä»¶ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`,
            "success"
          );
        } catch (error) {
          showNotification(
            "ä¸€æ‹¬å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message,
            "error"
          );
        } finally {
          isProcessing = false;
          showProgress(false);
        }
      }

      async function processUrlAutoCollect() {
        if (isProcessing) return;

        const startUrl = document.getElementById("startUrlInput").value.trim();
        const maxCount = parseInt(
          document.getElementById("maxCountInput").value
        );
        const priceRange = document.getElementById("priceRangeInput").value;

        if (!startUrl) {
          showNotification("é–‹å§‹URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", "error");
          return;
        }

        isProcessing = true;
        showProgress(true);
        updateProgress(
          0,
          `${mallConfigs[selectedMalls[0]].name}: URLè‡ªå‹•å–å¾—ã‚’é–‹å§‹ä¸­...`
        );

        try {
          // æ®µéšçš„ãªé€²æ—è¡¨ç¤º
          updateProgress(20, "ãƒšãƒ¼ã‚¸ã‚’è§£æä¸­...");
          await new Promise((resolve) => setTimeout(resolve, 1000));

          updateProgress(40, "å•†å“URLã‚’åé›†ä¸­...");
          await new Promise((resolve) => setTimeout(resolve, 1500));

          updateProgress(60, "ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€²è¡Œä¸­...");
          await new Promise((resolve) => setTimeout(resolve, 1200));

          updateProgress(80, "ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’é©ç”¨ä¸­...");
          await new Promise((resolve) => setTimeout(resolve, 800));

          updateProgress(100, "è‡ªå‹•å–å¾—å®Œäº†");

          const successCount = Math.floor(maxCount * 0.92);
          const errorCount = maxCount - successCount;

          showResults({
            total: maxCount,
            success: successCount,
            error: errorCount,
            processingTime: Math.ceil(maxCount / 50),
          });

          showNotification(
            `${
              mallConfigs[selectedMalls[0]].name
            }: ${successCount}ä»¶ã®URLè‡ªå‹•å–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`,
            "success"
          );
        } catch (error) {
          showNotification(
            "URLè‡ªå‹•å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message,
            "error"
          );
        } finally {
          isProcessing = false;
          showProgress(false);
        }
      }

      // ===== UIåˆ¶å¾¡æ©Ÿèƒ½ =====
      function showProgress(show) {
        const progressBar = document.getElementById("progressBar");
        if (show) {
          progressBar.classList.add("upload__progress--show");
        } else {
          progressBar.classList.remove("upload__progress--show");
        }
      }

      function updateProgress(percentage, message) {
        const progressFill = document.getElementById("progressBarFill");
        const progressText = document.getElementById("progressText");

        progressFill.style.width = percentage + "%";
        progressText.textContent = message || `${percentage}%`;
      }

      function showResults(data) {
        document.getElementById("totalCount").textContent =
          data.total.toLocaleString();
        document.getElementById("successCount").textContent =
          data.success.toLocaleString();
        document.getElementById("errorCount").textContent =
          data.error.toLocaleString();
        document.getElementById("processingTime").textContent =
          data.processingTime + "s";

        document
          .getElementById("resultsArea")
          .classList.add("upload__results--show");
        document.getElementById("downloadBtn").disabled = false;
      }

      function hideResults() {
        document
          .getElementById("resultsArea")
          .classList.remove("upload__results--show");
        document.getElementById("downloadBtn").disabled = true;
      }

      function resetForm() {
        document.getElementById("csvFile").value = "";
        document.getElementById("asinInput").value = "";
        document.getElementById("urlInput").value = "";
        document.getElementById("bulkInput").value = "";
        document.getElementById("startUrlInput").value = "";
        document.getElementById("maxCountInput").value = "100";
        currentFile = null;
        isProcessing = false;

        // é€²æ—ãƒãƒ¼éš ã™
        showProgress(false);
        hideResults();

        // å…¥åŠ›å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ
        document.getElementById("priceRangeInput").value = "";
        document.getElementById("enableLimit").checked = false;
        document.getElementById("limitValue").disabled = true;
        document.getElementById("limitValue").value = "100";

        // å°‚ç”¨æ©Ÿèƒ½ãƒªã‚»ãƒƒãƒˆ
        document
          .querySelectorAll('#amazon-features input[type="checkbox"]')
          .forEach((cb) => (cb.checked = false));
        document
          .querySelectorAll('#rakuten-features input[type="checkbox"]')
          .forEach((cb) => (cb.checked = false));
        document
          .querySelectorAll('#ebay-features input[type="checkbox"]')
          .forEach((cb) => (cb.checked = false));

        showNotification("ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚", "info");
      }

      function downloadResults() {
        if (!document.getElementById("downloadBtn").disabled) {
          // çµæœã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          const csvContent = generateResultsCsv();
          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const link = document.createElement("a");
          const url = URL.createObjectURL(blob);

          link.setAttribute("href", url);
          link.setAttribute(
            "download",
            `mall_data_results_${new Date().toISOString().slice(0, 10)}.csv`
          );
          link.style.visibility = "hidden";

          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          showNotification(
            "çµæœãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚",
            "success"
          );
        }
      }

      function generateResultsCsv() {
        const results = getCurrentResults();
        let csvContent = "ASIN,URL,å•†å“å,ä¾¡æ ¼,ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n";

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯å‡¦ç†çµæœã‚’ä½¿ç”¨ï¼‰
        for (let i = 1; i <= results.total; i++) {
          const status = i <= results.success ? "æˆåŠŸ" : "ã‚¨ãƒ©ãƒ¼";
          csvContent += `B0${String(i).padStart(
            8,
            "0"
          )},https://amazon.co.jp/dp/B0${String(i).padStart(
            8,
            "0"
          )},å•†å“å${i},${
            Math.floor(Math.random() * 10000) + 1000
          },${status}\n`;
        }

        return csvContent;
      }

      function getCurrentResults() {
        return {
          total:
            parseInt(
              document
                .getElementById("totalCount")
                .textContent.replace(/,/g, "")
            ) || 0,
          success:
            parseInt(
              document
                .getElementById("successCount")
                .textContent.replace(/,/g, "")
            ) || 0,
          error:
            parseInt(
              document
                .getElementById("errorCount")
                .textContent.replace(/,/g, "")
            ) || 0,
        };
      }

      // ===== é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  =====
      function showNotification(message, type = "info") {
        // æ—¢å­˜ã®é€šçŸ¥ãŒã‚ã‚Œã°å‰Šé™¤
        const existingNotification = document.querySelector(".notification");
        if (existingNotification) {
          existingNotification.remove();
        }

        const notification = document.createElement("div");
        notification.className = `notification notification--${type}`;

        const icon = getNotificationIcon(type);
        notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;

        document.getElementById("notificationArea").appendChild(notification);

        // è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        setTimeout(() => {
          notification.classList.add("notification--show");
        }, 100);

        // è‡ªå‹•å‰Šé™¤
        setTimeout(() => {
          notification.classList.remove("notification--show");
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        }, 4000);
      }

      function getNotificationIcon(type) {
        switch (type) {
          case "success":
            return "fas fa-check-circle";
          case "error":
            return "fas fa-exclamation-circle";
          case "warning":
            return "fas fa-exclamation-triangle";
          default:
            return "fas fa-info-circle";
        }
      }

      // ===== é€²æ—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ =====
      async function simulateProcessing() {
        const steps = [
          { percentage: 10, message: "ãƒ‡ãƒ¼ã‚¿ã‚’è§£æä¸­..." },
          { percentage: 25, message: "APIã«æ¥ç¶šä¸­..." },
          { percentage: 45, message: "å•†å“æƒ…å ±ã‚’å–å¾—ä¸­..." },
          { percentage: 65, message: "ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ä¸­..." },
          { percentage: 80, message: "çµæœã‚’æ•´ç†ä¸­..." },
          { percentage: 95, message: "å‡¦ç†ã‚’å®Œäº†ä¸­..." },
          { percentage: 100, message: "å®Œäº†" },
        ];

        for (const step of steps) {
          updateProgress(step.percentage, step.message);
          await new Promise((resolve) =>
            setTimeout(resolve, 300 + Math.random() * 500)
          );
        }
      }

      // ===== é«˜åº¦ãªæ©Ÿèƒ½ =====

      // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›æ¤œè¨¼
      function setupInputValidation() {
        const urlInput = document.getElementById("urlInput");
        const asinInput = document.getElementById("asinInput");
        const startUrlInput = document.getElementById("startUrlInput");

        if (urlInput) {
          urlInput.addEventListener("input", function () {
            validateUrl(this.value, this);
          });
        }

        if (asinInput) {
          asinInput.addEventListener("input", function () {
            validateAsin(this.value, this);
          });
        }

        if (startUrlInput) {
          startUrlInput.addEventListener("input", function () {
            validateUrl(this.value, this);
          });
        }
      }

      function validateUrl(url, inputElement) {
        const isValid = url === "" || /^https?:\/\/.+/.test(url);

        if (isValid) {
          inputElement.style.borderColor = "var(--border-color)";
        } else {
          inputElement.style.borderColor = "var(--color-danger)";
        }
      }

      function validateAsin(asin, inputElement) {
        const selectedMall = selectedMalls[0];
        let isValid = true;

        if (asin !== "") {
          switch (selectedMall) {
            case "amazon":
              isValid = /^B[0-9A-Z]{9}$/i.test(asin);
              break;
            case "rakuten":
              isValid = /^rakuten-.+/.test(asin) || /^[0-9]+$/.test(asin);
              break;
            case "yahoo":
              isValid = /^yahoo-.+/.test(asin) || /^[a-zA-Z0-9]+$/.test(asin);
              break;
            case "ebay":
              isValid = /^[0-9]{12}$/.test(asin);
              break;
            default:
              isValid = asin.length > 0;
          }
        }

        if (isValid) {
          inputElement.style.borderColor = "var(--border-color)";
        } else {
          inputElement.style.borderColor = "var(--color-danger)";
        }
      }

      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
      function setupKeyboardShortcuts() {
        document.addEventListener("keydown", function (e) {
          // Ctrl + Enter ã§ç¾åœ¨ã®ã‚¿ãƒ–ã®å‡¦ç†å®Ÿè¡Œ
          if (e.ctrlKey && e.key === "Enter") {
            e.preventDefault();

            const activeTab = document.querySelector(
              ".upload__tab-content--active"
            );
            if (!activeTab || isProcessing) return;

            const tabId = activeTab.id;
            switch (tabId) {
              case "csv-upload":
                processCsvFile();
                break;
              case "manual-input":
                processManualInput();
                break;
              case "bulk-paste":
                processBulkInput();
                break;
              case "url-auto-collect":
                processUrlAutoCollect();
                break;
            }
          }

          // Ctrl + R ã§ãƒªã‚»ãƒƒãƒˆ
          if (e.ctrlKey && e.key === "r") {
            e.preventDefault();
            resetForm();
          }

          // ESC ã§ãƒ¢ãƒ¼ãƒ€ãƒ«/é€šçŸ¥ã‚’é–‰ã˜ã‚‹
          if (e.key === "Escape") {
            const notification = document.querySelector(".notification--show");
            if (notification) {
              notification.classList.remove("notification--show");
            }
          }
        });
      }

      // è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
      function setupAutoSave() {
        const inputs = [
          "asinInput",
          "urlInput",
          "bulkInput",
          "startUrlInput",
          "maxCountInput",
          "priceRangeInput",
          "limitValue",
        ];

        inputs.forEach((inputId) => {
          const element = document.getElementById(inputId);
          if (element) {
            element.addEventListener("input", function () {
              saveToLocalStorage(inputId, this.value);
            });
          }
        });

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚‚ä¿å­˜
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            saveToLocalStorage(this.id, this.checked);
          });
        });
      }

      function saveToLocalStorage(key, value) {
        try {
          localStorage.setItem(`nagano3_upload_${key}`, JSON.stringify(value));
        } catch (e) {
          console.warn("LocalStorageä¿å­˜ã«å¤±æ•—:", e);
        }
      }

      function loadFromLocalStorage() {
        const inputs = [
          "asinInput",
          "urlInput",
          "bulkInput",
          "startUrlInput",
          "maxCountInput",
          "priceRangeInput",
          "limitValue",
        ];

        inputs.forEach((inputId) => {
          try {
            const saved = localStorage.getItem(`nagano3_upload_${inputId}`);
            if (saved !== null) {
              const value = JSON.parse(saved);
              const element = document.getElementById(inputId);
              if (element && value !== "") {
                element.value = value;
              }
            }
          } catch (e) {
            console.warn("LocalStorageèª­ã¿è¾¼ã¿ã«å¤±æ•—:", e);
          }
        });

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚‚å¾©å…ƒ
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach((checkbox) => {
          try {
            const saved = localStorage.getItem(`nagano3_upload_${checkbox.id}`);
            if (saved !== null) {
              checkbox.checked = JSON.parse(saved);
            }
          } catch (e) {
            console.warn("LocalStorageèª­ã¿è¾¼ã¿ã«å¤±æ•—:", e);
          }
        });
      }

      // ===== åˆæœŸåŒ–å‡¦ç† =====
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸš€ ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ«çµ±ä¸€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹");

        try {
          // åŸºæœ¬æ©Ÿèƒ½ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
          setupFileUpload();
          setupInputValidation();
          setupKeyboardShortcuts();
          setupAutoSave();

          // ä¿å­˜ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
          loadFromLocalStorage();

          // åˆæœŸè¨­å®š
          updateMallSelection();

          // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
          if (console.table) {
            console.table({
              ã‚·ã‚¹ãƒ†ãƒ å: "ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ«çµ±ä¸€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ",
              ãƒãƒ¼ã‚¸ãƒ§ãƒ³: "NAGANO-3 v1.0",
              å¯¾å¿œãƒ¢ãƒ¼ãƒ«: selectedMalls.length + "å€‹é¸æŠä¸­",
              ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ«: mallConfigs[selectedMalls[0]]?.name || "ãªã—",
            });
          }

          showNotification("ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚", "success");
          console.log("âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†");
        } catch (error) {
          console.error("âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
          showNotification(
            "ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
            "error"
          );
        }
      });

      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      window.addEventListener("error", function (e) {
        console.error("ğŸ’¥ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼:", e.error);
        showNotification(
          "äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
          "error"
        );
      });

      // æœªå‡¦ç†ã®Promiseæ‹’å¦ã‚’ã‚­ãƒ£ãƒƒãƒ
      window.addEventListener("unhandledrejection", function (e) {
        console.error("ğŸ’¥ æœªå‡¦ç†Promiseæ‹’å¦:", e.reason);
        showNotification("å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", "error");
      });

      // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
      window.addEventListener("load", function () {
        if (performance.timing) {
          const loadTime =
            performance.timing.loadEventEnd -
            performance.timing.navigationStart;
          console.log(`âš¡ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“: ${loadTime}ms`);

          if (loadTime > 3000) {
            console.warn("âš ï¸ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãŒé…ã„ã§ã™");
          }
        }
      });

      // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±æ›´æ–°ï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰
      setInterval(function () {
        if (!isProcessing) {
          // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦å®Ÿè£…ï¼‰
          // ä¾‹: ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šçŠ¶æ…‹ç¢ºèªã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèªãªã©
        }
      }, 30000); // 30ç§’é–“éš”

      // ===== æ—¢å­˜ãƒ‡ãƒ¼ã‚¿çµ±åˆ + ãƒ•ã‚¡ãƒ“ã‚³ãƒ³å¯¾å¿œç‰ˆ =====

      // ã€STEP 1ã€‘æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ«è¨­å®šã‚’ä¿æŒ
      const EXISTING_MALL_CONFIGS = {
        amazon: {
          name: "Amazon",
          asinLabel: "ASIN",
          bulkLabel: "ASINãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `ASIN,URL,å•†å“å,ä¾¡æ ¼
B08N5WRWNW,https://amazon.co.jp/dp/B08N5WRWNW,Echo Dot,3980
B09B8RRQT5,https://amazon.co.jp/dp/B09B8RRQT5,Fire Stick,4980`,
          features: "amazon-features",
          placeholder: "B08N5WRWNW",
          urlPattern: "https://amazon.co.jp/dp/",
          csvFormat: ["ASIN", "URL", "å•†å“å", "ä¾¡æ ¼"],
          settings: ["fba", "prime", "reviews"],
        },
        rakuten: {
          name: "æ¥½å¤©å¸‚å ´",
          asinLabel: "å•†å“ID",
          bulkLabel: "å•†å“IDãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `å•†å“ID,URL,å•†å“å,ä¾¡æ ¼,ã‚«ãƒ†ã‚´ãƒª
rakuten-123,https://item.rakuten.co.jp/shop/item123,å•†å“å,2980,å®¶é›»
rakuten-456,https://item.rakuten.co.jp/shop/item456,å•†å“å,4980,ç”Ÿæ´»ç”¨å“`,
          features: "rakuten-features",
          placeholder: "rakuten-item-123",
          urlPattern: "https://item.rakuten.co.jp/",
          csvFormat: ["å•†å“ID", "URL", "å•†å“å", "ä¾¡æ ¼", "ã‚«ãƒ†ã‚´ãƒª"],
          settings: ["points", "shop_rating"],
        },
        yahoo: {
          name: "Yahoo!ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°",
          asinLabel: "å•†å“ã‚³ãƒ¼ãƒ‰",
          bulkLabel: "å•†å“ã‚³ãƒ¼ãƒ‰ãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `å•†å“ã‚³ãƒ¼ãƒ‰,URL,å•†å“å,ä¾¡æ ¼
yahoo-abc123,https://shopping.yahoo.co.jp/products/abc123,å•†å“å,1980
yahoo-def456,https://shopping.yahoo.co.jp/products/def456,å•†å“å,3980`,
          features: null,
          placeholder: "yahoo-abc123",
          urlPattern: "https://shopping.yahoo.co.jp/",
          csvFormat: ["å•†å“ã‚³ãƒ¼ãƒ‰", "URL", "å•†å“å", "ä¾¡æ ¼"],
          settings: ["paypay"],
        },
        ebay: {
          name: "eBay",
          asinLabel: "Item ID",
          bulkLabel: "Item IDãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `ItemID,URL,Title,Price,Category
123456789012,https://ebay.com/itm/123456789012,Product Name,29.99,Electronics
123456789013,https://ebay.com/itm/123456789013,Product Name,49.99,Home`,
          features: "ebay-features",
          placeholder: "123456789012",
          urlPattern: "https://ebay.com/itm/",
          csvFormat: ["ItemID", "URL", "Title", "Price", "Category"],
          settings: ["region", "shipping"],
        },
        mercari: {
          name: "ãƒ¡ãƒ«ã‚«ãƒª",
          asinLabel: "å•†å“ID",
          bulkLabel: "å•†å“IDãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `å•†å“ID,URL,å•†å“å,ä¾¡æ ¼,çŠ¶æ…‹
m12345678901,https://mercari.com/jp/items/m12345678901,å•†å“å,1500,æœªä½¿ç”¨ã«è¿‘ã„
m12345678902,https://mercari.com/jp/items/m12345678902,å•†å“å,2800,ã‚„ã‚„å‚·ã‚„æ±šã‚Œã‚ã‚Š`,
          features: null,
          placeholder: "m12345678901",
          urlPattern: "https://mercari.com/jp/items/",
          csvFormat: ["å•†å“ID", "URL", "å•†å“å", "ä¾¡æ ¼", "çŠ¶æ…‹"],
          settings: ["condition"],
        },
        shopee: {
          name: "Shopee",
          asinLabel: "å•†å“ID",
          bulkLabel: "å•†å“IDãƒ»URLä¸€æ‹¬å…¥åŠ›",
          csvSample: `å•†å“ID,URL,å•†å“å,ä¾¡æ ¼,ã‚·ãƒ§ãƒƒãƒ—
shopee-123,https://shopee.sg/product/123,Product Name,25.99,Shop Name
shopee-456,https://shopee.sg/product/456,Product Name,45.99,Shop Name`,
          features: null,
          placeholder: "shopee-123",
          urlPattern: "https://shopee.sg/product/",
          csvFormat: ["å•†å“ID", "URL", "å•†å“å", "ä¾¡æ ¼", "ã‚·ãƒ§ãƒƒãƒ—"],
          settings: [],
        },
      };

      // ã€STEP 2ã€‘ãƒ•ã‚¡ãƒ“ã‚³ãƒ³å–å¾—ã‚·ã‚¹ãƒ†ãƒ 
      class FaviconManager {
        constructor() {
          this.cache = new Map();
          this.defaultIcon = "ğŸª";
        }

        async getFavicon(domain) {
          // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
          if (this.cache.has(domain)) {
            return this.cache.get(domain);
          }

          // ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã‚½ãƒ¼ã‚¹ï¼ˆå„ªå…ˆåº¦é †ï¼‰
          const sources = [
            `https://www.google.com/s2/favicons?domain=${domain}&sz=32`,
            `https://icons.duckduckgo.com/ip3/${domain}.ico`,
            `https://${domain}/favicon.ico`,
          ];

          for (const source of sources) {
            try {
              const result = await this.testImage(source);
              if (result) {
                this.cache.set(domain, result);
                return result;
              }
            } catch (error) {
              continue;
            }
          }

          // å…¨ã¦å¤±æ•—ã—ãŸå ´åˆ
          this.cache.set(domain, this.defaultIcon);
          return this.defaultIcon;
        }

        testImage(url) {
          return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => resolve(url);
            img.onerror = () => resolve(null);
            img.src = url;

            // 5ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
            setTimeout(() => resolve(null), 5000);
          });
        }

        // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
        getDomain(mallId) {
          const domainMap = {
            amazon: "amazon.co.jp",
            rakuten: "rakuten.co.jp",
            yahoo: "shopping.yahoo.co.jp",
            ebay: "ebay.com",
            mercari: "mercari.com",
            shopify: "shopify.com",
            etsy: "etsy.com",
            aliexpress: "aliexpress.com",
            taobao: "taobao.com",
            shopee: "shopee.sg",
            lazada: "lazada.sg",
            walmart: "walmart.com",
            target: "target.com",
            bestbuy: "bestbuy.com",
            booth: "booth.pm",
            minne: "minne.com",
            flipkart: "flipkart.com",
            coupang: "coupang.com",
            qoo10: "qoo10.jp",
          };
          return domainMap[mallId] || `${mallId}.com`;
        }
      }

      // ã€STEP 3ã€‘çµ±åˆãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
      class IntegratedMallDataSource {
        constructor() {
          this.faviconManager = new FaviconManager();
        }

        async getMalls() {
          // åŸºæœ¬ãƒ¢ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¢å­˜è¨­å®šã¨çµ±åˆï¼‰
          const baseMalls = {
            // ä¸»è¦ãƒ¢ãƒ¼ãƒ«ï¼ˆæ—¢å­˜è¨­å®šã‚ã‚Šï¼‰
            amazon: { sort: 1, status: "active" },
            rakuten: { sort: 2, status: "active" },
            yahoo: { sort: 3, status: "active" },
            ebay: { sort: 4, status: "active" },
            mercari: { sort: 5, status: "beta" },
            shopee: { sort: 6, status: "active" },

            // è¿½åŠ ãƒ¢ãƒ¼ãƒ«ï¼ˆåŸºæœ¬è¨­å®šã®ã¿ï¼‰
            shopify: { sort: 7, status: "beta" },
            etsy: { sort: 8, status: "beta" },
            aliexpress: { sort: 9, status: "beta" },
            booth: { sort: 10, status: "beta" },

            // é–‹ç™ºä¸­ãƒ¢ãƒ¼ãƒ«
            taobao: { sort: 11, status: "coming" },
            lazada: { sort: 12, status: "coming" },
            walmart: { sort: 13, status: "coming" },
            target: { sort: 14, status: "coming" },
            bestbuy: { sort: 15, status: "coming" },
            minne: { sort: 16, status: "coming" },
            flipkart: { sort: 17, status: "coming" },
            coupang: { sort: 18, status: "coming" },
            qoo10: { sort: 19, status: "coming" },
          };

          // ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ä»˜ããƒ‡ãƒ¼ã‚¿ã‚’ä¸¦åˆ—å–å¾—
          const mallPromises = Object.entries(baseMalls).map(
            async ([id, data]) => {
              const domain = this.faviconManager.getDomain(id);
              const icon = await this.faviconManager.getFavicon(domain);

              return [
                id,
                {
                  name:
                    EXISTING_MALL_CONFIGS[id]?.name || this.getDefaultName(id),
                  icon: icon,
                  status: data.status,
                  sort: data.sort,
                  config:
                    EXISTING_MALL_CONFIGS[id] || this.getDefaultConfig(id),
                },
              ];
            }
          );

          const mallEntries = await Promise.all(mallPromises);
          return Object.fromEntries(mallEntries);
        }

        getDefaultName(mallId) {
          const nameMap = {
            shopify: "Shopify",
            etsy: "Etsy",
            aliexpress: "AliExpress",
            taobao: "Taobao",
            booth: "BOOTH",
            lazada: "Lazada",
            walmart: "Walmart",
            target: "Target",
            bestbuy: "Best Buy",
            minne: "minne",
            flipkart: "Flipkart",
            coupang: "Coupang",
            qoo10: "Qoo10",
          };
          return (
            nameMap[mallId] || mallId.charAt(0).toUpperCase() + mallId.slice(1)
          );
        }

        getDefaultConfig(mallId) {
          return {
            asinLabel: "å•†å“ID",
            bulkLabel: "å•†å“IDãƒ»URLä¸€æ‹¬å…¥åŠ›",
            placeholder: "product123",
            csvFormat: ["å•†å“ID", "URL", "å•†å“å", "ä¾¡æ ¼"],
            csvSample: `å•†å“ID,URL,å•†å“å,ä¾¡æ ¼
product123,https://example.com/product123,ã‚µãƒ³ãƒ—ãƒ«å•†å“,1000`,
            features: null,
            settings: [],
          };
        }
      }

      // ã€STEP 4ã€‘ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒ©ã‚¹
      class EnhancedMallSystem {
        constructor() {
          this.selectedMall = "amazon"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠ
          this.selectedMalls = ["amazon"]; // æ—¢å­˜äº’æ›æ€§ã®ãŸã‚
          this.mallData = {};
          this.searchQuery = "";
          this.dataSource = new IntegratedMallDataSource();
          this.isProcessing = false;
          this.currentFile = null;

          this.init();
        }

        async init() {
          try {
            console.log("ğŸ”„ ãƒ¢ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...");
            this.mallData = await this.dataSource.getMalls();
            this.renderMalls();
            this.updateUIForMall("amazon"); // åˆæœŸè¡¨ç¤º
            console.log(
              `âœ… ${
                Object.keys(this.mallData).length
              }å€‹ã®ãƒ¢ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿å®Œäº†`
            );
          } catch (error) {
            console.error("âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
            if (typeof showNotification === "function") {
              showNotification("ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ", "error");
            }
          }
        }

        // ãƒ¢ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆãƒ•ã‚¡ãƒ“ã‚³ãƒ³å¯¾å¿œï¼‰
        renderMalls() {
          const grid = document.getElementById("mallGrid");
          if (!grid) return;

          const filteredMalls = this.getFilteredMalls();

          grid.innerHTML = filteredMalls
            .map(([id, mall]) => {
              const iconHtml = mall.icon.startsWith("http")
                ? `<img src="${mall.icon}" alt="${mall.name}" style="width: 24px; height: 24px; border-radius: 4px;">`
                : `<span style="font-size: 1.2rem;">${mall.icon}</span>`;

              return `
        <div class="mall-btn ${this.selectedMall === id ? "selected" : ""} ${
                mall.status === "coming" ? "disabled" : ""
              }" 
             onclick="mallSystem.selectMall('${id}')" 
             title="${mall.name}">
          <div class="mall-status ${mall.status}"></div>
          <div class="mall-icon">${iconHtml}</div>
          <div class="mall-name">${mall.name}</div>
        </div>
      `;
            })
            .join("");
        }

        getFilteredMalls() {
          return Object.entries(this.mallData)
            .filter(([id, mall]) => {
              if (this.searchQuery === "") return true;
              return mall.name
                .toLowerCase()
                .includes(this.searchQuery.toLowerCase());
            })
            .sort(([, a], [, b]) => a.sort - b.sort);
        }

        // ãƒ¢ãƒ¼ãƒ«é¸æŠï¼ˆæ—¢å­˜æ©Ÿèƒ½ã¨äº’æ›ï¼‰
        selectMall(mallId) {
          const mall = this.mallData[mallId];
          if (!mall || mall.status === "coming") {
            if (typeof showNotification === "function") {
              showNotification(`${mall.name}ã¯é–‹ç™ºä¸­ã§ã™`, "info");
            }
            return;
          }

          // å‰å›ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
          this.clearFormData();

          this.selectedMall = mallId;
          this.selectedMalls = [mallId]; // æ—¢å­˜äº’æ›æ€§ã®ãŸã‚
          this.renderMalls();
          this.updateUIForMall(mallId);

          if (typeof showNotification === "function") {
            showNotification(`${mall.name}ãŒé¸æŠã•ã‚Œã¾ã—ãŸ`, "success");
          }
        }

        // æ—¢å­˜ãƒ•ã‚©ãƒ¼ãƒ æ›´æ–°æ©Ÿèƒ½ã¨äº’æ›
        updateUIForMall(mallId) {
          const mall = this.mallData[mallId];
          if (!mall) return;

          const config = mall.config;

          // æ—¢å­˜ã®IDã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ æ›´æ–°
          const asinLabel = document.getElementById("asinLabel");
          const bulkLabel = document.getElementById("bulkLabel");
          const currentMallName = document.getElementById("currentMallName");
          const csvSample = document.getElementById("csvSample");
          const selectedMallDisplay = document.getElementById(
            "selectedMallDisplay"
          );

          if (asinLabel) asinLabel.textContent = config.asinLabel;
          if (bulkLabel) bulkLabel.textContent = config.bulkLabel;
          if (currentMallName) currentMallName.textContent = `(${config.name})`;
          if (csvSample) csvSample.textContent = config.csvSample;
          if (selectedMallDisplay)
            selectedMallDisplay.textContent = config.name;

          // å°‚ç”¨æ©Ÿèƒ½è¡¨ç¤ºåˆ¶å¾¡
          this.showSpecificFeatures(mallId);
        }

        // æ—¢å­˜ã®å°‚ç”¨æ©Ÿèƒ½è¡¨ç¤ºåˆ¶å¾¡
        showSpecificFeatures(mallId) {
          const config = this.mallData[mallId]?.config;
          const specificArea = document.getElementById("specificArea");
          const specificMallName = document.getElementById("specificMallName");

          // å…¨ã¦ã®å°‚ç”¨æ©Ÿèƒ½ã‚’éè¡¨ç¤º
          document.querySelectorAll('[id$="-features"]').forEach((el) => {
            el.style.display = "none";
          });

          if (config && config.features) {
            if (specificMallName) specificMallName.textContent = config.name;
            const featureElement = document.getElementById(config.features);
            if (featureElement) featureElement.style.display = "block";
            if (specificArea)
              specificArea.classList.add("upload__specific-area--show");
          } else {
            if (specificArea)
              specificArea.classList.remove("upload__specific-area--show");
          }
        }

        clearFormData() {
          const inputs = ["asinInput", "urlInput", "bulkInput"];
          inputs.forEach((id) => {
            const element = document.getElementById(id);
            if (element) element.value = "";
          });

          const csvFile = document.getElementById("csvFile");
          if (csvFile) csvFile.value = "";

          this.currentFile = null;
        }

        // æ¤œç´¢æ©Ÿèƒ½
        setSearch(query) {
          this.searchQuery = query;
          this.renderMalls();
        }

        // æ—¢å­˜é–¢æ•°ã¨ã®äº’æ›æ€§ç¢ºä¿
        updateMallSelection() {
          // æ—¢å­˜é–¢æ•°ã¨ã®äº’æ›æ€§ã®ãŸã‚ç©ºå®Ÿè£…
        }

        hideSpecificFeatures() {
          const specificArea = document.getElementById("specificArea");
          if (specificArea) {
            specificArea.classList.remove("upload__specific-area--show");
          }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        getStatusText(status) {
          const labels = {
            active: "å¯¾å¿œæ¸ˆã¿",
            beta: "ãƒ™ãƒ¼ã‚¿",
            coming: "é–‹ç™ºä¸­",
          };
          return labels[status] || status;
        }
      }

      // ã€STEP 5ã€‘ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
      let mallSystem;
      let selectedMalls = ["amazon"]; // æ—¢å­˜äº’æ›æ€§ã®ãŸã‚
      let isProcessing = false;
      let currentFile = null;

      // DOMContentLoaded ã§åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", () => {
        mallSystem = new EnhancedMallSystem();

        // æ¤œç´¢æ©Ÿèƒ½ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        const searchInput = document.getElementById("searchInput");
        if (searchInput) {
          searchInput.addEventListener("input", (e) => {
            mallSystem.setSearch(e.target.value);
          });
        }
      });

      // ã€STEP 6ã€‘æ—¢å­˜é–¢æ•°ã¨ã®äº’æ›æ€§ç¢ºä¿
      function updateMallSelection() {
        if (mallSystem) {
          mallSystem.updateMallSelection();
        }
      }

      function updateUIForMall(mallId) {
        if (mallSystem) {
          mallSystem.updateUIForMall(mallId);
        }
      }

      function showSpecificFeatures(mallId) {
        if (mallSystem) {
          mallSystem.showSpecificFeatures(mallId);
        }
      }

      function hideSpecificFeatures() {
        if (mallSystem) {
          mallSystem.hideSpecificFeatures();
        }
      }

      function filterMalls() {
        const searchInput = document.getElementById("searchInput");
        if (searchInput && mallSystem) {
          mallSystem.setSearch(searchInput.value);
        }
      }

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°åŒæœŸ
      function syncGlobalVars() {
        if (mallSystem) {
          selectedMalls = [mallSystem.selectedMall];
          isProcessing = mallSystem.isProcessing;
          currentFile = mallSystem.currentFile;
        }
      }

      // å®šæœŸçš„ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’åŒæœŸ
      setInterval(syncGlobalVars, 100);

      console.log("âœ… çµ±åˆå‹ãƒ¢ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿å®Œäº†");
    </script>
  </body>
</html>
