<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ASIN/å•†å“URL ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - Emverze SaaS</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="./static/css/style.css" />
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="../css/style.css" />
  <script>
// CAIDS error_handling Hook

// CAIDS ã‚¨ãƒ©ãƒ¼å‡¦ç†Hook - å®Œå…¨å®Ÿè£…
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('âš ï¸ CAIDS ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åˆæœŸåŒ–');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('ğŸš¨ CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">ğŸš¨</span>
                <div>
                    <strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»é€ä¿¡ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('ğŸ“‹ CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<script>
// CAIDS user_feedback Hook
// CAIDS user_feedback Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_feedback Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_limit Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_monitoring Hook
// CAIDS character_monitoring Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_monitoring Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS processing_capacity_monitoring Hook
// CAIDS processing_capacity_monitoring Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… processing_capacity_monitoring Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_approval_required Hook loaded');
</script>
<script>
// CAIDS timeout_management Hook
// CAIDS timeout_management Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… timeout_management Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… development_control Hook loaded');
</script>
</head>
  <body>
    <div class="container">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="header fade-in">
        <h1>ğŸ“¦ ASIN/å•†å“URL ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h1>
        <p>
          Amazon
          ASINã€å•†å“URLã€ã¾ãŸã¯CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬å–å¾—ã—ã¾ã™
        </p>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="upload-section fade-in">
        <h2 class="section-title">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›æ–¹æ³•ã‚’é¸æŠ</h2>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="upload-tabs">
          <button class="tab-button active" onclick="switchTab('csv-upload')">
            ğŸ“„ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          </button>
          <button class="tab-button" onclick="switchTab('manual-input')">
            âœï¸ æ‰‹å‹•å…¥åŠ›ï¼ˆASIN/URLï¼‰
          </button>
          <button class="tab-button" onclick="switchTab('bulk-paste')">
            ğŸ“‹ ä¸€æ‹¬è²¼ã‚Šä»˜ã‘
          </button>
        </div>

        <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¿ãƒ– -->
        <div id="csv-upload" class="tab-content active">
          <div class="validation-rules">
            <div class="rules-title">ğŸ“‹ CSVãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼è¦ä»¶</div>
            <ul class="rules-list">
              <li>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: .csv, .xlsxå¯¾å¿œ</li>
              <li>æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 10MB</li>
              <li>æœ€å¤§è¡Œæ•°: 10,000è¡Œ</li>
              <li>æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: UTF-8æ¨å¥¨</li>
              <li>åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼: ASIN, URL, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰, SKU (ä»»æ„)</li>
            </ul>
          </div>

          <div class="sample-section">
            <div class="sample-title">ğŸ“ CSVã‚µãƒ³ãƒ—ãƒ«å½¢å¼</div>
            <div class="sample-code">
              ASIN,URL,ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰,SKU
              B08N5WRWNW,https://amazon.co.jp/dp/B08N5WRWNW,Echo
              Dot,ECHO-DOT-001
              B09B8RRQT5,https://amazon.co.jp/dp/B09B8RRQT5,Fire TV
              Stick,FIRE-TV-002 ,https://amazon.co.jp/dp/B08KGG8T8S,Kindle
              Paperwhite,KINDLE-003
            </div>
          </div>

          <div class="form-group">
            <div
              class="file-upload-area"
              onclick="document.getElementById('csvFile').click()"
              ondrop="handleDrop(event)"
              ondragover="handleDragOver(event)"
              ondragleave="handleDragLeave(event)"
            >
              <div class="upload-icon">ğŸ“</div>
              <div class="upload-text">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
              <div class="upload-subtext">
                ã¾ãŸã¯ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
              </div>
              <input
                type="file"
                id="csvFile"
                class="hidden-input"
                accept=".csv,.xlsx,.xls"
                onchange="handleFileSelect(event)"
              />
            </div>
          </div>

          <div class="form-group">
            <button class="button button-primary" onclick="processCsvFile()">
              ğŸš€ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
            </button>
          </div>
        </div>

        <!-- æ‰‹å‹•å…¥åŠ›ã‚¿ãƒ– -->
        <div id="manual-input" class="tab-content">
          <div class="validation-rules">
            <div class="rules-title">âœ… å…¥åŠ›å½¢å¼ã«ã¤ã„ã¦</div>
            <ul class="rules-list">
              <li>ASIN: B08N5WRWNW (10æ–‡å­—ã®è‹±æ•°å­—)</li>
              <li>Amazon URL: https://amazon.co.jp/dp/[ASIN]</li>
              <li>æ¥½å¤©ãƒ»Yahooç­‰ã®URL: ç›´æ¥URLå…¥åŠ›</li>
              <li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: å•†å“æ¤œç´¢ç”¨ (ä»»æ„)</li>
            </ul>
          </div>

          <div class="form-group">
            <label class="form-label">ğŸ·ï¸ ASIN</label>
            <input
              type="text"
              id="asinInput"
              class="form-input"
              placeholder="ä¾‹: B08N5WRWNW"
              maxlength="10"
            />
          </div>

          <div class="form-group">
            <label class="form-label">ğŸ”— å•†å“URL</label>
            <input
              type="url"
              id="urlInput"
              class="form-input"
              placeholder="ä¾‹: https://amazon.co.jp/dp/B08N5WRWNW"
            />
          </div>

          <div class="form-group">
            <label class="form-label">ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä»»æ„)</label>
            <input
              type="text"
              id="keywordInput"
              class="form-input"
              placeholder="ä¾‹: Echo Dot ã‚¹ãƒãƒ¼ãƒˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼"
            />
          </div>

          <div class="form-group">
            <label class="form-label">ğŸ“¦ SKU (ä»»æ„)</label>
            <input
              type="text"
              id="skuInput"
              class="form-input"
              placeholder="ä¾‹: ECHO-DOT-001"
            />
          </div>

          <div class="form-group">
            <button
              class="button button-primary"
              onclick="processManualInput()"
            >
              â• å•†å“ã‚’è¿½åŠ 
            </button>
            <button class="button button-secondary" onclick="clearManualForm()">
              ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
            </button>
          </div>
        </div>

        <!-- ä¸€æ‹¬è²¼ã‚Šä»˜ã‘ã‚¿ãƒ– -->
        <div id="bulk-paste" class="tab-content">
          <div class="validation-rules">
            <div class="rules-title">ğŸ“ ä¸€æ‹¬å…¥åŠ›å½¢å¼</div>
            <ul class="rules-list">
              <li>1è¡Œã«ã¤ã1ã¤ã®ASINã¾ãŸã¯URL</li>
              <li>æ”¹è¡Œã§åŒºåˆ‡ã£ã¦è¤‡æ•°å…¥åŠ›å¯èƒ½</li>
              <li>ç©ºè¡Œã¯è‡ªå‹•çš„ã«ç„¡è¦–ã•ã‚Œã¾ã™</li>
              <li>æœ€å¤§1,000è¡Œã¾ã§å…¥åŠ›å¯èƒ½</li>
            </ul>
          </div>

          <div class="sample-section">
            <div class="sample-title">ğŸ“ å…¥åŠ›ä¾‹</div>
            <div class="sample-code">
              B08N5WRWNW https://amazon.co.jp/dp/B09B8RRQT5 B08KGG8T8S
              https://www.rakuten.co.jp/shop/item/12345/
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">ğŸ“‹ ASINãƒ»URLä¸€æ‹¬å…¥åŠ›</label>
            <textarea
              id="bulkInput"
              class="form-textarea"
              placeholder="ASINã¾ãŸã¯URLã‚’1è¡Œãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„...&#10;&#10;ä¾‹:&#10;B08N5WRWNW&#10;https://amazon.co.jp/dp/B09B8RRQT5&#10;B08KGG8T8S"
              rows="15"
            ></textarea>
          </div>

          <div class="form-group">
            <button class="button button-primary" onclick="processBulkInput()">
              ğŸ“Š ä¸€æ‹¬å‡¦ç†
            </button>
            <button class="button button-secondary" onclick="clearBulkInput()">
              ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
            </button>
          </div>
        </div>
      </div>

      <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div id="progressSection" class="progress-section">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressText" class="progress-text">å‡¦ç†ä¸­...</div>
      </div>

      <!-- çµæœè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div id="resultSection" class="result-section">
        <div class="upload-section">
          <h2 class="section-title">ğŸ“Š å‡¦ç†çµæœ</h2>
          <div id="resultContent">
            <table class="result-table">
              <thead>
                <tr>
                  <th>å…¥åŠ›å€¤</th>
                  <th>ç¨®åˆ¥</th>
                  <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                  <th>å•†å“å</th>
                  <th>ä¾¡æ ¼</th>
                  <th>è©³ç´°</th>
                </tr>
              </thead>
              <tbody id="resultTableBody">
                <!-- å‹•çš„ã«çµæœãŒæŒ¿å…¥ã•ã‚Œã¾ã™ -->
              </tbody>
            </table>
          </div>
          <div class="form-group" style="margin-top: 20px">
            <button class="button button-primary" onclick="downloadResults()">
              ğŸ’¾ çµæœã‚’CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            </button>
            <button class="button button-secondary" onclick="resetForm()">
              ğŸ”„ æ–°è¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let processedData = [];
      let currentFile = null;

      // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
      function switchTab(tabId) {
        // å…¨ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        // å…¨ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.classList.remove("active");
        });

        // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
        document.getElementById(tabId).classList.add("active");
        event.target.classList.add("active");
      }

      // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
      function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.classList.add("dragover");
      }

      function handleDragLeave(event) {
        event.currentTarget.classList.remove("dragover");
      }

      function handleDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.remove("dragover");

        const files = event.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          handleFile(file);
        }
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
          handleFile(file);
        }
      }

      function handleFile(file) {
        // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
        const allowedTypes = [
          "text/csv",
          "application/vnd.ms-excel",
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        ];
        if (
          !allowedTypes.includes(file.type) &&
          !file.name.endsWith(".csv") &&
          !file.name.endsWith(".xlsx") &&
          !file.name.endsWith(".xls")
        ) {
          showAlert(
            "ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚CSVã€XLSã€XLSXãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ã€‚",
            "error"
          );
          return;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ (10MB)
        if (file.size > 10 * 1024 * 1024) {
          showAlert(
            "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚10MBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚",
            "error"
          );
          return;
        }

        currentFile = file;
        showAlert(
          `ãƒ•ã‚¡ã‚¤ãƒ« "${file.name}" ãŒé¸æŠã•ã‚Œã¾ã—ãŸã€‚å‡¦ç†ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¶šè¡Œã—ã¦ãã ã•ã„ã€‚`,
          "success"
        );
      }

      // CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
      function processCsvFile() {
        if (!currentFile) {
          showAlert("ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚", "error");
          return;
        }

        showProgress(true);
        updateProgress(0, "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...");

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const csvContent = e.target.result;
            const parsedData = parseCSV(csvContent);
            processDataArray(parsedData);
          } catch (error) {
            showAlert(
              "ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message,
              "error"
            );
            showProgress(false);
          }
        };

        reader.onerror = function () {
          showAlert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", "error");
          showProgress(false);
        };

        reader.readAsText(currentFile);
      }

      // CSVè§£æ
      function parseCSV(csvContent) {
        const lines = csvContent.split("\n").filter((line) => line.trim());
        if (lines.length === 0) {
          throw new Error("ç©ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚");
        }

        const headers = lines[0]
          .split(",")
          .map((h) => h.trim().replace(/"/g, ""));
        const data = [];

        for (let i = 1; i < lines.length; i++) {
          const values = lines[i]
            .split(",")
            .map((v) => v.trim().replace(/"/g, ""));
          if (values.length >= headers.length) {
            const row = {};
            headers.forEach((header, index) => {
              row[header] = values[index] || "";
            });
            data.push(row);
          }
        }

        if (data.length === 0) {
          throw new Error("æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
        }

        return data;
      }

      // æ‰‹å‹•å…¥åŠ›å‡¦ç†
      function processManualInput() {
        const asin = document.getElementById("asinInput").value.trim();
        const url = document.getElementById("urlInput").value.trim();
        const keyword = document.getElementById("keywordInput").value.trim();
        const sku = document.getElementById("skuInput").value.trim();

        if (!asin && !url) {
          showAlert("ASINã¾ãŸã¯URLã®ã„ãšã‚Œã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", "error");
          return;
        }

        const inputData = [
          {
            ASIN: asin,
            URL: url,
            ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: keyword,
            SKU: sku,
          },
        ];

        processDataArray(inputData);
      }

      // ä¸€æ‹¬å…¥åŠ›å‡¦ç†
      function processBulkInput() {
        const bulkText = document.getElementById("bulkInput").value.trim();
        if (!bulkText) {
          showAlert("ASINãƒ»URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚", "error");
          return;
        }

        const lines = bulkText.split("\n").filter((line) => line.trim());
        if (lines.length > 1000) {
          showAlert("ä¸€åº¦ã«å‡¦ç†ã§ãã‚‹ã®ã¯1,000è¡Œã¾ã§ã§ã™ã€‚", "error");
          return;
        }

        const inputData = lines.map((line) => {
          const value = line.trim();
          // ASINã‹URLã‹ã‚’åˆ¤å®š
          if (value.startsWith("http")) {
            return { ASIN: "", URL: value, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: "", SKU: "" };
          } else {
            return { ASIN: value, URL: "", ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: "", SKU: "" };
          }
        });

        processDataArray(inputData);
      }

      // ãƒ‡ãƒ¼ã‚¿é…åˆ—å‡¦ç†
      async function processDataArray(dataArray) {
        if (!dataArray || dataArray.length === 0) {
          showAlert("å‡¦ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "error");
          return;
        }

        showProgress(true);
        processedData = [];

        for (let i = 0; i < dataArray.length; i++) {
          const item = dataArray[i];
          updateProgress(
            (i / dataArray.length) * 100,
            `${i + 1}/${dataArray.length} ä»¶å‡¦ç†ä¸­...`
          );

          try {
            const result = await processItem(item);
            processedData.push(result);
          } catch (error) {
            processedData.push({
              input: item.ASIN || item.URL || "ä¸æ˜",
              type: "å‡¦ç†ã‚¨ãƒ©ãƒ¼",
              status: "error",
              productName: "",
              price: "",
              details: error.message,
            });
          }

          // UIã®å¿œç­”æ€§ã‚’ä¿ã¤ãŸã‚å°‘ã—å¾…æ©Ÿ
          await new Promise((resolve) => setTimeout(resolve, 100));
        }

        updateProgress(100, "å‡¦ç†å®Œäº†");
        showProgress(false);
        displayResults();
      }

      // å€‹åˆ¥ã‚¢ã‚¤ãƒ†ãƒ å‡¦ç† (å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ)
      async function processItem(item) {
        const input = item.ASIN || item.URL || "";

        // ASINã®æ¤œè¨¼
        if (item.ASIN) {
          if (!/^[B][0-9A-Z]{9}$/.test(item.ASIN)) {
            throw new Error("ç„¡åŠ¹ãªASINå½¢å¼");
          }
        }

        // URLã®æ¤œè¨¼
        if (item.URL) {
          try {
            new URL(item.URL);
          } catch {
            throw new Error("ç„¡åŠ¹ãªURLå½¢å¼");
          }
        }

        // å®Ÿéš›ã®å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ (ã“ã“ã§APIã‚’å‘¼ã³å‡ºã™)
        await new Promise((resolve) =>
          setTimeout(resolve, Math.random() * 500 + 200)
        );

        // ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’è¿”ã™
        const mockProducts = [
          { name: "Echo Dot (ç¬¬4ä¸–ä»£)", price: "Â¥5,980" },
          { name: "Fire TV Stick 4K Max", price: "Â¥6,980" },
          { name: "Kindle Paperwhite", price: "Â¥14,980" },
          { name: "Echo Show 5", price: "Â¥8,980" },
          { name: "Fire HD 10 ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ", price: "Â¥15,980" },
        ];

        const randomProduct =
          mockProducts[Math.floor(Math.random() * mockProducts.length)];

        return {
          input: input,
          type: item.ASIN ? "ASIN" : "URL",
          status: "success",
          productName: randomProduct.name,
          price: randomProduct.price,
          details: "Amazonå•†å“ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ",
          keyword: item.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ || "",
          sku: item.SKU || "",
        };
      }

      // çµæœè¡¨ç¤º
      function displayResults() {
        const resultSection = document.getElementById("resultSection");
        const tableBody = document.getElementById("resultTableBody");

        tableBody.innerHTML = "";

        processedData.forEach((result) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${result.input}</td>
                    <td>${result.type}</td>
                    <td><span class="status-badge status-${result.status}">${
            result.status === "success" ? "æˆåŠŸ" : "ã‚¨ãƒ©ãƒ¼"
          }</span></td>
                    <td>${result.productName}</td>
                    <td>${result.price}</td>
                    <td>${result.details}</td>
                `;
          tableBody.appendChild(row);
        });

        resultSection.style.display = "block";
        resultSection.scrollIntoView({ behavior: "smooth" });

        const successCount = processedData.filter(
          (r) => r.status === "success"
        ).length;
        const errorCount = processedData.filter(
          (r) => r.status === "error"
        ).length;

        showAlert(
          `å‡¦ç†å®Œäº†: æˆåŠŸ ${successCount}ä»¶, ã‚¨ãƒ©ãƒ¼ ${errorCount}ä»¶`,
          successCount > 0 ? "success" : "error"
        );
      }

      // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºåˆ¶å¾¡
      function showProgress(show) {
        const progressSection = document.getElementById("progressSection");
        progressSection.style.display = show ? "block" : "none";
      }

      function updateProgress(percentage, text) {
        const progressFill = document.getElementById("progressFill");
        const progressText = document.getElementById("progressText");

        progressFill.style.width = percentage + "%";
        progressText.textContent = text;
      }

      // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
      function showAlert(message, type) {
        // æ—¢å­˜ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
        const existingAlert = document.querySelector(".alert");
        if (existingAlert) {
          existingAlert.remove();
        }

        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;
        alert.textContent = message;

        const container = document.querySelector(".container");
        container.insertBefore(alert, container.firstChild);

        // 5ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
        }, 5000);
      }

      // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
      function clearManualForm() {
        document.getElementById("asinInput").value = "";
        document.getElementById("urlInput").value = "";
        document.getElementById("keywordInput").value = "";
        document.getElementById("skuInput").value = "";
      }

      function clearBulkInput() {
        document.getElementById("bulkInput").value = "";
      }

      // çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      function downloadResults() {
        if (processedData.length === 0) {
          showAlert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚", "error");
          return;
        }

        const csvContent = generateCSV(processedData);
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");

        link.href = URL.createObjectURL(blob);
        link.download = `product_upload_results_${new Date()
          .toISOString()
          .slice(0, 10)}.csv`;
        link.click();
      }

      function generateCSV(data) {
        const headers = [
          "å…¥åŠ›å€¤",
          "ç¨®åˆ¥",
          "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",
          "å•†å“å",
          "ä¾¡æ ¼",
          "è©³ç´°",
        ];
        const csvRows = [headers.join(",")];

        data.forEach((row) => {
          const values = [
            `"${row.input}"`,
            `"${row.type}"`,
            `"${row.status === "success" ? "æˆåŠŸ" : "ã‚¨ãƒ©ãƒ¼"}"`,
            `"${row.productName}"`,
            `"${row.price}"`,
            `"${row.details}"`,
          ];
          csvRows.push(values.join(","));
        });

        return "\uFEFF" + csvRows.join("\n"); // UTF-8 BOMä»˜ã
      }

      // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
      function resetForm() {
        processedData = [];
        currentFile = null;

        document.getElementById("csvFile").value = "";
        clearManualForm();
        clearBulkInput();

        document.getElementById("resultSection").style.display = "none";
        showProgress(false);

        showAlert("ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚", "success");
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", function () {
        // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        const elements = document.querySelectorAll(".fade-in");
        elements.forEach((element, index) => {
          setTimeout(() => {
            element.style.opacity = "1";
            element.style.transform = "translateY(0)";
          }, index * 200);
        });
      });
    </script>
  </body>
</html>
