<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- SEOãƒ¡ã‚¿ã‚¿ã‚° -->
    <title>å®Œç’§ASINç®¡ç† - CSVãƒ»URLãƒ»ç›´æ¥å…¥åŠ›å¯¾å¿œ - Emverze SaaS</title>
    <meta name="description" content="Amazon ASINå•†å“ã®ä¸€æ‹¬ç™»éŒ²ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚CSVã€URLã€ç›´æ¥å…¥åŠ›ã§åŠ¹ç‡çš„ãªå•†å“ç™»éŒ²ã‚’å®Ÿç¾ã€‚">
    <meta name="keywords" content="ASIN,Amazon,å•†å“ç™»éŒ²,CSV,ä¸€æ‹¬ç™»éŒ²,åœ¨åº«ç®¡ç†">
    
    <!-- Open Graph -->
    <meta property="og:title" content="å®Œç’§ASINç®¡ç† - Emverze SaaS">
    <meta property="og:description" content="Amazon ASINå•†å“ã®åŠ¹ç‡çš„ãªä¸€æ‹¬ç™»éŒ²ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:image" content="{{ url_for('static', filename='images/og-image.png', _external=True) }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
    
    <!-- CSSèª­ã¿è¾¼ã¿(éšå±¤å¯¾å¿œ) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Emverzeçµ±ä¸€CSS(main.css) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    
    <!-- ãƒšãƒ¼ã‚¸å›ºæœ‰CSS -->
    <style>
        /* ASINç®¡ç†å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«(main.cssæº–æ‹ ) */
        .asin-upload-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--neumorphism);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
        }
        
        .upload-method-tabs {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-inset-sm);
        }
        
        .upload-tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }
        
        .upload-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .upload-tab.active {
            background: var(--accent-blue);
            color: var(--text-white);
            box-shadow: var(--neumorphism-sm);
        }
        
        .upload-content {
            display: none;
        }
        
        .upload-content.active {
            display: block;
        }
        
        .file-drop-zone {
            border: 2px dashed var(--shadow-dark);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            text-align: center;
            background: var(--bg-tertiary);
            transition: var(--transition-normal);
            cursor: pointer;
            margin-bottom: var(--space-4);
        }
        
        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: var(--accent-blue);
            background: var(--info-bg);
            box-shadow: var(--neumorphism-sm);
        }
        
        .drop-icon {
            font-size: var(--text-5xl);
            color: var(--accent-blue);
            margin-bottom: var(--space-4);
        }
        
        .asin-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }
        
        .asin-preview-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--neumorphism-sm);
            border-left: 4px solid var(--accent-blue);
        }
        
        .asin-code {
            font-family: var(--font-family-mono);
            font-weight: var(--font-semibold);
            color: var(--accent-blue);
            font-size: var(--text-sm);
        }
        
        .processing-progress {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-top: var(--space-6);
            display: none;
        }
        
        .processing-progress.active {
            display: block;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--shadow-dark);
        }
        
        .progress-item:last-child {
            border-bottom: none;
        }
        
        .progress-status {
            width: 20px;
            height: 20px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            color: var(--text-white);
        }
        
        .progress-status.success { background: var(--success-color); }
        .progress-status.error { background: var(--error-color); }
        .progress-status.processing { 
            background: var(--warning-color);
            animation: pulse 1.5s infinite;
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }
        
        .result-stat {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
            box-shadow: var(--neumorphism-sm);
        }
        
        .result-number {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-1);
        }
        
        .result-number.success { color: var(--success-color); }
        .result-number.error { color: var(--error-color); }
        .result-number.warning { color: var(--warning-color); }
        .result-number.info { color: var(--info-color); }
        
        .result-label {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: var(--font-medium);
        }
    </style>
<script>
// CAIDS error_handling Hook

// CAIDS ã‚¨ãƒ©ãƒ¼å‡¦ç†Hook - å®Œå…¨å®Ÿè£…
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('âš ï¸ CAIDS ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åˆæœŸåŒ–');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('ğŸš¨ CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">ğŸš¨</span>
                <div>
                    <strong>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»é€ä¿¡ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('ğŸ“‹ CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<script>
// CAIDS user_feedback Hook
// CAIDS user_feedback Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_feedback Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_limit Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… development_control Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_monitoring Hook
// CAIDS character_monitoring Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… character_monitoring Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… user_approval_required Hook loaded');
</script>
<script>
// CAIDS timeout_management Hook
// CAIDS timeout_management Hook - åŸºæœ¬å®Ÿè£…
console.log('âœ… timeout_management Hook loaded');
</script>
</head>

<body>
    <!-- ã‚³ãƒ³ãƒ†ãƒŠ(main.cssæº–æ‹ ) -->
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼(å…¨ãƒšãƒ¼ã‚¸å…±é€š) -->
        <header class="header" role="banner">
            <div class="header-content">
                <div class="header-left">
                    <button class="mobile-menu-toggle" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title">
                        <a href="{{ url_for('dashboard.index') if url_for else '/' }}">Emverze</a>
                    </h1>
                </div>

                <div class="header-center">
                    <div class="search-box">
                        <input type="search" placeholder="å•†å“ã‚’æ¤œç´¢..." aria-label="å•†å“æ¤œç´¢">
                        <button type="submit" aria-label="æ¤œç´¢å®Ÿè¡Œ">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="header-right">
                    <div class="notification-badge" data-count="3">
                        <button aria-label="é€šçŸ¥">
                            <i class="fas fa-bell"></i>
                        </button>
                    </div>
                    <div class="user-menu" role="button" tabindex="0" aria-label="ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
                        <img src="{{ url_for('static', filename='images/avatars/default.png') }}" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼" class="user-avatar">
                        <span class="user-name">{{ user.name if user else 'ã‚²ã‚¹ãƒˆ' }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼(å…¨ãƒšãƒ¼ã‚¸å…±é€š) -->
        <aside class="sidebar" role="navigation" aria-label="ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
            <div class="logo">
                <h2>Emverze</h2>
                <span class="version">SaaS v2.0</span>
            </div>

            <nav class="nav-menu">
                <ul role="menubar">
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('dashboard.index') if url_for else '/' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('inventory.list') if url_for else '/inventory' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-boxes" aria-hidden="true"></i>
                            <span>åœ¨åº«ç®¡ç†</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('products.list') if url_for else '/products' }}" class="nav-link active" role="menuitem" aria-current="page">
                            <i class="fas fa-box" aria-hidden="true"></i>
                            <span>å•†å“ç®¡ç†</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('listings.list') if url_for else '/listings' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-store" aria-hidden="true"></i>
                            <span>å‡ºå“ç®¡ç†</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('analytics.dashboard') if url_for else '/analytics' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            <span>åˆ†æ</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('settings.general') if url_for else '/settings' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                            <span>è¨­å®š</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-indicator online"></div>
                    <span>ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸</span>
                </div>
            </div>
        </aside>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <main class="main" role="main">
            <div class="main-content">
                <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="page-header">
                    <div class="page-header-left">
                        <h1 class="page-title">å®Œç’§ASINç®¡ç†</h1>
                        <p class="page-subtitle">Amazonå•†å“ã®ä¸€æ‹¬ç™»éŒ²ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
                    </div>
                    <div class="page-header-right">
                        <button class="btn secondary" onclick="showUploadHistory()">
                            <i class="fas fa-history"></i>
                            å±¥æ­´
                        </button>
                        <button class="btn primary" onclick="exportResults()">
                            <i class="fas fa-download"></i>
                            çµæœå‡ºåŠ›
                        </button>
                    </div>
                </div>

                <!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
                <nav aria-label="ãƒ‘ãƒ³ããšãƒŠãƒ“" class="breadcrumb">
                    <ol>
                        <li>
                            <a href="{{ url_for('dashboard.index') if url_for else '/' }}">
                                <i class="fas fa-home" aria-hidden="true"></i>
                                ãƒ›ãƒ¼ãƒ 
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('products.list') if url_for else '/products' }}">å•†å“ç®¡ç†</a>
                        </li>
                        <li>
                            <span aria-current="page">ASINç®¡ç†</span>
                        </li>
                    </ol>
                </nav>

                <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                <div class="content-area">
                    <!-- ASINçµ±åˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ -->
                    <div class="asin-upload-container">
                        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼é¸æŠã‚¿ãƒ– -->
                        <div class="upload-method-tabs" role="tablist">
                            <button class="upload-tab active" role="tab" aria-selected="true" onclick="switchUploadMethod('csv')">
                                <i class="fas fa-file-csv"></i>
                                CSVãƒ•ã‚¡ã‚¤ãƒ«
                            </button>
                            <button class="upload-tab" role="tab" aria-selected="false" onclick="switchUploadMethod('url')">
                                <i class="fas fa-link"></i>
                                URLå–ã‚Šè¾¼ã¿
                            </button>
                            <button class="upload-tab" role="tab" aria-selected="false" onclick="switchUploadMethod('direct')">
                                <i class="fas fa-keyboard"></i>
                                ç›´æ¥å…¥åŠ›
                            </button>
                        </div>

                        <!-- CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                        <div id="csv-upload" class="upload-content active" role="tabpanel">
                            <h3 class="section-title">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
                            
                            <div class="file-drop-zone" id="csvDropZone" onclick="document.getElementById('csvFileInput').click()">
                                <div class="drop-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <p class="text-lg font-semibold mb-2">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                                <p class="text-sm text-secondary">ã¾ãŸã¯ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                                <input type="file" id="csvFileInput" accept=".csv,.txt" style="display: none;" onchange="handleCsvFile(event)">
                            </div>

                            <!-- CSVå‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</label>
                                    <select class="form-select" id="csvEncoding">
                                        <option value="auto">è‡ªå‹•æ¤œå‡º</option>
                                        <option value="utf-8">UTF-8</option>
                                        <option value="shift_jis">Shift_JIS</option>
                                        <option value="euc-jp">EUC-JP</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">åŒºåˆ‡ã‚Šæ–‡å­—</label>
                                    <select class="form-select" id="csvDelimiter">
                                        <option value=",">ã‚«ãƒ³ãƒ (,)</option>
                                        <option value="\t">ã‚¿ãƒ–</option>
                                        <option value=";">ã‚»ãƒŸã‚³ãƒ­ãƒ³ (;)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ASINåˆ—å</label>
                                    <input type="text" class="form-input" id="asinColumn" value="ASIN" placeholder="ASINåˆ—ã®åå‰">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="csvSkipHeader" checked>
                                    <span class="checkmark">ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—</span>
                                </label>
                            </div>
                        </div>

                        <!-- URLå–ã‚Šè¾¼ã¿ -->
                        <div id="url-upload" class="upload-content" role="tabpanel">
                            <h3 class="section-title">Amazon URLå–ã‚Šè¾¼ã¿</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Amazonå•†å“URL</label>
                                <textarea class="form-textarea" id="urlList" rows="10" 
                                    placeholder="Amazonå•†å“URLã‚’1è¡Œã«1ã¤ãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;https://www.amazon.co.jp/dp/B01234567X&#10;https://www.amazon.com/dp/B09876543Z"></textarea>
                                <div class="field-help">
                                    æœ€å¤§100URLã¾ã§ä¸€æ‹¬å‡¦ç†å¯èƒ½
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="removeTracking" checked>
                                        <span class="checkmark">ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é™¤å»</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="validateUrls" checked>
                                        <span class="checkmark">URLå½¢å¼æ¤œè¨¼</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- ç›´æ¥å…¥åŠ› -->
                        <div id="direct-upload" class="upload-content" role="tabpanel">
                            <h3 class="section-title">ASINç›´æ¥å…¥åŠ›</h3>
                            
                            <div class="form-group">
                                <label class="form-label">ASINãƒªã‚¹ãƒˆ</label>
                                <textarea class="form-textarea" id="asinDirectList" rows="15" 
                                    placeholder="ASINã‚³ãƒ¼ãƒ‰ã‚’1è¡Œã«1ã¤ãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;B01234567X&#10;B09876543Z&#10;B05555555A"></textarea>
                                <div class="field-help">
                                    æœ€å¤§1000ASINã¾ã§ä¸€æ‹¬å‡¦ç†å¯èƒ½ã€‚ASINã¯10æ–‡å­—ã®è‹±æ•°å­—ã§ã™ã€‚
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="validateAsins" checked>
                                        <span class="checkmark">ASINå½¢å¼æ¤œè¨¼</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="removeDuplicates" checked>
                                        <span class="checkmark">é‡è¤‡é™¤å»</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- å…±é€šå‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                        <div class="card mt-6">
                            <div class="card-header">
                                <h4 class="card-title">å‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h4>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="fetchDetails" checked>
                                            <span class="checkmark">å•†å“è©³ç´°è‡ªå‹•å–å¾—</span>
                                        </label>
                                        <div class="field-help">Amazon APIã‹ã‚‰å•†å“åãƒ»ä¾¡æ ¼ãƒ»ç”»åƒç­‰ã‚’å–å¾—</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="autoCategory">
                                            <span class="checkmark">ã‚«ãƒ†ã‚´ãƒªè‡ªå‹•åˆ†é¡</span>
                                        </label>
                                        <div class="field-help">å•†å“æƒ…å ±ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’è‡ªå‹•åˆ†é¡</div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="duplicateCheck" checked>
                                            <span class="checkmark">é‡è¤‡ãƒã‚§ãƒƒã‚¯</span>
                                        </label>
                                        <div class="field-help">æ—¢å­˜å•†å“ã¨ã®é‡è¤‡ã‚’ãƒã‚§ãƒƒã‚¯</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="createInventory" checked>
                                            <span class="checkmark">åœ¨åº«ãƒ¬ã‚³ãƒ¼ãƒ‰è‡ªå‹•ä½œæˆ</span>
                                        </label>
                                        <div class="field-help">å•†å“ç™»éŒ²ã¨åŒæ™‚ã«åœ¨åº«ç®¡ç†ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ -->
                        <div class="btn-group mt-6">
                            <button class="btn large primary" onclick="startProcessing()">
                                <i class="fas fa-play"></i>
                                å‡¦ç†é–‹å§‹
                            </button>
                            <button class="btn large secondary" onclick="resetForm()">
                                <i class="fas fa-undo"></i>
                                ãƒªã‚»ãƒƒãƒˆ
                            </button>
                        </div>
                    </div>

                    <!-- å‡¦ç†é€²æ—è¡¨ç¤º -->
                    <div class="processing-progress" id="processingProgress">
                        <h3 class="section-title">å‡¦ç†é€²æ—</h3>
                        
                        <div class="progress mb-4">
                            <div class="progress-bar" id="overallProgress" style="width: 0%"></div>
                        </div>

                        <div id="progressList">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹é€²æ—ã‚¢ã‚¤ãƒ†ãƒ  -->
                        </div>
                    </div>

                    <!-- å‡¦ç†çµæœè¡¨ç¤º -->
                    <div class="card" id="resultsCard" style="display: none;">
                        <div class="card-header">
                            <h3 class="card-title">å‡¦ç†çµæœ</h3>
                            <button class="btn secondary small" onclick="exportResults()">
                                <i class="fas fa-download"></i>
                                CSVå‡ºåŠ›
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- å‡¦ç†çµæœã‚µãƒãƒªãƒ¼ -->
                            <div class="results-summary">
                                <div class="result-stat">
                                    <div class="result-number success" id="successCount">0</div>
                                    <div class="result-label">æˆåŠŸ</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number error" id="errorCount">0</div>
                                    <div class="result-label">ã‚¨ãƒ©ãƒ¼</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number warning" id="duplicateCount">0</div>
                                    <div class="result-label">é‡è¤‡</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number info" id="totalCount">0</div>
                                    <div class="result-label">åˆè¨ˆ</div>
                                </div>
                            </div>

                            <!-- è©³ç´°çµæœãƒ†ãƒ¼ãƒ–ãƒ« -->
                            <div class="table-container mt-6">
                                <table class="table" id="resultsTable">
                                    <thead>
                                        <tr>
                                            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                            <th>ASIN</th>
                                            <th>å•†å“å</th>
                                            <th>ä¾¡æ ¼</th>
                                            <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                            <th>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹çµæœè¡Œ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="false"></div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner" aria-hidden="true"></div>
            <div class="loading-message">å‡¦ç†ä¸­...</div>
        </div>
    </div>

    <!-- JavaScriptèª­ã¿è¾¼ã¿ -->
    <script src="{{ url_for('static', filename='js/emverze_unified_js.js') }}"></script>
    
    <!-- ASINç®¡ç†å°‚ç”¨JavaScript -->
    <script>
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼åˆ‡ã‚Šæ›¿ãˆ
        function switchUploadMethod(method) {
            // ã‚¿ãƒ–ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            
            document.querySelectorAll('.upload-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–è¨­å®š
            event.target.classList.add('active');
            event.target.setAttribute('aria-selected', 'true');
            document.getElementById(`${method}-upload`).classList.add('active');
        }

        // CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
        function handleCsvFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csvData = e.target.result;
                previewCsvData(csvData);
            };
            reader.readAsText(file, document.getElementById('csvEncoding').value || 'utf-8');
        }

        // CSV ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        function previewCsvData(csvData) {
            // CSVãƒ‘ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const lines = csvData.split('\n').filter(line => line.trim());
            const delimiter = document.getElementById('csvDelimiter').value;
            const asinColumn = document.getElementById('asinColumn').value;
            const skipHeader = document.getElementById('csvSkipHeader').checked;
            
            let startIndex = skipHeader ? 1 : 0;
            let asins = [];
            
            for (let i = startIndex; i < Math.min(lines.length, 10); i++) {
                const columns = lines[i].split(delimiter);
                if (columns[0]) {
                    asins.push(columns[0].trim());
                }
            }
            
            showToast('info', 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼', `${asins.length}ä»¶ã®ASINã‚’æ¤œå‡ºã—ã¾ã—ãŸ`);
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
        document.getElementById('csvDropZone').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        document.getElementById('csvDropZone').addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        document.getElementById('csvDropZone').addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('csvFileInput').files = files;
                handleCsvFile({target: {files: files}});
            }
        });

        // å‡¦ç†é–‹å§‹
        async function startProcessing() {
            const activeMethod = document.querySelector('.upload-content.active').id;
            let data = {};

            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ–¹å¼ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿åé›†
            switch(activeMethod) {
                case 'csv-upload':
                    data = await collectCsvData();
                    break;
                case 'url-upload':
                    data = collectUrlData();
                    break;
                case 'direct-upload':
                    data = collectDirectData();
                    break;
            }

            if (!data.items || data.items.length === 0) {
                showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'å‡¦ç†å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            // å‡¦ç†é–‹å§‹
            showLoading('ASINå‡¦ç†ä¸­...');
            document.getElementById('processingProgress').classList.add('active');
            
            try {
                const response = await apiRequest('/kanpeki-asin/process', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (response.success) {
                    showResults(response);
                    showToast('success', 'å®Œäº†', `${response.success_count}ä»¶ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ`);
                } else {
                    throw new Error(response.message || 'å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                showToast('error', 'ã‚¨ãƒ©ãƒ¼', error.message);
            } finally {
                hideLoading();
            }
        }

        // CSV ãƒ‡ãƒ¼ã‚¿åé›†
        async function collectCsvData() {
            const fileInput = document.getElementById('csvFileInput');
            if (!fileInput.files[0]) {
                return {items: []};
            }

            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvData = e.target.result;
                    const options = {
                        encoding: document.getElementById('csvEncoding').value,
                        delimiter: document.getElementById('csvDelimiter').value,
                        asin_column: document.getElementById('asinColumn').value,
                        skip_header: document.getElementById('csvSkipHeader').checked
                    };
                    
                    resolve({
                        method: 'csv',
                        data: csvData,
                        options: options,
                        processing_options: getProcessingOptions()
                    });
                };
                reader.readAsText(fileInput.files[0]);
            });
        }

        // URL ãƒ‡ãƒ¼ã‚¿åé›†
        function collectUrlData() {
            const urlText = document.getElementById('urlList').value.trim();
            const urls = urlText.split('\n').filter(url => url.trim());
            
            return {
                method: 'url',
                items: urls,
                options: {
                    remove_tracking: document.getElementById('removeTracking').checked,
                    validate_urls: document.getElementById('validateUrls').checked
                },
                processing_options: getProcessingOptions()
            };
        }

        // ç›´æ¥å…¥åŠ›ãƒ‡ãƒ¼ã‚¿åé›†
        function collectDirectData() {
            const asinText = document.getElementById('asinDirectList').value.trim();
            const asins = asinText.split('\n').filter(asin => asin.trim());
            
            return {
                method: 'direct',
                items: asins,
                options: {
                    validate_asins: document.getElementById('validateAsins').checked,
                    remove_duplicates: document.getElementById('removeDuplicates').checked
                },
                processing_options: getProcessingOptions()
            };
        }

        // å…±é€šå‡¦ç†ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¾—
        function getProcessingOptions() {
            return {
                fetch_details: document.getElementById('fetchDetails').checked,
                auto_category: document.getElementById('autoCategory').checked,
                duplicate_check: document.getElementById('duplicateCheck').checked,
                create_inventory: document.getElementById('createInventory').checked
            };
        }

        // çµæœè¡¨ç¤º
        function showResults(response) {
            document.getElementById('resultsCard').style.display = 'block';
            
            // ã‚µãƒãƒªãƒ¼æ›´æ–°
            document.getElementById('successCount').textContent = response.success_count;
            document.getElementById('errorCount').textContent = response.error_count;
            document.getElementById('duplicateCount').textContent = response.duplicate_count;
            document.getElementById('totalCount').textContent = response.processed_count;
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';
            
            response.results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="badge ${getStatusClass(result.status)}">${getStatusText(result.status)}</span></td>
                    <td><code class="asin-code">${result.asin}</code></td>
                    <td>${result.product_name || '-'}</td>
                    <td>${result.price || '-'}</td>
                    <td>${result.category || '-'}</td>
                    <td>${result.error_message || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¯ãƒ©ã‚¹å–å¾—
        function getStatusClass(status) {
            const statusMap = {
                'success': 'success',
                'error': 'danger',
                'duplicate': 'warning',
                'invalid': 'secondary'
            };
            return statusMap[status] || 'secondary';
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
        function getStatusText(status) {
            const statusMap = {
                'success': 'æˆåŠŸ',
                'error': 'ã‚¨ãƒ©ãƒ¼',
                'duplicate': 'é‡è¤‡',
                'invalid': 'ç„¡åŠ¹'
            };
            return statusMap[status] || 'ä¸æ˜';
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type === 'checkbox') {
                    element.checked = element.hasAttribute('checked');
                } else if (element.type === 'file') {
                    element.value = '';
                } else {
                    element.value = element.defaultValue || '';
                }
            });
            
            document.getElementById('processingProgress').classList.remove('active');
            document.getElementById('resultsCard').style.display = 'none';
            
            showToast('info', 'ãƒªã‚»ãƒƒãƒˆ', 'ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
        }

        // çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportResults() {
            showToast('info', 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ', 'CSVå‡ºåŠ›æ©Ÿèƒ½ã‚’æº–å‚™ä¸­ã§ã™');
        }

        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´è¡¨ç¤º
        function showUploadHistory() {
            showToast('info', 'å±¥æ­´', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å±¥æ­´æ©Ÿèƒ½ã‚’æº–å‚™ä¸­ã§ã™');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å®Œç’§ASINç®¡ç†ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        });
    </script>
</body>
</html>