<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay DDPå¯¾å¿œé€æ–™è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0e4b99;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 8px rgba(0,0,0,0.15);
            --radius: 8px;
            --space: 1rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: var(--space);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .header {
            background: var(--primary-color);
            color: white;
            padding: var(--space);
            text-align: center;
        }

        .nav-tabs {
            display: flex;
            background: var(--light-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tab {
            flex: 1;
            padding: var(--space);
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: white;
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: var(--space);
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space);
            margin-bottom: var(--space);
        }

        .form-section {
            background: var(--light-bg);
            padding: var(--space);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .form-section h3 {
            color: var(--primary-color);
            margin-bottom: var(--space);
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: calc(var(--space) * 0.75);
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        .inline-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: #333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: var(--space);
        }

        .calculation-mode {
            display: flex;
            gap: var(--space);
            margin-bottom: var(--space);
            padding: var(--space);
            background: var(--light-bg);
            border-radius: var(--radius);
        }

        .mode-option {
            flex: 1;
            padding: var(--space);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-option.active {
            border-color: var(--primary-color);
            background: white;
            box-shadow: var(--shadow);
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space);
            margin-top: var(--space);
        }

        .result-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space);
            box-shadow: var(--shadow);
        }

        .result-header {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--space);
            font-size: 1.1rem;
        }

        .calculation-breakdown {
            margin-top: var(--space);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: 600;
            background: var(--light-bg);
            margin: 0.5rem -1rem -1rem;
            padding: 0.75rem 1rem;
        }

        .country-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space);
        }

        .country-table th,
        .country-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .country-table th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--primary-color);
        }

        .country-table tr:hover {
            background: var(--light-bg);
        }

        .alert {
            padding: var(--space);
            border-radius: var(--radius);
            margin-bottom: var(--space);
            border-left: 4px solid;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: var(--info-color);
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning-color);
            color: #856404;
        }

        .shipping-limit-warning {
            background: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
        }

        .exchange-rate-display {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: var(--space);
            margin-bottom: var(--space);
        }

        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .calculation-mode {
                flex-direction: column;
            }

            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shipping-fast"></i> eBay DDPå¯¾å¿œé€æ–™è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>é–¢ç¨ãƒ»VATè¾¼ã¿ä¾¡æ ¼è¨­å®šã¨DDU/DDPæ¯”è¼ƒè¨ˆç®—</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('calculator')">
                <i class="fas fa-calculator"></i> é€æ–™è¨ˆç®—
            </button>
            <button class="nav-tab" onclick="switchTab('settings')">
                <i class="fas fa-cog"></i> è¨­å®šç®¡ç†
            </button>
            <button class="nav-tab" onclick="switchTab('limits')">
                <i class="fas fa-exclamation-triangle"></i> é€æ–™ä¸Šé™ç¢ºèª
            </button>
        </div>

        <!-- é€æ–™è¨ˆç®—ã‚¿ãƒ– -->
        <div id="calculator" class="tab-content active">
            <div class="calculation-mode">
                <div class="mode-option active" onclick="setCalculationMode('ddu')" id="ddu-mode">
                    <h3><i class="fas fa-truck"></i> DDU ãƒ¢ãƒ¼ãƒ‰</h3>
                    <p>é–¢ç¨ãƒ»VATåˆ¥é€”ï¼ˆè³¼å…¥è€…è² æ‹…ï¼‰</p>
                    <small>å¾“æ¥ã®è²©å£²æ–¹å¼</small>
                </div>
                <div class="mode-option" onclick="setCalculationMode('ddp')" id="ddp-mode">
                    <h3><i class="fas fa-shield-alt"></i> DDP ãƒ¢ãƒ¼ãƒ‰</h3>
                    <p>é–¢ç¨ãƒ»VATè¾¼ã¿ä¾¡æ ¼</p>
                    <small>æ¨å¥¨ï¼šè³¼å…¥ãƒãƒ¼ãƒ‰ãƒ«è»½æ¸›</small>
                </div>
                <div class="mode-option" onclick="setCalculationMode('compare')" id="compare-mode">
                    <h3><i class="fas fa-balance-scale"></i> æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰</h3>
                    <p>DDU vs DDP æ¯”è¼ƒ</p>
                    <small>æœ€é©æˆ¦ç•¥ã®æ¤œè¨</small>
                </div>
            </div>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                <strong>DDPæ¨å¥¨ç†ç”±ï¼š</strong> ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã§ã¯é–¢ç¨ãƒ»VATäº‹å‰è¾¼ã¿ä¾¡æ ¼ã«ã‚ˆã‚Šè³¼å…¥ç‡ãŒå¤§å¹…å‘ä¸Šã€‚eBay GSPæ´»ç”¨ã§ç°¡å˜ã«å®Ÿç¾å¯èƒ½ã€‚
            </div>

            <div class="form-grid">
                <div class="form-section">
                    <h3><i class="fas fa-box"></i> å•†å“æƒ…å ±</h3>
                    
                    <div class="form-group">
                        <label>å•†å“ä¾¡æ ¼ï¼ˆUSDï¼‰</label>
                        <input type="number" id="productPrice" placeholder="135.00" value="135.00">
                    </div>

                    <div class="form-group">
                        <label>å•†å“é‡é‡ï¼ˆkgï¼‰</label>
                        <input type="number" step="0.1" id="weight" placeholder="0.5" value="0.5">
                    </div>

                    <div class="form-group">
                        <label>å•†å“ã‚µã‚¤ã‚ºï¼ˆcmï¼‰</label>
                        <div class="inline-inputs">
                            <input type="number" id="length" placeholder="é•·ã•" value="25">
                            <input type="number" id="width" placeholder="å¹…" value="20">
                            <input type="number" id="height" placeholder="é«˜ã•" value="15">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>HSã‚³ãƒ¼ãƒ‰ï¼ˆé–¢ç¨è¨ˆç®—ç”¨ï¼‰</label>
                        <select id="hsCode">
                            <option value="8517.12">8517.12 - ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ (0-4%)</option>
                            <option value="9001.90">9001.90 - å…‰å­¦æ©Ÿå™¨ (2.5-7%)</option>
                            <option value="8528.72">8528.72 - æ¶²æ™¶ãƒ¢ãƒ‹ã‚¿ãƒ¼ (14%)</option>
                            <option value="6203.42">6203.42 - è¡£é¡ãƒ»ã‚ºãƒœãƒ³ (12%)</option>
                            <option value="9503.00">9503.00 - ãŠã‚‚ã¡ã‚ƒ (4.7%)</option>
                            <option value="8471.30">8471.30 - ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ (0%)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>åŸç”£å›½</label>
                        <select id="originCountry">
                            <option value="US">ã‚¢ãƒ¡ãƒªã‚« (FTAé©ç”¨å¯èƒ½æ€§ã‚ã‚Š)</option>
                            <option value="JP">æ—¥æœ¬</option>
                            <option value="CN">ä¸­å›½</option>
                            <option value="KR">éŸ“å›½</option>
                            <option value="DE">ãƒ‰ã‚¤ãƒ„</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-globe"></i> ç™ºé€å…ˆæƒ…å ±</h3>
                    
                    <div class="form-group">
                        <label>ç™ºé€å…ˆå›½</label>
                        <select id="destinationCountry">
                            <option value="DE">ãƒ‰ã‚¤ãƒ„ï¼ˆVAT: 19%ï¼‰</option>
                            <option value="FR">ãƒ•ãƒ©ãƒ³ã‚¹ï¼ˆVAT: 20%ï¼‰</option>
                            <option value="GB">ã‚¤ã‚®ãƒªã‚¹ï¼ˆVAT: 20%ï¼‰</option>
                            <option value="IT">ã‚¤ã‚¿ãƒªã‚¢ï¼ˆVAT: 22%ï¼‰</option>
                            <option value="ES">ã‚¹ãƒšã‚¤ãƒ³ï¼ˆVAT: 21%ï¼‰</option>
                            <option value="CA">ã‚«ãƒŠãƒ€ï¼ˆGST: 5-15%ï¼‰</option>
                            <option value="AU">ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ï¼ˆGST: 10%ï¼‰</option>
                            <option value="US">ã‚¢ãƒ¡ãƒªã‚«ï¼ˆå·ç¨: 0-10%ï¼‰</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>é…é€æ–¹æ³•</label>
                        <select id="shippingMethod">
                            <option value="standard">Standard (7-14æ—¥) - å®‰ä¾¡</option>
                            <option value="expedited">Expedited (3-7æ—¥) - æ¨™æº–</option>
                            <option value="express">Express (1-3æ—¥) - é«˜é€Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>eBayã‚µã‚¤ãƒˆ</label>
                        <select id="ebaySite">
                            <option value="US">eBay.com (US)</option>
                            <option value="DE">eBay.de (Germany)</option>
                            <option value="GB">eBay.co.uk (UK)</option>
                            <option value="AU">eBay.com.au (Australia)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="exchange-rate-display">
                <h3><i class="fas fa-exchange-alt"></i> ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆæƒ…å ±</h3>
                <div class="rate-item">
                    <span>USD/JPY:</span>
                    <span id="usdJpyRate">148.50</span>
                </div>
                <div class="rate-item">
                    <span>USD/EUR:</span>
                    <span id="usdEurRate">0.92</span>
                </div>
                <div class="rate-item">
                    <span>æœ€çµ‚æ›´æ–°:</span>
                    <span id="rateUpdateTime">2025-09-21 12:00:00</span>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calculateShipping()">
                    <i class="fas fa-calculator"></i> é€æ–™è¨ˆç®—å®Ÿè¡Œ
                </button>
                <button class="btn btn-success" onclick="optimizeForDDP()">
                    <i class="fas fa-magic"></i> DDPæœ€é©åŒ–
                </button>
                <button class="btn btn-warning" onclick="checkEbayLimits()">
                    <i class="fas fa-exclamation-triangle"></i> é€æ–™ä¸Šé™ãƒã‚§ãƒƒã‚¯
                </button>
                <button class="btn btn-secondary" onclick="clearForm()">
                    <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                </button>
            </div>

            <div id="results" class="results-container" style="display: none;">
                <!-- è¨ˆç®—çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- è¨­å®šç®¡ç†ã‚¿ãƒ– -->
        <div id="settings" class="tab-content">
            <div class="form-section">
                <h3><i class="fas fa-cog"></i> é–¢ç¨ãƒ»VATè¨­å®š</h3>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    é–¢ç¨ç‡ã¯é »ç¹ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚æœ€æ–°æƒ…å ±ã¯å„å›½ç¨é–¢ã‚µã‚¤ãƒˆã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                </div>

                <table class="country-table">
                    <thead>
                        <tr>
                            <th>å›½</th>
                            <th>VATç‡</th>
                            <th>é–¢ç¨ç‡ï¼ˆHSã‚³ãƒ¼ãƒ‰åˆ¥ï¼‰</th>
                            <th>å…ç¨é™åº¦é¡</th>
                            <th>FTAé©ç”¨</th>
                        </tr>
                    </thead>
                    <tbody id="countrySettings">
                        <tr>
                            <td>ğŸ‡©ğŸ‡ª ãƒ‰ã‚¤ãƒ„</td>
                            <td>19%</td>
                            <td>0-17%</td>
                            <td>â‚¬22</td>
                            <td>US-EU FTA</td>
                        </tr>
                        <tr>
                            <td>ğŸ‡«ğŸ‡· ãƒ•ãƒ©ãƒ³ã‚¹</td>
                            <td>20%</td>
                            <td>0-17%</td>
                            <td>â‚¬22</td>
                            <td>US-EU FTA</td>
                        </tr>
                        <tr>
                            <td>ğŸ‡¬ğŸ‡§ ã‚¤ã‚®ãƒªã‚¹</td>
                            <td>20%</td>
                            <td>0-25%</td>
                            <td>Â£15</td>
                            <td>ãªã—</td>
                        </tr>
                        <tr>
                            <td>ğŸ‡¨ğŸ‡¦ ã‚«ãƒŠãƒ€</td>
                            <td>5-15%</td>
                            <td>0-25%</td>
                            <td>CAD $20</td>
                            <td>USMCA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é€æ–™ä¸Šé™ç¢ºèªã‚¿ãƒ– -->
        <div id="limits" class="tab-content">
            <div class="form-section">
                <h3><i class="fas fa-exclamation-triangle"></i> eBayé€æ–™ä¸Šé™è¨­å®š</h3>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    eBayã§ã¯é€æ–™ã«ä¸Šé™ãŒã‚ã‚‹ãŸã‚ã€DDPä¾¡æ ¼è¨­å®šæ™‚ã¯å•†å“ä¾¡æ ¼ã§ã®èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚
                </div>

                <table class="country-table">
                    <thead>
                        <tr>
                            <th>eBayã‚µã‚¤ãƒˆ</th>
                            <th>é€æ–™ä¸Šé™ï¼ˆStandardï¼‰</th>
                            <th>é€æ–™ä¸Šé™ï¼ˆExpressï¼‰</th>
                            <th>åˆ¶é™è©³ç´°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>eBay.com (US)</td>
                            <td>$50</td>
                            <td>$100</td>
                            <td>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥åˆ¶é™ã‚ã‚Š</td>
                        </tr>
                        <tr>
                            <td>eBay.de (DE)</td>
                            <td>â‚¬50</td>
                            <td>â‚¬100</td>
                            <td>EUåŸŸå†…ã¯â‚¬30</td>
                        </tr>
                        <tr>
                            <td>eBay.co.uk (UK)</td>
                            <td>Â£40</td>
                            <td>Â£80</td>
                            <td>Brexitå¾Œã®åˆ¶é™</td>
                        </tr>
                        <tr>
                            <td>eBay.com.au (AU)</td>
                            <td>AUD $70</td>
                            <td>AUD $150</td>
                            <td>é‡é‡åˆ¶é™ä½µç”¨</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert shipping-limit-warning" id="limitWarning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>é€æ–™ä¸Šé™è¶…éè­¦å‘Šï¼š</strong> è¨ˆç®—ã•ã‚ŒãŸé€æ–™ãŒeBayã®ä¸Šé™ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚å•†å“ä¾¡æ ¼ã§ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentMode = 'ddu';
        let exchangeRates = {
            'USD/JPY': 148.50,
            'USD/EUR': 0.92,
            'USD/GBP': 0.79,
            'USD/CAD': 1.35,
            'USD/AUD': 1.48
        };

        // é–¢ç¨ãƒ»VATè¨­å®š
        const taxSettings = {
            'DE': { vat: 0.19, dutyRange: [0, 0.17], threshold: 22 },
            'FR': { vat: 0.20, dutyRange: [0, 0.17], threshold: 22 },
            'GB': { vat: 0.20, dutyRange: [0, 0.25], threshold: 15 },
            'IT': { vat: 0.22, dutyRange: [0, 0.17], threshold: 22 },
            'ES': { vat: 0.21, dutyRange: [0, 0.17], threshold: 22 },
            'CA': { vat: 0.13, dutyRange: [0, 0.25], threshold: 20 },
            'AU': { vat: 0.10, dutyRange: [0, 0.20], threshold: 1000 },
            'US': { vat: 0.08, dutyRange: [0, 0.15], threshold: 800 }
        };

        // HSã‚³ãƒ¼ãƒ‰åˆ¥é–¢ç¨ç‡
        const hsCodeRates = {
            '8517.12': { DE: 0, FR: 0, GB: 0, US: 0, CA: 0, AU: 0 },
            '9001.90': { DE: 0.025, FR: 0.025, GB: 0.025, US: 0.025, CA: 0.025, AU: 0.05 },
            '8528.72': { DE: 0.14, FR: 0.14, GB: 0.14, US: 0.05, CA: 0.06, AU: 0.05 },
            '6203.42': { DE: 0.12, FR: 0.12, GB: 0.12, US: 0.167, CA: 0.18, AU: 0.05 },
            '9503.00': { DE: 0.047, FR: 0.047, GB: 0.047, US: 0, CA: 0, AU: 0.05 },
            '8471.30': { DE: 0, FR: 0, GB: 0, US: 0, CA: 0, AU: 0 }
        };

        // eBayé€æ–™ä¸Šé™
        const shippingLimits = {
            'US': { standard: 50, express: 100 },
            'DE': { standard: 50, express: 100 },
            'GB': { standard: 40, express: 80 },
            'AU': { standard: 70, express: 150 }
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function setCalculationMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-option').forEach(option => option.classList.remove('active'));
            document.getElementById(mode + '-mode').classList.add('active');
        }

        // é€æ–™è¨ˆç®—ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function calculateShipping() {
            const productPrice = parseFloat(document.getElementById('productPrice').value) || 0;
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const hsCode = document.getElementById('hsCode').value;
            const originCountry = document.getElementById('originCountry').value;
            const destCountry = document.getElementById('destinationCountry').value;
            const shippingMethod = document.getElementById('shippingMethod').value;
            const ebaySite = document.getElementById('ebaySite').value;

            // åŸºæœ¬é€æ–™è¨ˆç®—
            const basicShipping = calculateBasicShipping(weight, length, width, height, shippingMethod);
            
            // é–¢ç¨ãƒ»VATè¨ˆç®—
            const dutyRate = hsCodeRates[hsCode][destCountry] || 0;
            const vatRate = taxSettings[destCountry].vat;
            
            const results = document.getElementById('results');
            results.style.display = 'block';
            
            if (currentMode === 'ddu') {
                results.innerHTML = generateDDUResults(productPrice, basicShipping, dutyRate, vatRate, destCountry);
            } else if (currentMode === 'ddp') {
                results.innerHTML = generateDDPResults(productPrice, basicShipping, dutyRate, vatRate, destCountry, ebaySite);
            } else if (currentMode === 'compare') {
                results.innerHTML = generateComparisonResults(productPrice, basicShipping, dutyRate, vatRate, destCountry, ebaySite);
            }
        }

        // åŸºæœ¬é€æ–™è¨ˆç®—
        function calculateBasicShipping(weight, length, width, height, method) {
            const volume = (length * width * height) / 1000; // ãƒªãƒƒãƒˆãƒ«
            const volumeWeight = volume * 0.2; // å®¹ç©é‡é‡ä¿‚æ•°
            const chargeableWeight = Math.max(weight, volumeWeight);
            
            const baseRates = {
                'standard': 15,
                'expedited': 25,
                'express': 45
            };
            
            return baseRates[method] + (chargeableWeight * 8);
        }

        // DDUçµæœç”Ÿæˆ
        function generateDDUResults(productPrice, shipping, dutyRate, vatRate, destCountry) {
            const duty = productPrice * dutyRate;
            const vatBase = productPrice + shipping + duty;
            const vat = vatBase * vatRate;
            const buyerTotal = productPrice + shipping + duty + vat;
            
            return `
                <div class="result-card">
                    <div class="result-header">DDUè¨ˆç®—çµæœï¼ˆé–¢ç¨ãƒ»VATåˆ¥é€”ï¼‰</div>
                    <div class="calculation-breakdown">
                        <div class="breakdown-item">
                            <span>å•†å“ä¾¡æ ¼ï¼š</span>
                            <span>$${productPrice.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>é€æ–™ï¼š</span>
                            <span>$${shipping.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>è³¼å…¥è€…æ”¯æ‰•é¡ï¼š</span>
                            <span>$${(productPrice + shipping).toFixed(2)}</span>
                        </div>
                    </div>
                </div>
                <div class="result-card">
                    <div class="result-header">è³¼å…¥è€…è¿½åŠ è² æ‹…ï¼ˆåˆ°ç€æ™‚æ”¯æ‰•ã„ï¼‰</div>
                    <div class="calculation-breakdown">
                        <div class="breakdown-item">
                            <span>é–¢ç¨ (${(dutyRate * 100).toFixed(1)}%)ï¼š</span>
                            <span>$${duty.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>VAT (${(vatRate * 100).toFixed(1)}%)ï¼š</span>
                            <span>$${vat.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>è³¼å…¥è€…æœ€çµ‚è² æ‹…é¡ï¼š</span>
                            <span>$${buyerTotal.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // DDPçµæœç”Ÿæˆ
        function generateDDPResults(productPrice, shipping, dutyRate, vatRate, destCountry, ebaySite) {
            const duty = productPrice * dutyRate;
            const vatBase = productPrice + shipping + duty;
            const vat = vatBase * vatRate;
            const totalTaxes = duty + vat;
            
            // DDPä¾¡æ ¼è¨­å®š
            const ddpProductPrice = productPrice + totalTaxes;
            const maxShipping = shippingLimits[ebaySite].standard;
            
            let adjustedShipping = shipping;
            let priceAdjustment = 0;
            
            if (shipping > maxShipping) {
                priceAdjustment = shipping - maxShipping;
                adjustedShipping = maxShipping;
                ddpProductPrice += priceAdjustment;
            }
            
            return `
                <div class="result-card">
                    <div class="result-header">DDPä¾¡æ ¼è¨­å®šï¼ˆé–¢ç¨ãƒ»VATè¾¼ã¿ï¼‰</div>
                    <div class="calculation-breakdown">
                        <div class="breakdown-item">
                            <span>åŸºæœ¬å•†å“ä¾¡æ ¼ï¼š</span>
                            <span>$${productPrice.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>é–¢ç¨è¾¼ã¿ï¼š</span>
                            <span>+$${duty.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>VATè¾¼ã¿ï¼š</span>
                            <span>+$${vat.toFixed(2)}</span>
                        </div>
                        ${priceAdjustment > 0 ? `
                        <div class="breakdown-item">
                            <span>é€æ–™ä¸Šé™èª¿æ•´ï¼š</span>
                            <span>+$${priceAdjustment.toFixed(2)}</span>
                        </div>
                        ` : ''}
                        <div class="breakdown-item">
                            <span>DDPå•†å“ä¾¡æ ¼ï¼š</span>
                            <span>$${(ddpProductPrice + priceAdjustment).toFixed(2)}</span>
                        </div>
                    </div>
                </div>
                <div class="result-card">
                    <div class="result-header">eBayå‡ºå“è¨­å®š</div>
                    <div class="calculation-breakdown">
                        <div class="breakdown-item">
                            <span>å‡ºå“ä¾¡æ ¼ï¼š</span>
                            <span>$${(ddpProductPrice + priceAdjustment).toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>é€æ–™è¨­å®šï¼š</span>
                            <span>$${adjustedShipping.toFixed(2)}</span>
                        </div>
                        <div class="breakdown-item">
                            <span>è³¼å…¥è€…æ”¯æ‰•é¡ï¼š</span>
                            <span>$${(ddpProductPrice + priceAdjustment + adjustedShipping).toFixed(2)}</span>
                        </div>
                    </div>
                    ${adjustedShipping >= maxShipping ? `
                    <div class="alert shipping-limit-warning" style="margin-top: 1rem;">
                        <i class="fas fa-exclamation-triangle"></i>
                        é€æ–™ä¸Šé™ï¼ˆ$${maxShipping}ï¼‰ã«é”ã—ã¦ã„ã¾ã™
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // æ¯”è¼ƒçµæœç”Ÿæˆ
        function generateComparisonResults(productPrice, shipping, dutyRate, vatRate, destCountry, ebaySite) {
            // DDUè¨ˆç®—
            const dduDuty = productPrice * dutyRate;
            const dduVatBase = productPrice + shipping + dduDuty;
            const dduVat = dduVatBase * vatRate;
            const dduBuyerTotal = productPrice + shipping + dduDuty + dduVat;
            
            // DDPè¨ˆç®—
            const ddpDuty = productPrice * dutyRate;
            const ddpVatBase = productPrice + shipping + ddpDuty;
            const ddpVat = ddpVatBase * vatRate;
            const ddpTotalTaxes = ddpDuty + ddpVat;
            const ddpProductPrice = productPrice + ddpTotalTaxes;
            const maxShipping = shippingLimits[ebaySite].standard;
            
            let ddpAdjustedShipping = shipping;
            let ddpPriceAdjustment = 0;
            
            if (shipping > maxShipping) {
                ddpPriceAdjustment = shipping - maxShipping;
                ddpAdjustedShipping = maxShipping;
            }
            
            const ddpFinalPrice = ddpProductPrice + ddpPriceAdjustment;
            const ddpBuyerTotal = ddpFinalPrice + ddpAdjustedShipping;
            
            return `
                <div class="result-card">
                    <div class="result-header">DDU vs DDP æ¯”è¼ƒ</div>
                    <table class="country-table">
                        <thead>
                            <tr>
                                <th>é …ç›®</th>
                                <th>DDU</th>
                                <th>DDP</th>
                                <th>å·®é¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>å‡ºå“ä¾¡æ ¼</td>
                                <td>$${productPrice.toFixed(2)}</td>
                                <td>$${ddpFinalPrice.toFixed(2)}</td>
                                <td>+$${(ddpFinalPrice - productPrice).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>é€æ–™</td>
                                <td>$${shipping.toFixed(2)}</td>
                                <td>$${ddpAdjustedShipping.toFixed(2)}</td>
                                <td>${(ddpAdjustedShipping - shipping).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>è³¼å…¥è€…æ”¯æ‰•é¡</td>
                                <td>$${(productPrice + shipping).toFixed(2)}</td>
                                <td>$${ddpBuyerTotal.toFixed(2)}</td>
                                <td>+$${(ddpBuyerTotal - productPrice - shipping).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>è¿½åŠ è²»ç”¨ï¼ˆåˆ°ç€æ™‚ï¼‰</td>
                                <td>$${(dduDuty + dduVat).toFixed(2)}</td>
                                <td>$0.00</td>
                                <td>-$${(dduDuty + dduVat).toFixed(2)}</td>
                            </tr>
                            <tr style="background: #f8f9fa; font-weight: bold;">
                                <td>æœ€çµ‚è² æ‹…é¡</td>
                                <td>$${dduBuyerTotal.toFixed(2)}</td>
                                <td>$${ddpBuyerTotal.toFixed(2)}</td>
                                <td>${(ddpBuyerTotal - dduBuyerTotal).toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="result-card">
                    <div class="result-header">æ¨å¥¨æˆ¦ç•¥</div>
                    <div style="padding: 1rem 0;">
                        ${ddpBuyerTotal <= dduBuyerTotal * 1.05 ? `
                        <div class="alert alert-info">
                            <i class="fas fa-thumbs-up"></i>
                            <strong>DDPæ¨å¥¨ï¼š</strong> è³¼å…¥è€…ã®è² æ‹…å·®ãŒå°ã•ãã€è³¼å…¥ãƒãƒ¼ãƒ‰ãƒ«ã‚’å¤§å¹…ã«è»½æ¸›ã§ãã¾ã™ã€‚
                        </div>
                        ` : `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>è¦æ¤œè¨ï¼š</strong> DDPä¾¡æ ¼ãŒé«˜ããªã£ã¦ã„ã¾ã™ã€‚ä¾¡æ ¼ç«¶äº‰åŠ›ã‚’è€ƒæ…®ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚
                        </div>
                        `}
                    </div>
                </div>
            `;
        }

        // DDPæœ€é©åŒ–
        function optimizeForDDP() {
            setCalculationMode('ddp');
            calculateShipping();
            
            // è¿½åŠ ã®æœ€é©åŒ–ææ¡ˆã‚’è¡¨ç¤º
            const results = document.getElementById('results');
            results.innerHTML += `
                <div class="result-card full-width">
                    <div class="result-header">DDPæœ€é©åŒ–ææ¡ˆ</div>
                    <div class="alert alert-info">
                        <h4>ä¾¡æ ¼è¨­å®šæˆ¦ç•¥ï¼š</h4>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            <li>æœ€ã‚‚é«˜ã„é–¢ç¨ç‡ã®å›½ï¼ˆä¾‹ï¼šEUï¼‰ã‚’åŸºæº–ã«DDPä¾¡æ ¼ã‚’è¨­å®š</li>
                            <li>å›½åˆ¥é€æ–™ã§é–¢ç¨ã®å·®åˆ†ã‚’å¸åã—ã€æœ€çµ‚æ”¯æ‰•é¡ã‚’å‡ä¸€åŒ–</li>
                            <li>eBay GSPã‚’æ´»ç”¨ã—ã¦DDPæ‰‹ç¶šãã‚’è‡ªå‹•åŒ–</li>
                            <li>ã€Œé–¢ç¨ãƒ»VATè¾¼ã¿ã€ã‚’å•†å“ã‚¿ã‚¤ãƒˆãƒ«ã«æ˜è¨˜ã—ã¦å·®åˆ¥åŒ–</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // é€æ–™ä¸Šé™ãƒã‚§ãƒƒã‚¯
        function checkEbayLimits() {
            const ebaySite = document.getElementById('ebaySite').value;
            const shippingMethod = document.getElementById('shippingMethod').value;
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            
            const calculatedShipping = calculateBasicShipping(weight, length, width, height, shippingMethod);
            const limit = shippingLimits[ebaySite][shippingMethod === 'express' ? 'express' : 'standard'];
            
            const warningDiv = document.getElementById('limitWarning');
            if (calculatedShipping > limit) {
                warningDiv.style.display = 'block';
                warningDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>é€æ–™ä¸Šé™è¶…éè­¦å‘Šï¼š</strong> 
                    è¨ˆç®—é€æ–™ $${calculatedShipping.toFixed(2)} ãŒ eBay${ebaySite} ã®ä¸Šé™ $${limit} ã‚’è¶…éã€‚
                    è¶…éåˆ† $${(calculatedShipping - limit).toFixed(2)} ã‚’å•†å“ä¾¡æ ¼ã«çµ„ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚
                `;
            } else {
                warningDiv.style.display = 'none';
            }
            
            // ãƒªãƒŸãƒƒãƒˆç¢ºèªã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            switchTab('limits');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearForm() {
            document.getElementById('productPrice').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('results').style.display = 'none';
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆæ›´æ–°
            updateExchangeRates();
        });

        // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆæ›´æ–°
        function updateExchangeRates() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯å¤–éƒ¨APIã‹ã‚‰å–å¾—
            document.getElementById('rateUpdateTime').textContent = new Date().toLocaleString('ja-JP');
        }
    </script>
</body>
</html>