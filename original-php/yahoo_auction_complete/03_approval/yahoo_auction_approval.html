<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yahoo Auction 商品承認システム - 改良版</title>

  <!-- 外部ライブラリ -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <style>
    /* ===== NAGANO-3共通変数 ===== */
    :root {
      /* ライトモード */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --bg-hover: #e2e8f0;
      --bg-active: #cbd5e1;
      
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --text-muted: #94a3b8;
      --text-white: #ffffff;
      
      --border-color: #e2e8f0;
      --border-light: #f1f5f9;
      --border-dark: #cbd5e1;
      
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      
      /* フィルター専用色 */
      --filter-primary: #dc2626;
      --filter-primary-rgb: 220, 38, 38;
      --filter-secondary: #f59e0b;
      --filter-success: #10b981;
      --filter-warning: #f59e0b;
      --filter-danger: #dc2626;
      --filter-info: #06b6d4;
      
      /* アクセントカラー */
      --accent-blue: #06b6d4;
      --accent-purple: #8b5cf6;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
      --accent-orange: #f97316;
      
      /* リスクカラー */
      --risk-high: #dc2626;
      --risk-high-light: #fef2f2;
      --risk-medium: #f59e0b;
      --risk-medium-light: #fefbf0;
      --risk-low: #10b981;
      --risk-low-light: #f0fdf4;
      
      /* AI判定カラー */
      --ai-approved: #10b981;
      --ai-rejected: #dc2626;
      --ai-pending: #6b7280;
      
      /* スペーシング */
      --space-1: 0.25rem;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-5: 1.25rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      
      /* ボーダーラジアス */
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
      --radius-2xl: 1rem;
      
      /* トランジション */
      --transition-fast: all 0.15s ease;
      --transition-normal: all 0.3s ease;
    }

    /* テーマ切り替え対応 */
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-hover: #475569;
      --bg-active: #64748b;
      
      --text-primary: #f8fafc;
      --text-secondary: #e2e8f0;
      --text-tertiary: #cbd5e1;
      --text-muted: #94a3b8;
      
      --border-color: #475569;
      --border-light: #64748b;
      --border-dark: #334155;
      
      --filter-primary: #f87171;
      --filter-primary-rgb: 248, 113, 113;
    }

    /* ベーススタイル */
    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      margin: 0;
      padding: 0;
      transition: var(--transition-normal);
    }

    .approval__main-container {
      padding: var(--space-4);
      max-width: none;
      width: 100%;
      margin: 0;
      background: var(--bg-primary);
      min-height: 100vh;
    }

    /* ===== ヘッダーセクション ===== */
    .approval__page-header {
      background: linear-gradient(135deg, #1e40af, #3b82f6);
      border-radius: var(--radius-2xl);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
      color: var(--text-white);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .approval__page-header::before {
      content: '';
      position: absolute;
      top: -30%;
      right: -10%;
      width: 200px;
      height: 200px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transform: rotate(45deg);
    }

    .approval__header-content {
      position: relative;
      z-index: 2;
    }

    .approval__page-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }

    .approval__title-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      backdrop-filter: blur(10px);
    }

    /* ===== 統計・フィルターセクション ===== */
    .approval__controls {
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-light);
    }

    .approval__stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--space-3);
      margin-bottom: var(--space-4);
    }

    .approval__stat-card {
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      text-align: center;
      border: 1px solid var(--border-color);
    }

    .approval__stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
    }

    .approval__stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* ===== フィルターコントロール ===== */
    .approval__filter-controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
      align-items: center;
      margin-bottom: var(--space-3);
    }

    .approval__filter-group {
      display: flex;
      gap: var(--space-2);
      align-items: center;
      flex-wrap: wrap;
    }

    .approval__filter-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .approval__filter-btn {
      padding: var(--space-1) var(--space-3);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-fast);
      white-space: nowrap;
    }

    .approval__filter-btn:hover {
      background: var(--bg-hover);
      border-color: var(--filter-primary);
    }

    .approval__filter-btn--active {
      background: var(--filter-primary);
      border-color: var(--filter-primary);
      color: var(--text-white);
    }

    .approval__filter-count {
      background: var(--bg-hover);
      color: var(--text-secondary);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
      margin-left: var(--space-1);
    }

    .approval__filter-btn--active .approval__filter-count {
      background: rgba(255, 255, 255, 0.2);
      color: var(--text-white);
    }

    /* ===== プルダウンフィルター ===== */
    .approval__filter-dropdown {
      position: relative;
      display: inline-block;
    }

    .approval__dropdown-btn {
      padding: var(--space-1) var(--space-3);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-fast);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .approval__dropdown-btn:hover {
      background: var(--bg-hover);
      border-color: var(--filter-primary);
    }

    .approval__dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 200px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
    }

    .approval__dropdown-content.show {
      display: block;
    }

    .approval__dropdown-item {
      padding: var(--space-2) var(--space-3);
      cursor: pointer;
      transition: var(--transition-fast);
      font-size: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .approval__dropdown-item:hover {
      background: var(--bg-hover);
    }

    .approval__dropdown-item.active {
      background: var(--filter-primary);
      color: var(--text-white);
    }

    /* ===== AI判定状態の視覚化 ===== */
    .approval__filter-btn[data-filter="ai-approved"] {
      border-color: var(--ai-approved);
    }

    .approval__filter-btn[data-filter="ai-approved"]:hover,
    .approval__filter-btn[data-filter="ai-approved"].approval__filter-btn--active {
      background: var(--ai-approved);
      border-color: var(--ai-approved);
      color: white;
    }

    .approval__filter-btn[data-filter="ai-rejected"] {
      border-color: var(--ai-rejected);
    }

    .approval__filter-btn[data-filter="ai-rejected"]:hover,
    .approval__filter-btn[data-filter="ai-rejected"].approval__filter-btn--active {
      background: var(--ai-rejected);
      border-color: var(--ai-rejected);
      color: white;
    }

    .approval__filter-btn[data-filter="ai-pending"] {
      border-color: var(--ai-pending);
    }

    .approval__filter-btn[data-filter="ai-pending"]:hover,
    .approval__filter-btn[data-filter="ai-pending"].approval__filter-btn--active {
      background: var(--ai-pending);
      border-color: var(--ai-pending);
      color: white;
    }

    /* ===== 主要操作ボタン ===== */
    .approval__main-actions {
      display: flex;
      justify-content: space-between;
      gap: var(--space-4);
      margin-top: var(--space-4);
      padding: var(--space-3);
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-color);
    }

    .approval__selection-controls,
    .approval__decision-controls {
      display: flex;
      gap: var(--space-2);
    }

    .approval__main-btn {
      padding: var(--space-3) var(--space-5);
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      min-width: 100px;
      justify-content: center;
    }

    .approval__main-btn--select {
      background: var(--accent-blue);
      color: white;
    }

    .approval__main-btn--select:hover {
      background: #0891b2;
    }

    .approval__main-btn--deselect {
      background: var(--text-muted);
      color: white;
    }

    .approval__main-btn--deselect:hover {
      background: #64748b;
    }

    .approval__main-btn--approve {
      background: var(--filter-success);
      color: white;
      font-size: 1rem;
      padding: var(--space-4) var(--space-6);
    }

    .approval__main-btn--approve:hover {
      background: #059669;
    }

    .approval__main-btn--reject {
      background: var(--filter-danger);
      color: white;
      font-size: 1rem;
      padding: var(--space-4) var(--space-6);
    }

    .approval__main-btn--reject:hover {
      background: #dc2626;
    }

    /* ===== 一括操作バー ===== */
    .approval__bulk-actions {
      background: var(--bg-secondary);
      border: 2px solid var(--filter-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      margin-bottom: var(--space-4);
      display: none;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-lg);
      position: sticky;
      top: var(--space-4);
      z-index: 100;
    }

    .approval__bulk-actions--show {
      display: flex;
    }

    .approval__bulk-info {
      font-weight: 600;
      color: var(--filter-primary);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .approval__bulk-buttons {
      display: flex;
      gap: var(--space-2);
    }

    .approval__bulk-btn {
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .approval__bulk-btn--success {
      background: var(--filter-success);
      border-color: var(--filter-success);
      color: var(--text-white);
    }

    .approval__bulk-btn--danger {
      background: var(--filter-danger);
      border-color: var(--filter-danger);
      color: var(--text-white);
    }

    /* ===== メイングリッド（無制限幅対応） ===== */
    .approval__grid-container {
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      padding: var(--space-2);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-light);
    }

    .approval__grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--space-2);
      margin-bottom: var(--space-3);
    }

    /* ===== 商品カード（デザイン3採用：暗いオーバーレイ） ===== */
    .product-card {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      overflow: hidden;
      cursor: pointer;
      transition: var(--transition-normal);
      position: relative;
      height: 180px;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--filter-info);
    }

    .product-card__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* ===== 上部バッジエリア ===== */
    .product-card__top-info {
      position: absolute;
      top: 4px;
      left: 4px;
      right: 4px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      z-index: 10;
    }

    .product-card__badges {
      display: flex;
      gap: 2px;
    }

    .product-card__badge {
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 0.5rem;
      font-weight: 700;
      color: white;
      backdrop-filter: blur(4px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .product-card__badge--risk-high { background: rgba(220, 38, 38, 0.9); }
    .product-card__badge--risk-medium { background: rgba(245, 158, 11, 0.9); }
    .product-card__badge--ai-approved { background: rgba(16, 185, 129, 0.9); }
    .product-card__badge--ai-rejected { background: rgba(220, 38, 38, 0.9); }
    .product-card__badge--ai-pending { background: rgba(107, 114, 128, 0.9); }

    .product-card__condition-sku {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }

    .product-card__condition {
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 0.5rem;
      font-weight: 700;
      color: white;
      backdrop-filter: blur(4px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .product-card__condition--new { background: rgba(5, 150, 105, 0.9); }
    .product-card__condition--used { background: rgba(93, 64, 55, 0.9); }
    .product-card__condition--preorder { background: rgba(21, 101, 192, 0.9); }
    .product-card__condition--refurbished { background: rgba(106, 27, 154, 0.9); }

    .product-card__sku {
      font-size: 0.45rem;
      color: white;
      font-weight: 500;
      background: rgba(0, 0, 0, 0.6);
      padding: 1px 3px;
      border-radius: 2px;
      backdrop-filter: blur(4px);
    }

    /* ===== オーバーレイ（45%以下に制限） ===== */
    .product-card__overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 45%;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.2));
      z-index: 5;
      padding: 6px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      backdrop-filter: blur(2px);
    }

    .product-card__category {
      font-size: 0.55rem;
      color: #06b6d4;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 1px;
    }

    .product-card__title {
      font-size: 0.7rem;
      font-weight: 600;
      color: white;
      line-height: 1.1;
      margin-bottom: 2px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .product-card__price {
      font-size: 0.8rem;
      font-weight: 700;
      color: #10b981;
      margin-bottom: 3px;
    }

    .product-card__details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
      font-size: 0.5rem;
      margin-bottom: 2px;
    }

    .product-card__detail {
      display: flex;
      justify-content: space-between;
    }

    .product-card__detail-label {
      color: rgba(255, 255, 255, 0.7);
    }

    .product-card__detail-value {
      font-weight: 600;
      color: white;
    }

    .product-card__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .product-card__source {
      font-size: 0.55rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
    }

    /* ===== 選択状態（チェックボックス不要） ===== */
    .product-card--selected {
      border-color: var(--filter-primary);
      box-shadow: 0 0 0 3px rgba(var(--filter-primary-rgb), 0.3);
      transform: translateY(-2px);
    }

    .product-card--selected::after {
      content: '✓';
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--filter-primary);
      color: white;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      z-index: 15;
      box-shadow: var(--shadow-md);
    }

    /* ===== AI判定表示（極細ボーダー・外周全体） ===== */
    .product-card--ai-approved {
      border: 1px solid var(--ai-approved);
    }

    .product-card--ai-rejected {
      border: 1px solid var(--ai-rejected);
    }

    .product-card--ai-pending {
      border: 1px solid var(--ai-pending);
    }

    /* ===== ホバー時のボーダー強調 ===== */
    .product-card:hover.product-card--ai-approved {
      border: 2px solid var(--ai-approved);
    }

    .product-card:hover.product-card--ai-rejected {
      border: 2px solid var(--ai-rejected);
    }

    .product-card:hover.product-card--ai-pending {
      border: 2px solid var(--ai-pending);
    }

    /* ===== ページネーション ===== */
    .approval__pagination {
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.875rem;
      border: 1px solid var(--border-color);
    }

    .approval__pagination-info {
      color: var(--text-secondary);
    }

    .approval__pagination-controls {
      display: flex;
      gap: var(--space-1);
    }

    .approval__pagination-btn {
      padding: var(--space-1) var(--space-2);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.75rem;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .approval__pagination-btn:hover {
      background: var(--bg-hover);
    }

    .approval__pagination-btn--active {
      background: var(--filter-primary);
      border-color: var(--filter-primary);
      color: var(--text-white);
    }

    /* ===== レスポンシブ対応 ===== */
    @media (max-width: 1200px) {
      .approval__grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .approval__main-container {
        padding: var(--space-2);
      }

      .approval__grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: var(--space-1);
      }

      .product-card {
        height: 320px;
      }

      .approval__filter-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .approval__bulk-actions {
        flex-direction: column;
        gap: var(--space-2);
      }
    }

    /* ===== アニメーション ===== */
    @keyframes cardSlideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .product-card {
      animation: cardSlideIn 0.3s ease;
    }

    /* ===== AI推奨表示 ===== */
    .approval__ai-recommendations {
      background: linear-gradient(135deg, var(--accent-purple), var(--filter-info));
      border-radius: var(--radius-lg);
      padding: var(--space-3);
      margin-bottom: var(--space-4);
      color: var(--text-white);
    }

    .approval__ai-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: var(--space-2);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    .approval__ai-summary {
      font-size: 0.875rem;
      opacity: 0.9;
    }

    /* ===== 除外商品 ===== */
    .product-card--excluded {
      opacity: 0.4;
      border-color: var(--text-muted);
      background: var(--bg-hover);
      pointer-events: none;
    }
  </style>
</head>
<body data-system-ready="false">
  <!-- メインコンテナ -->
  <main class="approval__main-container">
    
    <!-- ページヘッダー -->
    <header class="approval__page-header">
      <div class="approval__header-content">
        <h1 class="approval__page-title">
          <div class="approval__title-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          Yahoo Auction 商品承認システム（改良版）
        </h1>
        <p class="approval__page-subtitle">
          フルイメージカード × 暗いオーバーレイ × 動的カテゴリー・仕入先管理
        </p>
      </div>
    </header>

    <!-- AI推奨セクション -->
    <section class="approval__ai-recommendations">
      <h2 class="approval__ai-title">
        <i class="fas fa-brain"></i>
        AI推奨: 要確認商品のみ表示中
      </h2>
      <div class="approval__ai-summary">
        低リスク商品 1,847件は自動承認済み。高・中リスク商品 <span id="totalProductCount">25</span>件を人間判定待ちで表示しています。
      </div>
    </section>

    <!-- 統計・コントロールセクション -->
    <section class="approval__controls">
      <!-- 統計表示 -->
      <div class="approval__stats-grid">
        <div class="approval__stat-card">
          <div class="approval__stat-value" id="pendingCount">25</div>
          <div class="approval__stat-label">承認待ち</div>
        </div>
        <div class="approval__stat-card">
          <div class="approval__stat-value">1,847</div>
          <div class="approval__stat-label">自動承認済み</div>
        </div>
        <div class="approval__stat-card">
          <div class="approval__stat-value" id="highRiskCount">13</div>
          <div class="approval__stat-label">高リスク</div>
        </div>
        <div class="approval__stat-card">
          <div class="approval__stat-value" id="mediumRiskCount">12</div>
          <div class="approval__stat-label">中リスク</div>
        </div>
        <div class="approval__stat-card">
          <div class="approval__stat-value">2.3分</div>
          <div class="approval__stat-label">平均処理時間</div>
        </div>
      </div>

      <!-- フィルターコントロール -->
      <div class="approval__filter-controls">
        <div class="approval__filter-group">
          <span class="approval__filter-label">表示:</span>
          <button class="approval__filter-btn approval__filter-btn--active" data-filter="all">
            すべて <span class="approval__filter-count" id="countAll">25</span>
          </button>
        </div>

        <div class="approval__filter-group">
          <span class="approval__filter-label">AI判定:</span>
          <button class="approval__filter-btn" data-filter="ai-approved">
            AI承認済み <span class="approval__filter-count" id="countAiApproved">13</span>
          </button>
          <button class="approval__filter-btn" data-filter="ai-rejected">
            AI非承認 <span class="approval__filter-count" id="countAiRejected">8</span>
          </button>
          <button class="approval__filter-btn" data-filter="ai-pending">
            AI判定待ち <span class="approval__filter-count" id="countAiPending">4</span>
          </button>
        </div>

        <div class="approval__filter-group">
          <span class="approval__filter-label">リスク:</span>
          <button class="approval__filter-btn" data-filter="high-risk">
            高リスク <span class="approval__filter-count" id="countHighRisk">13</span>
          </button>
          <button class="approval__filter-btn" data-filter="medium-risk">
            中リスク <span class="approval__filter-count" id="countMediumRisk">12</span>
          </button>
        </div>

        <div class="approval__filter-group">
          <span class="approval__filter-label">価格帯:</span>
          <button class="approval__filter-btn" data-filter="low-price">
            ～5,000円 <span class="approval__filter-count" id="countLowPrice">8</span>
          </button>
          <button class="approval__filter-btn" data-filter="medium-price">
            5,001～20,000円 <span class="approval__filter-count" id="countMediumPrice">10</span>
          </button>
          <button class="approval__filter-btn" data-filter="high-price">
            20,001円～ <span class="approval__filter-count" id="countHighPrice">7</span>
          </button>
        </div>

        <div class="approval__filter-group">
          <span class="approval__filter-label">コンディション:</span>
          <button class="approval__filter-btn" data-filter="new">
            新品 <span class="approval__filter-count" id="countNew">17</span>
          </button>
          <button class="approval__filter-btn" data-filter="used">
            中古 <span class="approval__filter-count" id="countUsed">7</span>
          </button>
          <button class="approval__filter-btn" data-filter="preorder">
            予約 <span class="approval__filter-count" id="countPreorder">1</span>
          </button>
        </div>

        <!-- 動的カテゴリープルダウン -->
        <div class="approval__filter-group">
          <span class="approval__filter-label">カテゴリ:</span>
          <div class="approval__filter-dropdown">
            <button class="approval__dropdown-btn" onclick="toggleDropdown('categoryDropdown')">
              <span id="categorySelected">すべて</span>
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="approval__dropdown-content" id="categoryDropdown">
              <div class="approval__dropdown-item active" onclick="selectCategory('all', 'すべて')">
                すべて <span id="categoryCountAll">25</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 動的仕入先プルダウン -->
        <div class="approval__filter-group">
          <span class="approval__filter-label">仕入先:</span>
          <div class="approval__filter-dropdown">
            <button class="approval__dropdown-btn" onclick="toggleDropdown('sourceDropdown')">
              <span id="sourceSelected">すべて</span>
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="approval__dropdown-content" id="sourceDropdown">
              <div class="approval__dropdown-item active" onclick="selectSource('all', 'すべて')">
                すべて <span id="sourceCountAll">25</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 主要操作ボタン -->
      <div class="approval__main-actions">
        <div class="approval__selection-controls">
          <button class="approval__main-btn approval__main-btn--select" onclick="selectAllVisible()">
            <i class="fas fa-check-square"></i>
            全選択
          </button>
          <button class="approval__main-btn approval__main-btn--deselect" onclick="deselectAll()">
            <i class="fas fa-square"></i>
            全解除
          </button>
        </div>
        
        <div class="approval__decision-controls">
          <button class="approval__main-btn approval__main-btn--approve" onclick="bulkApprove()">
            <i class="fas fa-check"></i>
            承認
          </button>
          <button class="approval__main-btn approval__main-btn--reject" onclick="bulkReject()">
            <i class="fas fa-times"></i>
            非承認
          </button>
        </div>
      </div>
    </section>

    <!-- 一括操作バー -->
    <div class="approval__bulk-actions" id="bulkActions">
      <div class="approval__bulk-info">
        <i class="fas fa-check-square"></i>
        <span id="selectedCount">0</span>件 を選択中
      </div>
      <div class="approval__bulk-buttons">
        <button class="approval__bulk-btn approval__bulk-btn--success" onclick="bulkApprove()">
          <i class="fas fa-check"></i>
          一括承認
        </button>
        <button class="approval__bulk-btn approval__bulk-btn--danger" onclick="bulkReject()">
          <i class="fas fa-ban"></i>
          一括否認
        </button>
        <button class="approval__bulk-btn" onclick="bulkHold()">
          <i class="fas fa-pause"></i>
          一括保留
        </button>
        <button class="approval__bulk-btn" onclick="clearSelection()">
          <i class="fas fa-times"></i>
          選択クリア
        </button>
      </div>
    </div>

    <!-- メイングリッド -->
    <section class="approval__grid-container">
      <div class="approval__grid" id="productGrid">
        
        <!-- 商品カード動的生成領域 -->
        
      </div>

      <div class="approval__pagination">
        <div class="approval__pagination-info">
          <span id="displayRange">1-25件表示</span> / 全<span id="totalCount">25</span>件
        </div>
        <div class="approval__pagination-controls">
          <button class="approval__pagination-btn approval__pagination-btn--active">1</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== グローバル変数 =====
    let selectedProducts = new Set();
    let currentFilter = 'all';
    let currentCategory = 'all';
    let currentSource = 'all';
    let approvedCount = 0;
    let rejectedCount = 0;
    let heldCount = 0;

    // 動的カテゴリーマスター（実際の使用時はAPIから取得）
    let activeCategories = new Map();
    let activeSources = new Map();

    // ===== 拡張商品データ（多様な仕入先・カテゴリー） =====
    const productData = [
      {
        sku: "YAH-ELE-H-001", risk: "high", ai: "approved", category: "Consumer Electronics", categoryId: "9355",
        condition: "new", price: 18500, source: "amazon", title: "Apple Watch Series 9 GPS 45mm",
        image: "https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=300&h=300&fit=crop",
        stock: 1, profitRate: 23.5, profitAmount: 4348
      },
      {
        sku: "YAH-TOY-M-002", risk: "medium", ai: "approved", category: "Toys & Hobbies", categoryId: "220",
        condition: "new", price: 12800, source: "yahooauction", title: "LEGO Creator Expert 10242 Limited",
        image: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=300&h=300&fit=crop",
        stock: 3, profitRate: 18.2, profitAmount: 2330
      },
      {
        sku: "YAH-BK-H-003", risk: "high", ai: "rejected", category: "Books", categoryId: "267",
        condition: "used", price: 4200, source: "mercari", title: "Clean Code プログラマー必読書",
        image: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=300&h=300&fit=crop",
        stock: 1, profitRate: 31.8, profitAmount: 1336
      },
      {
        sku: "YAH-CLO-M-004", risk: "medium", ai: "approved", category: "Clothing, Shoes & Accessories", categoryId: "11450",
        condition: "new", price: 3980, source: "rakuten", title: "Uniqlo ヒートテック Tシャツ",
        image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop",
        stock: 8, profitRate: 15.7, profitAmount: 625
      },
      {
        sku: "YAH-ELE-H-005", risk: "high", ai: "rejected", category: "Consumer Electronics", categoryId: "9355",
        condition: "preorder", price: 28900, source: "yahooshopping", title: "Sony WH-1000XM5 ヘッドフォン",
        image: "https://images.unsplash.com/photo-1567581935884-3349723552ca?w=300&h=300&fit=crop",
        stock: 1, profitRate: 27.3, profitAmount: 7889
      },
      {
        sku: "YAH-TOY-M-006", risk: "medium", ai: "approved", category: "Toys & Hobbies", categoryId: "220",
        condition: "used", price: 6750, source: "ebay", title: "1000ピース ジグソーパズル",
        image: "https://images.unsplash.com/photo-1594736797933-d0bc02e4bb66?w=300&h=300&fit=crop",
        stock: 2, profitRate: 22.1, profitAmount: 1492
      },
      {
        sku: "YAH-ELE-H-007", risk: "high", ai: "approved", category: "Consumer Electronics", categoryId: "9355",
        condition: "refurbished", price: 45200, source: "amazon", title: "iPad Pro 11インチ 第4世代",
        image: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=300&h=300&fit=crop",
        stock: 1, profitRate: 19.8, profitAmount: 8950
      },
      {
        sku: "YAH-BK-M-008", risk: "medium", ai: "rejected", category: "Books", categoryId: "267",
        condition: "new", price: 2890, source: "mercari", title: "人を動かす D.カーネギー",
        image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=300&fit=crop",
        stock: 5, profitRate: 24.6, profitAmount: 711
      },
      {
        sku: "YAH-CLO-H-009", risk: "high", ai: "rejected", category: "Clothing, Shoes & Accessories", categoryId: "11450",
        condition: "used", price: 16500, source: "rakuten", title: "Patagonia フリースジャケット",
        image: "https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=300&h=300&fit=crop",
        stock: 1, profitRate: 33.2, profitAmount: 5478
      },
      {
        sku: "YAH-SPO-M-010", risk: "medium", ai: "approved", category: "Sporting Goods", categoryId: "888",
        condition: "new", price: 8980, source: "yahooshopping", title: "ナイキ エアマックス 運動靴",
        image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop",
        stock: 4, profitRate: 16.9, profitAmount: 1518
      },
      {
        sku: "YAH-ELE-H-011", risk: "high", ai: "approved", category: "Consumer Electronics", categoryId: "9355",
        condition: "new", price: 32800, source: "ebay", title: "Bose SoundLink Mini II",
        image: "https://images.unsplash.com/photo-1585776245991-cf89dd7fc73a?w=300&h=300&fit=crop",
        stock: 1, profitRate: 28.7, profitAmount: 9414
      },
      {
        sku: "YAH-HOME-M-012", risk: "medium", ai: "rejected", category: "Home & Garden", categoryId: "11700",
        condition: "used", price: 1650, source: "amazon", title: "無印良品 アロマディフューザー",
        image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=300&h=300&fit=crop",
        stock: 3, profitRate: 29.4, profitAmount: 485
      },
      {
        sku: "YAH-ELE-H-013", risk: "high", ai: "pending", category: "Consumer Electronics", categoryId: "9355",
        condition: "new", price: 24500, source: "yahooauction", title: "Nintendo Switch OLED",
        image: "https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?w=300&h=300&fit=crop",
        stock: 2, profitRate: 21.3, profitAmount: 5218
      },
      {
        sku: "YAH-COL-H-014", risk: "high", ai: "pending", category: "Collectibles", categoryId: "1",
        condition: "new", price: 15800, source: "mercari", title: "ポケモンカード 未開封BOX",
        image: "https://images.unsplash.com/photo-1613963931023-5dc59437c8a6?w=300&h=300&fit=crop",
        stock: 1, profitRate: 45.2, profitAmount: 7142
      },
      {
        sku: "YAH-BK-M-015", risk: "medium", ai: "approved", category: "Books", categoryId: "267",
        condition: "new", price: 3200, source: "rakuten", title: "Think Fast and Slow",
        image: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=300&h=300&fit=crop",
        stock: 6, profitRate: 18.7, profitAmount: 598
      },
      {
        sku: "YAH-ELE-H-016", risk: "high", ai: "rejected", category: "Consumer Electronics", categoryId: "9355",
        condition: "new", price: 89800, source: "yahooshopping", title: "MacBook Pro 14インチ M3",
        image: "https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=300&h=300&fit=crop",
        stock: 1, profitRate: 12.5, profitAmount: 11225
      },
      {
        sku: "YAH-TOY-M-017", risk: "medium", ai: "approved", category: "Toys & Hobbies", categoryId: "220",
        condition: "new", price: 7800, source: "ebay", title: "タミヤ ミニ四駆 完全セット",
        image: "https://images.unsplash.com/photo-1607734834519-d8576ae60ea4?w=300&h=300&fit=crop",
        stock: 3, profitRate: 25.1, profitAmount: 1958
      },
      {
        sku: "YAH-CLO-H-018", risk: "high", ai: "pending", category: "Clothing, Shoes & Accessories", categoryId: "11450",
        condition: "new", price: 25600, source: "amazon", title: "Supreme Box Logo Hoodie",
        image: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=300&h=300&fit=crop",
        stock: 1, profitRate: 38.4, profitAmount: 9830
      },
      {
        sku: "YAH-ELE-M-019", risk: "medium", ai: "approved", category: "Consumer Electronics", categoryId: "9355",
        condition: "used", price: 14200, source: "yahooauction", title: "iPhone 14 Pro 128GB",
        image: "https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=300&h=300&fit=crop",
        stock: 2, profitRate: 19.7, profitAmount: 2797
      },
      {
        sku: "YAH-BK-H-020", risk: "high", ai: "rejected", category: "Books", categoryId: "267",
        condition: "new", price: 4980, source: "mercari", title: "プログラミング完全ガイド 2024",
        image: "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=300&h=300&fit=crop",
        stock: 4, profitRate: 42.1, profitAmount: 2097
      },
      {
        sku: "YAH-COL-H-021", risk: "high", ai: "approved", category: "Collectibles", categoryId: "1",
        condition: "new", price: 18900, source: "rakuten", title: "遊戯王 限定コレクション",
        image: "https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=300&h=300&fit=crop",
        stock: 1, profitRate: 51.2, profitAmount: 9677
      },
      {
        sku: "YAH-SPO-M-022", risk: "medium", ai: "approved", category: "Sporting Goods", categoryId: "888",
        condition: "used", price: 8900, source: "yahooshopping", title: "Wilson テニスラケット",
        image: "https://images.unsplash.com/photo-1595435934249-5df7ed86e1c0?w=300&h=300&fit=crop",
        stock: 1, profitRate: 28.3, profitAmount: 2519
      },
      {
        sku: "YAH-ELE-H-023", risk: "high", ai: "pending", category: "Consumer Electronics", categoryId: "9355",
        condition: "new", price: 35400, source: "ebay", title: "Canon EOS R6 Mark II",
        image: "https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=300&h=300&fit=crop",
        stock: 1, profitRate: 22.8, profitAmount: 8071
      },
      {
        sku: "YAH-HOME-M-024", risk: "medium", ai: "approved", category: "Home & Garden", categoryId: "11700",
        condition: "new", price: 2750, source: "amazon", title: "ダイソン 掃除機 V15",
        image: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=300&h=300&fit=crop",
        stock: 8, profitRate: 31.2, profitAmount: 858
      },
      {
        sku: "YAH-TOY-M-025", risk: "medium", ai: "rejected", category: "Toys & Hobbies", categoryId: "220",
        condition: "new", price: 12400, source: "yahooauction", title: "ドラゴンボール フィギュア",
        image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop",
        stock: 2, profitRate: 23.8, profitAmount: 2951
      }
    ];

    // ===== 仕入先名マッピング =====
    const sourceNames = {
      amazon: "Amazon",
      yahooauction: "ヤフオク",
      rakuten: "楽天",
      mercari: "メルカリ",
      yahooshopping: "Yahoo!ショッピング",
      ebay: "eBay"
    };

    // ===== 初期化 =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Yahoo Auction 商品承認システム（改良版）初期化開始');
      detectCategoriesAndSources();
      renderProducts(productData);
      initializeFilters();
      updateBulkActions();
      updateStats();
      console.log('商品承認システム初期化完了');
    });

    // ===== カテゴリーと仕入先の動的検出 =====
    function detectCategoriesAndSources() {
      // カテゴリー検出
      productData.forEach(product => {
        if (!activeCategories.has(product.categoryId)) {
          activeCategories.set(product.categoryId, {
            name: product.category,
            count: 0
          });
        }
        activeCategories.get(product.categoryId).count++;
      });

      // 仕入先検出
      productData.forEach(product => {
        if (!activeSources.has(product.source)) {
          activeSources.set(product.source, {
            name: sourceNames[product.source] || product.source,
            count: 0
          });
        }
        activeSources.get(product.source).count++;
      });

      updateDropdownMenus();
    }

    // ===== プルダウンメニュー更新 =====
    function updateDropdownMenus() {
      // カテゴリープルダウン更新
      const categoryDropdown = document.getElementById('categoryDropdown');
      let categoryHtml = '<div class="approval__dropdown-item active" onclick="selectCategory(\'all\', \'すべて\')">すべて <span id="categoryCountAll">' + productData.length + '</span></div>';
      
      activeCategories.forEach((data, categoryId) => {
        categoryHtml += `<div class="approval__dropdown-item" onclick="selectCategory('${categoryId}', '${data.name}')">${data.name} <span>${data.count}</span></div>`;
      });
      
      categoryDropdown.innerHTML = categoryHtml;

      // 仕入先プルダウン更新
      const sourceDropdown = document.getElementById('sourceDropdown');
      let sourceHtml = '<div class="approval__dropdown-item active" onclick="selectSource(\'all\', \'すべて\')">すべて <span id="sourceCountAll">' + productData.length + '</span></div>';
      
      activeSources.forEach((data, sourceKey) => {
        sourceHtml += `<div class="approval__dropdown-item" onclick="selectSource('${sourceKey}', '${data.name}')">${data.name} <span>${data.count}</span></div>`;
      });
      
      sourceDropdown.innerHTML = sourceHtml;
    }

    // ===== プルダウン表示切り替え =====
    function toggleDropdown(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      dropdown.classList.toggle('show');
      
      // 他のプルダウンを閉じる
      document.querySelectorAll('.approval__dropdown-content').forEach(d => {
        if (d.id !== dropdownId) {
          d.classList.remove('show');
        }
      });
    }

    // ===== カテゴリー選択 =====
    function selectCategory(categoryId, categoryName) {
      currentCategory = categoryId;
      document.getElementById('categorySelected').textContent = categoryName;
      
      // アクティブ状態更新
      document.querySelectorAll('#categoryDropdown .approval__dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // プルダウンを閉じる
      document.getElementById('categoryDropdown').classList.remove('show');
      
      // フィルター適用
      applyAllFilters();
    }

    // ===== 仕入先選択 =====
    function selectSource(sourceKey, sourceName) {
      currentSource = sourceKey;
      document.getElementById('sourceSelected').textContent = sourceName;
      
      // アクティブ状態更新
      document.querySelectorAll('#sourceDropdown .approval__dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // プルダウンを閉じる
      document.getElementById('sourceDropdown').classList.remove('show');
      
      // フィルター適用
      applyAllFilters();
    }

    // ===== 商品カード生成（改良版：デザイン3） =====
    function createProductCard(product) {
      const aiClass = `product-card--ai-${product.ai}`;
      const riskClass = `product-card--risk-${product.risk}`;
      
      return `
        <div class="product-card ${riskClass} ${aiClass}" 
             data-risk="${product.risk}" 
             data-ai="${product.ai}"
             data-category="${product.categoryId}" 
             data-condition="${product.condition}"
             data-price="${product.price}"
             data-source="${product.source}"
             data-sku="${product.sku}"
             onclick="toggleSelection(this)">
          
          <img src="${product.image}" alt="${product.title}" class="product-card__image">
          
          <div class="product-card__top-info">
            <div class="product-card__badges">
              <span class="product-card__badge product-card__badge--risk-${product.risk}">
                ${product.risk === 'high' ? '高' : '中'}
              </span>
              <span class="product-card__badge product-card__badge--ai-${product.ai}">
                ${product.ai === 'approved' ? 'AI承認' : product.ai === 'rejected' ? 'AI否認' : 'AI判定待ち'}
              </span>
            </div>
            <div class="product-card__condition-sku">
              <span class="product-card__condition product-card__condition--${product.condition}">
                ${getConditionName(product.condition)}
              </span>
              <span class="product-card__sku">${product.sku}</span>
            </div>
          </div>
          
          <div class="product-card__overlay">
            <div class="product-card__category">${getCategoryDisplayName(product.category)}</div>
            <div class="product-card__title">${product.title}</div>
            <div class="product-card__price">¥${product.price.toLocaleString()}</div>
            <div class="product-card__details">
              <div class="product-card__detail">
                <span class="product-card__detail-label">在庫</span>
                <span class="product-card__detail-value">${product.stock}個</span>
              </div>
              <div class="product-card__detail">
                <span class="product-card__detail-label">利益率</span>
                <span class="product-card__detail-value">${product.profitRate}%</span>
              </div>
              <div class="product-card__detail">
                <span class="product-card__detail-label">利益額</span>
                <span class="product-card__detail-value">¥${product.profitAmount.toLocaleString()}</span>
              </div>
              <div class="product-card__detail">
                <span class="product-card__detail-label">仕入先</span>
                <span class="product-card__detail-value">${sourceNames[product.source]}</span>
              </div>
            </div>
            <div class="product-card__footer">
              <span class="product-card__source">${sourceNames[product.source]}</span>
            </div>
          </div>
        </div>
      `;
    }

    // ===== カテゴリー表示名取得 =====
    function getCategoryDisplayName(categoryName) {
      const shortNames = {
        'Consumer Electronics': '電子機器',
        'Toys & Hobbies': 'おもちゃ',
        'Books': '書籍',
        'Clothing, Shoes & Accessories': '衣類',
        'Sporting Goods': 'スポーツ',
        'Home & Garden': '住まい',
        'Collectibles': 'コレクション'
      };
      return shortNames[categoryName] || categoryName;
    }

    // ===== コンディション名取得 =====
    function getConditionName(condition) {
      const names = {
        new: "新品",
        used: "中古",
        preorder: "予約",
        refurbished: "整備済"
      };
      return names[condition] || condition;
    }

    // ===== 商品レンダリング =====
    function renderProducts(products) {
      const grid = document.getElementById('productGrid');
      if (!grid) return;
      
      grid.innerHTML = products.map(product => createProductCard(product)).join('');
    }

    // ===== フィルター初期化 =====
    function initializeFilters() {
      const filterButtons = document.querySelectorAll('.approval__filter-btn');
      
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          if (this.dataset.filter) {
            const group = this.closest('.approval__filter-group');
            const groupButtons = group.querySelectorAll('.approval__filter-btn');
            groupButtons.forEach(btn => btn.classList.remove('approval__filter-btn--active'));
            
            this.classList.add('approval__filter-btn--active');
            currentFilter = this.dataset.filter;
            applyAllFilters();
          }
        });
      });

      // プルダウン外クリックで閉じる
      document.addEventListener('click', function(event) {
        if (!event.target.closest('.approval__filter-dropdown')) {
          document.querySelectorAll('.approval__dropdown-content').forEach(dropdown => {
            dropdown.classList.remove('show');
          });
        }
      });
    }

    // ===== 統合フィルター適用 =====
    function applyAllFilters() {
      const cards = document.querySelectorAll('.product-card');
      
      cards.forEach(card => {
        let show = true;
        
        // 基本フィルター
        if (currentFilter !== 'all') {
          if (currentFilter === 'ai-approved') {
            show = show && card.dataset.ai === 'approved';
          } else if (currentFilter === 'ai-rejected') {
            show = show && card.dataset.ai === 'rejected';
          } else if (currentFilter === 'ai-pending') {
            show = show && card.dataset.ai === 'pending';
          } else if (currentFilter === 'high-risk') {
            show = show && card.dataset.risk === 'high';
          } else if (currentFilter === 'medium-risk') {
            show = show && card.dataset.risk === 'medium';
          } else if (currentFilter === 'new') {
            show = show && card.dataset.condition === 'new';
          } else if (currentFilter === 'used') {
            show = show && card.dataset.condition === 'used';
          } else if (currentFilter === 'preorder') {
            show = show && card.dataset.condition === 'preorder';
          } else if (currentFilter === 'low-price') {
            const price = parseInt(card.dataset.price);
            show = show && price <= 5000;
          } else if (currentFilter === 'medium-price') {
            const price = parseInt(card.dataset.price);
            show = show && price > 5000 && price <= 20000;
          } else if (currentFilter === 'high-price') {
            const price = parseInt(card.dataset.price);
            show = show && price > 20000;
          }
        }
        
        // カテゴリーフィルター
        if (currentCategory !== 'all') {
          show = show && card.dataset.category === currentCategory;
        }
        
        // 仕入先フィルター
        if (currentSource !== 'all') {
          show = show && card.dataset.source === currentSource;
        }
        
        if (show) {
          card.style.display = 'block';
          card.style.animation = 'cardSlideIn 0.3s ease';
        } else {
          card.style.display = 'none';
        }
      });
      
      console.log(`統合フィルター適用: 基本=${currentFilter}, カテゴリー=${currentCategory}, 仕入先=${currentSource}`);
    }

    // ===== 一括選択機能 =====
    function selectAllVisible() {
      const visibleCards = document.querySelectorAll('.product-card:not([style*="display: none"])');
      visibleCards.forEach(card => {
        if (card.dataset.sku && !selectedProducts.has(card.dataset.sku)) {
          selectedProducts.add(card.dataset.sku);
          card.classList.add('product-card--selected');
        }
      });
      updateBulkActions();
      showNotification(`${visibleCards.length}件の表示中商品を全選択しました`, 'info');
    }

    function deselectAll() {
      selectedProducts.clear();
      const cards = document.querySelectorAll('.product-card');
      cards.forEach(card => {
        card.classList.remove('product-card--selected');
      });
      updateBulkActions();
      showNotification('全選択を解除しました', 'info');
    }

    // ===== 商品選択の切り替え（クリック選択） =====
    function toggleSelection(card) {
      if (!card || !card.dataset.sku) {
        console.warn('Invalid card element');
        return;
      }
      
      const sku = card.dataset.sku;
      
      if (selectedProducts.has(sku)) {
        selectedProducts.delete(sku);
        card.classList.remove('product-card--selected');
      } else {
        selectedProducts.add(sku);
        card.classList.add('product-card--selected');
      }
      
      updateBulkActions();
    }

    // ===== 承認・否認・保留処理 =====
    function bulkApprove() {
      if (selectedProducts.size === 0) {
        showNotification('商品が選択されていません', 'warning');
        return;
      }
      
      if (confirm(`${selectedProducts.size}件の商品を承認しますか？\n\n承認後は出品システムが自動で検知し、順次出品処理が開始されます。`)) {
        const selectedCards = [];
        document.querySelectorAll('.product-card').forEach(card => {
          if (card.dataset.sku && selectedProducts.has(card.dataset.sku)) {
            selectedCards.push(card);
          }
        });
        
        selectedCards.forEach((card, index) => {
          setTimeout(() => {
            card.style.transform = 'scale(0.9)';
            card.style.opacity = '0.5';
            card.style.backgroundColor = '#f0fdf4';
            card.style.borderColor = '#22c55e';
            
            setTimeout(() => {
              if (card.parentNode) {
                // データからも削除
                const cardSku = card.dataset.sku;
                const productIndex = productData.findIndex(p => p.sku === cardSku);
                if (productIndex !== -1) {
                  productData.splice(productIndex, 1);
                }
                card.remove();
              }
              approvedCount++;
            }, 500);
          }, index * 100);
        });
        
        selectedProducts.clear();
        updateBulkActions();
        
        setTimeout(() => {
          showNotification(`${selectedCards.length}件の商品を承認しました。出品システムに通知済みです。`, 'success');
          updateStats();
          detectCategoriesAndSources(); // カテゴリー・仕入先を再検出
        }, 1000);
      }
    }

    function bulkReject() {
      if (selectedProducts.size === 0) {
        showNotification('商品が選択されていません', 'warning');
        return;
      }
      
      const reason = prompt(`${selectedProducts.size}件の商品を否認します。\n否認理由を入力してください：`, '品質基準に満たないため');
      
      if (reason !== null && reason.trim() !== '') {
        const selectedCards = [];
        document.querySelectorAll('.product-card').forEach(card => {
          if (card.dataset.sku && selectedProducts.has(card.dataset.sku)) {
            selectedCards.push(card);
          }
        });
        
        selectedCards.forEach((card, index) => {
          setTimeout(() => {
            card.style.transform = 'scale(0.9)';
            card.style.opacity = '0.5';
            card.style.backgroundColor = '#fef2f2';
            card.style.borderColor = '#ef4444';
            
            setTimeout(() => {
              if (card.parentNode) {
                const cardSku = card.dataset.sku;
                const productIndex = productData.findIndex(p => p.sku === cardSku);
                if (productIndex !== -1) {
                  productData.splice(productIndex, 1);
                }
                card.remove();
              }
              rejectedCount++;
            }, 500);
          }, index * 100);
        });
        
        selectedProducts.clear();
        updateBulkActions();
        
        setTimeout(() => {
          showNotification(`${selectedCards.length}件の商品を否認しました。理由: ${reason}`, 'danger');
          updateStats();
          detectCategoriesAndSources(); // カテゴリー・仕入先を再検出
        }, 1000);
      }
    }

    function bulkHold() {
      if (selectedProducts.size === 0) {
        showNotification('商品が選択されていません', 'warning');
        return;
      }
      
      if (confirm(`${selectedProducts.size}件の商品を保留にしますか？`)) {
        const selectedCards = [];
        document.querySelectorAll('.product-card').forEach(card => {
          if (card.dataset.sku && selectedProducts.has(card.dataset.sku)) {
            selectedCards.push(card);
          }
        });
        
        selectedCards.forEach((card, index) => {
          setTimeout(() => {
            card.style.transform = 'scale(0.9)';
            card.style.opacity = '0.5';
            card.style.backgroundColor = '#fefbf0';
            card.style.borderColor = '#f59e0b';
            
            setTimeout(() => {
              if (card.parentNode) {
                const cardSku = card.dataset.sku;
                const productIndex = productData.findIndex(p => p.sku === cardSku);
                if (productIndex !== -1) {
                  productData.splice(productIndex, 1);
                }
                card.remove();
              }
              heldCount++;
            }, 500);
          }, index * 100);
        });
        
        selectedProducts.clear();
        updateBulkActions();
        
        setTimeout(() => {
          showNotification(`${selectedCards.length}件の商品を保留にしました`, 'warning');
          updateStats();
          detectCategoriesAndSources(); // カテゴリー・仕入先を再検出
        }, 1000);
      }
    }

    // ===== 一括操作バーの更新 =====
    function updateBulkActions() {
      const bulkActions = document.getElementById('bulkActions');
      const selectedCount = document.getElementById('selectedCount');
      
      if (selectedProducts.size > 0) {
        bulkActions.classList.add('approval__bulk-actions--show');
        selectedCount.textContent = selectedProducts.size;
      } else {
        bulkActions.classList.remove('approval__bulk-actions--show');
      }
    }

    // ===== 選択クリア =====
    function clearSelection() {
      selectedProducts.clear();
      
      const cards = document.querySelectorAll('.product-card');
      cards.forEach(card => {
        card.classList.remove('product-card--selected');
      });
      
      updateBulkActions();
      showNotification('選択をクリアしました', 'info');
    }

    // ===== 統計更新 =====
    function updateStats() {
      const remainingCards = document.querySelectorAll('.product-card').length;
      
      // 統計表示を更新
      const pendingCountEl = document.getElementById('pendingCount');
      const totalProductCountEl = document.getElementById('totalProductCount');
      const totalCountEl = document.getElementById('totalCount');
      const displayRangeEl = document.getElementById('displayRange');
      
      if (pendingCountEl) pendingCountEl.textContent = remainingCards;
      if (totalProductCountEl) totalProductCountEl.textContent = remainingCards;
      if (totalCountEl) totalCountEl.textContent = remainingCards;
      if (displayRangeEl) displayRangeEl.textContent = `1-${remainingCards}件表示`;
      
      // フィルターカウント更新
      updateFilterCounts();
      
      console.log(`承認済み: ${approvedCount}件, 否認済み: ${rejectedCount}件, 保留: ${heldCount}件, 残り: ${remainingCards}件`);
    }

    // ===== フィルターカウント更新 =====
    function updateFilterCounts() {
      const cards = document.querySelectorAll('.product-card');
      
      const counts = {
        all: cards.length,
        aiApproved: 0,
        aiRejected: 0,
        aiPending: 0,
        highRisk: 0,
        mediumRisk: 0,
        lowPrice: 0,
        mediumPrice: 0,
        highPrice: 0,
        new: 0,
        used: 0,
        preorder: 0
      };
      
      cards.forEach(card => {
        const ai = card.dataset.ai;
        const risk = card.dataset.risk;
        const condition = card.dataset.condition;
        const price = parseInt(card.dataset.price);
        
        if (ai === 'approved') counts.aiApproved++;
        if (ai === 'rejected') counts.aiRejected++;
        if (ai === 'pending') counts.aiPending++;
        
        if (risk === 'high') counts.highRisk++;
        if (risk === 'medium') counts.mediumRisk++;
        
        if (price <= 5000) counts.lowPrice++;
        if (price > 5000 && price <= 20000) counts.mediumPrice++;
        if (price > 20000) counts.highPrice++;
        
        if (condition === 'new') counts.new++;
        if (condition === 'used') counts.used++;
        if (condition === 'preorder') counts.preorder++;
      });
      
      // DOM更新
      const updateElement = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };
      
      updateElement('countAll', counts.all);
      updateElement('countAiApproved', counts.aiApproved);
      updateElement('countAiRejected', counts.aiRejected);
      updateElement('countAiPending', counts.aiPending);
      updateElement('countHighRisk', counts.highRisk);
      updateElement('countMediumRisk', counts.mediumRisk);
      updateElement('countLowPrice', counts.lowPrice);
      updateElement('countMediumPrice', counts.mediumPrice);
      updateElement('countHighPrice', counts.highPrice);
      updateElement('countNew', counts.new);
      updateElement('countUsed', counts.used);
      updateElement('countPreorder', counts.preorder);
    }

    // ===== 通知表示 =====
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      const bgColors = {
        success: 'var(--filter-success)',
        warning: 'var(--filter-warning)',
        danger: 'var(--filter-danger)',
        info: 'var(--filter-info)'
      };
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        background: ${bgColors[type] || bgColors.info};
        color: white;
        border-radius: 8px;
        font-weight: 500;
        z-index: 1000;
        animation: cardSlideIn 0.3s ease;
        box-shadow: var(--shadow-lg);
        max-width: 300px;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 300);
      }, 3000);
    }

    // ===== キーボードショートカット =====
    document.addEventListener('keydown', function(e) {
      // Ctrl+A: 全選択
      if (e.ctrlKey && e.key === 'a') {
        e.preventDefault();
        selectAllVisible();
      }
      
      // Escape: 選択クリア
      if (e.key === 'Escape') {
        clearSelection();
      }
      
      // Enter: 一括承認
      if (e.key === 'Enter' && selectedProducts.size > 0) {
        bulkApprove();
      }
      
      // R: 一括否認
      if (e.key === 'r' && selectedProducts.size > 0) {
        bulkReject();
      }
      
      // H: 一括保留
      if (e.key === 'h' && selectedProducts.size > 0) {
        bulkHold();
      }
    });

    console.log('Yahoo Auction 商品承認システム（改良版）JavaScript読み込み完了');
  </script>
</body>
</html>