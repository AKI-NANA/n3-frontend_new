<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出荷管理システム - プロ仕様</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS変数定義（プロ仕様） ===== */
        :root {
            /* 基本カラー */
            --bg-primary: #f7f8f9;
            --bg-secondary: #fcfcfd;
            --bg-tertiary: #f0f1f3;
            --bg-hover: #e8f0fe;
            --bg-card: #ffffff;

            /* テキストカラー */
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-tertiary: #6b7280;
            --text-white: #ffffff;
            --text-muted: #9ca3af;

            /* プロ仕様アクセントカラー */
            --accent-primary: #ea580c;
            --accent-success: #059669;
            --accent-warning: #d97706;
            --accent-danger: #dc2626;
            --accent-info: #0ea5e9;
            --accent-purple: #8b5cf6;

            /* ステータス境界線色 */
            --border-pending: #f59e0b;
            --border-processing: #3b82f6;
            --border-completed: #10b981;
            --border-shipped: #8b5cf6;
            --border-problem: #ef4444;
            --border-default: #e5e7eb;

            /* 美しいグラデーション */
            --gradient-fedex: linear-gradient(135deg, #4c1d95 0%, #7c3aed 100%);
            --gradient-dhl: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            --gradient-ems: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            --gradient-ups: linear-gradient(135deg, #92400e 0%, #a16207 100%);
            --gradient-country: linear-gradient(135deg, #059669 0%, #047857 100%);
            --gradient-price-high: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            --gradient-price-normal: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            --gradient-price-low: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            --gradient-signature: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            --gradient-insurance: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            --gradient-package: linear-gradient(135deg, #059669 0%, #047857 100%);
            --gradient-package-special: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);

            /* シャドウ */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

            /* スペーシング */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;

            /* フォントサイズ */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;

            /* ボーダーラジアス */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.25rem;
            --radius-full: 9999px;

            /* トランジション */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.6;
            font-weight: 500;
        }

        /* ===== メインコンテナ ===== */
        .shipping-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--space-6);
        }

        /* ===== ヘッダー ===== */
        .shipping-header {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-default);
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--accent-primary), #f97316);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-size: 24px;
            box-shadow: var(--shadow-md);
        }

        .header-controls {
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }

        .header-stats {
            display: flex;
            gap: var(--space-6);
            align-items: center;
            font-size: var(--text-sm);
            color: var(--text-secondary);
            padding: var(--space-4);
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .stat-value {
            font-weight: 700;
            font-size: var(--text-base);
        }

        /* ===== フィルターバー ===== */
        .filter-bar {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-default);
        }

        .filter-controls {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }

        .filter-label {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .filter-select, .search-input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--text-sm);
            transition: var(--transition);
            min-width: 120px;
        }

        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
        }

        .search-input {
            min-width: 250px;
        }

        /* ===== ボタン ===== */
        .btn {
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid;
            background: var(--bg-card);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            text-decoration: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--text-white);
            border-color: var(--accent-primary);
        }

        .btn-primary:hover {
            background: #dc5a0a;
            border-color: #dc5a0a;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            color: var(--text-secondary);
            border-color: var(--border-default);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-primary);
        }

        .btn-sm {
            padding: var(--space-1) var(--space-3);
            font-size: var(--text-xs);
        }

        /* ===== 出荷リスト ===== */
        .shipping-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        /* ===== 出荷カード（プロ仕様） ===== */
        .shipping-card {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-5);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border-default);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .shipping-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-default);
            transition: var(--transition);
        }

        .shipping-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
            border-color: var(--accent-primary);
        }

        .shipping-card.expanded {
            background: var(--bg-primary);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-2xl);
        }

        .shipping-card.expanded::before {
            width: 6px;
            background: var(--accent-primary);
        }

        /* ステータス別境界線色 */
        .shipping-card[data-status="pending"]::before { background: var(--border-pending); }
        .shipping-card[data-status="processing"]::before { background: var(--border-processing); }
        .shipping-card[data-status="completed"]::before { background: var(--border-completed); }
        .shipping-card[data-status="shipped"]::before { background: var(--border-shipped); }
        .shipping-card[data-status="problem"]::before { background: var(--border-problem); }

        /* ===== カードヘッダー ===== */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .card-basic-info {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            flex: 1;
        }

        .card-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-default);
            border-radius: var(--radius-sm);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .card-checkbox:checked {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .card-checkbox:checked::after {
            content: '✓';
            position: absolute;
            color: var(--text-white);
            font-size: 12px;
            font-weight: 700;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .product-image {
            width: 72px;
            height: 72px;
            object-fit: cover;
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-default);
            box-shadow: var(--shadow-sm);
        }

        .product-info {
            flex: 1;
            min-width: 0;
        }

        .product-title {
            font-size: var(--text-base);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
            line-height: 1.3;
        }

        .order-id {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-1);
            font-weight: 600;
        }

        .customer-info {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .sale-price {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--accent-primary);
            cursor: pointer;
            padding: var(--space-2) var(--space-3);
            background: rgba(234, 88, 12, 0.1);
            border-radius: var(--radius-md);
            transition: var(--transition);
            user-select: all;
        }

        .sale-price:hover {
            background: rgba(234, 88, 12, 0.2);
            transform: scale(1.02);
        }

        .price-conversion {
            font-size: var(--text-xs);
            color: var(--text-secondary);
            margin-top: var(--space-1);
        }

        /* ===== 美しい円形アイコン（プロ仕様） ===== */
        .decision-icons {
            display: flex;
            gap: var(--space-3);
            align-items: center;
            flex-wrap: wrap;
        }

        .decision-icon {
            width: 52px;
            height: 52px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-size: 16px;
            font-weight: 700;
            position: relative;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
            line-height: 1;
        }

        .decision-icon:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* 配送方法アイコン */
        .icon-shipping-fedex { background: var(--gradient-fedex); }
        .icon-shipping-dhl { background: var(--gradient-dhl); }
        .icon-shipping-ems { background: var(--gradient-ems); }
        .icon-shipping-ups { background: var(--gradient-ups); }

        /* 国旗アイコン（美しい円形） */
        .icon-country {
            background: var(--gradient-country);
            font-size: 22px;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        /* 価格帯アイコン */
        .icon-price-high { background: var(--gradient-price-high); }
        .icon-price-normal { background: var(--gradient-price-normal); }
        .icon-price-low { background: var(--gradient-price-low); }

        /* サイン・保険・梱包アイコン */
        .icon-signature { background: var(--gradient-signature); }
        .icon-signature.not-required { 
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            opacity: 0.6;
        }

        .icon-insurance { background: var(--gradient-insurance); }
        .icon-insurance.not-required { 
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            opacity: 0.6;
        }

        .icon-package { background: var(--gradient-package); }
        .icon-package.special { background: var(--gradient-package-special); }
        .icon-package.hazard { 
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* アイコンツールチップ（美しいデザイン） */
        .decision-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -32px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: var(--text-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .decision-icon:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-2px);
        }

        /* ===== 展開エリア（詳細情報） ===== */
        .card-details {
            display: none;
            padding-top: var(--space-5);
            border-top: 2px solid var(--border-default);
            margin-top: var(--space-4);
        }

        .card-details.expanded {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
        }

        /* ===== セクション ===== */
        .section {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            border: 1px solid var(--border-default);
        }

        .section-title {
            font-size: var(--text-base);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .section-icon {
            width: 24px;
            height: 24px;
            background: var(--accent-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-size: 12px;
        }

        /* ===== 多層メモシステム ===== */
        .memo-tabs {
            display: flex;
            gap: var(--space-1);
            margin-bottom: var(--space-3);
            background: var(--bg-tertiary);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }

        .memo-tab {
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            position: relative;
        }

        .memo-tab.active {
            background: var(--bg-card);
            color: var(--accent-primary);
            box-shadow: var(--shadow-sm);
        }

        .memo-tab:hover:not(.active) {
            background: rgba(234, 88, 12, 0.1);
            color: var(--accent-primary);
        }

        .memo-content {
            min-height: 80px;
            padding: var(--space-3);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-default);
        }

        .memo-text {
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-primary);
        }

        .memo-text.ai-generated {
            background: rgba(139, 92, 246, 0.1);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--accent-purple);
        }

        .memo-text.customer-note {
            background: rgba(14, 165, 233, 0.1);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--accent-info);
        }

        .memo-text.warning {
            background: rgba(239, 68, 68, 0.1);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--accent-danger);
        }

        /* ===== 配送方法タブ ===== */
        .shipping-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            background: var(--bg-tertiary);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }

        .shipping-tab {
            padding: var(--space-2) var(--space-4);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            flex: 1;
            text-align: center;
        }

        .shipping-tab.active {
            background: var(--bg-card);
            color: var(--accent-primary);
            box-shadow: var(--shadow-sm);
        }

        .shipping-tab:hover:not(.active) {
            background: rgba(234, 88, 12, 0.1);
            color: var(--accent-primary);
        }

        /* ===== 情報グリッド ===== */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .info-label {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .copyable {
            cursor: pointer;
            padding: var(--space-2) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            font-family: 'Monaco', 'Consolas', monospace;
            transition: var(--transition);
            display: inline-block;
            user-select: all;
        }

        .copyable:hover {
            background: var(--accent-primary);
            color: var(--text-white);
            border-color: var(--accent-primary);
            transform: scale(1.02);
        }

        /* ===== 配送オプション動的表示 ===== */
        .shipping-options {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            border: 1px solid var(--border-default);
        }

        .option-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }

        .toggle-btn {
            padding: var(--space-1) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn.active {
            background: var(--accent-primary);
            color: var(--text-white);
            border-color: var(--accent-primary);
        }

        .recommended-option {
            background: rgba(5, 150, 105, 0.1);
            border: 2px solid var(--accent-success);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            margin-bottom: var(--space-3);
            position: relative;
        }

        .recommended-option::before {
            content: '推奨';
            position: absolute;
            top: -8px;
            left: var(--space-3);
            background: var(--accent-success);
            color: var(--text-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 700;
        }

        /* ===== 入力フィールド ===== */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .input-field, .textarea-field {
            padding: var(--space-3);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--text-sm);
            transition: var(--transition);
            font-family: inherit;
        }

        .input-field:focus, .textarea-field:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
        }

        .input-field.auto-filled {
            background: rgba(5, 150, 105, 0.1);
            border-color: var(--accent-success);
        }

        .textarea-field {
            min-height: 80px;
            resize: vertical;
        }

        /* ===== 梱包情報入力 ===== */
        .package-inputs {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
        }

        /* ===== 外部リンク ===== */
        .external-links {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .external-link {
            padding: var(--space-2) var(--space-3);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .external-link:hover {
            background: var(--accent-info);
            color: var(--text-white);
            border-color: var(--accent-info);
        }

        /* ===== アクションボタン ===== */
        .action-buttons {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-5);
            padding-top: var(--space-4);
            border-top: 2px solid var(--border-default);
            flex-wrap: wrap;
        }

        /* ===== レスポンシブ ===== */
        @media (max-width: 1200px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .package-inputs {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .shipping-container {
                padding: var(--space-4);
            }
            
            .card-basic-info {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-3);
            }
            
            .decision-icons {
                width: 100%;
                justify-content: space-between;
            }
            
            .decision-icon {
                width: 44px;
                height: 44px;
                font-size: 14px;
            }
            
            .package-inputs {
                grid-template-columns: 1fr;
            }
            
            .header-controls {
                flex-wrap: wrap;
            }
            
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
            }
        }

        /* ===== 一括選択表示 ===== */
        .bulk-actions {
            position: fixed;
            bottom: var(--space-6);
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: var(--space-4) var(--space-6);
            box-shadow: var(--shadow-2xl);
            border: 2px solid var(--accent-primary);
            display: none;
            align-items: center;
            gap: var(--space-4);
            z-index: 1000;
        }

        .bulk-actions.visible {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .bulk-info {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .bulk-count {
            font-weight: 700;
            color: var(--accent-primary);
        }
    </style>
<script>
// CAIDS error_handling Hook

// CAIDS エラー処理Hook - 完全実装
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('⚠️ CAIDS エラーハンドリングシステム完全初期化');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('🚨 CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">🚨</span>
                <div>
                    <strong>エラーが発生しました</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // エラーレポート生成・送信（将来の拡張用）
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('📋 CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<script>
// CAIDS user_feedback Hook
// CAIDS user_feedback Hook - 基本実装
console.log('✅ user_feedback Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - 基本実装
console.log('✅ character_limit Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - 基本実装
console.log('✅ development_control Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - 基本実装
console.log('✅ natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_monitoring Hook
// CAIDS character_monitoring Hook - 基本実装
console.log('✅ character_monitoring Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - 基本実装
console.log('✅ emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS processing_capacity_monitoring Hook
// CAIDS processing_capacity_monitoring Hook - 基本実装
console.log('✅ processing_capacity_monitoring Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - 基本実装
console.log('✅ pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - 基本実装
console.log('✅ user_approval_required Hook loaded');
</script>
<script>
// CAIDS timeout_management Hook
// CAIDS timeout_management Hook - 基本実装
console.log('✅ timeout_management Hook loaded');
</script>
</head>
<body>
    <div class="shipping-container">
        <!-- ヘッダー -->
        <div class="shipping-header">
            <div class="header-main">
                <div class="header-title">
                    <div class="header-icon">
                        🚚
                    </div>
                    <span>出荷管理システム</span>
                </div>
                <div class="header-controls">
                    <button class="btn btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        データ出力
                    </button>
                    <button class="btn btn-primary" onclick="bulkProcess()">
                        <i class="fas fa-tasks"></i>
                        一括処理
                    </button>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span>⏳ 待機中:</span>
                    <span class="stat-value" style="color: var(--accent-warning);">12件</span>
                </div>
                <div class="stat-item">
                    <span>🔄 処理中:</span>
                    <span class="stat-value" style="color: var(--accent-info);">5件</span>
                </div>
                <div class="stat-item">
                    <span>✅ 完了:</span>
                    <span class="stat-value" style="color: var(--accent-success);">23件</span>
                </div>
                <div class="stat-item">
                    <span>⚠️ 要注意:</span>
                    <span class="stat-value" style="color: var(--accent-danger);">3件</span>
                </div>
            </div>
        </div>

        <!-- フィルターバー -->
        <div class="filter-bar">
            <div class="filter-controls">
                <div class="filter-group">
                    <label class="filter-label">ステータス</label>
                    <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                        <option value="">全て</option>
                        <option value="pending">未着手</option>
                        <option value="processing">処理中</option>
                        <option value="completed">処理完了</option>
                        <option value="shipped">出荷済み</option>
                        <option value="problem">要注意</option>
                        <option value="tracking-pending">追跡未同期</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">配送方法</label>
                    <select class="filter-select" id="shippingFilter" onchange="applyFilters()">
                        <option value="">全て</option>
                        <option value="fedex">FedEx</option>
                        <option value="dhl">DHL</option>
                        <option value="ems">EMS</option>
                        <option value="ups">UPS</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">優先度</label>
                    <select class="filter-select" id="priorityFilter" onchange="applyFilters()">
                        <option value="">全て</option>
                        <option value="high">高</option>
                        <option value="normal">通常</option>
                        <option value="low">低</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">検索</label>
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="注文番号・顧客名・商品名..." 
                           onchange="applyFilters()">
                </div>
                <button class="btn btn-secondary btn-sm" onclick="resetFilters()">
                    <i class="fas fa-undo"></i>
                    リセット
                </button>
            </div>
        </div>

        <!-- 出荷リスト -->
        <div class="shipping-list" id="shippingList">
            <!-- 出荷カード 1 -->
            <div class="shipping-card" data-status="pending" data-shipping="fedex" data-priority="high" onclick="toggleCard(this)">
                <div class="card-header">
                    <div class="card-basic-info">
                        <input type="checkbox" class="card-checkbox" onclick="event.stopPropagation(); updateBulkActions()">
                        <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=72&h=72&fit=crop&crop=center" 
                             alt="商品画像" class="product-image">
                        <div class="product-info">
                            <div class="product-title">Vintage Camera Set Premium Collection</div>
                            <div class="order-id">EB001-20241213</div>
                            <div class="customer-info">山田 太郎 → New York, USA</div>
                        </div>
                        <div class="sale-price" onclick="event.stopPropagation(); copyToClipboard(this, '¥52,000')">
                            ¥52,000
                            <div class="price-conversion">$348 USD</div>
                        </div>
                    </div>
                    
                    <!-- 美しい円形アイコン -->
                    <div class="decision-icons">
                        <div class="decision-icon icon-shipping-fedex" data-tooltip="FedEx International Priority">
                            FEX
                        </div>
                        <div class="decision-icon icon-country" data-tooltip="United States">
                            🇺🇸
                        </div>
                        <div class="decision-icon icon-price-high" data-tooltip="高額商品 (¥50,000以上)">
                            💎
                        </div>
                        <div class="decision-icon icon-signature" data-tooltip="サイン必須">
                            ✍️
                        </div>
                        <div class="decision-icon icon-insurance" data-tooltip="全額保険">
                            🛡️
                        </div>
                        <div class="decision-icon icon-package special" data-tooltip="精密機器梱包">
                            📷
                        </div>
                    </div>
                </div>

                <!-- 展開エリア -->
                <div class="card-details">
                    <div class="external-links">
                        <a href="#" class="external-link" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                            eBay商品ページ
                        </a>
                        <a href="#" class="external-link" target="_blank">
                            <i class="fas fa-receipt"></i>
                            受注詳細
                        </a>
                        <a href="#" class="external-link" target="_blank">
                            <i class="fas fa-shipping-fast"></i>
                            シーパス連携
                        </a>
                    </div>

                    <div class="details-grid">
                        <!-- 左カラム -->
                        <div class="left-column">
                            <!-- 多層メモシステム -->
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">💬</div>
                                    メモ・注意事項
                                </div>
                                
                                <div class="memo-tabs">
                                    <button class="memo-tab active" onclick="switchMemoTab(this, 'customer')">お客様</button>
                                    <button class="memo-tab" onclick="switchMemoTab(this, 'ai-analysis')">AI分析</button>
                                    <button class="memo-tab" onclick="switchMemoTab(this, 'ai-product')">商品AI</button>
                                    <button class="memo-tab" onclick="switchMemoTab(this, 'order')">受注連動</button>
                                    <button class="memo-tab" onclick="switchMemoTab(this, 'staff')">スタッフ</button>
                                </div>
                                
                                <div class="memo-content" id="memoContent">
                                    <div class="memo-text customer-note">
                                        eBayメッセージ：「Please pack very carefully as this is a gift for my father. He's a professional photographer.」
                                    </div>
                                </div>
                            </div>

                            <!-- 出荷準備 -->
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">📋</div>
                                    出荷準備情報
                                </div>
                                
                                <div class="shipping-tabs">
                                    <button class="shipping-tab active" onclick="switchShippingTab(this, 'courier')">クーリエ用</button>
                                    <button class="shipping-tab" onclick="switchShippingTab(this, 'japanpost')">日本郵便用</button>
                                </div>
                                
                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">商品名（英語）</div>
                                        <div class="info-value copyable" onclick="copyToClipboard(this, 'Vintage Camera Equipment Set')">
                                            Vintage Camera Equipment Set
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">HSコード</div>
                                        <div class="info-value copyable" onclick="copyToClipboard(this, '9006.10.00')">
                                            9006.10.00
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">原産国</div>
                                        <div class="info-value copyable" onclick="copyToClipboard(this, 'Japan')">
                                            Japan
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">配送先住所</div>
                                        <div class="info-value copyable" onclick="copyToClipboard(this, '123 Main Street, New York, NY 10001, USA')">
                                            123 Main Street<br>New York, NY 10001, USA
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 右カラム -->
                        <div class="right-column">
                            <!-- 梱包作業 -->
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">📦</div>
                                    梱包作業（担当者入力）
                                </div>
                                
                                <div class="package-inputs">
                                    <div class="input-group">
                                        <div class="info-label">縦 (cm)</div>
                                        <input type="number" class="input-field" placeholder="30.0" step="0.1" 
                                               onchange="calculateShipping()" onclick="copyOnClick(this)">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">横 (cm)</div>
                                        <input type="number" class="input-field" placeholder="25.0" step="0.1" 
                                               onchange="calculateShipping()" onclick="copyOnClick(this)">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">高さ (cm)</div>
                                        <input type="number" class="input-field" placeholder="15.0" step="0.1" 
                                               onchange="calculateShipping()" onclick="copyOnClick(this)">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">重量 (g)</div>
                                        <input type="number" class="input-field" placeholder="2500" step="1" 
                                               onchange="calculateShipping()" onclick="copyOnClick(this)">
                                    </div>
                                </div>
                            </div>

                            <!-- 配送オプション（動的表示） -->
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">⚙️</div>
                                    配送方法選択
                                    <div class="option-toggle">
                                        <button class="toggle-btn active" onclick="toggleOption(this, 'ai')">AI推奨</button>
                                        <button class="toggle-btn" onclick="toggleOption(this, 'manual')">手動選択</button>
                                    </div>
                                </div>
                                
                                <div class="recommended-option">
                                    <div style="font-weight: 700; margin-bottom: var(--space-2);">
                                        FedEx International Priority
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2); font-size: var(--text-sm);">
                                        <div>配送料: <strong>¥4,850</strong></div>
                                        <div>日数: <strong>2-3日</strong></div>
                                        <div>追跡: <strong>あり</strong></div>
                                    </div>
                                </div>

                                <div class="info-grid">
                                    <div class="info-item">
                                        <div class="info-label">サイン</div>
                                        <select class="input-field">
                                            <option value="required" selected>必須</option>
                                            <option value="adult">成人サイン</option>
                                            <option value="not-required">不要</option>
                                        </select>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">保険</div>
                                        <select class="input-field">
                                            <option value="full" selected>全額補償 (¥52,000)</option>
                                            <option value="partial">部分補償 (¥25,000)</option>
                                            <option value="none">なし</option>
                                        </select>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">追跡番号</div>
                                        <div class="input-group">
                                            <input type="text" class="input-field auto-filled" 
                                                   value="1234567890123456" readonly>
                                            <button class="btn btn-secondary btn-sm" onclick="manualTracking(this)">
                                                手動入力
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- アクションボタン -->
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="processShipping(1)">
                            <i class="fas fa-truck"></i>
                            出荷処理実行
                        </button>
                        <button class="btn btn-secondary" onclick="printLabel(1)">
                            <i class="fas fa-print"></i>
                            ラベル印刷
                        </button>
                        <button class="btn btn-secondary" onclick="printInvoice(1)">
                            <i class="fas fa-file-invoice"></i>
                            インボイス
                        </button>
                        <button class="btn btn-secondary" onclick="printReceipt(1)">
                            <i class="fas fa-receipt"></i>
                            領収書
                        </button>
                        <button class="btn btn-secondary" onclick="saveProgress(1)">
                            <i class="fas fa-save"></i>
                            進捗保存
                        </button>
                    </div>
                </div>
            </div>

            <!-- 出荷カード 2 -->
            <div class="shipping-card" data-status="completed" data-shipping="dhl" data-priority="normal" onclick="toggleCard(this)">
                <div class="card-header">
                    <div class="card-basic-info">
                        <input type="checkbox" class="card-checkbox" onclick="event.stopPropagation(); updateBulkActions()">
                        <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=72&h=72&fit=crop&crop=center" 
                             alt="商品画像" class="product-image">
                        <div class="product-info">
                            <div class="product-title">Nike Air Max Limited Edition</div>
                            <div class="order-id">EB002-20241213</div>
                            <div class="customer-info">佐藤 花子 → Berlin, Germany</div>
                        </div>
                        <div class="sale-price" onclick="event.stopPropagation(); copyToClipboard(this, '¥28,500')">
                            ¥28,500
                            <div class="price-conversion">€171 EUR</div>
                        </div>
                    </div>
                    
                    <div class="decision-icons">
                        <div class="decision-icon icon-shipping-dhl" data-tooltip="DHL Express Worldwide">
                            DHL
                        </div>
                        <div class="decision-icon icon-country" data-tooltip="Germany">
                            🇩🇪
                        </div>
                        <div class="decision-icon icon-price-normal" data-tooltip="通常価格帯">
                            💰
                        </div>
                        <div class="decision-icon icon-signature not-required" data-tooltip="サイン不要">
                            ✍️
                        </div>
                        <div class="decision-icon icon-insurance" data-tooltip="標準保険">
                            🛡️
                        </div>
                        <div class="decision-icon icon-package" data-tooltip="通常梱包">
                            📦
                        </div>
                    </div>
                </div>

                <div class="card-details">
                    <div class="external-links">
                        <a href="#" class="external-link" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                            eBay商品ページ
                        </a>
                        <a href="#" class="external-link" target="_blank">
                            <i class="fas fa-receipt"></i>
                            受注詳細
                        </a>
                    </div>

                    <div class="details-grid">
                        <div class="left-column">
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">💬</div>
                                    メモ・注意事項
                                </div>
                                
                                <div class="memo-tabs">
                                    <button class="memo-tab active">お客様</button>
                                    <button class="memo-tab">AI分析</button>
                                    <button class="memo-tab">商品AI</button>
                                    <button class="memo-tab">受注連動</button>
                                    <button class="memo-tab">スタッフ</button>
                                </div>
                                
                                <div class="memo-content">
                                    <div class="memo-text customer-note">
                                        eBayメッセージ：「土曜日配達希望です。平日は不在のことが多いです。」
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="right-column">
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">✅</div>
                                    処理完了済み
                                </div>
                                
                                <div class="package-inputs">
                                    <div class="input-group">
                                        <div class="info-label">縦 (cm)</div>
                                        <input type="number" class="input-field auto-filled" value="32.0" readonly>
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">横 (cm)</div>
                                        <input type="number" class="input-field auto-filled" value="22.0" readonly>
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">高さ (cm)</div>
                                        <input type="number" class="input-field auto-filled" value="14.0" readonly>
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">重量 (g)</div>
                                        <input type="number" class="input-field auto-filled" value="1500" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="processShipping(2)">
                            <i class="fas fa-truck"></i>
                            出荷実行
                        </button>
                        <button class="btn btn-secondary" onclick="printLabel(2)">
                            <i class="fas fa-print"></i>
                            ラベル印刷
                        </button>
                        <button class="btn btn-secondary" onclick="printInvoice(2)">
                            <i class="fas fa-file-invoice"></i>
                            インボイス
                        </button>
                    </div>
                </div>
            </div>

            <!-- 出荷カード 3 - 要注意 -->
            <div class="shipping-card" data-status="problem" data-shipping="ems" data-priority="high" onclick="toggleCard(this)">
                <div class="card-header">
                    <div class="card-basic-info">
                        <input type="checkbox" class="card-checkbox" onclick="event.stopPropagation(); updateBulkActions()">
                        <img src="https://images.unsplash.com/photo-1560472355-536de3962603?w=72&h=72&fit=crop&crop=center" 
                             alt="商品画像" class="product-image">
                        <div class="product-info">
                            <div class="product-title">Smart Watch Series X</div>
                            <div class="order-id">EB003-20241213</div>
                            <div class="customer-info">高橋 健太 → Toronto, Canada</div>
                        </div>
                        <div class="sale-price" onclick="event.stopPropagation(); copyToClipboard(this, '¥89,000')">
                            ¥89,000
                            <div class="price-conversion">$593 CAD</div>
                        </div>
                    </div>
                    
                    <div class="decision-icons">
                        <div class="decision-icon icon-shipping-ems" data-tooltip="EMS (Express Mail Service)">
                            EMS
                        </div>
                        <div class="decision-icon icon-country" data-tooltip="Canada">
                            🇨🇦
                        </div>
                        <div class="decision-icon icon-price-high" data-tooltip="高額商品">
                            💎
                        </div>
                        <div class="decision-icon icon-signature" data-tooltip="サイン必須">
                            ✍️
                        </div>
                        <div class="decision-icon icon-insurance" data-tooltip="全額保険">
                            🛡️
                        </div>
                        <div class="decision-icon icon-package hazard" data-tooltip="危険物要確認！">
                            ⚠️
                        </div>
                    </div>
                </div>

                <div class="card-details">
                    <div class="details-grid">
                        <div class="left-column">
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">⚠️</div>
                                    重要な注意事項
                                </div>
                                
                                <div class="memo-content">
                                    <div class="memo-text warning">
                                        <strong>危険物判定：</strong>リチウム電池内蔵の可能性が高いです。航空輸送制限を確認してください。UN3481の申告が必要になる場合があります。
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="right-column">
                            <div class="section">
                                <div class="section-title">
                                    <div class="section-icon">📦</div>
                                    梱包作業（要確認）
                                </div>
                                
                                <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid var(--accent-danger); border-radius: var(--radius-lg); padding: var(--space-3); margin-bottom: var(--space-3);">
                                    <div style="color: var(--accent-danger); font-weight: 700; margin-bottom: var(--space-1);">
                                        ⚠️ 危険物確認必須
                                    </div>
                                    <div style="font-size: var(--text-sm);">
                                        出荷前に必ず危険物該当性を確認してください
                                    </div>
                                </div>
                                
                                <div class="package-inputs">
                                    <div class="input-group">
                                        <div class="info-label">縦 (cm)</div>
                                        <input type="number" class="input-field" placeholder="要測定" step="0.1">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">横 (cm)</div>
                                        <input type="number" class="input-field" placeholder="要測定" step="0.1">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">高さ (cm)</div>
                                        <input type="number" class="input-field" placeholder="要測定" step="0.1">
                                    </div>
                                    <div class="input-group">
                                        <div class="info-label">重量 (g)</div>
                                        <input type="number" class="input-field" placeholder="要測定" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="processShipping(3)" style="background: var(--accent-danger); border-color: var(--accent-danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                            危険物確認後処理
                        </button>
                        <button class="btn btn-secondary" onclick="checkHazmat(3)">
                            <i class="fas fa-search"></i>
                            危険物チェック
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 一括処理パネル -->
        <div class="bulk-actions" id="bulkActions">
            <div class="bulk-info">
                <span class="bulk-count" id="bulkCount">0</span>件選択中
            </div>
            <div style="display: flex; gap: var(--space-3);">
                <button class="btn btn-primary" onclick="bulkPrintLabels()">
                    <i class="fas fa-print"></i>
                    一括ラベル印刷
                </button>
                <button class="btn btn-secondary" onclick="bulkPrintInvoices()">
                    <i class="fas fa-file-invoice"></i>
                    一括インボイス
                </button>
                <button class="btn btn-secondary" onclick="bulkUpdateStatus()">
                    <i class="fas fa-edit"></i>
                    ステータス一括更新
                </button>
                <button class="btn btn-secondary" onclick="clearSelection()">
                    <i class="fas fa-times"></i>
                    選択解除
                </button>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let selectedCards = new Set();
        let allCards = [];
        let filteredCards = [];

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            allCards = Array.from(document.querySelectorAll('.shipping-card'));
            filteredCards = [...allCards];
            console.log('出荷管理システム（プロ仕様）初期化完了');
            updateFilteredCount();
        });

        // カード展開・折りたたみ
        function toggleCard(card) {
            const details = card.querySelector('.card-details');
            const isExpanded = card.classList.contains('expanded');
            
            // 全カードを折りたたむ
            document.querySelectorAll('.shipping-card').forEach(c => {
                c.classList.remove('expanded');
                c.querySelector('.card-details').classList.remove('expanded');
            });
            
            // クリックされたカードが折りたたまれていた場合は展開
            if (!isExpanded) {
                card.classList.add('expanded');
                details.classList.add('expanded');
                
                // スムーズスクロール
                setTimeout(() => {
                    card.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }, 100);
            }
        }

        // メモタブ切り替え
        function switchMemoTab(tab, type) {
            const tabs = tab.parentNode.querySelectorAll('.memo-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            const content = tab.parentNode.nextElementSibling;
            
            const memoData = {
                'customer': '<div class="memo-text customer-note">eBayメッセージ：「Please pack very carefully as this is a gift for my father. He\'s a professional photographer.」</div>',
                'ai-analysis': '<div class="memo-text ai-generated">AI分析：過去の購入履歴から、この顧客は精密機器に詳しく、梱包品質に厳しい傾向があります。丁寧な梱包を心がけてください。</div>',
                'ai-product': '<div class="memo-text ai-generated">商品AI：精密機器のため気泡緩衝材で厳重梱包推奨。リチウム電池含有の可能性があるため危険物チェック必須。</div>',
                'order': '<div class="memo-text">受注連動：ギフト包装希望。配送予定日：12/20指定。</div>',
                'staff': '<div class="memo-text"><textarea class="textarea-field" placeholder="スタッフメモ（チャットワーク連携）"></textarea></div>'
            };
            
            content.innerHTML = memoData[type] || '';
        }

        // 配送タブ切り替え
        function switchShippingTab(tab, type) {
            const tabs = tab.parentNode.querySelectorAll('.shipping-tab');
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            console.log(`配送方法切り替え: ${type}`);
            // 実際の実装では、タブに応じて表示内容を変更
        }

        // オプション切り替え（AI推奨/手動選択）
        function toggleOption(btn, type) {
            const buttons = btn.parentNode.querySelectorAll('.toggle-btn');
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            console.log(`オプション切り替え: ${type}`);
            // 実際の実装では、選択に応じて表示を変更
        }

        // コピー機能
        function copyToClipboard(element, text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalBg = element.style.background;
                const originalColor = element.style.color;
                
                element.style.background = 'var(--accent-success)';
                element.style.color = 'var(--text-white)';
                element.style.transform = 'scale(1.02)';
                
                setTimeout(() => {
                    element.style.background = originalBg;
                    element.style.color = originalColor;
                    element.style.transform = '';
                }, 1000);
                
                showNotification(`📋 コピーしました: ${text}`, 'success');
            }).catch(() => {
                showNotification('❌ コピーに失敗しました', 'error');
            });
        }

        // 入力フィールドクリック時のコピー選択
        function copyOnClick(input) {
            input.select();
        }

        // 送料計算（サイズ・重量変更時）
        function calculateShipping() {
            // 実際の実装では、API呼び出しで送料を計算
            console.log('送料再計算中...');
        }

        // 手動追跡番号入力
        function manualTracking(btn) {
            const input = btn.previousElementSibling;
            input.readOnly = false;
            input.classList.remove('auto-filled');
            input.focus();
            btn.textContent = '保存';
            btn.onclick = () => saveTracking(btn);
        }

        function saveTracking(btn) {
            const input = btn.previousElementSibling;
            input.readOnly = true;
            input.classList.add('auto-filled');
            btn.textContent = '手動入力';
            btn.onclick = () => manualTracking(btn);
            showNotification('✅ 追跡番号を保存しました', 'success');
        }

        // フィルター機能
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const shippingFilter = document.getElementById('shippingFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            filteredCards = allCards.filter(card => {
                const status = card.dataset.status || '';
                const shipping = card.dataset.shipping || '';
                const priority = card.dataset.priority || '';
                const text = card.textContent.toLowerCase();
                
                return (!statusFilter || status === statusFilter) &&
                       (!shippingFilter || shipping === shippingFilter) &&
                       (!priorityFilter || priority === priorityFilter) &&
                       (!searchInput || text.includes(searchInput));
            });
            
            // カード表示/非表示切り替え
            allCards.forEach(card => {
                if (filteredCards.includes(card)) {
                    card.style.display = 'block';
                    card.style.animation = 'fadeIn 0.3s ease-out';
                } else {
                    card.style.display = 'none';
                }
            });
            
            updateFilteredCount();
        }

        function resetFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('shippingFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('searchInput').value = '';
            applyFilters();
        }

        function updateFilteredCount() {
            const visibleCount = filteredCards.length;
            const totalCount = allCards.length;
            console.log(`表示中: ${visibleCount}/${totalCount}件`);
        }

        // 一括選択機能
        function updateBulkActions() {
            const checkboxes = document.querySelectorAll('.card-checkbox:checked');
            const count = checkboxes.length;
            
            const bulkActions = document.getElementById('bulkActions');
            const bulkCount = document.getElementById('bulkCount');
            
            if (count > 0) {
                bulkActions.classList.add('visible');
                bulkCount.textContent = count;
            } else {
                bulkActions.classList.remove('visible');
            }
        }

        function clearSelection() {
            document.querySelectorAll('.card-checkbox').forEach(cb => {
                cb.checked = false;
            });
            updateBulkActions();
        }

        // 一括処理機能
        function bulkPrintLabels() {
            const selected = document.querySelectorAll('.card-checkbox:checked');
            showNotification(`📄 ${selected.length}件のラベルを印刷しています`, 'info');
        }

        function bulkPrintInvoices() {
            const selected = document.querySelectorAll('.card-checkbox:checked');
            showNotification(`📋 ${selected.length}件のインボイスを作成しています`, 'info');
        }

        function bulkUpdateStatus() {
            const selected = document.querySelectorAll('.card-checkbox:checked');
            showNotification(`🔄 ${selected.length}件のステータスを更新しています`, 'info');
        }

        // 個別処理機能
        function processShipping(id) {
            showNotification(`🚚 注文 ${id} の出荷処理を開始しました`, 'info');
            
            // 処理完了をシミュレート
            setTimeout(() => {
                showNotification(`✅ 注文 ${id} の出荷処理が完了しました`, 'success');
            }, 2000);
        }

        function printLabel(id) {
            showNotification(`🏷️ 注文 ${id} のラベルを印刷しています`, 'info');
        }

        function printInvoice(id) {
            showNotification(`📄 注文 ${id} のインボイスを作成しています`, 'info');
        }

        function printReceipt(id) {
            showNotification(`🧾 注文 ${id} の領収書を発行しています`, 'info');
        }

        function saveProgress(id) {
            showNotification(`💾 注文 ${id} の進捗を保存しました`, 'success');
        }

        function checkHazmat(id) {
            showNotification(`⚠️ 注文 ${id} の危険物チェックを開始しています`, 'warning');
        }

        // データ出力
        function exportData() {
            showNotification('📤 データを出力しています...', 'info');
        }

        function bulkProcess() {
            showNotification('⚙️ 一括処理オプションを表示しています', 'info');
        }

        // 通知システム（プロ仕様）
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 24px;
                right: 24px;
                padding: 16px 24px;
                border-radius: var(--radius-xl);
                color: var(--text-white);
                font-weight: 600;
                z-index: 10000;
                max-width: 400px;
                box-shadow: var(--shadow-2xl);
                transform: translateX(100%);
                transition: var(--transition);
                font-size: var(--text-sm);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            `;
            
            const styles = {
                'success': 'background: linear-gradient(135deg, var(--accent-success), #047857);',
                'error': 'background: linear-gradient(135deg, var(--accent-danger), #b91c1c);',
                'warning': 'background: linear-gradient(135deg, var(--accent-warning), #b45309);',
                'info': 'background: linear-gradient(135deg, var(--accent-info), #0284c7);'
            };
            
            notification.style.cssText += styles[type] || styles.info;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: var(--space-2);">
                    <div>${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: var(--text-white); cursor: pointer; padding: var(--space-1);">
                        ✕
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // キーボードショートカット
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                        break;
                    case 'a':
                        if (e.shiftKey) {
                            e.preventDefault();
                            document.querySelectorAll('.card-checkbox').forEach(cb => {
                                cb.checked = true;
                            });
                            updateBulkActions();
                        }
                        break;
                    case 'Escape':
                        clearSelection();
                        resetFilters();
                        break;
                }
            }
        });

        // フェードインアニメーション用CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);

        console.log('🚀 プロ仕様出荷管理システム JavaScript 初期化完了');
        console.log('⌨️ キーボードショートカット:');
        console.log('  Ctrl+F: 検索フォーカス');
        console.log('  Ctrl+Shift+A: 全選択');
        console.log('  Escape: 選択解除・フィルターリセット');
    </script>
</body>
</html>