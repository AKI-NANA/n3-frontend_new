# Dockeré–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
pokemon_content_system/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements/
â”‚   â”œâ”€â”€ base.txt
â”‚   â”œâ”€â”€ development.txt
â”‚   â””â”€â”€ production.txt
â”œâ”€â”€ .env.example
â”œâ”€â”€ .env
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ default.conf
â””â”€â”€ scripts/
    â”œâ”€â”€ start-dev.sh
    â”œâ”€â”€ migrate.sh
    â””â”€â”€ collect-static.sh
```

## 2. Docker Composeè¨­å®š

### docker-compose.yml (é–‹ç™ºç’°å¢ƒ)
```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - media_volume:/app/media
      - static_volume:/app/static
    environment:
      - DEBUG=1
      - DATABASE_URL=postgresql://postgres:password@db:5432/pokemon_card_db
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    command: python manage.py runserver 0.0.0.0:8000
    networks:
      - pokemon_network

  worker:
    build: .
    volumes:
      - .:/app
      - media_volume:/app/media
    environment:
      - DEBUG=1
      - DATABASE_URL=postgresql://postgres:password@db:5432/pokemon_card_db
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    command: celery -A config worker -l info -Q data_collection,ai_generation,publishing
    networks:
      - pokemon_network

  beat:
    build: .
    volumes:
      - .:/app
    environment:
      - DEBUG=1
      - DATABASE_URL=postgresql://postgres:password@db:5432/pokemon_card_db
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
    depends_on:
      - db
      - redis
    command: celery -A config beat -l info
    networks:
      - pokemon_network

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: pokemon_card_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    networks:
      - pokemon_network

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - pokemon_network

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - static_volume:/static
      - media_volume:/media
    depends_on:
      - web
    networks:
      - pokemon_network

  flower:
    build: .
    command: celery -A config flower --port=5555
    ports:
      - "5555:5555"
    environment:
      - DEBUG=1
      - DATABASE_URL=postgresql://postgres:password@db:5432/pokemon_card_db
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - redis
    networks:
      - pokemon_network

volumes:
  postgres_data:
  redis_data:
  media_volume:
  static_volume:

networks:
  pokemon_network:
    driver: bridge
```

### docker-compose.prod.yml (æœ¬ç•ªç’°å¢ƒ)
```yaml
version: '3.8'

services:
  web:
    build: 
      context: .
      dockerfile: Dockerfile.prod
    expose:
      - 8000
    volumes:
      - static_volume:/app/static
      - media_volume:/app/media
    environment:
      - DEBUG=0
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - CELERY_BROKER_URL=${CELERY_BROKER_URL}
      - SECRET_KEY=${SECRET_KEY}
      - ALLOWED_HOSTS=${ALLOWED_HOSTS}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_STORAGE_BUCKET_NAME=${AWS_STORAGE_BUCKET_NAME}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
      - YOUTUBE_CLIENT_ID=${YOUTUBE_CLIENT_ID}
      - YOUTUBE_CLIENT_SECRET=${YOUTUBE_CLIENT_SECRET}
    depends_on:
      - db
      - redis
    command: gunicorn config.wsgi:application --bind 0.0.0.0:8000 --workers 4
    networks:
      - pokemon_network

  worker:
    build: 
      context: .
      dockerfile: Dockerfile.prod
    volumes:
      - media_volume:/app/media
    environment:
      - DEBUG=0
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - CELERY_BROKER_URL=${CELERY_BROKER_URL}
      - SECRET_KEY=${SECRET_KEY}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
    depends_on:
      - db
      - redis
    command: celery -A config worker -l info -Q data_collection,ai_generation,publishing --concurrency=4
    networks:
      - pokemon_network
    scale: 2

  beat:
    build: 
      context: .
      dockerfile: Dockerfile.prod
    environment:
      - DEBUG=0
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - CELERY_BROKER_URL=${CELERY_BROKER_URL}
    depends_on:
      - db
      - redis
    command: celery -A config beat -l info
    networks:
      - pokemon_network

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - pokemon_network

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    networks:
      - pokemon_network

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/prod.conf:/etc/nginx/conf.d/default.conf
      - ./ssl:/etc/nginx/ssl
      - static_volume:/static
      - media_volume:/media
    depends_on:
      - web
    networks:
      - pokemon_network

volumes:
  postgres_data:
  redis_data:
  media_volume:
  static_volume:

networks:
  pokemon_network:
    driver: bridge
```

## 3. Dockerfile

### Dockerfile (é–‹ç™ºãƒ»æœ¬ç•ªå…±é€š)
```dockerfile
FROM python:3.11-slim

# ç’°å¢ƒå¤‰æ•°è¨­å®š
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV DEBIAN_FRONTEND noninteractive

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
WORKDIR /app

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°ãƒ»å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        postgresql-client \
        gettext \
        curl \
        build-essential \
        libpq-dev \
        libjpeg-dev \
        libpng-dev \
        libwebp-dev \
        ffmpeg \
        imagemagick \
        git \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Pythonã®ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements/base.txt /app/requirements/base.txt
COPY requirements/development.txt /app/requirements/development.txt
RUN pip install --no-cache-dir -r requirements/development.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
COPY . /app/

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
RUN mkdir -p /app/static /app/media

# å®Ÿè¡Œæ¨©é™ä»˜ä¸
RUN chmod +x /app/scripts/*.sh

# ãƒãƒ¼ãƒˆå…¬é–‹
EXPOSE 8000

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
```

### Dockerfile.prod (æœ¬ç•ªç’°å¢ƒç”¨)
```dockerfile
FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV DEBIAN_FRONTEND noninteractive

WORKDIR /app

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        postgresql-client \
        gettext \
        curl \
        build-essential \
        libpq-dev \
        libjpeg-dev \
        libpng-dev \
        libwebp-dev \
        ffmpeg \
        imagemagick \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Pythonã®ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements/production.txt /app/requirements/production.txt
RUN pip install --no-cache-dir -r requirements/production.txt

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
COPY . /app/

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†
RUN python manage.py collectstatic --noinput

# érootãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
RUN adduser --disabled-password --gecos '' appuser
RUN chown -R appuser:appuser /app
USER appuser

EXPOSE 8000

CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000", "--workers", "4"]
```

## 4. ä¾å­˜é–¢ä¿‚ãƒ•ã‚¡ã‚¤ãƒ«

### requirements/base.txt
```
Django==4.2.7
djangorestframework==3.14.0
django-cors-headers==4.3.1
django-filter==23.3
psycopg2-binary==2.9.8
redis==5.0.1
celery==5.3.4
python-decouple==3.8
Pillow==10.1.0
requests==2.31.0
beautifulsoup4==4.12.2
openai==1.3.8
boto3==1.34.0
django-storages==1.14.2
python-slugify==8.0.1
lxml==4.9.3
pandas==2.1.3
scikit-learn==1.3.2
```

### requirements/development.txt
```
-r base.txt
django-debug-toolbar==4.2.0
django-extensions==3.2.3
factory-boy==3.3.0
pytest==7.4.3
pytest-django==4.7.0
black==23.11.0
isort==5.12.0
flake8==6.1.0
coverage==7.3.2
```

### requirements/production.txt
```
-r base.txt
gunicorn==21.2.0
whitenoise==6.6.0
sentry-sdk==1.38.0
django-health-check==3.17.0
```

## 5. ç’°å¢ƒå¤‰æ•°è¨­å®š

### .env.example
```bash
# Djangoè¨­å®š
DEBUG=1
SECRET_KEY=your-secret-key-here
ALLOWED_HOSTS=localhost,127.0.0.1

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DATABASE_URL=postgresql://postgres:password@db:5432/pokemon_card_db
POSTGRES_DB=pokemon_card_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password

# Redisè¨­å®š
REDIS_URL=redis://redis:6379/0
CELERY_BROKER_URL=redis://redis:6379/0

# AWSè¨­å®š
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_STORAGE_BUCKET_NAME=pokemon-content-storage
AWS_S3_REGION_NAME=ap-northeast-1

# AI APIè¨­å®š
OPENAI_API_KEY=your-openai-api-key
ELEVENLABS_API_KEY=your-elevenlabs-api-key
MIDJOURNEY_API_KEY=your-midjourney-api-key

# YouTube APIè¨­å®š
YOUTUBE_CLIENT_ID=your-youtube-client-id
YOUTUBE_CLIENT_SECRET=your-youtube-client-secret

# WordPress APIè¨­å®š
WORDPRESS_JP_URL=https://your-japanese-site.com
WORDPRESS_JP_USERNAME=admin
WORDPRESS_JP_PASSWORD=your-app-password
WORDPRESS_CN_URL=https://your-chinese-site.com
WORDPRESS_CN_USERNAME=admin
WORDPRESS_CN_PASSWORD=your-app-password

# SNS APIè¨­å®š
TWITTER_API_KEY=your-twitter-api-key
TWITTER_API_SECRET=your-twitter-api-secret
TWITTER_ACCESS_TOKEN=your-twitter-access-token
TWITTER_ACCESS_TOKEN_SECRET=your-twitter-access-token-secret

INSTAGRAM_ACCESS_TOKEN=your-instagram-access-token
FACEBOOK_PAGE_ACCESS_TOKEN=your-facebook-page-access-token

# ãƒ¡ãƒ¼ãƒ«è¨­å®š
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
EMAIL_USE_TLS=1
```

## 6. Nginxè¨­å®š

### nginx/default.conf (é–‹ç™ºç’°å¢ƒç”¨)
```nginx
upstream web {
    server web:8000;
}

server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://web;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_redirect off;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    location /static/ {
        alias /static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header X-Content-Type-Options nosniff;
    }

    location /media/ {
        alias /media/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Flower (Celeryç›£è¦–)
    location /flower/ {
        proxy_pass http://flower:5555/;
        proxy_set_header Host $host;
        proxy_redirect off;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    client_max_body_size 100M;
}
```

### nginx/prod.conf (æœ¬ç•ªç’°å¢ƒç”¨)
```nginx
upstream web {
    server web:8000;
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    add_header Strict-Transport-Security "max-age=63072000" always;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";

    location / {
        proxy_pass http://web;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $host;
        proxy_redirect off;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    location /static/ {
        alias /static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        gzip_static on;
    }

    location /media/ {
        alias /media/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    client_max_body_size 100M;
}
```

## 7. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### scripts/start-dev.sh
```bash
#!/bin/bash

echo "ğŸš€ ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºç’°å¢ƒèµ·å‹•"

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
if [ ! -f .env ]; then
    echo "âš ï¸  .envãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚.env.exampleã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚"
    cp .env.example .env
    echo "âœ… .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚å¿…è¦ãªå€¤ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"
    exit 1
fi

# Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•
echo "ğŸ”§ Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
docker-compose build

echo "ğŸ”„ Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ä¸­..."
docker-compose up -d

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™ãŒã§ãã‚‹ã¾ã§å¾…æ©Ÿ
echo "â³ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™ã‚’å¾…æ©Ÿä¸­..."
sleep 10

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
echo "ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­..."
docker-compose exec web python manage.py migrate

# ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰
echo "ğŸ‘¤ ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆä¸­..."
docker-compose exec web python manage.py shell -c "
from django.contrib.auth.models import User
if not User.objects.filter(username='admin').exists():
    User.objects.create_superuser('admin', 'admin@example.com', 'admin123')
    print('Admin user created: admin/admin123')
else:
    print('Admin user already exists')
"

# åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
echo "ğŸ“¦ åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ä¸­..."
docker-compose exec web python manage.py loaddata fixtures/initial_data.json

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†
echo "ğŸ“‚ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åé›†ä¸­..."
docker-compose exec web python manage.py collectstatic --noinput

echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼"
echo ""
echo "ğŸŒ ã‚¢ã‚¯ã‚»ã‚¹URL:"
echo "   ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª: http://localhost"
echo "   Django Admin: http://localhost/admin (admin/admin123)"
echo "   API: http://localhost/api/"
echo "   Flower (Celeryç›£è¦–): http://localhost/flower/"
echo ""
echo "ğŸ”§ ä¾¿åˆ©ãªã‚³ãƒãƒ³ãƒ‰:"
echo "   ãƒ­ã‚°ç¢ºèª: docker-compose logs -f"
echo "   ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢: docker-compose down"
echo "   å†ãƒ“ãƒ«ãƒ‰: docker-compose build --no-cache"
```

### scripts/migrate.sh
```bash
#!/bin/bash

echo "ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
docker-compose exec web python manage.py makemigrations

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker-compose exec web python manage.py migrate

echo "âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†"
```

### scripts/collect-static.sh
```bash
#!/bin/bash

echo "ğŸ“‚ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†"

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†
docker-compose exec web python manage.py collectstatic --noinput

echo "âœ… é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†å®Œäº†"
```

### scripts/backup-db.sh
```bash
#!/bin/bash

BACKUP_DIR="./backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="pokemon_db_backup_${TIMESTAMP}.sql"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p $BACKUP_DIR

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
echo "ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œä¸­..."
docker-compose exec db pg_dump -U postgres pokemon_card_db > "${BACKUP_DIR}/${BACKUP_FILE}"

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šå‰ï¼‰
find $BACKUP_DIR -name "*.sql" -mtime +30 -delete

echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${BACKUP_DIR}/${BACKUP_FILE}"
```

### scripts/restore-db.sh
```bash
#!/bin/bash

if [ -z "$1" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: ./restore-db.sh <backup_file.sql>"
    exit 1
fi

BACKUP_FILE=$1

if [ ! -f "$BACKUP_FILE" ]; then
    echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $BACKUP_FILE"
    exit 1
fi

echo "ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©å…ƒä¸­..."
echo "âš ï¸  è­¦å‘Š: ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚"
read -p "ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N): " -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]]; then
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ãƒ»å†ä½œæˆ
    docker-compose exec db dropdb -U postgres pokemon_card_db
    docker-compose exec db createdb -U postgres pokemon_card_db
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©å…ƒ
    docker-compose exec -T db psql -U postgres pokemon_card_db < "$BACKUP_FILE"
    
    echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©å…ƒå®Œäº†"
else
    echo "âŒ å¾©å…ƒã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ"
fi
```

## 8. åˆæœŸãƒ‡ãƒ¼ã‚¿ä½œæˆ

### fixtures/initial_data.json
```json
[
    {
        "model": "cards.pokemonseries",
        "pk": 1,
        "fields": {
            "name": "ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆ",
            "name_en": "Base Set",
            "release_date": "1996-10-20",
            "is_active": true
        }
    },
    {
        "model": "cards.pokemonseries", 
        "pk": 2,
        "fields": {
            "name": "æ‹¡å¼µãƒ‘ãƒƒã‚¯ã€Œã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆ&ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆã€",
            "name_en": "Scarlet & Violet",
            "release_date": "2023-01-20",
            "is_active": true
        }
    },
    {
        "model": "cards.pokemoncard",
        "pk": 1,
        "fields": {
            "name_jp": "ãƒ”ã‚«ãƒãƒ¥ã‚¦",
            "name_en": "Pikachu",
            "name_cn": "çš®å¡ä¸˜",
            "card_number": "025/102",
            "series": 1,
            "rarity": "RRR",
            "hp": 60,
            "card_type": "ãƒã‚±ãƒ¢ãƒ³",
            "pokemon_type": "é›·",
            "is_popular": true,
            "investment_grade": "A",
            "metadata": {
                "description": "ã§ã‚“ããƒã‚ºãƒŸãƒã‚±ãƒ¢ãƒ³",
                "abilities": ["é™é›»æ°—"]
            }
        }
    },
    {
        "model": "price_tracking.pricesource",
        "pk": 1,
        "fields": {
            "name": "ãƒ¡ãƒ«ã‚«ãƒª",
            "base_url": "https://mercari.com",
            "is_active": true,
            "scraping_config": {
                "search_endpoint": "/search",
                "card_selector": ".item-box",
                "price_selector": ".item-price"
            },
            "rate_limit_per_hour": 100
        }
    },
    {
        "model": "content_collection.contentsource",
        "pk": 1,
        "fields": {
            "name": "ãƒã‚±ã‚«æŠ•è³‡ãƒãƒ£ãƒ³ãƒãƒ«",
            "source_type": "youtube",
            "url": "https://www.youtube.com/channel/UCxxxxxxx",
            "is_active": true,
            "collection_config": {
                "channel_id": "UCxxxxxxx",
                "keywords": ["ãƒã‚±ã‚«", "ç›¸å ´", "æŠ•è³‡"]
            },
            "collection_interval_hours": 6
        }
    },
    {
        "model": "ai_generation.contenttemplate",
        "pk": 1,
        "fields": {
            "name": "æ—¥æœ¬èªãƒ–ãƒ­ã‚°è¨˜äº‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ",
            "content_type": "blog_jp",
            "system_prompt": "ã‚ãªãŸã¯ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰å¸‚å ´ã®å°‚é–€ã‚¢ãƒŠãƒªã‚¹ãƒˆã§ã™ã€‚æŠ•è³‡åˆå¿ƒè€…ã«ã‚‚åˆ†ã‹ã‚Šã‚„ã™ãã€SEOæœ€é©åŒ–ã•ã‚ŒãŸè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚",
            "user_prompt_template": "ä»¥ä¸‹ã®ãƒã‚±ãƒ¢ãƒ³ã‚«ãƒ¼ãƒ‰ã®ç›¸å ´ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€3000æ–‡å­—ç¨‹åº¦ã®SEOæœ€é©åŒ–ã•ã‚ŒãŸãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nã‚«ãƒ¼ãƒ‰å: {card_name}\nç¾åœ¨ä¾¡æ ¼: {current_price}å††\n24æ™‚é–“å¤‰å‹•: {change_24h}%\n7æ—¥é–“å¤‰å‹•: {change_7d}%\n30æ—¥é–“å¤‰å‹•: {change_30d}%\n\nè¨˜äº‹ã¯ä»¥ä¸‹ã®æ§‹æˆã§ãŠé¡˜ã„ã—ã¾ã™ï¼š\n1. å°å…¥ï¼ˆã‚«ãƒ¼ãƒ‰ã®åŸºæœ¬æƒ…å ±ï¼‰\n2. ç¾åœ¨ã®ç›¸å ´çŠ¶æ³\n3. ä¾¡æ ¼å¤‰å‹•ã®è¦å› åˆ†æ\n4. ä»Šå¾Œã®ä¾¡æ ¼äºˆæ¸¬\n5. æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹\n6. ã¾ã¨ã‚",
            "max_tokens": 3000,
            "temperature": 0.7,
            "target_keywords": ["ãƒã‚±ã‚« ç›¸å ´", "æŠ•è³‡", "ä¾¡æ ¼äºˆæ¸¬"],
            "is_active": true
        }
    }
]
```

## 9. å®Ÿè¡Œæ‰‹é †

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd pokemon_content_system

# 2. å®Ÿè¡Œæ¨©é™ä»˜ä¸
chmod +x scripts/*.sh

# 3. é–‹ç™ºç’°å¢ƒèµ·å‹•
./scripts/start-dev.sh

# 4. å‹•ä½œç¢ºèª
curl http://localhost/api/health/
```

### æ—¥å¸¸çš„ãªé–‹ç™ºä½œæ¥­
```bash
# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f web

# Django shell
docker-compose exec web python manage.py shell

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
./scripts/migrate.sh

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec web python manage.py test

# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
docker-compose exec web black .
docker-compose exec web isort .

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†
./scripts/collect-static.sh

# ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
docker-compose down
```

### æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env.prod
# .env.prodã‚’æœ¬ç•ªç”¨ã«ç·¨é›†

# æœ¬ç•ªç’°å¢ƒãƒ“ãƒ«ãƒ‰ãƒ»èµ·å‹•
docker-compose -f docker-compose.prod.yml up -d --build

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker-compose -f docker-compose.prod.yml exec web python manage.py migrate

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«åé›†
docker-compose -f docker-compose.prod.yml exec web python manage.py collectstatic --noinput

# ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
docker-compose -f docker-compose.prod.yml exec web python manage.py createsuperuser
```

## 10. ç›£è¦–ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®çŠ¶æ…‹ç¢ºèª
curl http://localhost/health/

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
curl http://localhost/health/database/

# Redisæ¥ç¶šç¢ºèª  
curl http://localhost/health/cache/

# Celery workerçŠ¶æ…‹ç¢ºèª
curl http://localhost/health/celery/
```

### ãƒ­ã‚°ç¢ºèª
```bash
# å…¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°
docker-compose logs -f

# ç‰¹å®šã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°
docker-compose logs -f web
docker-compose logs -f worker
docker-compose logs -f beat

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿
docker-compose logs -f web | grep ERROR
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
```bash
# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
docker stats

# ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§
docker-compose ps

# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
docker system df

# ä¸è¦ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤
docker system prune -a
```

## 11. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker-compose ps db

# PostgreSQLãƒ­ã‚°ç¢ºèª
docker-compose logs db

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†ä½œæˆ
docker-compose down
docker volume rm pokemon_content_system_postgres_data
docker-compose up -d db
```

#### Celery workerãŒå‹•ã‹ãªã„
```bash
# WorkerçŠ¶æ…‹ç¢ºèª
docker-compose ps worker

# Redisã®çŠ¶æ…‹ç¢ºèª
docker-compose exec redis redis-cli ping

# Workerå†èµ·å‹•
docker-compose restart worker
```

#### é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„
```bash
# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«å†åé›†
./scripts/collect-static.sh

# Nginxã®è¨­å®šç¢ºèª
docker-compose exec nginx nginx -t

# Nginxå†èµ·å‹•
docker-compose restart nginx
```

#### ãƒ¡ãƒ¢ãƒªä¸è¶³
```bash
# Docker Desktop ã®ãƒªã‚½ãƒ¼ã‚¹è¨­å®šã‚’ç¢ºèª
# æœ€ä½8GB RAM, 4 CPU coresæ¨å¥¨

# ä¸è¦ãªã‚³ãƒ³ãƒ†ãƒŠãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
docker system prune -a

# Swapè¨­å®šç¢ºèªï¼ˆLinuxï¼‰
swapon --show
```

ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã§ã€å®Œå…¨ãªé–‹ç™ºç’°å¢ƒãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚æ¬¡ã«ã©ã®æ©Ÿèƒ½ã‹ã‚‰å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ