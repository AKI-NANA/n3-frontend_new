📋 フィルタールール管理システム バックエンド開発指示書
🎯 システム概要
AIルール学習 + テキストマッチによる輸出・モール別禁止品フィルタリングシステム
📊 データベース設計要件
テーブル構成
sql-- AIルールテーブル
ai_rules: id, name, category, learning_text, status, accuracy, created_at, updated_at

-- テキストルールテーブル  
text_rules: id, keyword, match_type, priority, reason, category, status, detection_count, created_at

-- モール設定テーブル
mall_settings: id, mall_name, rule_id, rule_type, is_enabled

-- ブロック結果テーブル
blocked_results: id, product_name, sku, mall, method, applied_rule, reason, keywords, priority, blocked_at

-- 外部データソーステーブル
external_sources: id, name, url, format, frequency, last_updated, status
🔧 API エンドポイント要件
AIルール管理

POST /api/ai-rules - AI学習ルール作成
GET /api/ai-rules - ルール一覧取得（状態フィルタ対応）
PUT /api/ai-rules/{id} - ルール更新
DELETE /api/ai-rules/{id} - ルール削除
POST /api/ai-rules/{id}/test - AI学習テスト実行

テキストルール管理

POST /api/text-rules - テキストルール作成
GET /api/text-rules - ルール一覧取得（状態・カテゴリフィルタ対応）
PUT /api/text-rules/{id} - ルール更新
DELETE /api/text-rules/{id} - ルール削除
POST /api/text-rules/bulk-delete - 一括削除

CSV一括管理

POST /api/csv/upload - CSVアップロード・一括登録
GET /api/csv/template - CSVテンプレートダウンロード
GET /api/csv/export - 全データエクスポート
POST /api/external-sources - 外部データソース追加
POST /api/external-sources/{id}/update - 外部データ取得・更新

モール別設定

GET /api/mall-settings - 全モール設定取得
PUT /api/mall-settings - モール別設定一括更新
POST /api/mall-settings/copy - 設定コピー

ブロック結果

GET /api/blocked-results - ブロック結果一覧（フィルタ・検索対応）
POST /api/blocked-results/filter - フィルタリング実行
DELETE /api/blocked-results - 結果削除
GET /api/blocked-results/export - 結果エクスポート

🤖 AI連携要件
AI学習エンジン

自然言語処理: 学習テキストから判定ルール生成
精度測定: ルール適用結果の正確性計算
継続学習: ブロック結果フィードバックによる改善

外部データ解析

CSV解析: 政府機関リストの自動読み込み
HTML解析: ウェブサイトからの情報抽出
自動更新: 定期的な外部データ取得・反映

⚡ リアルタイム処理要件
フィルタリング実行

商品データ入力 → AIルール判定 + テキストルール判定 → ブロック/通過判定
レスポンス時間: 1秒以内
同時処理: 1000件/分以上

データ同期

ルール変更 → モール設定自動更新
CSV アップロード → リアルタイム反映
ブロック実行 → 統計即座更新

🔒 セキュリティ要件

API認証: JWT/API Key
入力検証: CSV・テキスト入力のサニタイズ
ログ記録: 全操作の監査ログ
データ暗号化: 機密ルール情報の保護

📈 パフォーマンス要件

データベース: インデックス最適化
キャッシュ: Redis使用（ルール・設定キャッシュ）
非同期処理: CSV大容量アップロード対応
スケーリング: 水平スケール対応

🎨 フロントエンド連携

WebSocket: リアルタイム統計更新
プログレス表示: CSV処理・AI学習進捗
エラーハンドリング: 詳細エラーメッセージ表示
ファイル処理: ドラッグ&ドロップアップロード対応