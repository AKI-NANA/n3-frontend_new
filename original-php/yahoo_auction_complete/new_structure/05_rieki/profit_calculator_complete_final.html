<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ©ç›Šè¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨çµ±åˆç‰ˆ - å…¨æ©Ÿèƒ½æ­è¼‰FINAL</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* CSS Variables */
        :root {
            --primary: #3b82f6; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --info: #06b6d4;
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b; --text-secondary: #475569; --text-muted: #64748b;
            --border-color: #e2e8f0; --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --space-sm: 0.5rem; --space-md: 1rem; --space-lg: 1.5rem; --space-xl: 2rem;
            --radius-md: 0.5rem; --radius-lg: 0.75rem; --radius-xl: 1rem;
            --ebay-color: #e53e3e; --shopee-color: #ee4d2d; --calc-primary: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }
        .container { max-width: 1600px; margin: 0 auto; padding: var(--space-md); }

        /* Header */
        .header { background: linear-gradient(135deg, var(--calc-primary), #d97706); color: white; padding: var(--space-xl); border-radius: var(--radius-xl); margin-bottom: var(--space-xl); text-align: center; box-shadow: var(--shadow-md); }
        .header h1 { font-size: 2.5rem; margin-bottom: var(--space-md); }
        .header p { font-size: 1.125rem; opacity: 0.9; }

        /* Navigation */
        .nav { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--space-sm); background: var(--bg-secondary); border-radius: var(--radius-lg); padding: var(--space-sm); margin-bottom: var(--space-xl); box-shadow: var(--shadow-md); }
        .nav-btn { padding: var(--space-md); border: none; background: transparent; border-radius: var(--radius-md); cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .nav-btn:hover { background: var(--bg-tertiary); }
        .nav-btn.active { background: var(--calc-primary); color: white; }

        /* Tabs */
        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Sections */
        .section { background: var(--bg-secondary); border-radius: var(--radius-xl); padding: var(--space-xl); margin-bottom: var(--space-xl); box-shadow: var(--shadow-md); }
        .section-header { display: flex; justify-content: between; align-items: center; margin-bottom: var(--space-lg); border-bottom: 2px solid var(--border-color); padding-bottom: var(--space-md); }
        .section-title { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: var(--space-sm); }
        .section-title i { color: var(--calc-primary); }

        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-xl); }
        .form-section { background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: var(--space-lg); }
        .form-section h4 { margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-sm); }
        .form-section h4 i { color: var(--calc-primary); }
        .form-group { margin-bottom: var(--space-lg); }
        .form-group label { display: block; margin-bottom: var(--space-sm); font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: var(--space-md); border: 2px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--calc-primary); }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; gap: var(--space-sm); padding: var(--space-md) var(--space-lg); border: none; border-radius: var(--radius-md); font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .btn-primary { background: var(--calc-primary); color: white; }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 2px solid var(--border-color); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-calculate { width: 100%; padding: var(--space-lg); font-size: 1.125rem; margin-top: var(--space-lg); }
        .btn-group { display: flex; gap: var(--space-sm); margin-top: var(--space-md); }

        /* Results */
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-lg); margin-top: var(--space-xl); }
        .result-card { background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center; }
        .result-value { font-size: 2rem; font-weight: 700; margin-bottom: var(--space-sm); color: var(--success); }
        .result-value.negative { color: var(--danger); }
        .result-value.warning { color: var(--warning); }
        .result-label { font-size: 0.875rem; color: var(--text-muted); font-weight: 500; text-transform: uppercase; }

        /* Mode Selection */
        .mode-selector { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-md); margin-bottom: var(--space-lg); }
        .mode-card { background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-lg); padding: var(--space-lg); cursor: pointer; text-align: center; transition: all 0.2s; }
        .mode-card:hover { border-color: var(--primary); }
        .mode-card.selected { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }

        /* Country Grid */
        .country-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-sm); margin-bottom: var(--space-lg); }
        .country-btn { padding: var(--space-md); border: 2px solid var(--border-color); background: var(--bg-secondary); border-radius: var(--radius-md); cursor: pointer; text-align: center; font-weight: 600; transition: all 0.2s; }
        .country-btn:hover { border-color: var(--shopee-color); }
        .country-btn.selected { border-color: var(--shopee-color); background: var(--shopee-color); color: white; }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; margin-top: var(--space-lg); background: var(--bg-secondary); border-radius: var(--radius-lg); overflow: hidden; }
        .data-table th, .data-table td { padding: var(--space-md); text-align: left; border-bottom: 1px solid var(--border-color); }
        .data-table th { background: var(--bg-tertiary); font-weight: 600; }
        .data-table tr:hover { background: var(--bg-tertiary); }

        /* Special Sections */
        .tariff-settings { background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(220, 38, 127, 0.05)); border: 2px solid var(--danger); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-lg); }
        .fee-display { background: linear-gradient(135deg, #fefce8, #fef3c7); border: 2px solid var(--warning); border-radius: var(--radius-lg); padding: var(--space-lg); margin-top: var(--space-md); }
        .fee-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-top: var(--space-md); }
        .fee-item { text-align: center; background: rgba(255, 255, 255, 0.7); padding: var(--space-md); border-radius: var(--radius-md); }
        .fee-value { font-size: 1.25rem; font-weight: 700; color: #92400e; margin-bottom: var(--space-sm); }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: var(--space-sm); }
            .form-grid { grid-template-columns: 1fr; }
            .mode-selector { grid-template-columns: 1fr; }
            .result-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-calculator"></i> åˆ©ç›Šè¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨çµ±åˆç‰ˆ</h1>
            <p>eBay DDP/DDUãƒ»Shopee 7ã‚«å›½ãƒ»æ®µéšæ‰‹æ•°æ–™ãƒ»éšå±¤å‹åˆ©ç›Šç‡ãƒ»ç‚ºæ›¿å¤‰å‹•å¯¾å¿œå®Œå…¨ç‰ˆ</p>
        </div>

        <!-- Navigation -->
        <div class="nav">
            <button class="nav-btn active" onclick="showTab('simulation')">
                <i class="fas fa-chart-line"></i> é«˜ç²¾åº¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            <button class="nav-btn" onclick="showTab('ebay')">
                <i class="fab fa-ebay"></i> eBay USA (DDP/DDU)
            </button>
            <button class="nav-btn" onclick="showTab('shopee')">
                <i class="fas fa-shopping-bag"></i> Shopee 7ã‚«å›½
            </button>
            <button class="nav-btn" onclick="showTab('fees')">
                <i class="fas fa-tags"></i> æ®µéšæ‰‹æ•°æ–™ç®¡ç†
            </button>
            <button class="nav-btn" onclick="showTab('settings')">
                <i class="fas fa-sliders-h"></i> åˆ©ç›Šç‡è¨­å®š
            </button>
            <button class="nav-btn" onclick="showTab('rates')">
                <i class="fas fa-exchange-alt"></i> ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ
            </button>
        </div>

        <!-- é«˜ç²¾åº¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
        <div id="simulation" class="tab active">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-calculator"></i> é«˜ç²¾åº¦å‡ºå“å‰åˆ©ç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="clearAll()">
                            <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                        </button>
                        <button class="btn btn-info" onclick="loadSample()">
                            <i class="fas fa-file-import"></i> ã‚µãƒ³ãƒ—ãƒ«
                        </button>
                        <button class="btn btn-warning" onclick="loadAdvanced()">
                            <i class="fas fa-rocket"></i> é«˜ç²¾åº¦ãƒ—ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>
                </div>

                <div class="form-grid">
                    <!-- å•†å“æƒ…å ± -->
                    <div class="form-section">
                        <h4><i class="fas fa-box"></i> å•†å“æƒ…å ±</h4>
                        
                        <div class="form-group">
                            <label>Yahoo!ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ä¾¡æ ¼ (å††)</label>
                            <input type="number" id="yahooPrice" placeholder="15000" value="15000">
                        </div>
                        
                        <div class="form-group">
                            <label>å›½å†…é€æ–™ (å††)</label>
                            <input type="number" id="domesticShipping" placeholder="800" value="800">
                        </div>
                        
                        <div class="form-group">
                            <label>å¤–æ³¨å·¥è³ƒè²» (å††)</label>
                            <input type="number" id="outsourceFee" placeholder="500" value="500">
                        </div>
                        
                        <div class="form-group">
                            <label>æ¢±åŒ…è²» (å††)</label>
                            <input type="number" id="packagingFee" placeholder="200" value="200">
                        </div>
                        
                        <div class="form-group">
                            <label>eBayã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆæ®µéšæ‰‹æ•°æ–™ï¼‰</label>
                            <select id="ebayCategory">
                                <option value="293">Consumer Electronics (Tier1: 10.0%, Tier2: 12.35% @$7,500)</option>
                                <option value="11450">Clothing (Tier1: 12.9%, Tier2: 14.70% @$10,000)</option>
                                <option value="58058">Collectibles (Tier1: 9.15%, Tier2: 11.70% @$5,000)</option>
                                <option value="267">Books (Tier1: 15.0%, Tier2: 15.0%)</option>
                                <option value="550">Art (Tier1: 12.9%, Tier2: 15.0% @$10,000)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>å•†å“ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼ˆéšå±¤å‹åˆ©ç›Šç‡ï¼‰</label>
                            <select id="itemCondition">
                                <option value="New">æ–°å“ (ç›®æ¨™: 28% | æœ€ä½: $7.00)</option>
                                <option value="Used" selected>ä¸­å¤ (ç›®æ¨™: 20% | æœ€ä½: $3.00)</option>
                                <option value="Refurbished">ãƒªãƒ•ã‚¡ãƒ“ãƒƒã‚·ãƒ¥ (ç›®æ¨™: 25% | æœ€ä½: $5.00)</option>
                                <option value="ForParts">ã‚¸ãƒ£ãƒ³ã‚¯ (ç›®æ¨™: 15% | æœ€ä½: $2.00)</option>
                            </select>
                        </div>
                    </div>

                    <!-- è²©å£²ä¾¡æ ¼è¨­å®š -->
                    <div class="form-section">
                        <h4><i class="fas fa-dollar-sign"></i> è²©å£²ä¾¡æ ¼è¨­å®š</h4>
                        
                        <div class="form-group">
                            <label>æƒ³å®šè²©å£²ä¾¡æ ¼ (USD)</label>
                            <input type="number" id="assumedPrice" placeholder="120.00" value="120.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label>æƒ³å®šé€æ–™ (USD)</label>
                            <input type="number" id="assumedShipping" placeholder="15.00" value="15.00" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label>å‡ºå“çµŒéæ—¥æ•°</label>
                            <input type="number" id="daysSince" value="0" min="0" max="365">
                            <small style="color: var(--text-muted);">30æ—¥ä»¥ä¸Š: 15%åˆ©ç›Šç‡, 60æ—¥ä»¥ä¸Š: 10%åˆ©ç›Šç‡</small>
                        </div>
                        
                        <div class="form-group">
                            <label>è²©å£²æˆ¦ç•¥</label>
                            <select id="strategy">
                                <option value="standard">æ¨™æº–è²©å£²</option>
                                <option value="quick">æ—©æœŸå£²å´ (-5%)</option>
                                <option value="premium">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  (+10%)</option>
                                <option value="volume">ãƒœãƒªãƒ¥ãƒ¼ãƒ  (-3%)</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary btn-calculate" onclick="calculateAdvanced()">
                            <i class="fas fa-magic"></i> é«˜ç²¾åº¦åˆ©ç›Šè¨ˆç®—å®Ÿè¡Œ
                        </button>
                    </div>

                    <!-- æ‰‹æ•°æ–™æƒ…å ±è¡¨ç¤º -->
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> æ®µéšæ‰‹æ•°æ–™ãƒ»ç‚ºæ›¿æƒ…å ±</h4>
                        
                        <div class="fee-display">
                            <h5>æ®µéšæ‰‹æ•°æ–™è¨ˆç®—</h5>
                            <div class="fee-breakdown">
                                <div class="fee-item">
                                    <div class="fee-value" id="tier1Rate">10.0%</div>
                                    <div>Tier1 Fee</div>
                                </div>
                                <div class="fee-item">
                                    <div class="fee-value" id="tier2Rate">12.35%</div>
                                    <div>Tier2 Fee</div>
                                </div>
                                <div class="fee-item">
                                    <div class="fee-value" id="appliedRate">10.0%</div>
                                    <div>é©ç”¨æ‰‹æ•°æ–™</div>
                                </div>
                                <div class="fee-item">
                                    <div class="fee-value" id="insertionFee">$0.35</div>
                                    <div>å‡ºå“æ‰‹æ•°æ–™</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: var(--space-md); padding: var(--space-md); background: var(--bg-tertiary); border-radius: var(--radius-md);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-sm);">
                                <span>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç‚ºæ›¿:</span>
                                <span id="currentRate">1 USD = Â¥148.5</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-sm);">
                                <span>å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³:</span>
                                <span>5.0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: 700;">
                                <span>è¨ˆç®—ç”¨ãƒ¬ãƒ¼ãƒˆ:</span>
                                <span id="safeRate">1 USD = Â¥155.9</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¨ˆç®—çµæœè¡¨ç¤º -->
                <div class="result-grid" id="resultGrid" style="display: none;">
                    <div class="result-card">
                        <div class="result-value" id="totalRevenue">$135.00</div>
                        <div class="result-label">ç·åå…¥</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="totalCost">$110.50</div>
                        <div class="result-label">ç·ã‚³ã‚¹ãƒˆ</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="totalFees">$13.85</div>
                        <div class="result-label">ç·æ‰‹æ•°æ–™</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="netProfit">$10.65</div>
                        <div class="result-label">ç´”åˆ©ç›Š</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="profitMargin">7.9%</div>
                        <div class="result-label">åˆ©ç›Šç‡</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="roi">9.6%</div>
                        <div class="result-label">ROI</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="recommendedPrice">$145.50</div>
                        <div class="result-label">æ¨å¥¨ä¾¡æ ¼</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="breakEven">$125.30</div>
                        <div class="result-label">æç›Šåˆ†å²ç‚¹</div>
                    </div>
                </div>

                <!-- æ¨å¥¨äº‹é … -->
                <div id="recommendation" style="display: none; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border: 2px solid var(--info); border-radius: var(--radius-lg); padding: var(--space-lg); margin-top: var(--space-xl);">
                    <div style="display: flex; align-items: flex-start; gap: var(--space-md);">
                        <i class="fas fa-lightbulb" style="color: var(--info); font-size: 1.5rem; margin-top: 0.25rem;"></i>
                        <div id="recommendationText" style="flex: 1; font-weight: 500; line-height: 1.6; color: #0c4a6e;">
                            é«˜ç²¾åº¦è¨ˆç®—ã«ã‚ˆã‚‹æ¨å¥¨äº‹é …ã‚’è¡¨ç¤ºã—ã¾ã™...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- eBay USAã‚¿ãƒ– -->
        <div id="ebay" class="tab">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fab fa-ebay" style="color: var(--ebay-color);"></i> eBay USA åˆ©ç›Šè¨ˆç®— (DDP/DDUå¯¾å¿œ)
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="loadEbayPreset()">
                            <i class="fas fa-download"></i> ãƒ—ãƒªã‚»ãƒƒãƒˆ
                        </button>
                        <button class="btn btn-success" onclick="saveEbayConfig()">
                            <i class="fas fa-save"></i> è¨­å®šä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- DDP/DDUé¸æŠ -->
                <div class="mode-selector">
                    <div class="mode-card selected" onclick="selectMode('ddp')" data-mode="ddp">
                        <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-sm);">DDP (Delivered Duty Paid)</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">é–¢ç¨è¾¼ã¿é…é€ - å£²ä¸»ãŒé–¢ç¨è² æ‹…</div>
                    </div>
                    <div class="mode-card" onclick="selectMode('ddu')" data-mode="ddu">
                        <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: var(--space-sm);">DDU (Delivered Duty Unpaid)</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">é–¢ç¨åˆ¥é…é€ - è²·ä¸»ãŒé–¢ç¨è² æ‹…</div>
                    </div>
                </div>

                <!-- é–¢ç¨è¨­å®š -->
                <div class="tariff-settings">
                    <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-lg);">
                        <div style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background: var(--danger); color: white; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--danger);">USAé–¢ç¨è¨­å®š</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥é–¢ç¨ç‡</div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-section">
                            <h4><i class="fas fa-percentage"></i> åŸºæœ¬é–¢ç¨ç‡</h4>
                            <div class="form-group">
                                <label>Electronicsé–¢ç¨ç‡ (%)</label>
                                <input type="number" id="electronicsRate" value="7.5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Textilesé–¢ç¨ç‡ (%)</label>
                                <input type="number" id="textilesRate" value="12.0" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Otheré–¢ç¨ç‡ (%)</label>
                                <input type="number" id="otherRate" value="5.0" step="0.1">
                            </div>
                        </div>

                        <div class="form-section">
                            <h4><i class="fas fa-calculator"></i> è¿½åŠ è²»ç”¨</h4>
                            <div class="form-group">
                                <label>å¤–æ³¨å·¥è³ƒè²» (å††)</label>
                                <input type="number" id="ebayOutsourceFee" value="500">
                            </div>
                            <div class="form-group">
                                <label>æ¢±åŒ…è²» (å††)</label>
                                <input type="number" id="ebayPackagingFee" value="200">
                            </div>
                            <div class="form-group">
                                <label>ç‚ºæ›¿å¤‰å‹•ãƒãƒ¼ã‚¸ãƒ³ (%)</label>
                                <input type="number" id="ebayMargin" value="5.0" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- eBayå•†å“æƒ…å ± -->
                <div class="form-grid">
                    <div class="form-section">
                        <h4><i class="fas fa-box"></i> å•†å“æƒ…å ±</h4>
                        <div class="form-group">
                            <label>å•†å“ã‚¿ã‚¤ãƒˆãƒ«</label>
                            <input type="text" id="ebayTitle" placeholder="iPhone 15 Pro Max 256GB">
                        </div>
                        <div class="form-group">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ (å††)</label>
                            <input type="number" id="ebayPurchasePrice" placeholder="150000">
                        </div>
                        <div class="form-group">
                            <label>è²©å£²ä¾¡æ ¼ (USD)</label>
                            <input type="number" id="ebaySellPrice" placeholder="1200" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>é€æ–™ (USD)</label>
                            <input type="number" id="ebayShipping" placeholder="25" step="0.01">
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-cog"></i> eBayè¨­å®š</h4>
                        <div class="form-group">
                            <label>å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                            <select id="ebayProductCategory">
                                <option value="electronics">Electronics</option>
                                <option value="textiles">Clothing & Textiles</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å•†å“çŠ¶æ…‹</label>
                            <select id="ebayCondition">
                                <option value="New">New</option>
                                <option value="Used">Used</option>
                                <option value="Refurbished">Refurbished</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é‡é‡ (kg)</label>
                            <input type="number" id="ebayWeight" placeholder="0.5" step="0.1">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary btn-calculate" onclick="calculateEbay()">
                    <i class="fas fa-calculator"></i> eBay USAåˆ©ç›Šè¨ˆç®—å®Ÿè¡Œ
                </button>
            </div>
        </div>

        <!-- Shopee 7ã‚«å›½ã‚¿ãƒ– -->
        <div id="shopee" class="tab">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-shopping-bag" style="color: var(--shopee-color);"></i> Shopee 7ã‚«å›½åˆ©ç›Šè¨ˆç®—
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="loadShopeePreset()">
                            <i class="fas fa-download"></i> ãƒ—ãƒªã‚»ãƒƒãƒˆ
                        </button>
                        <button class="btn btn-success" onclick="saveShopeeConfig()">
                            <i class="fas fa-save"></i> è¨­å®šä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- å›½é¸æŠ -->
                <div class="country-grid">
                    <div class="country-btn selected" data-country="SG" onclick="selectCountry('SG')">ğŸ‡¸ğŸ‡¬ ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«</div>
                    <div class="country-btn" data-country="MY" onclick="selectCountry('MY')">ğŸ‡²ğŸ‡¾ ãƒãƒ¬ãƒ¼ã‚·ã‚¢</div>
                    <div class="country-btn" data-country="TH" onclick="selectCountry('TH')">ğŸ‡¹ğŸ‡­ ã‚¿ã‚¤</div>
                    <div class="country-btn" data-country="PH" onclick="selectCountry('PH')">ğŸ‡µğŸ‡­ ãƒ•ã‚£ãƒªãƒ”ãƒ³</div>
                    <div class="country-btn" data-country="ID" onclick="selectCountry('ID')">ğŸ‡®ğŸ‡© ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢</div>
                    <div class="country-btn" data-country="VN" onclick="selectCountry('VN')">ğŸ‡»ğŸ‡³ ãƒ™ãƒˆãƒŠãƒ </div>
                    <div class="country-btn" data-country="TW" onclick="selectCountry('TW')">ğŸ‡¹ğŸ‡¼ å°æ¹¾</div>
                </div>

                <!-- Shopeeå•†å“æƒ…å ±ãƒ»é–¢ç¨è¨­å®š -->
                <div class="form-grid">
                    <div class="form-section">
                        <h4><i class="fas fa-box"></i> å•†å“æƒ…å ±</h4>
                        <div class="form-group">
                            <label>å•†å“ã‚¿ã‚¤ãƒˆãƒ«</label>
                            <input type="text" id="shopeeTitle" placeholder="ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³ Bluetooth">
                        </div>
                        <div class="form-group">
                            <label>ä»•å…¥ã‚Œä¾¡æ ¼ (å††)</label>
                            <input type="number" id="shopeePurchasePrice" placeholder="3000">
                        </div>
                        <div class="form-group">
                            <label>è²©å£²ä¾¡æ ¼ (ç¾åœ°é€šè²¨)</label>
                            <input type="number" id="shopeeSellPrice" placeholder="100" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>é€æ–™ (ç¾åœ°é€šè²¨)</label>
                            <input type="number" id="shopeeShipping" placeholder="10" step="0.01">
                        </div>
                    </div>

                    <div class="form-section">
                        <h4><i class="fas fa-globe-asia"></i> <span id="countryTitle">ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«</span> é–¢ç¨è¨­å®š</h4>
                        <div class="form-group">
                            <label>é–¢ç¨ç‡ (%)</label>
                            <input type="number" id="shopeeTariffRate" value="7.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>GST/VAT (%)</label>
                            <input type="number" id="shopeeVatRate" value="7.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>å…ç¨é¡ (ç¾åœ°é€šè²¨)</label>
                            <input type="number" id="shopeeDutyFree" value="400">
                        </div>
                        <div class="form-group">
                            <label>é¸æŠå›½é€šè²¨</label>
                            <input type="text" id="selectedCountry" readonly value="ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ« (SGD)">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary btn-calculate" onclick="calculateShopee()">
                    <i class="fas fa-calculator"></i> Shopee 7ã‚«å›½åˆ©ç›Šè¨ˆç®—å®Ÿè¡Œ
                </button>
            </div>
        </div>

        <!-- æ®µéšæ‰‹æ•°æ–™ç®¡ç†ã‚¿ãƒ– -->
        <div id="fees" class="tab">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-tags"></i> eBayæ®µéšæ‰‹æ•°æ–™ç®¡ç†
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-info" onclick="updateFeesAPI()">
                            <i class="fas fa-sync"></i> APIæ›´æ–°
                        </button>
                        <button class="btn btn-warning" onclick="editFees()">
                            <i class="fas fa-edit"></i> æ‰‹æ•°æ–™ç·¨é›†
                        </button>
                    </div>
                </div>

                <!-- æ®µéšæ‰‹æ•°æ–™ãƒ†ãƒ¼ãƒ–ãƒ« -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼ID</th>
                            <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼å</th>
                            <th>Tier1æ‰‹æ•°æ–™</th>
                            <th>Tier1é–¾å€¤</th>
                            <th>Tier2æ‰‹æ•°æ–™</th>
                            <th>Insertion Fee</th>
                            <th>æœ€çµ‚æ›´æ–°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>293</td>
                            <td>Consumer Electronics</td>
                            <td>10.0%</td>
                            <td>$7,500</td>
                            <td>12.35%</td>
                            <td>$0.35</td>
                            <td>2025-09-17</td>
                        </tr>
                        <tr>
                            <td>11450</td>
                            <td>Clothing & Accessories</td>
                            <td>12.9%</td>
                            <td>$10,000</td>
                            <td>14.70%</td>
                            <td>$0.30</td>
                            <td>2025-09-17</td>
                        </tr>
                        <tr>
                            <td>58058</td>
                            <td>Collectibles</td>
                            <td>9.15%</td>
                            <td>$5,000</td>
                            <td>11.70%</td>
                            <td>$0.35</td>
                            <td>2025-09-17</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- åˆ©ç›Šç‡è¨­å®šã‚¿ãƒ– -->
        <div id="settings" class="tab">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-sliders-h"></i> éšå±¤å‹åˆ©ç›Šç‡è¨­å®š
                    </h3>
                    <button class="btn btn-primary" onclick="addProfitRule()">
                        <i class="fas fa-plus"></i> æ–°è¦è¨­å®šè¿½åŠ 
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: var(--space-xl);">
                    <div style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: var(--space-lg);">
                        <h4><i class="fas fa-globe"></i> ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š</h4>
                        <div class="form-group">
                            <label>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›®æ¨™åˆ©ç›Šç‡ (%)</label>
                            <input type="number" id="globalMargin" value="25.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>æœ€ä½åˆ©ç›Šé¡ (USD)</label>
                            <input type="number" id="globalMinProfit" value="5.00" step="0.01">
                        </div>
                    </div>

                    <div style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: var(--space-lg);">
                        <h4><i class="fas fa-layer-group"></i> å„ªå…ˆé †ä½</h4>
                        <div style="background: var(--bg-secondary); padding: var(--space-md); border-radius: var(--radius-md);">
                            <div style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--border-color);">
                                <strong>1. æœŸé–“åˆ¥è¨­å®š</strong> (æœ€é«˜å„ªå…ˆ)
                            </div>
                            <div style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--border-color);">
                                <strong>2. ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³åˆ¥</strong> (é«˜å„ªå…ˆ)
                            </div>
                            <div style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--border-color);">
                                <strong>3. ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥</strong> (ä¸­å„ªå…ˆ)
                            </div>
                            <div style="padding: var(--space-sm) 0;">
                                <strong>4. ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š</strong> (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ©ç›Šç‡è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ« -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>è¨­å®šã‚¿ã‚¤ãƒ—</th>
                            <th>å¯¾è±¡å€¤</th>
                            <th>ç›®æ¨™åˆ©ç›Šç‡</th>
                            <th>æœ€ä½åˆ©ç›Šé¡</th>
                            <th>å„ªå…ˆé †ä½</th>
                            <th>çŠ¶æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span style="color: var(--success);">æœŸé–“</span></td>
                            <td>30æ—¥çµŒé</td>
                            <td>15.0%</td>
                            <td>$2.00</td>
                            <td>50</td>
                            <td><span style="color: var(--success);">æœ‰åŠ¹</span></td>
                        </tr>
                        <tr>
                            <td><span style="color: var(--info);">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³</span></td>
                            <td>æ–°å“</td>
                            <td>28.0%</td>
                            <td>$7.00</td>
                            <td>200</td>
                            <td><span style="color: var(--success);">æœ‰åŠ¹</span></td>
                        </tr>
                        <tr>
                            <td><span style="color: var(--warning);">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span></td>
                            <td>Electronics (293)</td>
                            <td>30.0%</td>
                            <td>$8.00</td>
                            <td>100</td>
                            <td><span style="color: var(--success);">æœ‰åŠ¹</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚¿ãƒ– -->
        <div id="rates" class="tab">
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-exchange-alt"></i> ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆç®¡ç†
                    </h3>
                    <button class="btn btn-info" onclick="updateRates()">
                        <i class="fas fa-sync"></i> ãƒ¬ãƒ¼ãƒˆæ›´æ–°
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: var(--space-xl);">
                    <div style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: var(--space-lg);">
                        <h4><i class="fas fa-chart-line"></i> USD/JPY</h4>
                        <div style="text-align: center; padding: var(--space-lg);">
                            <div style="font-size: 2.5rem; font-weight: 700; color: var(--calc-primary); margin-bottom: var(--space-sm);">
                                Â¥148.50
                            </div>
                            <div style="color: var(--text-muted);">1 USD = 148.50 JPY</div>
                            <div style="font-size: 0.875rem; color: var(--text-muted); margin-top: var(--space-sm);">
                                æœ€çµ‚æ›´æ–°: 2025-09-17 14:30
                            </div>
                        </div>
                    </div>

                    <div style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: var(--space-lg);">
                        <h4><i class="fas fa-globe-asia"></i> Shopeeå„å›½ãƒ¬ãƒ¼ãƒˆ</h4>
                        <div style="display: grid; gap: var(--space-sm);">
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡¸ğŸ‡¬ SGD:</span><span>Â¥110.45</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡²ğŸ‡¾ MYR:</span><span>Â¥33.78</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡¹ğŸ‡­ THB:</span><span>Â¥4.23</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡»ğŸ‡³ VND:</span><span>Â¥0.0061</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡µğŸ‡­ PHP:</span><span>Â¥2.68</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡®ğŸ‡© IDR:</span><span>Â¥0.0098</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ğŸ‡¹ğŸ‡¼ TWD:</span><span>Â¥4.75</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentMode = 'ddp';
        let selectedCountry = 'SG';
        let exchangeRates = {
            USD: 148.50, SGD: 110.45, MYR: 33.78, THB: 4.23,
            VND: 0.0061, PHP: 2.68, IDR: 0.0098, TWD: 4.75
        };

        // å›½åˆ¥è¨­å®š
        const countrySettings = {
            'SG': { name: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«', currency: 'SGD', tariff: 7.0, vat: 7.0, dutyFree: 400, commission: 6.0 },
            'MY': { name: 'ãƒãƒ¬ãƒ¼ã‚·ã‚¢', currency: 'MYR', tariff: 15.0, vat: 10.0, dutyFree: 500, commission: 5.5 },
            'TH': { name: 'ã‚¿ã‚¤', currency: 'THB', tariff: 20.0, vat: 7.0, dutyFree: 1500, commission: 5.0 },
            'PH': { name: 'ãƒ•ã‚£ãƒªãƒ”ãƒ³', currency: 'PHP', tariff: 25.0, vat: 12.0, dutyFree: 10000, commission: 5.5 },
            'ID': { name: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢', currency: 'IDR', tariff: 30.0, vat: 11.0, dutyFree: 75, commission: 5.0 },
            'VN': { name: 'ãƒ™ãƒˆãƒŠãƒ ', currency: 'VND', tariff: 35.0, vat: 10.0, dutyFree: 200, commission: 6.0 },
            'TW': { name: 'å°æ¹¾', currency: 'TWD', tariff: 10.0, vat: 5.0, dutyFree: 2000, commission: 5.5 }
        };

        // æ®µéšæ‰‹æ•°æ–™è¨­å®š
        const tieredFees = {
            '293': { tier1: 10.0, tier2: 12.35, threshold: 7500, insertion: 0.35 },
            '11450': { tier1: 12.9, tier2: 14.70, threshold: 10000, insertion: 0.30 },
            '58058': { tier1: 9.15, tier2: 11.70, threshold: 5000, insertion: 0.35 },
            '267': { tier1: 15.0, tier2: 15.0, threshold: Infinity, insertion: 0.30 },
            '550': { tier1: 12.9, tier2: 15.0, threshold: 10000, insertion: 0.35 }
        };

        // DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ åˆ©ç›Šè¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨çµ±åˆç‰ˆ åˆæœŸåŒ–é–‹å§‹');
            updateTieredFees();
            updateRateDisplays();
            console.log('âœ… åˆæœŸåŒ–å®Œäº†');
        });

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // é«˜ç²¾åº¦åˆ©ç›Šè¨ˆç®—
        function calculateAdvanced() {
            try {
                const data = {
                    yahooPrice: parseFloat(document.getElementById('yahooPrice').value) || 0,
                    domesticShipping: parseFloat(document.getElementById('domesticShipping').value) || 0,
                    outsourceFee: parseFloat(document.getElementById('outsourceFee').value) || 0,
                    packagingFee: parseFloat(document.getElementById('packagingFee').value) || 0,
                    assumedPrice: parseFloat(document.getElementById('assumedPrice').value) || 0,
                    assumedShipping: parseFloat(document.getElementById('assumedShipping').value) || 0,
                    daysSince: parseInt(document.getElementById('daysSince').value) || 0,
                    category: document.getElementById('ebayCategory').value,
                    condition: document.getElementById('itemCondition').value,
                    strategy: document.getElementById('strategy').value
                };

                if (!validateData(data)) return;

                const result = performAdvancedCalculation(data);
                displayResults(result);
                showRecommendation(result);
                
            } catch (error) {
                console.error('è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
        function validateData(data) {
            if (data.yahooPrice <= 0 || data.assumedPrice <= 0) {
                alert('Yahooä¾¡æ ¼ã¨æƒ³å®šè²©å£²ä¾¡æ ¼ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return false;
            }
            return true;
        }

        // é«˜ç²¾åº¦è¨ˆç®—å®Ÿè¡Œ
        function performAdvancedCalculation(data) {
            // æ®µéšæ‰‹æ•°æ–™è¨ˆç®—
            const fees = tieredFees[data.category] || tieredFees['293'];
            const feeRate = data.assumedPrice >= fees.threshold ? fees.tier2 : fees.tier1;
            
            // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³è¾¼ã¿ï¼‰
            const safeRate = exchangeRates.USD * 1.05; // 5%ãƒãƒ¼ã‚¸ãƒ³
            
            // ã‚³ã‚¹ãƒˆè¨ˆç®—
            const totalCostJPY = data.yahooPrice + data.domesticShipping + data.outsourceFee + data.packagingFee;
            const totalCostUSD = totalCostJPY / safeRate;
            
            // åå…¥è¨ˆç®—
            const totalRevenueUSD = data.assumedPrice + data.assumedShipping;
            
            // æ‰‹æ•°æ–™è¨ˆç®—
            const finalValueFee = data.assumedPrice * (feeRate / 100);
            const insertionFee = fees.insertion;
            const paypalFee = data.assumedPrice * 0.034 + 0.30;
            const internationalFee = data.assumedPrice * 0.013;
            const totalFeesUSD = finalValueFee + insertionFee + paypalFee + internationalFee;
            
            // éšå±¤å‹åˆ©ç›Šç‡è¨­å®šé©ç”¨
            const profitSettings = getHierarchicalSettings(data);
            
            // åˆ©ç›Šè¨ˆç®—
            const netProfitUSD = totalRevenueUSD - totalCostUSD - totalFeesUSD;
            const profitMargin = (netProfitUSD / totalRevenueUSD) * 100;
            const roi = (netProfitUSD / totalCostUSD) * 100;
            
            // æ¨å¥¨ä¾¡æ ¼è¨ˆç®—
            const recommendedPrice = calculateRecommendedPrice(totalCostUSD, totalFeesUSD, data.assumedShipping, profitSettings.targetMargin);
            const breakEvenPrice = totalCostUSD + totalFeesUSD + data.assumedShipping;
            
            return {
                totalRevenue: totalRevenueUSD,
                totalCost: totalCostUSD,
                totalFees: totalFeesUSD,
                netProfit: netProfitUSD,
                profitMargin: profitMargin,
                roi: roi,
                recommendedPrice: recommendedPrice,
                breakEven: breakEvenPrice,
                appliedSettings: profitSettings,
                feeDetails: { rate: feeRate, tier: data.assumedPrice >= fees.threshold ? 2 : 1 }
            };
        }

        // éšå±¤å‹åˆ©ç›Šç‡è¨­å®šå–å¾—
        function getHierarchicalSettings(data) {
            const settings = [
                {
                    priority: 50,
                    condition: () => data.daysSince >= 30,
                    targetMargin: data.daysSince >= 60 ? 10 : 15,
                    minProfit: 2.00,
                    type: 'æœŸé–“',
                    description: `${data.daysSince}æ—¥çµŒé`
                },
                {
                    priority: 150,
                    condition: () => data.condition === 'New',
                    targetMargin: 28,
                    minProfit: 7.00,
                    type: 'ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³',
                    description: 'æ–°å“'
                },
                {
                    priority: 160,
                    condition: () => data.condition === 'Refurbished',
                    targetMargin: 25,
                    minProfit: 5.00,
                    type: 'ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³',
                    description: 'ãƒªãƒ•ã‚¡ãƒ“ãƒƒã‚·ãƒ¥å“'
                },
                {
                    priority: 170,
                    condition: () => data.condition === 'ForParts',
                    targetMargin: 15,
                    minProfit: 2.00,
                    type: 'ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³',
                    description: 'ã‚¸ãƒ£ãƒ³ã‚¯å“'
                },
                {
                    priority: 250,
                    condition: () => data.category === '293',
                    targetMargin: 30,
                    minProfit: 8.00,
                    type: 'ã‚«ãƒ†ã‚´ãƒªãƒ¼',
                    description: 'Electronics'
                },
                {
                    priority: 1000,
                    condition: () => true,
                    targetMargin: 25,
                    minProfit: 5.00,
                    type: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«',
                    description: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'
                }
            ];

            // è²©å£²æˆ¦ç•¥èª¿æ•´
            const strategyAdjustments = {
                'quick': -5, 'premium': 10, 'volume': -3, 'standard': 0
            };
            const adjustment = strategyAdjustments[data.strategy] || 0;

            settings.sort((a, b) => a.priority - b.priority);
            const appliedSetting = settings.find(setting => setting.condition());

            return {
                targetMargin: appliedSetting.targetMargin + adjustment,
                minProfit: appliedSetting.minProfit,
                type: appliedSetting.type,
                description: appliedSetting.description,
                strategyAdjustment: adjustment
            };
        }

        // æ¨å¥¨ä¾¡æ ¼è¨ˆç®—
        function calculateRecommendedPrice(totalCost, totalFees, shipping, targetMargin) {
            return (totalCost + totalFees + shipping) / (1 - targetMargin / 100);
        }

        // çµæœè¡¨ç¤º
        function displayResults(result) {
            document.getElementById('resultGrid').style.display = 'grid';
            document.getElementById('resultGrid').classList.add('bounce-in');
            
            document.getElementById('totalRevenue').textContent = `${result.totalRevenue.toFixed(2)}`;
            document.getElementById('totalCost').textContent = `${result.totalCost.toFixed(2)}`;
            document.getElementById('totalFees').textContent = `${result.totalFees.toFixed(2)}`;
            document.getElementById('netProfit').textContent = `${result.netProfit.toFixed(2)}`;
            document.getElementById('profitMargin').textContent = `${result.profitMargin.toFixed(1)}%`;
            document.getElementById('roi').textContent = `${result.roi.toFixed(1)}%`;
            document.getElementById('recommendedPrice').textContent = `${result.recommendedPrice.toFixed(2)}`;
            document.getElementById('breakEven').textContent = `${result.breakEven.toFixed(2)}`;
            
            // è‰²åˆ†ã‘
            const profitElement = document.getElementById('netProfit');
            const marginElement = document.getElementById('profitMargin');
            const roiElement = document.getElementById('roi');
            
            if (result.netProfit > 10) {
                profitElement.className = 'result-value';
            } else if (result.netProfit > 3) {
                profitElement.className = 'result-value warning';
            } else {
                profitElement.className = 'result-value negative';
            }
            
            if (result.profitMargin > 20) {
                marginElement.className = 'result-value';
            } else if (result.profitMargin > 10) {
                marginElement.className = 'result-value warning';
            } else {
                marginElement.className = 'result-value negative';
            }
            
            if (result.roi > 25) {
                roiElement.className = 'result-value';
            } else if (result.roi > 15) {
                roiElement.className = 'result-value warning';
            } else {
                roiElement.className = 'result-value negative';
            }
        }

        // æ¨å¥¨äº‹é …è¡¨ç¤º
        function showRecommendation(result) {
            const recommendationDiv = document.getElementById('recommendation');
            const recommendationText = document.getElementById('recommendationText');
            
            let recommendations = [];
            
            if (result.netProfit <= 0) {
                recommendations.push('ğŸ”´ <strong>æå¤±ç™ºç”Ÿ</strong>: ã“ã®è¨­å®šã§ã¯æå¤±ãŒç™ºç”Ÿã—ã¾ã™ã€‚');
                recommendations.push(`ğŸ“ˆ æç›Šåˆ†å²ç‚¹: ${result.breakEven.toFixed(2)} ä»¥ä¸Šã§ã®è²©å£²ãŒå¿…è¦ã§ã™ã€‚`);
            } else if (result.profitMargin < 5) {
                recommendations.push('âš ï¸ <strong>ä½åˆ©ç›Šç‡è­¦å‘Š</strong>: åˆ©ç›Šç‡ãŒ5%ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™ã€‚');
            } else if (result.profitMargin < 15) {
                recommendations.push('ğŸŸ¡ <strong>åˆ©ç›Šç‡æ”¹å–„ææ¡ˆ</strong>: åˆ©ç›Šç‡ãŒä½ã‚ã§ã™ã€‚ä¾¡æ ¼èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚');
            } else if (result.profitMargin < 25) {
                recommendations.push('âœ… <strong>æ¨™æº–çš„åˆ©ç›Šç‡</strong>: è¨±å®¹ç¯„å›²å†…ã§ã™ãŒã€æœ€é©åŒ–ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚');
            } else {
                recommendations.push('ğŸ‰ <strong>å„ªç§€ãªåˆ©ç›Šç‡</strong>: éå¸¸ã«è‰¯å¥½ãªåˆ©ç›Šç‡ã§ã™ï¼');
            }
            
            if (result.feeDetails.tier === 2) {
                recommendations.push(`ğŸ’¡ <strong>æ®µéšæ‰‹æ•°æ–™é©ç”¨</strong>: Tier${result.feeDetails.tier} (${result.feeDetails.rate}%) ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`);
            }
            
            recommendations.push(`âš™ï¸ <strong>é©ç”¨è¨­å®š</strong>: ${result.appliedSettings.type}è¨­å®šã«ã‚ˆã‚‹ç›®æ¨™åˆ©ç›Šç‡ ${result.appliedSettings.targetMargin}% ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`);
            
            if (result.netProfit < result.appliedSettings.minProfit) {
                recommendations.push(`ğŸ¯ <strong>ä¾¡æ ¼ææ¡ˆ</strong>: æœ€ä½åˆ©ç›Šé¡ç¢ºä¿ã®ãŸã‚ ${result.recommendedPrice.toFixed(2)} ã§ã®è²©å£²ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`);
            }
            
            recommendationText.innerHTML = recommendations.join('<br><br>');
            recommendationDiv.style.display = 'block';
        }

        // eBay USAè¨ˆç®—
        function calculateEbay() {
            try {
                const data = {
                    title: document.getElementById('ebayTitle').value,
                    purchasePrice: parseFloat(document.getElementById('ebayPurchasePrice').value) || 0,
                    sellPrice: parseFloat(document.getElementById('ebaySellPrice').value) || 0,
                    shipping: parseFloat(document.getElementById('ebayShipping').value) || 0,
                    category: document.getElementById('ebayProductCategory').value,
                    condition: document.getElementById('ebayCondition').value,
                    weight: parseFloat(document.getElementById('ebayWeight').value) || 0,
                    mode: currentMode,
                    outsourceFee: parseFloat(document.getElementById('ebayOutsourceFee').value) || 0,
                    packagingFee: parseFloat(document.getElementById('ebayPackagingFee').value) || 0,
                    exchangeMargin: parseFloat(document.getElementById('ebayMargin').value) || 5.0
                };

                if (!data.title || data.purchasePrice <= 0 || data.sellPrice <= 0) {
                    alert('å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const result = performEbayCalculation(data);
                displayEbayResults(result);
                
            } catch (error) {
                console.error('eBayè¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
        }

        // eBayè¨ˆç®—å®Ÿè¡Œ
        function performEbayCalculation(data) {
            const safeRate = exchangeRates.USD * (1 + data.exchangeMargin / 100);
            const totalCostJPY = data.purchasePrice + data.outsourceFee + data.packagingFee;
            const revenueUSD = data.sellPrice + data.shipping;
            
            // é–¢ç¨è¨ˆç®—ï¼ˆDDPæ™‚ã®ã¿ï¼‰
            const tariffRates = { electronics: 7.5, textiles: 12.0, other: 5.0 };
            const tariffUSD = (data.mode === 'ddp') ? (revenueUSD * (tariffRates[data.category] || 5.0) / 100) : 0;
            
            // æ‰‹æ•°æ–™è¨ˆç®—
            const finalValueFee = revenueUSD * 0.129;
            const paypalFee = revenueUSD * 0.0349 + 0.49;
            const totalFeesUSD = finalValueFee + paypalFee;
            
            // åˆ©ç›Šè¨ˆç®—
            const netRevenueUSD = revenueUSD - tariffUSD - totalFeesUSD;
            const netRevenueJPY = netRevenueUSD * safeRate;
            const profitJPY = netRevenueJPY - totalCostJPY;
            const marginPercent = (profitJPY / netRevenueJPY) * 100;
            const roiPercent = (profitJPY / totalCostJPY) * 100;
            
            return {
                platform: 'eBay USA',
                mode: data.mode.toUpperCase(),
                profitJPY: Math.round(profitJPY),
                marginPercent: marginPercent.toFixed(2),
                roiPercent: roiPercent.toFixed(2),
                tariffJPY: Math.round(tariffUSD * safeRate),
                revenueJPY: Math.round(netRevenueJPY),
                totalCostJPY: Math.round(totalCostJPY)
            };
        }

        // eBayçµæœè¡¨ç¤º
        function displayEbayResults(result) {
            alert(`ğŸ‡ºğŸ‡¸ eBay USAè¨ˆç®—çµæœ (${result.mode})\n\nğŸ’° ç´”åˆ©ç›Š: Â¥${result.profitJPY.toLocaleString()}\nğŸ“Š åˆ©ç›Šç‡: ${result.marginPercent}%\nğŸ“ˆ ROI: ${result.roiPercent}%\nğŸ›ï¸ é–¢ç¨: Â¥${result.tariffJPY.toLocaleString()}\n\nãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ : ${result.platform}`);
        }

        // Shopeeè¨ˆç®—
        function calculateShopee() {
            try {
                const data = {
                    title: document.getElementById('shopeeTitle').value,
                    purchasePrice: parseFloat(document.getElementById('shopeePurchasePrice').value) || 0,
                    sellPrice: parseFloat(document.getElementById('shopeeSellPrice').value) || 0,
                    shipping: parseFloat(document.getElementById('shopeeShipping').value) || 0,
                    country: selectedCountry,
                    tariffRate: parseFloat(document.getElementById('shopeeTariffRate').value) || 0,
                    vatRate: parseFloat(document.getElementById('shopeeVatRate').value) || 0,
                    dutyFree: parseFloat(document.getElementById('shopeeDutyFree').value) || 0
                };

                if (!data.title || data.purchasePrice <= 0 || data.sellPrice <= 0) {
                    alert('å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const result = performShopeeCalculation(data);
                displayShopeeResults(result);
                
            } catch (error) {
                console.error('Shopeeè¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                alert('è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
        }

        // Shopeeè¨ˆç®—å®Ÿè¡Œ
        function performShopeeCalculation(data) {
            const settings = countrySettings[data.country];
            const exchangeRate = exchangeRates[settings.currency];
            const totalCostJPY = data.purchasePrice + 300 + 150 + 500; // å¤–æ³¨+æ¢±åŒ…+å›½éš›é€æ–™
            const revenueLocal = data.sellPrice + data.shipping;
            
            // é–¢ç¨ãƒ»ç¨è¨ˆç®—
            const taxableAmount = Math.max(0, revenueLocal - data.dutyFree);
            const tariffAmount = taxableAmount * (data.tariffRate / 100);
            const vatAmount = (taxableAmount + tariffAmount) * (data.vatRate / 100);
            const totalTaxLocal = tariffAmount + vatAmount;
            
            // Shopeeæ‰‹æ•°æ–™
            const commissionFee = revenueLocal * (settings.commission / 100);
            const transactionFee = revenueLocal * 0.024;
            const totalFeesLocal = commissionFee + transactionFee;
            
            // åˆ©ç›Šè¨ˆç®—
            const netRevenueLocal = revenueLocal - totalTaxLocal - totalFeesLocal;
            const netRevenueJPY = netRevenueLocal * exchangeRate;
            const profitJPY = netRevenueJPY - totalCostJPY;
            const marginPercent = (profitJPY / netRevenueJPY) * 100;
            const roiPercent = (profitJPY / totalCostJPY) * 100;
            
            return {
                platform: 'Shopee',
                country: settings.name,
                currency: settings.currency,
                profitJPY: Math.round(profitJPY),
                marginPercent: marginPercent.toFixed(2),
                roiPercent: roiPercent.toFixed(2),
                tariffJPY: Math.round(totalTaxLocal * exchangeRate),
                revenueJPY: Math.round(netRevenueJPY),
                totalCostJPY: Math.round(totalCostJPY)
            };
        }

        // Shopeeçµæœè¡¨ç¤º
        function displayShopeeResults(result) {
            alert(`ğŸ›’ Shopee ${result.country}è¨ˆç®—çµæœ\n\nğŸ’° ç´”åˆ©ç›Š: Â¥${result.profitJPY.toLocaleString()}\nğŸ“Š åˆ©ç›Šç‡: ${result.marginPercent}%\nğŸ“ˆ ROI: ${result.roiPercent}%\nğŸ›ï¸ é–¢ç¨ãƒ»ç¨: Â¥${result.tariffJPY.toLocaleString()}\nğŸ’± é€šè²¨: ${result.currency}`);
        }

        // æ®µéšæ‰‹æ•°æ–™æ›´æ–°
        function updateTieredFees() {
            const categoryId = document.getElementById('ebayCategory').value;
            const assumedPrice = parseFloat(document.getElementById('assumedPrice').value) || 120;
            
            const fees = tieredFees[categoryId] || tieredFees['293'];
            const applicableFee = assumedPrice >= fees.threshold ? fees.tier2 : fees.tier1;
            
            document.getElementById('tier1Rate').textContent = `${fees.tier1}%`;
            document.getElementById('tier2Rate').textContent = `${fees.tier2}%`;
            document.getElementById('appliedRate').textContent = `${applicableFee}%`;
            document.getElementById('insertionFee').textContent = `${fees.insertion}`;
        }

        // ãƒ¬ãƒ¼ãƒˆè¡¨ç¤ºæ›´æ–°
        function updateRateDisplays() {
            const safeRate = exchangeRates.USD * 1.05;
            document.getElementById('currentRate').textContent = `1 USD = Â¥${exchangeRates.USD}`;
            document.getElementById('safeRate').textContent = `1 USD = Â¥${safeRate.toFixed(2)}`;
        }

        // ãƒ¢ãƒ¼ãƒ‰é¸æŠ
        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('selected');
        }

        // å›½é¸æŠ
        function selectCountry(country) {
            selectedCountry = country;
            document.querySelectorAll('.country-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-country="${country}"]`).classList.add('selected');
            
            const settings = countrySettings[country];
            document.getElementById('countryTitle').textContent = settings.name;
            document.getElementById('selectedCountry').value = `${settings.name} (${settings.currency})`;
            document.getElementById('shopeeTariffRate').value = settings.tariff;
            document.getElementById('shopeeVatRate').value = settings.vat;
            document.getElementById('shopeeDutyFree').value = settings.dutyFree;
        }

        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ»è¨­å®šä¿å­˜æ©Ÿèƒ½
        function loadSample() {
            document.getElementById('yahooPrice').value = '15000';
            document.getElementById('domesticShipping').value = '800';
            document.getElementById('outsourceFee').value = '500';
            document.getElementById('packagingFee').value = '200';
            document.getElementById('assumedPrice').value = '120.00';
            document.getElementById('assumedShipping').value = '15.00';
            document.getElementById('ebayCategory').value = '293';
            document.getElementById('itemCondition').value = 'Used';
            document.getElementById('strategy').value = 'standard';
            updateTieredFees();
        }

        function loadAdvanced() {
            document.getElementById('yahooPrice').value = '75000';
            document.getElementById('domesticShipping').value = '1200';
            document.getElementById('outsourceFee').value = '1000';
            document.getElementById('packagingFee').value = '500';
            document.getElementById('assumedPrice').value = '899.99';
            document.getElementById('assumedShipping').value = '35.00';
            document.getElementById('ebayCategory').value = '293';
            document.getElementById('itemCondition').value = 'New';
            document.getElementById('strategy').value = 'premium';
            updateTieredFees();
            setTimeout(() => calculateAdvanced(), 500);
        }

        function loadEbayPreset() {
            document.getElementById('ebayTitle').value = 'iPhone 15 Pro Max 256GB Space Black';
            document.getElementById('ebayPurchasePrice').value = '150000';
            document.getElementById('ebaySellPrice').value = '1200';
            document.getElementById('ebayShipping').value = '25';
            document.getElementById('ebayProductCategory').value = 'electronics';
            document.getElementById('ebayCondition').value = 'New';
            document.getElementById('ebayWeight').value = '0.5';
        }

        function loadShopeePreset() {
            document.getElementById('shopeeTitle').value = 'ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³ Bluetooth 5.0 ANC';
            document.getElementById('shopeePurchasePrice').value = '3000';
            document.getElementById('shopeeSellPrice').value = '100';
            document.getElementById('shopeeShipping').value = '10';
        }

        function clearAll() {
            document.getElementById('yahooPrice').value = '';
            document.getElementById('domesticShipping').value = '';
            document.getElementById('outsourceFee').value = '';
            document.getElementById('packagingFee').value = '';
            document.getElementById('assumedPrice').value = '';
            document.getElementById('assumedShipping').value = '';
            document.getElementById('daysSince').value = '0';
            document.getElementById('resultGrid').style.display = 'none';
            document.getElementById('recommendation').style.display = 'none';
        }

        // è¨­å®šä¿å­˜æ©Ÿèƒ½
        function saveEbayConfig() {
            const configName = prompt('eBayè¨­å®šåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:', 'eBay_' + new Date().toLocaleDateString());
            if (configName) {
                localStorage.setItem(`ebay_config_${configName}`, JSON.stringify({
                    type: 'ebay',
                    name: configName,
                    saved: new Date().toISOString()
                }));
                alert(`eBayè¨­å®šã€Œ${configName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚`);
            }
        }

        function saveShopeeConfig() {
            const configName = prompt('Shopeeè¨­å®šåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:', `Shopee_${selectedCountry}_` + new Date().toLocaleDateString());
            if (configName) {
                localStorage.setItem(`shopee_config_${configName}`, JSON.stringify({
                    type: 'shopee',
                    name: configName,
                    country: selectedCountry,
                    saved: new Date().toISOString()
                }));
                alert(`Shopeeè¨­å®šã€Œ${configName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚`);
            }
        }

        // é«˜åº¦æ©Ÿèƒ½ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
        function updateFeesAPI() {
            const btn = event.target;
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ›´æ–°ä¸­...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = original;
                btn.disabled = false;
                alert('ğŸ“¡ eBay APIã‹ã‚‰æœ€æ–°ã®æ®µéšæ‰‹æ•°æ–™æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n\nâ€¢ Consumer Electronics: Tier1 10.0% â†’ Tier2 12.35% @$7,500\nâ€¢ Clothing: Tier1 12.9% â†’ Tier2 14.70% @$10,000\nâ€¢ Collectibles: Tier1 9.15% â†’ Tier2 11.70% @$5,000');
            }, 2000);
        }

        function editFees() {
            alert('ğŸ–Šï¸ æ®µéšæ‰‹æ•°æ–™ç·¨é›†æ©Ÿèƒ½\n\nâ€¢ Tier1/Tier2æ‰‹æ•°æ–™ç‡ã®å€‹åˆ¥è¨­å®š\nâ€¢ é–¾å€¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½\nâ€¢ ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥æ®µéšè¨­å®š\nâ€¢ APIæ›´æ–°ä¿è­·æ©Ÿèƒ½\n\nâ€» å®Œå…¨ç‰ˆã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚');
        }

        function addProfitRule() {
            alert('â• éšå±¤å‹åˆ©ç›Šç‡è¨­å®šè¿½åŠ \n\næ–°è¦è¨­å®šã‚¿ã‚¤ãƒ—ï¼š\nâ€¢ æœŸé–“åˆ¥è¨­å®šï¼ˆå‡ºå“æ—¥æ•°ï¼‰\nâ€¢ ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³åˆ¥è¨­å®š\nâ€¢ ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥è¨­å®š\nâ€¢ ä¾¡æ ¼å¸¯åˆ¥è¨­å®š\nâ€¢ ã‚«ã‚¹ã‚¿ãƒ è¤‡åˆè¨­å®š\n\nâ€» å®Œå…¨ç‰ˆã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚');
        }

        function updateRates() {
            const btn = event.target;
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ›´æ–°ä¸­...';
            btn.disabled = true;
            
            setTimeout(() => {
                // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆå¤‰å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                Object.keys(exchangeRates).forEach(currency => {
                    const fluctuation = (Math.random() - 0.5) * 0.02; // Â±1%å¤‰å‹•
                    exchangeRates[currency] *= (1 + fluctuation);
                });
                
                updateRateDisplays();
                
                btn.innerHTML = original;
                btn.disabled = false;
                alert('ğŸ’± ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n\nğŸ‡ºğŸ‡¸ USD: Â¥' + exchangeRates.USD.toFixed(2) + '\nğŸ‡¸ğŸ‡¬ SGD: Â¥' + exchangeRates.SGD.toFixed(2) + '\nğŸ‡²ğŸ‡¾ MYR: Â¥' + exchangeRates.MYR.toFixed(2));
            }, 1500);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.getElementById('ebayCategory')?.addEventListener('change', updateTieredFees);
        document.getElementById('assumedPrice')?.addEventListener('input', updateTieredFees);

        // ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
        if (typeof window !== 'undefined') {
            window.ProfitCalculatorComplete = {
                calculateAdvanced,
                calculateEbay,
                calculateShopee,
                loadSample,
                loadAdvanced,
                loadEbayPreset,
                loadShopeePreset,
                clearAll,
                updateTieredFees,
                updateRates,
                showTab,
                selectMode,
                selectCountry,
                exchangeRates,
                countrySettings,
                tieredFees
            };
            
            console.log('ğŸ¯ åˆ©ç›Šè¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨çµ±åˆç‰ˆãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«åˆ©ç”¨å¯èƒ½');
            console.log('ğŸš€ ä¸»è¦æ©Ÿèƒ½: é«˜ç²¾åº¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»eBay DDP/DDUãƒ»Shopee 7ã‚«å›½ãƒ»æ®µéšæ‰‹æ•°æ–™ãƒ»éšå±¤å‹åˆ©ç›Šç‡ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç‚ºæ›¿');
            console.log('ä½¿ç”¨ä¾‹: ProfitCalculatorComplete.loadAdvanced()');
        }
    </script>
</body>
</html>
        