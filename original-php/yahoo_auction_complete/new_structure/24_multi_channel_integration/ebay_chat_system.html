                        <div class="template-tab" data-tab="custom" onclick="switchTemplateTab('custom', this)">
                            カスタム
                        </div>
                        <div class="template-tab" onclick="showTemplateManager()">
                            <i class="fas fa-plus"></i>
                        </div><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBayチャット管理システム - 4列完成版</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-hover: #e0f2fe;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --text-white: #ffffff;
            
            /* カラーパレット（画像のグラデーション） */
            --color-purple-light: #6439FF;
            --color-purple-dark: #4F75FF;
            --color-blue: #4F75FF;
            --color-cyan: #00CCDD;
            --color-cyan-light: #7CF5FF;
            
            /* ブルー系グラデーション */
            --blue-primary: #0ea5e9;
            --blue-secondary: #0284c7;
            --blue-accent: #0369a1;
            --blue-light: #7dd3fc;
            --blue-dark: #0c4a6e;
            
            --success: #16a34a;
            --warning: #d97706;
            --danger: #dc2626;
            --info: #0ea5e9;
            
            /* フォルダ識別カラー */
            --folder-inbox: #0ea5e9;
            --folder-unread: #dc2626;
            --folder-urgent: #ef4444;
            --folder-bookmarked: #f59e0b;
            --folder-replied: #16a34a;
            --folder-completed: #6b7280;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius-sm: 3px;
            --radius-md: 4px;
            --radius-lg: 6px;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --transition: all 0.2s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
            font-weight: 500;
            overflow-x: hidden;
        }

        /* メインコンテナ */
        .chat-container {
            padding: 5px;
            min-height: 100vh;
        }

        /* 独立トグルボタン */
        .toggle-buttons {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .main-toggle-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--blue-primary), var(--blue-secondary));
            border: none;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            color: var(--text-white);
            cursor: pointer;
            font-size: 16px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-toggle-btn:hover {
            background: linear-gradient(135deg, var(--blue-secondary), var(--blue-accent));
            transform: translateX(2px);
        }

        /* 4列レイアウト */
        .chat-layout {
            display: grid;
            grid-template-columns: 380px 200px 1fr 280px;
            gap: 6px;
            align-items: start;
            min-height: calc(100vh - 10px);
            transition: var(--transition);
        }

        /* 1列目が閉じた状態 */
        .chat-layout.left-collapsed {
            grid-template-columns: 0px 200px 1fr 280px;
        }

        /* 2列目が閉じた状態 */
        .chat-layout.history-collapsed {
            grid-template-columns: 380px 0px 1fr 280px;
        }

        /* 両方閉じた状態 */
        .chat-layout.both-collapsed {
            grid-template-columns: 0px 0px 1fr 280px;
        }

        /* ===== 1列目: フォルダパネル + メッセージカード ===== */
        .folder-panel {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: calc(100vh - 10px);
            transition: var(--transition);
        }

        .folder-panel.collapsed {
            width: 0;
            opacity: 0;
            transform: translateX(-100%);
        }

        .folder-header {
            padding: var(--space-2) var(--space-3);
            background: linear-gradient(135deg, var(--color-cyan-light), var(--color-cyan), var(--color-blue), var(--color-purple-dark));
            color: var(--text-white);
            text-align: center;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .folder-title {
            font-size: var(--text-base);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }

        /* 検索とボタンエリア復活 */
        .header-search-area {
            padding: var(--space-2);
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .header-actions {
            display: flex;
            gap: var(--space-2);
        }

        .header-btn {
            padding: var(--space-1) var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            color: var(--text-white);
            cursor: pointer;
            font-size: var(--text-xs);
            transition: var(--transition);
            position: relative;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: var(--text-white);
            font-size: 8px;
            font-weight: 700;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 14px;
            text-align: center;
        }

        .global-search {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--space-2) var(--space-2) var(--space-2) 35px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
            font-size: var(--text-sm);
            transition: var(--transition);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: var(--text-sm);
        }

        /* 3つのコントロール横並び */
        .controls-row {
            padding: var(--space-2);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--space-1);
            border-bottom: 1px solid #e2e8f0;
        }

        .control-select {
            padding: var(--space-1);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        /* フォルダボタン - 1列6個（横並び） */
        .folder-grid {
            padding: var(--space-2);
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: var(--space-1);
            border-bottom: 1px solid #e2e8f0;
        }

        .folder-item {
            padding: var(--space-1);
            background: var(--bg-tertiary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            position: relative;
            text-align: center;
        }

        .folder-item.active {
            background: var(--blue-primary);
            color: var(--text-white);
            border-color: var(--blue-primary);
        }

        .folder-item:hover:not(.active) {
            background: var(--bg-hover);
        }

        .folder-icon {
            font-size: var(--text-xs);
        }

        .folder-label {
            font-size: 9px;
            font-weight: 600;
            line-height: 1;
        }

        .folder-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: var(--text-white);
            font-size: 10px;
            font-weight: 700;
            padding: 2px 4px;
            border-radius: 8px;
            min-width: 16px;
            text-align: center;
            line-height: 1;
        }

        /* メッセージカード一覧 */
        .message-list {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-1);
        }

        .message-card {
            display: grid;
            grid-template-columns: 60px 1fr 60px;
            gap: var(--space-2);
            padding: var(--space-2);
            margin-bottom: var(--space-1);
            background: var(--bg-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            border-left: 4px solid var(--folder-inbox);
            min-height: 70px;
            align-items: start;
        }

        .message-card:hover {
            background: var(--bg-hover);
            transform: translateX(2px);
        }

        .message-card.selected {
            background: rgba(14, 165, 233, 0.1);
            border-color: var(--blue-primary);
            box-shadow: 0 0 0 1px var(--blue-primary);
        }

        /* フォルダ別左ボーダー色 */
        .message-card[data-folder="inbox"] { border-left-color: var(--folder-inbox); }
        .message-card[data-folder="unread"] { border-left-color: var(--folder-unread); }
        .message-card[data-folder="urgent"] { border-left-color: var(--folder-urgent); }
        .message-card[data-folder="bookmarked"] { border-left-color: var(--folder-bookmarked); }
        .message-card[data-folder="replied"] { border-left-color: var(--folder-replied); }
        .message-card[data-folder="completed"] { border-left-color: var(--folder-completed); }

        /* 商品画像（左側・高さいっぱい） */
        .message-product-image {
            width: 60px;
            height: 100%;
            background: var(--bg-primary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-placeholder {
            color: var(--text-tertiary);
            font-size: var(--text-sm);
        }

        /* メイン情報（中央） */
        .message-main {
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .message-sender {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .message-subject {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            margin-bottom: var(--space-1);
        }

        .message-product-title {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            margin-bottom: var(--space-1);
        }

        .message-preview {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        /* AI判定カテゴリバッジ */
        .ai-category-badge {
            font-size: 8px;
            font-weight: 600;
            padding: 2px 4px;
            border-radius: var(--radius-sm);
            text-transform: uppercase;
            margin-right: var(--space-1);
        }

        .category-product { background: rgba(139, 92, 246, 0.1); color: var(--color-purple-dark); }
        .category-shipping { background: rgba(14, 165, 233, 0.1); color: var(--color-blue); }
        .category-payment { background: rgba(22, 163, 74, 0.1); color: var(--success); }
        .category-return { background: rgba(217, 119, 6, 0.1); color: var(--warning); }
        .category-complaint { background: rgba(220, 38, 38, 0.1); color: var(--danger); }

        /* カード操作ボタン */
        .message-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            align-items: flex-end;
        }

        .action-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .bookmark-btn:hover, .bookmark-btn.active {
            color: #f59e0b;
        }

        /* メタ情報（右側） */
        .message-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: var(--space-1);
        }

        .message-time {
            font-size: 9px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        /* SOLDバッジ - 24px、白枠なし */
        .sold-badge {
            width: 24px;
            height: 24px;
            background: #dc2626;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px;
            font-weight: 700;
            color: var(--text-white);
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.4);
        }

        .inquiry-badge {
            font-size: 8px;
            font-weight: 700;
            padding: 3px 6px;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, var(--color-medium-blue), #1f4f7a);
            color: var(--text-white);
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(42, 98, 154, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        /* 店舗バッジ - サイズ拡大・カラーパレット使用 */
        .store-badge {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-weight: 700;
            border: 2px solid var(--bg-secondary);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .store-badge[data-store="alpha"] { background: var(--color-dark-blue); }
        .store-badge[data-store="beta"] { background: var(--color-medium-blue); }
        .store-badge[data-store="gamma"] { background: var(--color-orange); }
        .store-badge[data-store="delta"] { background: var(--color-yellow); color: var(--text-primary); }
        .store-badge[data-store="epsilon"] { background: var(--danger); }

        /* ===== 2列目: 商品別履歴パネル ===== */
        .history-panel {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: calc(100vh - 10px);
            transition: var(--transition);
        }

        .history-panel.collapsed {
            width: 0;
            opacity: 0;
            transform: translateX(-100%);
        }

        .history-header {
            padding: var(--space-2);
            background: linear-gradient(135deg, var(--blue-secondary), var(--blue-accent));
            color: var(--text-white);
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .history-title {
            font-size: var(--text-sm);
            font-weight: 600;
        }

        .history-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-1);
        }

        .history-card {
            padding: var(--space-2);
            margin-bottom: var(--space-1);
            background: var(--bg-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            border-left: 4px solid var(--folder-inbox);
            box-shadow: var(--shadow-sm);
        }

        .history-card:hover {
            background: var(--bg-hover);
            transform: translateX(2px);
        }

        .history-card.selected {
            background: rgba(14, 165, 233, 0.1);
            border-color: var(--blue-primary);
            box-shadow: 0 0 0 1px var(--blue-primary);
        }

        /* ===== 3列目: チャットパネル ===== */
        .chat-panel {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: calc(100vh - 10px);
        }

        .chat-header {
            padding: var(--space-2) var(--space-3);
            background: linear-gradient(135deg, var(--blue-accent), var(--blue-dark));
            color: var(--text-white);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 50px;
        }

        .chat-title {
            font-size: var(--text-base);
            font-weight: 600;
        }

        .chat-actions {
            display: flex;
            gap: var(--space-2);
        }

        .chat-action-btn {
            padding: var(--space-1) var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            color: var(--text-white);
            cursor: pointer;
            font-size: var(--text-xs);
            transition: var(--transition);
        }

        .chat-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-3);
            background: var(--bg-primary);
        }

        /* チャットメッセージ */
        .chat-message {
            margin-bottom: var(--space-3);
            display: flex;
            gap: var(--space-2);
        }

        .chat-message.sent {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--blue-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-size: var(--text-sm);
            font-weight: 600;
            flex-shrink: 0;
        }

        .chat-avatar.customer {
            background: var(--success);
        }

        .chat-message-content {
            flex: 1;
            max-width: 70%;
        }

        .chat-message-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-1);
            font-size: var(--text-xs);
            color: var(--text-secondary);
        }

        .chat-message.sent .chat-message-header {
            justify-content: flex-end;
        }

        .chat-bubble {
            background: var(--bg-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            font-size: var(--text-sm);
            line-height: 1.5;
        }

        .chat-message.sent .chat-bubble {
            background: var(--blue-primary);
            color: var(--text-white);
            border-color: var(--blue-primary);
        }

        .translation-toggle {
            margin-top: var(--space-2);
            padding: var(--space-1) var(--space-2);
            background: var(--bg-tertiary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .translation-toggle:hover {
            background: var(--info);
            color: var(--text-white);
        }

        .original-text {
            margin-top: var(--space-2);
            padding: var(--space-2);
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            color: var(--text-secondary);
            display: none;
        }

        /* 返信エリア */
        .chat-reply-section {
            border-top: 1px solid #e2e8f0;
            background: var(--bg-secondary);
            padding: var(--space-3);
        }

        /* テンプレートタブ */
        .template-tabs {
            display: flex;
            gap: var(--space-1);
            margin-bottom: var(--space-3);
            border-bottom: 1px solid #e2e8f0;
        }

        .template-tab {
            padding: var(--space-2) var(--space-3);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: none;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            font-size: var(--text-xs);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .template-tab.active {
            background: var(--blue-primary);
            color: var(--text-white);
        }

        .template-content {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--space-2);
            margin-bottom: var(--space-3);
            max-height: 120px;
            overflow-y: auto;
        }

        .template-content.active {
            display: grid;
        }

        .template-btn {
            padding: var(--space-2);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .template-btn:hover {
            background: var(--success);
            color: var(--text-white);
            border-color: var(--success);
        }

        .reply-textarea {
            width: 100%;
            min-height: 60px;
            padding: var(--space-3);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-family: inherit;
            resize: none;
            transition: var(--transition);
        }

        .reply-textarea.expanded {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 80%;
            z-index: 1000;
            background: var(--bg-secondary);
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        }

        .reply-textarea.collapsed {
            min-height: 40px;
        }

        .reply-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }

        .reply-mode-toggle {
            display: flex;
            gap: var(--space-1);
        }

        .mode-btn {
            padding: var(--space-1) var(--space-2);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .mode-btn.active {
            background: var(--blue-primary);
            color: var(--text-white);
            border-color: var(--blue-primary);
        }

        .textarea-controls {
            display: flex;
            gap: var(--space-1);
        }

        .textarea-toggle, .translate-btn {
            padding: var(--space-1) var(--space-2);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: var(--transition);
        }

        .textarea-toggle:hover, .translate-btn:hover {
            background: var(--blue-primary);
            color: var(--text-white);
        }

        .reply-actions {
            display: flex;
            gap: var(--space-3);
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .btn-primary {
            background: var(--blue-primary);
            color: var(--text-white);
            border-color: var(--blue-primary);
        }

        .btn-primary:hover {
            background: var(--blue-secondary);
            border-color: var(--blue-secondary);
            transform: translateY(-1px);
        }

        .btn-ai {
            background: linear-gradient(135deg, var(--color-orange), #e56b2b);
            color: var(--text-white);
            border-color: var(--color-orange);
        }

        /* ===== 4列目: 商品情報パネル（幅拡張） ===== */
        .detail-panel {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: calc(100vh - 10px);
        }

        .detail-header {
            padding: var(--space-2);
            background: linear-gradient(135deg, var(--blue-dark), var(--blue-accent));
            color: var(--text-white);
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-title {
            font-size: var(--text-sm);
            font-weight: 600;
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2);
        }

        /* 商品・顧客情報セクション */
        .detail-section {
            margin-bottom: var(--space-3);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .section-header {
            padding: var(--space-2);
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .section-content {
            padding: var(--space-2);
            background: var(--bg-secondary);
        }

        .product-overview {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .product-image-detail {
            width: 60px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            border: 1px solid #e2e8f0;
        }

        .product-details h3 {
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
            line-height: 1.3;
        }

        .product-badges {
            display: flex;
            gap: var(--space-1);
            align-items: center;
        }

        .price-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            background: var(--color-medium-blue);
            color: var(--text-white);
            border-radius: var(--radius-sm);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-1);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-1) 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: var(--text-xs);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            flex: 1;
        }

        .info-value {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            text-align: right;
        }

        .copyable {
            cursor: pointer;
            padding: 2px 4px;
            background: var(--bg-tertiary);
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-family: "Fira Code", monospace;
            transition: var(--transition);
            display: inline-block;
        }

        .copyable:hover {
            background: var(--color-yellow);
            border-color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .tracking-link {
            color: var(--blue-primary);
            text-decoration: underline;
            cursor: pointer;
        }

        .tracking-link:hover {
            color: var(--blue-secondary);
        }

        .product-link {
            color: var(--color-orange);
            text-decoration: underline;
            cursor: pointer;
            font-weight: 600;
        }

        .product-link:hover {
            color: #e56b2b;
        }
    </style>
</head>
<body>
    <!-- 独立トグルボタン -->
    <div class="toggle-buttons">
        <button class="main-toggle-btn" onclick="toggleFolderPanel()" title="フォルダパネル">
            <i class="fas fa-folder" id="folderToggleIcon"></i>
        </button>
        <button class="main-toggle-btn" onclick="toggleHistoryPanel()" title="履歴パネル">
            <i class="fas fa-history" id="historyToggleIcon"></i>
        </button>
    </div>

    <div class="chat-container">
        <div class="chat-layout" id="chatLayout">
            <!-- 1列目: フォルダパネル + メッセージカード -->
            <div class="folder-panel" id="folderPanel">
                <div class="folder-header">
                    <div class="folder-title">
                        <i class="fas fa-comments"></i>
                        <span>eBayチャット管理</span>
                    </div>
                    
                    <!-- 検索とボタンエリア復活 -->
                    <div class="header-search-area">
                        <div class="header-top-row">
                            <div class="header-actions">
                                <div class="header-btn" onclick="openSettings()">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <div class="header-btn" onclick="showNotifications()">
                                    <i class="fas fa-bell"></i>
                                    <span class="notification-badge">5</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="global-search">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" 
                                   placeholder="メッセージ・商品・顧客・注文IDで検索..." 
                                   id="global-search-input">
                        </div>
                    </div>
                </div>

                <!-- 3つのコントロール横並び -->
                <div class="controls-row">
                    <select class="control-select" onchange="switchStore(this.value)">
                        <option value="all">全店舗</option>
                        <option value="alpha">Alpha店</option>
                        <option value="beta">Beta店</option>
                        <option value="gamma">Gamma店</option>
                        <option value="delta">Delta店</option>
                        <option value="epsilon">Epsilon店</option>
                    </select>
                    
                    <select class="control-select" onchange="filterByCategory(this.value)">
                        <option value="all">全カテゴリ</option>
                        <option value="product">商品質問</option>
                        <option value="shipping">配送問題</option>
                        <option value="payment">支払い</option>
                        <option value="return">返品・返金</option>
                        <option value="complaint">苦情</option>
                    </select>
                    
                    <select class="control-select" onchange="filterBySender(this.value)">
                        <option value="all">全送信者</option>
                        <option value="customer">顧客</option>
                        <option value="ebay">eBay運営</option>
                    </select>
                </div>

                <!-- フォルダボタン - 1列6個（横並び） -->
                <div class="folder-grid">
                    <div class="folder-item active" data-folder="inbox" onclick="switchFolder('inbox', this)">
                        <i class="fas fa-inbox folder-icon"></i>
                        <span class="folder-label">受信箱</span>
                        <span class="folder-count">23</span>
                    </div>
                    <div class="folder-item" data-folder="unread" onclick="switchFolder('unread', this)">
                        <i class="fas fa-envelope folder-icon"></i>
                        <span class="folder-label">未読</span>
                        <span class="folder-count">15</span>
                    </div>
                    <div class="folder-item" data-folder="urgent" onclick="switchFolder('urgent', this)">
                        <i class="fas fa-exclamation-triangle folder-icon"></i>
                        <span class="folder-label">緊急</span>
                        <span class="folder-count">3</span>
                    </div>
                    <div class="folder-item" data-folder="bookmarked" onclick="switchFolder('bookmarked', this)">
                        <i class="fas fa-star folder-icon"></i>
                        <span class="folder-label">重要</span>
                        <span class="folder-count">7</span>
                    </div>
                    <div class="folder-item" data-folder="replied" onclick="switchFolder('replied', this)">
                        <i class="fas fa-reply folder-icon"></i>
                        <span class="folder-label">返信済</span>
                        <span class="folder-count">34</span>
                    </div>
                    <div class="folder-item" data-folder="completed" onclick="switchFolder('completed', this)">
                        <i class="fas fa-check folder-icon"></i>
                        <span class="folder-label">完了</span>
                        <span class="folder-count">156</span>
                    </div>
                </div>

                <!-- メッセージカード一覧 -->
                <div class="message-list">
                    <!-- メッセージカード1 - 緊急・SOLD -->
                    <div class="message-card" data-folder="urgent" onclick="selectMainMessage(this, 1)">
                        <div class="message-product-image">
                            <img src="https://i.ebayimg.com/thumbs/images/g/JykAAOSwKdNg3Oe3/s-l225.jpg" 
                                 alt="Product" class="product-image" 
                                 onerror="this.parentNode.innerHTML='<div class=\'product-placeholder\'><i class=\'fas fa-camera\'></i></div>'">
                        </div>
                        <div class="message-main">
                            <div class="message-sender">
                                John Smith (米国)
                            </div>
                            <div class="message-subject">
                                商品が3週間経っても届きません - 緊急対応必要
                            </div>
                            <div class="message-preview">
                                追跡番号の確認をお願いします...
                            </div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2時間前</div>
                            <div class="sold-badge">SOLD</div>
                            <div class="store-badge" data-store="alpha">α</div>
                        </div>
                    </div>

                    <!-- メッセージカード2 - eBay運営 -->
                    <div class="message-card" data-folder="unread" onclick="selectMainMessage(this, 2)">
                        <div class="message-product-image">
                            <div class="product-placeholder">
                                <i class="fab fa-ebay" style="color: var(--color-medium-blue);"></i>
                            </div>
                        </div>
                        <div class="message-main">
                            <div class="message-sender">
                                eBay Customer Service
                            </div>
                            <div class="message-subject">
                                商品リスティングについてのポリシー違反報告
                            </div>
                            <div class="message-preview">
                                We have received a report about your listing...
                            </div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">4時間前</div>
                            <div class="inquiry-badge">問合せ</div>
                            <div class="store-badge" data-store="beta">β</div>
                        </div>
                    </div>

                    <!-- メッセージカード3 - 商品質問 -->
                    <div class="message-card" data-folder="inbox" onclick="selectMainMessage(this, 3)">
                        <div class="message-product-image">
                            <img src="https://i.ebayimg.com/thumbs/images/g/3XcAAOSw0YJhE5pC/s-l225.jpg" 
                                 alt="Product" class="product-image"
                                 onerror="this.parentNode.innerHTML='<div class=\'product-placeholder\'><i class=\'fas fa-camera\'></i></div>'">
                        </div>
                        <div class="message-main">
                            <div class="message-sender">
                                Marie Dubois (仏)
                            </div>
                            <div class="message-subject">
                                レンズの互換性について詳しく教えてください
                            </div>
                            <div class="message-preview">
                                Canon EOS R5との対応状況を確認したいです...
                            </div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">1日前</div>
                            <div class="inquiry-badge">問合せ</div>
                            <div class="store-badge" data-store="gamma">γ</div>
                        </div>
                    </div>

                    <!-- メッセージカード4 - 返信済・SOLD -->
                    <div class="message-card" data-folder="replied" onclick="selectMainMessage(this, 4)">
                        <div class="message-product-image">
                            <img src="https://i.ebayimg.com/thumbs/images/g/7gUAAOSwXY5lR3Kl/s-l225.jpg" 
                                 alt="Product" class="product-image"
                                 onerror="this.parentNode.innerHTML='<div class=\'product-placeholder\'><i class=\'fas fa-camera\'></i></div>'">
                        </div>
                        <div class="message-main">
                            <div class="message-sender">
                                Alessandro Rossi (伊)
                            </div>
                            <div class="message-subject">
                                支払い方法の変更は可能でしょうか？
                            </div>
                            <div class="message-preview">
                                PayPalを使用したいと思います...
                            </div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">2日前</div>
                            <div class="sold-badge">SOLD</div>
                            <div class="store-badge" data-store="delta">δ</div>
                        </div>
                    </div>

                    <!-- メッセージカード5 - 返品・SOLD -->
                    <div class="message-card" data-folder="inbox" onclick="selectMainMessage(this, 5)">
                        <div class="message-product-image">
                            <img src="https://i.ebayimg.com/thumbs/images/g/Y0UAAOSwKONh4XKm/s-l225.jpg" 
                                 alt="Product" class="product-image"
                                 onerror="this.parentNode.innerHTML='<div class=\'product-placeholder\'><i class=\'fas fa-camera\'></i></div>'">
                        </div>
                        <div class="message-main">
                            <div class="message-sender">
                                Emma Johnson (加)
                            </div>
                            <div class="message-subject">
                                商品説明と異なる商品が届きました
                            </div>
                            <div class="message-preview">
                                色と素材が写真と完全に異なります...
                            </div>
                        </div>
                        <div class="message-meta">
                            <div class="message-time">3日前</div>
                            <div class="sold-badge">SOLD</div>
                            <div class="store-badge" data-store="epsilon">ε</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2列目: 商品別履歴パネル -->
            <div class="history-panel" id="historyPanel">
                <div class="history-header">
                    <div class="history-title">商品別履歴</div>
                </div>
                <div class="history-content">
                    <!-- 履歴カード1 - 同一商品の過去受注記録 -->
                    <div class="history-card" data-folder="completed" onclick="selectMessage(this, 'h1')">
                        <div class="history-card-header">
                            <span class="history-sender">過去受注記録</span>
                            <span class="history-date">11/15 10:20</span>
                        </div>
                        <div class="history-content-text">
                            同じカメラモデルの販売完了。顧客満足度：★★★★★
                        </div>
                        <div class="history-meta">
                            <span class="sold-badge">SOLD</span>
                            <div class="store-badge" data-store="alpha">α</div>
                        </div>
                    </div>

                    <!-- 履歴カード2 - 同一商品の過去問い合わせ -->
                    <div class="history-card" data-folder="replied" onclick="selectMessage(this, 'h2')">
                        <div class="history-card-header">
                            <span class="history-sender">過去問い合わせ</span>
                            <span class="history-date">10/28 15:45</span>
                        </div>
                        <div class="history-content-text">
                            同モデルの仕様確認問い合わせ→回答済み→購入に至らず
                        </div>
                        <div class="history-meta">
                            <span class="inquiry-badge">問合せ</span>
                            <div class="store-badge" data-store="alpha">α</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3列目: チャットパネル -->
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="chat-title">チャット履歴</div>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="markAsRead()">
                            <i class="fas fa-check"></i> 既読
                        </button>
                    </div>
                </div>
                <div class="chat-content" id="chatContent">
                    <!-- チャット履歴がここに表示される -->
                </div>

                <!-- 返信エリア -->
                <div class="chat-reply-section">
                    <!-- テンプレートタブ -->
                    <div class="template-tabs">
                        <div class="template-tab active" data-tab="basic" onclick="switchTemplateTab('basic', this)">
                            基本
                        </div>
                        <div class="template-tab" data-tab="emotion" onclick="switchTemplateTab('emotion', this)">
                            感情
                        </div>
                        <div class="template-tab" data-tab="action" onclick="switchTemplateTab('action', this)">
                            対応
                        </div>
                        <div class="template-tab" data-tab="situation" onclick="switchTemplateTab('situation', this)">
                            状況
                        </div>
                    </div>

                    <!-- テンプレートコンテンツ -->
                    <div class="template-content active" data-content="basic">
                        <div class="template-btn" onclick="insertTemplate('挨拶')">挨拶</div>
                        <div class="template-btn" onclick="insertTemplate('感謝')">感謝</div>
                        <div class="template-btn" onclick="insertTemplate('謝罪')">謝罪</div>
                        <div class="template-btn" onclick="insertTemplate('確認')">確認</div>
                        <div class="template-btn" onclick="insertTemplate('説明')">説明</div>
                        <div class="template-btn" onclick="insertTemplate('依頼')">依頼</div>
                    </div>

                    <div class="template-content" data-content="emotion">
                        <div class="template-btn" onclick="insertTemplate('共感')">共感</div>
                        <div class="template-btn" onclick="insertTemplate('心配')">心配</div>
                        <div class="template-btn" onclick="insertTemplate('安心')">安心</div>
                        <div class="template-btn" onclick="insertTemplate('緊急')">緊急</div>
                    </div>

                    <div class="template-content" data-content="action">
                        <div class="template-btn" onclick="insertTemplate('返金')">返金</div>
                        <div class="template-btn" onclick="insertTemplate('交換')">交換</div>
                        <div class="template-btn" onclick="insertTemplate('追跡')">追跡</div>
                        <div class="template-btn" onclick="insertTemplate('交渉')">交渉</div>
                    </div>

                    <div class="template-content" data-content="custom">
                        <div class="template-btn" onclick="insertTemplate('カスタム1')">カスタム1</div>
                        <div class="template-btn" onclick="insertTemplate('カスタム2')">カスタム2</div>
                        <div class="template-btn" onclick="insertTemplate('カスタム3')">カスタム3</div>
                        <div class="template-btn" onclick="insertTemplate('カスタム4')">カスタム4</div>
                    </div>

                    <textarea class="reply-textarea" id="replyText" 
                              placeholder="返信メッセージを入力してください..."></textarea>

                    <div class="reply-controls">
                        <div class="reply-mode-toggle">
                            <button class="mode-btn active" data-mode="template" onclick="switchReplyMode('template', this)">
                                <i class="fas fa-list"></i> テンプレート
                            </button>
                            <button class="mode-btn" data-mode="ai" onclick="switchReplyMode('ai', this)">
                                <i class="fas fa-robot"></i> AI選択
                            </button>
                        </div>
                        
                        <div class="textarea-controls">
                            <button class="textarea-toggle" onclick="toggleTextareaHeight()">
                                <i class="fas fa-expand-alt" id="textareaToggleIcon"></i>
                            </button>
                            <button class="translate-btn" onclick="translateText()">
                                <i class="fas fa-language"></i> 翻訳
                            </button>
                        </div>
                    </div>

                    <div class="reply-actions">
                        <button class="btn btn-ai" onclick="generateAIReply()">
                            <i class="fas fa-robot"></i>
                            AI返信生成
                        </button>
                        <button class="btn btn-primary" onclick="sendReply()">
                            <i class="fas fa-paper-plane"></i>
                            返信送信
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4列目: 商品情報パネル（幅拡張280px） -->
            <div class="detail-panel">
                <div class="detail-header">
                    <div class="detail-title">商品・顧客情報</div>
                </div>
                <div class="detail-content">
                    <!-- 商品情報サンプル -->
                    <div class="detail-section">
                        <div class="section-header">
                            <i class="fas fa-camera"></i>
                            <span>商品情報</span>
                        </div>
                        <div class="section-content">
                            <div class="product-overview">
                                <img src="https://i.ebayimg.com/thumbs/images/g/JykAAOSwKdNg3Oe3/s-l225.jpg" 
                                     alt="商品画像" class="product-image-detail"
                                     onerror="this.src='https://via.placeholder.com/80x60'">
                                <div class="product-details">
                                    <h3>Vintage Camera Set Premium Collection</h3>
                                    <div class="product-badges">
                                        <div class="sold-badge">SOLD</div>
                                        <div class="price-badge">$89.33</div>
                                    </div>
                                </div>
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">商品ID</span>
                                    <span class="info-value copyable" onclick="copyToClipboard('25-13453-70180')">25-13453-70180</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">SKU</span>
                                    <span class="info-value copyable" onclick="copyToClipboard('cldur7enyk')">cldur7enyk</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">注文ID</span>
                                    <span class="info-value copyable" onclick="copyToClipboard('ORD-123456789')">ORD-123456789</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">追跡番号</span>
                                    <span class="info-value tracking-link" onclick="openTrackingUrl('https://tools.usps.com/go/TrackConfirmAction?tRef=fullpage&tLc=2&text28777=&tLabels=9405511206213462891234')">9405511206213462891234</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">商品ページ</span>
                                    <span class="info-value product-link" onclick="openProductPage('https://www.ebay.com/itm/25-13453-70180')">eBayで確認</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 顧客情報サンプル -->
                    <div class="detail-section">
                        <div class="section-header">
                            <i class="fas fa-user"></i>
                            <span>顧客情報</span>
                        </div>
                        <div class="section-content">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">顧客名</span>
                                    <span class="info-value">John Smith</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">ユーザーID</span>
                                    <span class="info-value copyable" onclick="copyToClipboard('john_smith_84')">john_smith_84</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">評価</span>
                                    <span class="info-value">247 (98.7%)</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">国</span>
                                    <span class="info-value">米国</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let folderCollapsed = false;
        let historyCollapsed = true;
        let currentSelectedMessage = null;

        // メッセージデータ
        const messageData = {
            1: {
                sender: "John Smith",
                country: "米国",
                subject: "商品が3週間経っても届きません - 緊急対応必要",
                chatHistory: [
                    {
                        type: "received",
                        timestamp: "2024-12-13 14:30:00",
                        sender: "John Smith",
                        message: "I ordered this camera 3 weeks ago and it still hasn't arrived. The tracking shows it was shipped but no updates since then. I need this camera for an important event next week. Please help me track this package or arrange a replacement urgently.",
                        translated: "3週間前にこのカメラを注文しましたが、まだ届いていません。追跡情報では発送済みとなっていますが、それ以降更新されていません。来週の重要なイベントでこのカメラが必要です。この荷物の追跡を手伝っていただくか、緊急で代替品を手配してください。"
                    }
                ]
            },
            2: {
                sender: "eBay Customer Service",
                country: "運営",
                subject: "商品リスティングについてのポリシー違反報告",
                chatHistory: [
                    {
                        type: "received",
                        timestamp: "2024-12-13 12:15:00",
                        sender: "eBay Customer Service",
                        message: "We have received a report about your listing for item EB003-20241213. The buyer claims the item description does not match the actual product received.",
                        translated: "商品EB003-20241213のリスティングについて報告を受けました。購入者は、商品説明が実際に受け取った商品と一致しないと主張しています。"
                    }
                ]
            }
        };

        let textareaMode = 'standard'; // 'collapsed', 'standard', 'expanded'

        // テンプレートデータ（追加）
        const templates = {
            '挨拶': 'いつもお世話になっております。',
            '感謝': 'この度は貴重なお時間をいただき、誠にありがとうございます。',
            '謝罪': 'この度はご不便をおかけして大変申し訳ございません。',
            '確認': 'お客様のご要求について確認させていただきます。',
            '説明': '詳細について丁寧にご説明いたします。',
            '依頼': '恐れ入りますが、以下についてご協力をお願いいたします。',
            '共感': 'お客様のお気持ちを心からお察しいたします。',
            '心配': 'お客様のご状況を大変心配しております。',
            '安心': 'ご安心ください。必ず解決いたします。',
            '緊急': '緊急事態として最優先で対応いたします。',
            '返金': '返金処理を速やかに開始いたします。',
            '交換': '商品交換の手続きをご案内いたします。',
            '追跡': '配送状況を詳しく調査いたします。',
            '交渉': '最良の解決策を一緒に見つけましょう。',
            '遅延': '配送遅延についてお詫び申し上げます。',
            '損傷': '商品の損傷について対応いたします。',
            '相違': '商品相違について確認いたします。',
            '税関': '税関手続きについてサポートいたします。',
            'カスタム1': 'カスタムテンプレート1の内容です。',
            'カスタム2': 'カスタムテンプレート2の内容です。',
            'カスタム3': 'カスタムテンプレート3の内容です。',
            'カスタム4': 'カスタムテンプレート4の内容です。'
        };

        function toggleTextareaHeight() {
            const textarea = document.getElementById('replyText');
            const icon = document.getElementById('textareaToggleIcon');
            
            if (textareaMode === 'standard') {
                textareaMode = 'expanded';
                textarea.classList.add('expanded');
                textarea.classList.remove('collapsed');
                icon.className = 'fas fa-compress-alt';
            } else if (textareaMode === 'expanded') {
                textareaMode = 'collapsed';
                textarea.classList.add('collapsed');
                textarea.classList.remove('expanded');
                icon.className = 'fas fa-expand-alt';
            } else {
                textareaMode = 'standard';
                textarea.classList.remove('collapsed', 'expanded');
                icon.className = 'fas fa-expand-alt';
            }
        }

        function translateText() {
            const textarea = document.getElementById('replyText');
            if (!textarea.value.trim()) {
                alert('翻訳するテキストを入力してください');
                return;
            }
            
            // Google翻訳API連携のシミュレーション
            alert('翻訳機能を実行します（Google翻訳API連携予定）');
        }

        function switchReplyMode(mode, element) {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
            
            console.log(`返信モード切り替え: ${mode}`);
            // ここでテンプレート表示/AI選択表示の切り替え処理
        }

        function openTrackingUrl(url) {
            window.open(url, '_blank');
        }

        function openProductPage(url) {
            window.open(url, '_blank');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`コピーしました: ${text}`);
            });
        }

        function showTemplateManager() {
            alert('テンプレート管理画面を開きます');
        }

        function toggleFolderPanel() {
            const panel = document.getElementById('folderPanel');
            const layout = document.getElementById('chatLayout');
            const icon = document.getElementById('folderToggleIcon');
            
            folderCollapsed = !folderCollapsed;
            
            if (folderCollapsed) {
                panel.classList.add('collapsed');
                icon.className = 'fas fa-chevron-right';
                
                if (historyCollapsed) {
                    layout.classList.add('both-collapsed');
                } else {
                    layout.classList.add('left-collapsed');
                    layout.classList.remove('history-collapsed');
                }
            } else {
                panel.classList.remove('collapsed');
                icon.className = 'fas fa-folder';
                
                layout.classList.remove('left-collapsed', 'both-collapsed');
                if (historyCollapsed) {
                    layout.classList.add('history-collapsed');
                }
            }
        }

        function toggleHistoryPanel() {
            const panel = document.getElementById('historyPanel');
            const layout = document.getElementById('chatLayout');
            const icon = document.getElementById('historyToggleIcon');
            
            historyCollapsed = !historyCollapsed;
            
            if (historyCollapsed) {
                panel.classList.add('collapsed');
                icon.className = 'fas fa-chevron-right';
                
                if (folderCollapsed) {
                    layout.classList.add('both-collapsed');
                } else {
                    layout.classList.add('history-collapsed');
                    layout.classList.remove('left-collapsed');
                }
            } else {
                panel.classList.remove('collapsed');
                icon.className = 'fas fa-history';
                
                layout.classList.remove('history-collapsed', 'both-collapsed');
                if (folderCollapsed) {
                    layout.classList.add('left-collapsed');
                }
            }
        }

        function selectMainMessage(element, messageId) {
            // 選択状態の切り替え
            document.querySelectorAll('.message-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            currentSelectedMessage = messageId;
            
            // チャット履歴を表示
            showChatHistory(messageId);
            
            // 履歴パネルを表示（商品選択時）
            if (historyCollapsed) {
                toggleHistoryPanel();
            }
        }

        function showChatHistory(messageId) {
            const message = messageData[messageId];
            if (!message) return;

            const chatContent = document.getElementById('chatContent');
            let chatHTML = '';

            message.chatHistory.forEach((chat) => {
                const isReceived = chat.type === 'received';
                const avatarInitial = isReceived ? chat.sender.charAt(0) : 'S';
                const avatarClass = isReceived ? 'customer' : '';

                chatHTML += `
                    <div class="chat-message ${chat.type === 'sent' ? 'sent' : ''}">
                        <div class="chat-avatar ${avatarClass}">${avatarInitial}</div>
                        <div class="chat-message-content">
                            <div class="chat-message-header">
                                <strong>${chat.sender}</strong>
                                <span>${formatTimestamp(chat.timestamp)}</span>
                            </div>
                            <div class="chat-bubble">
                                ${isReceived ? chat.translated : chat.message}
                                ${isReceived ? `
                                    <div class="translation-toggle" onclick="toggleOriginalText(this)">
                                        <i class="fas fa-language"></i> 原文を表示
                                    </div>
                                    <div class="original-text">
                                        <strong>原文:</strong><br>${chat.message}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            chatContent.innerHTML = chatHTML;
        }

        function toggleOriginalText(element) {
            const originalText = element.nextElementSibling;
            if (originalText.style.display === 'none' || !originalText.style.display) {
                originalText.style.display = 'block';
                element.innerHTML = '<i class="fas fa-language"></i> 原文を非表示';
            } else {
                originalText.style.display = 'none';
                element.innerHTML = '<i class="fas fa-language"></i> 原文を表示';
            }
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ja-JP', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function switchTemplateTab(tabName, element) {
            document.querySelectorAll('.template-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');

            document.querySelectorAll('.template-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector(`[data-content="${tabName}"]`).classList.add('active');
        }

        function insertTemplate(templateName) {
            const textarea = document.getElementById('replyText');
            const template = templates[templateName];
            if (template) {
                textarea.value += (textarea.value ? '\n\n' : '') + template;
                textarea.focus();
            }
        }

        function generateAIReply() {
            if (!currentSelectedMessage) {
                alert('メッセージを選択してください');
                return;
            }

            const textarea = document.getElementById('replyText');
            const message = messageData[currentSelectedMessage];
            
            // AI返信生成のシミュレーション
            let aiResponse = "お問い合わせいただき、ありがとうございます。\n\n";
            
            if (message.subject.includes('届きません')) {
                aiResponse += "お荷物の配送状況について確認いたしましたところ、配送に遅延が生じていることを確認いたします。配送業者に問い合わせを行い、最新の状況をお調べしております。\n\n24時間以内にご連絡いたします。ご不便をおかけして大変申し訳ございません。";
            } else if (message.subject.includes('ポリシー')) {
                aiResponse += "貴重なご報告をいただき、ありがとうございます。\n\nお客様からのご指摘を真摯に受け止め、商品説明と実際の商品に相違がないか詳細に確認いたします。48時間以内に調査結果をご報告いたします。";
            } else {
                aiResponse += "詳しく確認し、適切な回答をご提供いたします。\n\n何かご不明な点がございましたら、お気軽にお声かけください。\n\nよろしくお願いいたします。";
            }

            textarea.value = aiResponse;
        }

        function sendReply() {
            const textarea = document.getElementById('replyText');
            if (!textarea.value.trim()) {
                alert('返信メッセージを入力してください');
                return;
            }

            alert('返信を送信しました');
            textarea.value = '';
        }

        function switchFolder(folderType, element) {
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            console.log(`フォルダ切り替え: ${folderType}`);
        }

        function switchStore(storeId) {
            console.log(`店舗切り替え: ${storeId}`);
        }

        function filterByCategory(category) {
            console.log(`カテゴリフィルター: ${category}`);
        }

        function filterBySender(sender) {
            console.log(`送信者フィルター: ${sender}`);
        }

        function toggleTranslations() {
            console.log('翻訳切り替え');
        }

        function markAsRead() {
            console.log('既読マーク');
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('eBayチャット管理システム - 4列完成版初期化完了');
            
            // 初期状態で履歴パネルは非表示
            const historyPanel = document.getElementById('historyPanel');
            const layout = document.getElementById('chatLayout');
            historyPanel.classList.add('collapsed');
            layout.classList.add('history-collapsed');
        });
    </script>
</body>
</html>