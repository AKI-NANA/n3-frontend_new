<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高度統合利益計算システム - デプロイメント修正ガイド</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #007bff, #6f42c1);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .file-tree {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
        .step {
            counter-increment: step-counter;
            position: relative;
            margin-bottom: 25px;
            padding-left: 50px;
        }
        .step::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .steps {
            counter-reset: step-counter;
        }
        h2 {
            color: #007bff;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        h3 {
            color: #6f42c1;
            margin-top: 25px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔧 高度統合利益計算システム</h1>
        <p>デプロイメント修正ガイド - Not Found エラー解決</p>
    </div>

    <div class="alert alert-danger">
        <strong>⚠️ 現在の問題:</strong><br>
        <code>Not Found: /new_structure/05_rieki/rieki_advanced.php?action=health</code><br>
        ファイルが見つからない、またはサーバー設定に問題があります。
    </div>

    <div class="section">
        <h2>🔍 問題の原因分析</h2>
        
        <h3>1. 想定される原因</h3>
        <ul>
            <li><strong>ファイルが存在しない</strong> - rieki_advanced.php が実際に配置されていない</li>
            <li><strong>パスが間違っている</strong> - ディレクトリ構造が想定と異なる</li>
            <li><strong>サーバー設定問題</strong> - PHP実行環境、権限設定、.htaccess</li>
            <li><strong>ポート番号問題</strong> - 8080番ポートでのアクセス設定</li>
        </ul>

        <h3>2. 現在のディレクトリ構造（想定）</h3>
        <div class="file-tree">
new_structure/
├── 01_dashboard/
├── 02_scraping/
├── 03_approval/
├── 04_analysis/
├── 05_rieki/              ← ここに配置予定
│   ├── rieki.php          ← 既存ファイル
│   ├── rieki_fixed.php    ← 修正済みファイル
│   ├── rieki_advanced.php ← 🆕 新規作成ファイル
│   ├── advanced_tariff_calculator.html
│   └── advanced_database_schema.sql
├── 06_filters/
├── 07_editing/
├── 08_listing/
├── 09_shipping/
├── 10_zaiko/
├── 11_category/
├── 12_html_editor/
├── 13_bunseki/
├── 14_api_renkei/
└── shared/
        </div>
    </div>

    <div class="section">
        <h2>🛠️ 修正手順</h2>
        
        <div class="steps">
            <div class="step">
                <h3>ファイル配置確認</h3>
                <p>以下のファイルが正しく配置されているか確認してください。</p>
                <div class="code-block">
# Windows の場合
C:\xampp\htdocs\new_structure\05_rieki\rieki_advanced.php

# Mac/Linux の場合  
/Applications/XAMPP/htdocs/new_structure/05_rieki/rieki_advanced.php

# または
/var/www/html/new_structure/05_rieki/rieki_advanced.php
                </div>
            </div>

            <div class="step">
                <h3>ファイル権限設定</h3>
                <p>PHPファイルに適切な実行権限を設定します。</p>
                <div class="code-block">
# Mac/Linux の場合
chmod 644 new_structure/05_rieki/rieki_advanced.php
chmod 755 new_structure/05_rieki/
                </div>
            </div>

            <div class="step">
                <h3>サーバー起動確認</h3>
                <p>Webサーバーが8080番ポートで正常に動作しているか確認します。</p>
                <div class="code-block">
# XAMPP の場合
http://localhost/dashboard

# カスタムポート設定の場合
http://localhost:8080/

# 基本テスト
http://localhost:8080/new_structure/
                </div>
            </div>

            <div class="step">
                <h3>PHP実行環境確認</h3>
                <p>PHPが正常に動作しているかテストします。</p>
                <div class="code-block">
# テスト用 info.php ファイル作成
&lt;?php phpinfo(); ?&gt;

# アクセステスト
http://localhost:8080/new_structure/05_rieki/info.php
                </div>
            </div>

            <div class="step">
                <h3>代替アクセス方法</h3>
                <p>異なるパスやポートでアクセスを試してみます。</p>
                <div class="code-block">
# 標準ポート
http://localhost/new_structure/05_rieki/rieki_advanced.php?action=health

# ポート8080
http://localhost:8080/new_structure/05_rieki/rieki_advanced.php?action=health

# IPアドレス直接指定
http://127.0.0.1:8080/new_structure/05_rieki/rieki_advanced.php?action=health
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>🔄 簡易版デプロイメント</h2>
        
        <div class="alert alert-info">
            <strong>💡 暫定解決策:</strong> まず既存の rieki.php を修正して動作確認を行います。
        </div>

        <h3>1. 既存ファイルの確認</h3>
        <p>以下のファイルが存在するか確認してください：</p>
        <div class="code-block">
new_structure/05_rieki/rieki.php
new_structure/05_rieki/rieki_fixed.php  
        </div>

        <h3>2. アクセステスト</h3>
        <p>以下のURLで動作確認を行ってください：</p>
        <div class="code-block">
# 既存システムテスト
http://localhost:8080/new_structure/05_rieki/rieki.php

# 修正版テスト  
http://localhost:8080/new_structure/05_rieki/rieki_fixed.php?action=health
        </div>

        <h3>3. データベース設定</h3>
        <p>PostgreSQL接続設定を確認・修正してください：</p>
        <div class="code-block">
// rieki_fixed.php 内で修正
$host = 'localhost';
$dbname = 'yahoo_auction_tool';
$username = 'postgres';  // ← 実際のユーザー名に変更
$password = 'your_password';  // ← 実際のパスワードに変更
        </div>
    </div>

    <div class="section">
        <h2>🧪 動作確認手順</h2>
        
        <div class="steps">
            <div class="step">
                <h3>基本接続テスト</h3>
                <div class="code-block">
curl -X GET "http://localhost:8080/new_structure/05_rieki/rieki_fixed.php?action=health"
                </div>
            </div>

            <div class="step">
                <h3>ブラウザテスト</h3>
                <p>ブラウザで以下のURLにアクセス：</p>
                <div class="code-block">
http://localhost:8080/new_structure/05_rieki/rieki_fixed.php?action=health
                </div>
                <p>期待される応答：</p>
                <div class="code-block">
{
    "success": true,
    "message": "統合利益計算システム稼働中",
    "health": {
        "database": true,
        "api": true
    }
}
                </div>
            </div>

            <div class="step">
                <h3>エラー診断</h3>
                <p>エラーが発生する場合、以下を確認：</p>
                <ul>
                    <li>PHPエラーログの確認</li>
                    <li>Webサーバーエラーログの確認</li>
                    <li>データベース接続の確認</li>
                    <li>ファイル権限の確認</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>🚀 フルシステム展開</h2>
        
        <p>基本システムが動作確認できたら、以下のステップで高度システムを展開します：</p>

        <h3>1. データベーススキーマ適用</h3>
        <div class="code-block">
psql -U postgres -d yahoo_auction_tool -f advanced_database_schema.sql
        </div>

        <h3>2. 新規APIファイル配置</h3>
        <div class="code-block">
# rieki_advanced.php を 05_rieki フォルダに配置
# advanced_tariff_calculator.html を配置
        </div>

        <h3>3. 設定ファイル調整</h3>
        <div class="code-block">
// データベース接続情報を環境に合わせて修正
// API設定の調整
// 権限設定の確認
        </div>

        <h3>4. 統合テスト実行</h3>
        <div class="code-block">
# ヘルスチェック
http://localhost:8080/new_structure/05_rieki/rieki_advanced.php?action=health

# UI表示確認
http://localhost:8080/new_structure/05_rieki/advanced_tariff_calculator.html
        </div>
    </div>

    <div class="alert alert-success">
        <strong>✅ 成功確認指標:</strong><br>
        • API ヘルスチェックが成功 <br>
        • データベース接続が確立<br>
        • UI画面が正常表示<br>
        • 計算機能が動作<br>
    </div>

    <div class="section">
        <h2>📞 サポート情報</h2>
        
        <h3>よくある問題と解決策</h3>
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #dee2e6;">エラー</th>
                    <th style="padding: 10px; border: 1px solid #dee2e6;">原因</th>
                    <th style="padding: 10px; border: 1px solid #dee2e6;">解決策</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">404 Not Found</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">ファイル不存在</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">ファイルパス確認・再配置</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">500 Internal Error</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">PHP構文エラー</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">エラーログ確認・構文修正</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">DB Connection Failed</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">データベース設定</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">接続情報修正・DB起動確認</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">Permission Denied</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">ファイル権限</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">chmod 644 ファイル名</td>
                </tr>
            </tbody>
        </table>

        <h3>追加サポート</h3>
        <ul>
            <li>PHPバージョン: 8.0以上推奨</li>
            <li>PostgreSQLバージョン: 12以上推奨</li>
            <li>メモリ制限: 256MB以上</li>
            <li>実行時間制限: 300秒以上</li>
        </ul>
    </div>

    <div style="text-align: center; margin-top: 30px; padding: 20px; background: #e9ecef; border-radius: 8px;">
        <p><strong>🎯 目標:</strong> 高度統合利益計算システムの完全稼働</p>
        <p><strong>📅 想定完了時間:</strong> 30分〜1時間</p>
        <a href="#" class="btn">📋 チェックリスト印刷</a>
        <a href="#" class="btn">💾 設定ファイル保存</a>
    </div>
</body>
</html>