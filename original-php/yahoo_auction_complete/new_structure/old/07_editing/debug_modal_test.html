        
        // ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢
        function clearTest() {
            const logContainer = document.getElementById('testLog');
            logContainer.innerHTML = '<div>[ã‚¯ãƒªã‚¢å®Œäº†] ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†</div>';
            addTestLog('ãƒ†ã‚¹ãƒˆãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
            
            // æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å…¨ã¦å‰Šé™¤
            const existingModals = document.querySelectorAll('div[style*="position: fixed"]');
            existingModals.forEach(modal => modal.remove());
            addTestLog('æ—¢å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
        }
        
        // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å•†å“è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆï¼ˆediting.jsã‹ã‚‰ã‚³ãƒ”ãƒ¼ï¼‰
        function createProductDetailsModalFromTable(product) {
            addTestLog(`ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ: ${product.title}`, 'info');
            
            const qualityScore = 85; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå“è³ªã‚¹ã‚³ã‚¢
            const accuracyColor = '#28a745'; // ç·‘è‰²
            
            // ç”»åƒURLã®å‡¦ç†
            let imageUrl = product.picture_url || product.active_image_url || '';
            if (!imageUrl || imageUrl.includes('placehold')) {
                imageUrl = 'https://placehold.co/300x200/725CAD/FFFFFF/png?text=No+Image';
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto;
                padding: 20px; box-sizing: border-box;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 30px; max-width: 900px; margin: 0 auto; position: relative;">
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #1f2937;">ğŸ“‹ å•†å“è©³ç´°æƒ…å ± - ${product.item_id || product.id}</h3>
                        <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px;">Ã—</button>
                    </div>
                    
                    <!-- ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <div class="notification success" style="margin-bottom: 20px; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 10px; background: #d4edda; border: 1px solid #c3e6cb; color: #155724;">
                        <i class="fas fa-table"></i>
                        <span>ğŸ“Š ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è©³ç´°è¡¨ç¤ºï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰</span>
                    </div>
                    
                    <!-- ç²¾åº¦ãƒãƒ¼ -->
                    <div class="accuracy-bar" style="width: 100%; height: 30px; background: #e9ecef; border-radius: 15px; overflow: hidden; margin: 15px 0; position: relative;">
                        <div class="accuracy-fill" style="height: 100%; width: ${qualityScore}%; background: ${accuracyColor}; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 14px;">
                            ${qualityScore}%
                        </div>
                    </div>
                    
                    <!-- åŸºæœ¬æƒ…å ± -->
                    <div class="product-basic-info" style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="margin: 0 0 10px 0; color: #1f2937;">ğŸ“‹ åŸºæœ¬æƒ…å ±</h4>
                                <p style="margin: 5px 0;"><strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${product.title || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ä¾¡æ ¼:</strong> Â¥${(product.current_price || product.price || 0).toLocaleString()}</p>
                                <p style="margin: 5px 0;"><strong>çŠ¶æ…‹:</strong> ${product.condition_name || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${product.category_name || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :</strong> ${product.platform || 'Yahoo'}</p>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 10px 0; color: #1f2937;">ğŸ”‘ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±</h4>
                                <p style="margin: 5px 0;"><strong>Item ID:</strong> ${product.item_id || product.id || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>SKU:</strong> ${product.master_sku || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${product.listing_status || 'not_listed'}</p>
                                <p style="margin: 5px 0;"><strong>åœ¨åº«:</strong> ${product.current_stock || '1'}</p>
                                <p style="margin: 5px 0;"><strong>æ›´æ–°æ—¥:</strong> ${formatDateTime(product.updated_at)}</p>
                            </div>
                        </div>
                        
                        <!-- ç”»åƒè¡¨ç¤º -->
                        ${imageUrl && !imageUrl.includes('undefined') ? `
                        <div style="margin-top: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #1f2937;">ğŸ–¼ï¸ å•†å“ç”»åƒ</h4>
                            <div style="text-align: center;">
                                <img src="${imageUrl}" alt="å•†å“ç”»åƒ" style="max-width: 300px; max-height: 200px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; cursor: pointer;" onclick="openImagePreview('${imageUrl}')" onerror="this.src='https://placehold.co/300x200/725CAD/FFFFFF/png?text=No+Image'">
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-primary" onclick="editProductModalEditing('${product.item_id || product.id}')" style="margin: 5px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-edit"></i> è©³ç´°ç·¨é›†
                            </button>
                            ${product.source_url ? `
                            <button class="btn btn-info" onclick="window.open('${product.source_url}', '_blank')" style="margin: 5px; padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-external-link-alt"></i> å…ƒãƒšãƒ¼ã‚¸
                            </button>
                            ` : ''}
                            <button class="btn btn-danger" onclick="deleteProduct('${product.id || product.item_id}', '${(product.title || '').replace(/'/g, "\\'")}')">  
                                <i class="fas fa-trash"></i> å‰Šé™¤
                            </button>
                        </div>
                    </div>
                    
                    <!-- è©³ç´°ãƒ‡ãƒ¼ã‚¿ -->
                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px;"><strong>ğŸ” å…¨ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</strong></summary>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 11px; max-height: 300px; overflow-y: auto; margin-top: 10px;">${JSON.stringify(product, null, 2)}</pre>
                    </details>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç¾åœ¨ã®å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¿å­˜ï¼ˆç·¨é›†ç”¨ï¼‰
            window.currentProductData = {
                item_id: product.item_id || product.id,
                title: product.title || '',
                current_price: product.current_price || product.price || 0,
                condition: product.condition_name || '',
                category: product.category_name || '',
                description: '',
                data_quality: qualityScore,
                scraping_method: 'Table Data'
            };
            
            addTestLog(`ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºå®Œäº†: ${product.title}`, 'success');
        }
        
        // APIç‰ˆãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ
        function createProductDetailsModal(product) {
            addTestLog(`APIç‰ˆãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ: ${product.title}`, 'info');
            
            const qualityScore = product.data_quality || 85;
            const accuracyColor = qualityScore >= 90 ? '#28a745' : (qualityScore >= 75 ? '#ffc107' : '#dc3545');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto;
                padding: 20px; box-sizing: border-box;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 30px; max-width: 900px; margin: 0 auto; position: relative;">
                    <div style="display: flex; align-items: center; justify-content: between; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #1f2937;">ğŸ“‹ å•†å“è©³ç´°æƒ…å ±ï¼ˆAPIç‰ˆï¼‰ - ${product.item_id}</h3>
                        <button onclick="this.closest('div').parentElement.parentElement.remove()" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px;">Ã—</button>
                    </div>
                    
                    <!-- Emergency Parser æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <div style="margin-bottom: 20px; padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 10px; background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460;">
                        <i class="fas fa-check-circle"></i>
                        <span>ğŸ‰ Emergency Parser API ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæˆåŠŸï¼</span>
                    </div>
                    
                    <!-- ç²¾åº¦ãƒãƒ¼ -->
                    <div style="width: 100%; height: 30px; background: #e9ecef; border-radius: 15px; overflow: hidden; margin: 15px 0; position: relative;">
                        <div style="height: 100%; width: ${qualityScore}%; background: ${accuracyColor}; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 14px;">
                            ${qualityScore}%
                        </div>
                    </div>
                    
                    <!-- åŸºæœ¬æƒ…å ± -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="margin: 0 0 10px 0; color: #1f2937;">ğŸ“‹ åŸºæœ¬æƒ…å ±</h4>
                                <p style="margin: 5px 0;"><strong>ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${product.title || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ä¾¡æ ¼:</strong> Â¥${(product.current_price || 0).toLocaleString()}</p>
                                <p style="margin: 5px 0;"><strong>çŠ¶æ…‹:</strong> ${product.condition || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${product.category || 'N/A'}</p>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 10px 0; color: #1f2937;">ğŸ”‘ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±</h4>
                                <p style="margin: 5px 0;"><strong>Item ID:</strong> ${product.item_id || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>SKU:</strong> ${product.sku || 'N/A'}</p>
                                <p style="margin: 5px 0;"><strong>ã‚½ãƒ¼ã‚¹:</strong> ãƒ¤ãƒ•ã‚ªã‚¯</p>
                                <p style="margin: 5px 0;"><strong>å“è³ªã‚¹ã‚³ã‚¢:</strong> ${qualityScore}%</p>
                                <p style="margin: 5px 0;"><strong>æŠ½å‡ºæ–¹æ³•:</strong> ${product.scraping_method || 'Emergency Parser'}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; text-align: center;">
                            <button onclick="editProductModalEditing('${product.item_id}')" style="margin: 5px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-edit"></i> è©³ç´°ç·¨é›†
                            </button>
                        </div>
                    </div>
                    
                    <!-- è©³ç´°ãƒ‡ãƒ¼ã‚¿ -->
                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px;"><strong>ğŸ” å…¨ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</strong></summary>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 11px; max-height: 300px; overflow-y: auto; margin-top: 10px;">${JSON.stringify(product, null, 2)}</pre>
                    </details>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentProductData = product;
            
            addTestLog(`APIç‰ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºå®Œäº†: ${product.title}`, 'success');
        }
        
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ja-JP');
            } catch (e) {
                return dateString;
            }
        }
        
        function openImagePreview(imageUrl) {
        // URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã
    if (!imageUrl || imageUrl === 'undefined' || imageUrl.includes('%7B')) {
        addTestLog('ç„¡åŠ¹ãªç”»åƒURL: ' + imageUrl, 'error');
        return;
    }
    
    addTestLog(`ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã: ${imageUrl}`, 'info');
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.9); z-index: 10001; display: flex; 
                align-items: center; justify-content: center; cursor: pointer;
            `;
            
            modal.innerHTML = `
                <div style="position: relative; max-width: 90%; max-height: 90%;">
                    <img src="${imageUrl}" style="max-width: 100%; max-height: 100%; border-radius: 8px;" alt="å•†å“ç”»åƒ">
                    <div style="position: absolute; top: -40px; right: 0; color: white; font-size: 24px; cursor: pointer;" onclick="this.closest('div').parentElement.remove()">Ã—</div>
                </div>
            `;
            
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            document.body.appendChild(modal);
        }
        
        function editProductModalEditing(itemId) {
            addTestLog(`ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«èµ·å‹•: ${itemId}`, 'warning');
            alert(`ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«èµ·å‹•ãƒ†ã‚¹ãƒˆ\nItem ID: ${itemId}\nå®Ÿéš›ã®ç·¨é›†æ©Ÿèƒ½ã¯ editing.php ã§å®Ÿè£…æ¸ˆã¿ã§ã™`);
        }
        
        function deleteProduct(productId, productTitle) {
            addTestLog(`å‰Šé™¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ: ${productId}`, 'warning');
            alert(`å‰Šé™¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ\nProduct ID: ${productId}\nTitle: ${productTitle}\nå®Ÿéš›ã®å‰Šé™¤æ©Ÿèƒ½ã¯ editing.php ã§å®Ÿè£…æ¸ˆã¿ã§ã™`);
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestLog('ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†', 'success');
            addTestLog('å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
        });
    </script>
</body>
</html>
