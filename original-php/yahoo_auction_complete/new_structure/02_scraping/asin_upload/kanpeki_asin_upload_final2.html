<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- SEO„É°„Çø„Çø„Ç∞ -->
    <title>ÂÆåÁíßASINÁÆ°ÁêÜ - CSV„ÉªURL„ÉªÁõ¥Êé•ÂÖ•ÂäõÂØæÂøú - Emverze SaaS</title>
    <meta name="description" content="Amazon ASINÂïÜÂìÅ„ÅÆ‰∏ÄÊã¨ÁôªÈå≤„ÉªÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„ÄÇCSV„ÄÅURL„ÄÅÁõ¥Êé•ÂÖ•Âäõ„ÅßÂäπÁéáÁöÑ„Å™ÂïÜÂìÅÁôªÈå≤„ÇíÂÆüÁèæ„ÄÇ">
    <meta name="keywords" content="ASIN,Amazon,ÂïÜÂìÅÁôªÈå≤,CSV,‰∏ÄÊã¨ÁôªÈå≤,Âú®Â∫´ÁÆ°ÁêÜ">
    
    <!-- Open Graph -->
    <meta property="og:title" content="ÂÆåÁíßASINÁÆ°ÁêÜ - Emverze SaaS">
    <meta property="og:description" content="Amazon ASINÂïÜÂìÅ„ÅÆÂäπÁéáÁöÑ„Å™‰∏ÄÊã¨ÁôªÈå≤„ÉªÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:image" content="{{ url_for('static', filename='images/og-image.png', _external=True) }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
    
    <!-- CSSË™≠„ÅøËæº„Åø(ÈöéÂ±§ÂØæÂøú) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- EmverzeÁµ±‰∏ÄCSS(main.css) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    
    <!-- „Éö„Éº„Ç∏Âõ∫ÊúâCSS -->
    <style>
        /* ASINÁÆ°ÁêÜÂ∞ÇÁî®„Çπ„Çø„Ç§„É´(main.cssÊ∫ñÊã†) */
        .asin-upload-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            box-shadow: var(--neumorphism);
            padding: var(--space-8);
            margin-bottom: var(--space-6);
        }
        
        .upload-method-tabs {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-inset-sm);
        }
        
        .upload-tab {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }
        
        .upload-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .upload-tab.active {
            background: var(--accent-blue);
            color: var(--text-white);
            box-shadow: var(--neumorphism-sm);
        }
        
        .upload-content {
            display: none;
        }
        
        .upload-content.active {
            display: block;
        }
        
        .file-drop-zone {
            border: 2px dashed var(--shadow-dark);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            text-align: center;
            background: var(--bg-tertiary);
            transition: var(--transition-normal);
            cursor: pointer;
            margin-bottom: var(--space-4);
        }
        
        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: var(--accent-blue);
            background: var(--info-bg);
            box-shadow: var(--neumorphism-sm);
        }
        
        .drop-icon {
            font-size: var(--text-5xl);
            color: var(--accent-blue);
            margin-bottom: var(--space-4);
        }
        
        .asin-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }
        
        .asin-preview-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--neumorphism-sm);
            border-left: 4px solid var(--accent-blue);
        }
        
        .asin-code {
            font-family: var(--font-family-mono);
            font-weight: var(--font-semibold);
            color: var(--accent-blue);
            font-size: var(--text-sm);
        }
        
        .processing-progress {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-top: var(--space-6);
            display: none;
        }
        
        .processing-progress.active {
            display: block;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--shadow-dark);
        }
        
        .progress-item:last-child {
            border-bottom: none;
        }
        
        .progress-status {
            width: 20px;
            height: 20px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            color: var(--text-white);
        }
        
        .progress-status.success { background: var(--success-color); }
        .progress-status.error { background: var(--error-color); }
        .progress-status.processing { 
            background: var(--warning-color);
            animation: pulse 1.5s infinite;
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }
        
        .result-stat {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
            box-shadow: var(--neumorphism-sm);
        }
        
        .result-number {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--space-1);
        }
        
        .result-number.success { color: var(--success-color); }
        .result-number.error { color: var(--error-color); }
        .result-number.warning { color: var(--warning-color); }
        .result-number.info { color: var(--info-color); }
        
        .result-label {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: var(--font-medium);
        }
    </style>
<script>
// CAIDS error_handling Hook

// CAIDS „Ç®„É©„ÉºÂá¶ÁêÜHook - ÂÆåÂÖ®ÂÆüË£Ö
window.CAIDS_ERROR_HANDLER = {
    isActive: true,
    errorCount: 0,
    errorHistory: [],
    
    initialize: function() {
        this.setupGlobalErrorHandler();
        this.setupUnhandledPromiseRejection();
        this.setupNetworkErrorHandler();
        console.log('‚ö†Ô∏è CAIDS „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„Ç∑„Çπ„ÉÜ„É†ÂÆåÂÖ®ÂàùÊúüÂåñ');
    },
    
    setupGlobalErrorHandler: function() {
        window.addEventListener('error', (event) => {
            this.handleError({
                type: 'JavaScript Error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error?.stack
            });
        });
    },
    
    setupUnhandledPromiseRejection: function() {
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError({
                type: 'Unhandled Promise Rejection',
                message: event.reason?.message || String(event.reason),
                stack: event.reason?.stack
            });
        });
    },
    
    setupNetworkErrorHandler: function() {
        const originalFetch = window.fetch;
        window.fetch = async function(...args) {
            try {
                const response = await originalFetch.apply(this, args);
                if (!response.ok) {
                    window.CAIDS_ERROR_HANDLER.handleError({
                        type: 'Network Error',
                        message: `HTTP ${response.status}: ${response.statusText}`,
                        url: args[0]
                    });
                }
                return response;
            } catch (error) {
                window.CAIDS_ERROR_HANDLER.handleError({
                    type: 'Network Fetch Error',
                    message: error.message,
                    url: args[0]
                });
                throw error;
            }
        };
    },
    
    handleError: function(errorInfo) {
        this.errorCount++;
        this.errorHistory.push({...errorInfo, timestamp: new Date().toISOString()});
        
        console.error('üö® CAIDS Error Handler:', errorInfo);
        this.showErrorNotification(errorInfo);
        this.reportError(errorInfo);
    },
    
    showErrorNotification: function(errorInfo) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
            position: fixed; top: 10px; right: 10px; z-index: 999999;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white; padding: 15px 20px; border-radius: 8px;
            max-width: 350px; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            border: 2px solid #ff6666; animation: caids-error-shake 0.5s ease-in-out;
        `;
        errorDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 18px;">üö®</span>
                <div>
                    <strong>„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</strong><br>
                    <small style="opacity: 0.9;">${errorInfo.type}: ${errorInfo.message}</small>
                </div>
            </div>
        `;
        
        // CSS Animation
        if (!document.getElementById('caids-error-styles')) {
            const style = document.createElement('style');
            style.id = 'caids-error-styles';
            style.textContent = `
                @keyframes caids-error-shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
        
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 7000);
    },
    
    reportError: function(errorInfo) {
        // „Ç®„É©„Éº„É¨„Éù„Éº„ÉàÁîüÊàê„ÉªÈÄÅ‰ø°ÔºàÂ∞ÜÊù•„ÅÆÊã°ÂºµÁî®Ôºâ
        const report = {
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
            url: window.location.href,
            errorCount: this.errorCount,
            sessionId: this.getSessionId(),
            ...errorInfo
        };
        
        console.log('üìã CAIDS Error Report:', report);
        localStorage.setItem('caids_last_error', JSON.stringify(report));
    },
    
    getSessionId: function() {
        let sessionId = sessionStorage.getItem('caids_session_id');
        if (!sessionId) {
            sessionId = 'caids_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('caids_session_id', sessionId);
        }
        return sessionId;
    },
    
    getErrorStats: function() {
        return {
            totalErrors: this.errorCount,
            recentErrors: this.errorHistory.slice(-10),
            sessionId: this.getSessionId()
        };
    }
};

window.CAIDS_ERROR_HANDLER.initialize();

</script>
<script>
// CAIDS user_feedback Hook
// CAIDS user_feedback Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ user_feedback Hook loaded');
</script>
<script>
// CAIDS character_limit Hook
// CAIDS character_limit Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ character_limit Hook loaded');
</script>
<script>
// CAIDS development_control Hook
// CAIDS development_control Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ development_control Hook loaded');
</script>
<script>
// CAIDS natural_explanation Hook
// CAIDS natural_explanation Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ natural_explanation Hook loaded');
</script>
<script>
// CAIDS character_monitoring Hook
// CAIDS character_monitoring Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ character_monitoring Hook loaded');
</script>
<script>
// CAIDS emergency_accumulation Hook
// CAIDS emergency_accumulation Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ emergency_accumulation Hook loaded');
</script>
<script>
// CAIDS pre_analysis_enforcement Hook
// CAIDS pre_analysis_enforcement Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ pre_analysis_enforcement Hook loaded');
</script>
<script>
// CAIDS user_approval_required Hook
// CAIDS user_approval_required Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ user_approval_required Hook loaded');
</script>
<script>
// CAIDS timeout_management Hook
// CAIDS timeout_management Hook - Âü∫Êú¨ÂÆüË£Ö
console.log('‚úÖ timeout_management Hook loaded');
</script>
</head>

<body>
    <!-- „Ç≥„É≥„ÉÜ„Éä(main.cssÊ∫ñÊã†) -->
    <div class="container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº(ÂÖ®„Éö„Éº„Ç∏ÂÖ±ÈÄö) -->
        <header class="header" role="banner">
            <div class="header-content">
                <div class="header-left">
                    <button class="mobile-menu-toggle" aria-label="„É°„Éã„É•„Éº„ÇíÈñã„Åè">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="header-title">
                        <a href="{{ url_for('dashboard.index') if url_for else '/' }}">Emverze</a>
                    </h1>
                </div>

                <div class="header-center">
                    <div class="search-box">
                        <input type="search" placeholder="ÂïÜÂìÅ„ÇíÊ§úÁ¥¢..." aria-label="ÂïÜÂìÅÊ§úÁ¥¢">
                        <button type="submit" aria-label="Ê§úÁ¥¢ÂÆüË°å">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="header-right">
                    <div class="notification-badge" data-count="3">
                        <button aria-label="ÈÄöÁü•">
                            <i class="fas fa-bell"></i>
                        </button>
                    </div>
                    <div class="user-menu" role="button" tabindex="0" aria-label="„É¶„Éº„Ç∂„Éº„É°„Éã„É•„Éº">
                        <img src="{{ url_for('static', filename='images/avatars/default.png') }}" alt="„É¶„Éº„Ç∂„Éº„Ç¢„Éê„Çø„Éº" class="user-avatar">
                        <span class="user-name">{{ user.name if user else '„Ç≤„Çπ„Éà' }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- „Çµ„Ç§„Éâ„Éê„Éº(ÂÖ®„Éö„Éº„Ç∏ÂÖ±ÈÄö) -->
        <aside class="sidebar" role="navigation" aria-label="„É°„Ç§„É≥„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥">
            <div class="logo">
                <h2>Emverze</h2>
                <span class="version">SaaS v2.0</span>
            </div>

            <nav class="nav-menu">
                <ul role="menubar">
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('dashboard.index') if url_for else '/' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('inventory.list') if url_for else '/inventory' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-boxes" aria-hidden="true"></i>
                            <span>Âú®Â∫´ÁÆ°ÁêÜ</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('products.list') if url_for else '/products' }}" class="nav-link active" role="menuitem" aria-current="page">
                            <i class="fas fa-box" aria-hidden="true"></i>
                            <span>ÂïÜÂìÅÁÆ°ÁêÜ</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('listings.list') if url_for else '/listings' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-store" aria-hidden="true"></i>
                            <span>Âá∫ÂìÅÁÆ°ÁêÜ</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('analytics.dashboard') if url_for else '/analytics' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            <span>ÂàÜÊûê</span>
                        </a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="{{ url_for('settings.general') if url_for else '/settings' }}" class="nav-link" role="menuitem">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                            <span>Ë®≠ÂÆö</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-indicator online"></div>
                    <span>„Ç∑„Çπ„ÉÜ„É†Ê≠£Â∏∏</span>
                </div>
            </div>
        </aside>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
        <main class="main" role="main">
            <div class="main-content">
                <!-- „Éö„Éº„Ç∏„Éò„ÉÉ„ÉÄ„Éº -->
                <div class="page-header">
                    <div class="page-header-left">
                        <h1 class="page-title">ÂÆåÁíßASINÁÆ°ÁêÜ</h1>
                        <p class="page-subtitle">AmazonÂïÜÂìÅ„ÅÆ‰∏ÄÊã¨ÁôªÈå≤„ÉªÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
                    </div>
                    <div class="page-header-right">
                        <button class="btn secondary" onclick="showUploadHistory()">
                            <i class="fas fa-history"></i>
                            Â±•Ê≠¥
                        </button>
                        <button class="btn primary" onclick="exportResults()">
                            <i class="fas fa-download"></i>
                            ÁµêÊûúÂá∫Âäõ
                        </button>
                    </div>
                </div>

                <!-- „Éë„É≥„Åè„Åö„Éä„Éì -->
                <nav aria-label="„Éë„É≥„Åè„Åö„Éä„Éì" class="breadcrumb">
                    <ol>
                        <li>
                            <a href="{{ url_for('dashboard.index') if url_for else '/' }}">
                                <i class="fas fa-home" aria-hidden="true"></i>
                                „Éõ„Éº„É†
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('products.list') if url_for else '/products' }}">ÂïÜÂìÅÁÆ°ÁêÜ</a>
                        </li>
                        <li>
                            <span aria-current="page">ASINÁÆ°ÁêÜ</span>
                        </li>
                    </ol>
                </nav>

                <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="content-area">
                    <!-- ASINÁµ±Âêà„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç≥„É≥„ÉÜ„Éä -->
                    <div class="asin-upload-container">
                        <!-- „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊñπÂºèÈÅ∏Êäû„Çø„Éñ -->
                        <div class="upload-method-tabs" role="tablist">
                            <button class="upload-tab active" role="tab" aria-selected="true" onclick="switchUploadMethod('csv')">
                                <i class="fas fa-file-csv"></i>
                                CSV„Éï„Ç°„Ç§„É´
                            </button>
                            <button class="upload-tab" role="tab" aria-selected="false" onclick="switchUploadMethod('url')">
                                <i class="fas fa-link"></i>
                                URLÂèñ„ÇäËæº„Åø
                            </button>
                            <button class="upload-tab" role="tab" aria-selected="false" onclick="switchUploadMethod('direct')">
                                <i class="fas fa-keyboard"></i>
                                Áõ¥Êé•ÂÖ•Âäõ
                            </button>
                        </div>

                        <!-- CSV„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                        <div id="csv-upload" class="upload-content active" role="tabpanel">
                            <h3 class="section-title">CSV„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h3>
                            
                            <div class="file-drop-zone" id="csvDropZone" onclick="document.getElementById('csvFileInput').click()">
                                <div class="drop-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <p class="text-lg font-semibold mb-2">CSV„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó</p>
                                <p class="text-sm text-secondary">„Åæ„Åü„ÅØ„ÄÅ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</p>
                                <input type="file" id="csvFileInput" accept=".csv,.txt" style="display: none;" onchange="handleCsvFile(event)">
                            </div>

                            <!-- CSVÂá¶ÁêÜ„Ç™„Éó„Ç∑„Éß„É≥ -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞</label>
                                    <select class="form-select" id="csvEncoding">
                                        <option value="auto">Ëá™ÂãïÊ§úÂá∫</option>
                                        <option value="utf-8">UTF-8</option>
                                        <option value="shift_jis">Shift_JIS</option>
                                        <option value="euc-jp">EUC-JP</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Âå∫Âàá„ÇäÊñáÂ≠ó</label>
                                    <select class="form-select" id="csvDelimiter">
                                        <option value=",">„Ç´„É≥„Éû (,)</option>
                                        <option value="\t">„Çø„Éñ</option>
                                        <option value=";">„Çª„Éü„Ç≥„É≠„É≥ (;)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ASINÂàóÂêç</label>
                                    <input type="text" class="form-input" id="asinColumn" value="ASIN" placeholder="ASINÂàó„ÅÆÂêçÂâç">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-checkbox">
                                    <input type="checkbox" id="csvSkipHeader" checked>
                                    <span class="checkmark">„Éò„ÉÉ„ÉÄ„ÉºË°å„Çí„Çπ„Ç≠„ÉÉ„Éó</span>
                                </label>
                            </div>
                        </div>

                        <!-- URLÂèñ„ÇäËæº„Åø -->
                        <div id="url-upload" class="upload-content" role="tabpanel">
                            <h3 class="section-title">Amazon URLÂèñ„ÇäËæº„Åø</h3>
                            
                            <div class="form-group">
                                <label class="form-label">AmazonÂïÜÂìÅURL</label>
                                <textarea class="form-textarea" id="urlList" rows="10" 
                                    placeholder="AmazonÂïÜÂìÅURL„Çí1Ë°å„Å´1„Å§„Åö„Å§ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ&#10;‰æã:&#10;https://www.amazon.co.jp/dp/B01234567X&#10;https://www.amazon.com/dp/B09876543Z"></textarea>
                                <div class="field-help">
                                    ÊúÄÂ§ß100URL„Åæ„Åß‰∏ÄÊã¨Âá¶ÁêÜÂèØËÉΩ
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="removeTracking" checked>
                                        <span class="checkmark">„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞„Éë„É©„É°„Éº„ÇøÈô§Âéª</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="validateUrls" checked>
                                        <span class="checkmark">URLÂΩ¢ÂºèÊ§úË®º</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Áõ¥Êé•ÂÖ•Âäõ -->
                        <div id="direct-upload" class="upload-content" role="tabpanel">
                            <h3 class="section-title">ASINÁõ¥Êé•ÂÖ•Âäõ</h3>
                            
                            <div class="form-group">
                                <label class="form-label">ASIN„É™„Çπ„Éà</label>
                                <textarea class="form-textarea" id="asinDirectList" rows="15" 
                                    placeholder="ASIN„Ç≥„Éº„Éâ„Çí1Ë°å„Å´1„Å§„Åö„Å§ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ&#10;‰æã:&#10;B01234567X&#10;B09876543Z&#10;B05555555A"></textarea>
                                <div class="field-help">
                                    ÊúÄÂ§ß1000ASIN„Åæ„Åß‰∏ÄÊã¨Âá¶ÁêÜÂèØËÉΩ„ÄÇASIN„ÅØ10ÊñáÂ≠ó„ÅÆËã±Êï∞Â≠ó„Åß„Åô„ÄÇ
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="validateAsins" checked>
                                        <span class="checkmark">ASINÂΩ¢ÂºèÊ§úË®º</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-checkbox">
                                        <input type="checkbox" id="removeDuplicates" checked>
                                        <span class="checkmark">ÈáçË§áÈô§Âéª</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- ÂÖ±ÈÄöÂá¶ÁêÜ„Ç™„Éó„Ç∑„Éß„É≥ -->
                        <div class="card mt-6">
                            <div class="card-header">
                                <h4 class="card-title">Âá¶ÁêÜ„Ç™„Éó„Ç∑„Éß„É≥</h4>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="fetchDetails" checked>
                                            <span class="checkmark">ÂïÜÂìÅË©≥Á¥∞Ëá™ÂãïÂèñÂæó</span>
                                        </label>
                                        <div class="field-help">Amazon API„Åã„ÇâÂïÜÂìÅÂêç„Éª‰æ°Ê†º„ÉªÁîªÂÉèÁ≠â„ÇíÂèñÂæó</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="autoCategory">
                                            <span class="checkmark">„Ç´„ÉÜ„Ç¥„É™Ëá™ÂãïÂàÜÈ°û</span>
                                        </label>
                                        <div class="field-help">ÂïÜÂìÅÊÉÖÂ†±„Åã„Çâ„Ç´„ÉÜ„Ç¥„É™„ÇíËá™ÂãïÂàÜÈ°û</div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="duplicateCheck" checked>
                                            <span class="checkmark">ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ</span>
                                        </label>
                                        <div class="field-help">Êó¢Â≠òÂïÜÂìÅ„Å®„ÅÆÈáçË§á„Çí„ÉÅ„Çß„ÉÉ„ÇØ</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-checkbox">
                                            <input type="checkbox" id="createInventory" checked>
                                            <span class="checkmark">Âú®Â∫´„É¨„Ç≥„Éº„ÉâËá™Âãï‰ΩúÊàê</span>
                                        </label>
                                        <div class="field-help">ÂïÜÂìÅÁôªÈå≤„Å®ÂêåÊôÇ„Å´Âú®Â∫´ÁÆ°ÁêÜ„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÂÆüË°å„Éú„Çø„É≥ -->
                        <div class="btn-group mt-6">
                            <button class="btn large primary" onclick="startProcessing()">
                                <i class="fas fa-play"></i>
                                Âá¶ÁêÜÈñãÂßã
                            </button>
                            <button class="btn large secondary" onclick="resetForm()">
                                <i class="fas fa-undo"></i>
                                „É™„Çª„ÉÉ„Éà
                            </button>
                        </div>
                    </div>

                    <!-- Âá¶ÁêÜÈÄ≤ÊçóË°®Á§∫ -->
                    <div class="processing-progress" id="processingProgress">
                        <h3 class="section-title">Âá¶ÁêÜÈÄ≤Êçó</h3>
                        
                        <div class="progress mb-4">
                            <div class="progress-bar" id="overallProgress" style="width: 0%"></div>
                        </div>

                        <div id="progressList">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÈÄ≤Êçó„Ç¢„Ç§„ÉÜ„É† -->
                        </div>
                    </div>

                    <!-- Âá¶ÁêÜÁµêÊûúË°®Á§∫ -->
                    <div class="card" id="resultsCard" style="display: none;">
                        <div class="card-header">
                            <h3 class="card-title">Âá¶ÁêÜÁµêÊûú</h3>
                            <button class="btn secondary small" onclick="exportResults()">
                                <i class="fas fa-download"></i>
                                CSVÂá∫Âäõ
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- Âá¶ÁêÜÁµêÊûú„Çµ„Éû„É™„Éº -->
                            <div class="results-summary">
                                <div class="result-stat">
                                    <div class="result-number success" id="successCount">0</div>
                                    <div class="result-label">ÊàêÂäü</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number error" id="errorCount">0</div>
                                    <div class="result-label">„Ç®„É©„Éº</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number warning" id="duplicateCount">0</div>
                                    <div class="result-label">ÈáçË§á</div>
                                </div>
                                <div class="result-stat">
                                    <div class="result-number info" id="totalCount">0</div>
                                    <div class="result-label">ÂêàË®à</div>
                                </div>
                            </div>

                            <!-- Ë©≥Á¥∞ÁµêÊûú„ÉÜ„Éº„Éñ„É´ -->
                            <div class="table-container mt-6">
                                <table class="table" id="resultsTable">
                                    <thead>
                                        <tr>
                                            <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                            <th>ASIN</th>
                                            <th>ÂïÜÂìÅÂêç</th>
                                            <th>‰æ°Ê†º</th>
                                            <th>„Ç´„ÉÜ„Ç¥„É™</th>
                                            <th>„É°„ÉÉ„Çª„Éº„Ç∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãÁµêÊûúË°å -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- „Éà„Éº„Çπ„ÉàÈÄöÁü•„Ç≥„É≥„ÉÜ„Éä -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="false"></div>

    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner" aria-hidden="true"></div>
            <div class="loading-message">Âá¶ÁêÜ‰∏≠...</div>
        </div>
    </div>

    <!-- JavaScriptË™≠„ÅøËæº„Åø -->
    <script src="{{ url_for('static', filename='js/emverze_unified_js.js') }}"></script>
    
    <!-- ASINÁÆ°ÁêÜÂ∞ÇÁî®JavaScript -->
    <script>
        // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊñπÂºèÂàá„ÇäÊõø„Åà
        function switchUploadMethod(method) {
            // „Çø„Éñ„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            
            document.querySelectorAll('.upload-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„ÉñË®≠ÂÆö
            event.target.classList.add('active');
            event.target.setAttribute('aria-selected', 'true');
            document.getElementById(`${method}-upload`).classList.add('active');
        }

        // CSV„Éï„Ç°„Ç§„É´Âá¶ÁêÜ
        function handleCsvFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csvData = e.target.result;
                previewCsvData(csvData);
            };
            reader.readAsText(file, document.getElementById('csvEncoding').value || 'utf-8');
        }

        // CSV „Éá„Éº„Çø„Éó„É¨„Éì„É•„Éº
        function previewCsvData(csvData) {
            // CSV„Éë„Éº„ÇπÔºàÁ∞°ÊòìÁâàÔºâ
            const lines = csvData.split('\n').filter(line => line.trim());
            const delimiter = document.getElementById('csvDelimiter').value;
            const asinColumn = document.getElementById('asinColumn').value;
            const skipHeader = document.getElementById('csvSkipHeader').checked;
            
            let startIndex = skipHeader ? 1 : 0;
            let asins = [];
            
            for (let i = startIndex; i < Math.min(lines.length, 10); i++) {
                const columns = lines[i].split(delimiter);
                if (columns[0]) {
                    asins.push(columns[0].trim());
                }
            }
            
            showToast('info', '„Éó„É¨„Éì„É•„Éº', `${asins.length}‰ª∂„ÅÆASIN„ÇíÊ§úÂá∫„Åó„Åæ„Åó„Åü`);
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ
        document.getElementById('csvDropZone').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        document.getElementById('csvDropZone').addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        document.getElementById('csvDropZone').addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('csvFileInput').files = files;
                handleCsvFile({target: {files: files}});
            }
        });

        // Âá¶ÁêÜÈñãÂßã
        async function startProcessing() {
            const activeMethod = document.querySelector('.upload-content.active').id;
            let data = {};

            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™ÊñπÂºè„Å´Âøú„Åò„Å¶„Éá„Éº„ÇøÂèéÈõÜ
            switch(activeMethod) {
                case 'csv-upload':
                    data = await collectCsvData();
                    break;
                case 'url-upload':
                    data = collectUrlData();
                    break;
                case 'direct-upload':
                    data = collectDirectData();
                    break;
            }

            if (!data.items || data.items.length === 0) {
                showToast('error', '„Ç®„É©„Éº', 'Âá¶ÁêÜÂØæË±°„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            // Âá¶ÁêÜÈñãÂßã
            showLoading('ASINÂá¶ÁêÜ‰∏≠...');
            document.getElementById('processingProgress').classList.add('active');
            
            try {
                const response = await apiRequest('/kanpeki-asin/process', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (response.success) {
                    showResults(response);
                    showToast('success', 'ÂÆå‰∫Ü', `${response.success_count}‰ª∂„ÅÆÂá¶ÁêÜ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü`);
                } else {
                    throw new Error(response.message || 'Âá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                showToast('error', '„Ç®„É©„Éº', error.message);
            } finally {
                hideLoading();
            }
        }

        // CSV „Éá„Éº„ÇøÂèéÈõÜ
        async function collectCsvData() {
            const fileInput = document.getElementById('csvFileInput');
            if (!fileInput.files[0]) {
                return {items: []};
            }

            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvData = e.target.result;
                    const options = {
                        encoding: document.getElementById('csvEncoding').value,
                        delimiter: document.getElementById('csvDelimiter').value,
                        asin_column: document.getElementById('asinColumn').value,
                        skip_header: document.getElementById('csvSkipHeader').checked
                    };
                    
                    resolve({
                        method: 'csv',
                        data: csvData,
                        options: options,
                        processing_options: getProcessingOptions()
                    });
                };
                reader.readAsText(fileInput.files[0]);
            });
        }

        // URL „Éá„Éº„ÇøÂèéÈõÜ
        function collectUrlData() {
            const urlText = document.getElementById('urlList').value.trim();
            const urls = urlText.split('\n').filter(url => url.trim());
            
            return {
                method: 'url',
                items: urls,
                options: {
                    remove_tracking: document.getElementById('removeTracking').checked,
                    validate_urls: document.getElementById('validateUrls').checked
                },
                processing_options: getProcessingOptions()
            };
        }

        // Áõ¥Êé•ÂÖ•Âäõ„Éá„Éº„ÇøÂèéÈõÜ
        function collectDirectData() {
            const asinText = document.getElementById('asinDirectList').value.trim();
            const asins = asinText.split('\n').filter(asin => asin.trim());
            
            return {
                method: 'direct',
                items: asins,
                options: {
                    validate_asins: document.getElementById('validateAsins').checked,
                    remove_duplicates: document.getElementById('removeDuplicates').checked
                },
                processing_options: getProcessingOptions()
            };
        }

        // ÂÖ±ÈÄöÂá¶ÁêÜ„Ç™„Éó„Ç∑„Éß„É≥ÂèñÂæó
        function getProcessingOptions() {
            return {
                fetch_details: document.getElementById('fetchDetails').checked,
                auto_category: document.getElementById('autoCategory').checked,
                duplicate_check: document.getElementById('duplicateCheck').checked,
                create_inventory: document.getElementById('createInventory').checked
            };
        }

        // ÁµêÊûúË°®Á§∫
        function showResults(response) {
            document.getElementById('resultsCard').style.display = 'block';
            
            // „Çµ„Éû„É™„ÉºÊõ¥Êñ∞
            document.getElementById('successCount').textContent = response.success_count;
            document.getElementById('errorCount').textContent = response.error_count;
            document.getElementById('duplicateCount').textContent = response.duplicate_count;
            document.getElementById('totalCount').textContent = response.processed_count;
            
            // „ÉÜ„Éº„Éñ„É´Êõ¥Êñ∞
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';
            
            response.results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="badge ${getStatusClass(result.status)}">${getStatusText(result.status)}</span></td>
                    <td><code class="asin-code">${result.asin}</code></td>
                    <td>${result.product_name || '-'}</td>
                    <td>${result.price || '-'}</td>
                    <td>${result.category || '-'}</td>
                    <td>${result.error_message || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÇØ„É©„ÇπÂèñÂæó
        function getStatusClass(status) {
            const statusMap = {
                'success': 'success',
                'error': 'danger',
                'duplicate': 'warning',
                'invalid': 'secondary'
            };
            return statusMap[status] || 'secondary';
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„ÉÜ„Ç≠„Çπ„ÉàÂèñÂæó
        function getStatusText(status) {
            const statusMap = {
                'success': 'ÊàêÂäü',
                'error': '„Ç®„É©„Éº',
                'duplicate': 'ÈáçË§á',
                'invalid': 'ÁÑ°Âäπ'
            };
            return statusMap[status] || '‰∏çÊòé';
        }

        // „Éï„Ç©„Éº„É†„É™„Çª„ÉÉ„Éà
        function resetForm() {
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type === 'checkbox') {
                    element.checked = element.hasAttribute('checked');
                } else if (element.type === 'file') {
                    element.value = '';
                } else {
                    element.value = element.defaultValue || '';
                }
            });
            
            document.getElementById('processingProgress').classList.remove('active');
            document.getElementById('resultsCard').style.display = 'none';
            
            showToast('info', '„É™„Çª„ÉÉ„Éà', '„Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
        }

        // ÁµêÊûú„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportResults() {
            showToast('info', '„Ç®„ÇØ„Çπ„Éù„Éº„Éà', 'CSVÂá∫ÂäõÊ©üËÉΩ„ÇíÊ∫ñÂÇô‰∏≠„Åß„Åô');
        }

        // „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ±•Ê≠¥Ë°®Á§∫
        function showUploadHistory() {
            showToast('info', 'Â±•Ê≠¥', '„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÂ±•Ê≠¥Ê©üËÉΩ„ÇíÊ∫ñÂÇô‰∏≠„Åß„Åô');
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ÂÆåÁíßASINÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü');
        });
    </script>
</body>
</html>