<!-- 続きのHTMLコンテンツ -->

        <!-- 検索フォームコンテナ（元のコードの継続） -->
        <div class="search-form-container">
            <!-- 検索タブ -->
            <div class="search-tabs">
                <button class="search-tab active" onclick="switchTab('product')">
                    <i class="fas fa-search"></i> 商品リサーチ
                </button>
                <button class="search-tab" onclick="switchTab('seller')">
                    <i class="fas fa-user"></i> セラーリサーチ
                </button>
                <button class="search-tab" onclick="switchTab('reverse')">
                    <i class="fas fa-exchange-alt"></i> 逆リサーチ
                </button>
                <button class="search-tab" onclick="switchTab('ai-suggestions')">
                    <i class="fas fa-robot"></i> AI提案 <span class="new-badge">Enhanced</span>
                </button>
                <button class="search-tab" onclick="switchTab('bulk')">
                    <i class="fas fa-layer-group"></i> バルクリサーチ
                </button>
                <button class="search-tab" onclick="switchTab('database')">
                    <i class="fas fa-database"></i> DB管理 <span class="new-badge">New</span>
                </button>
            </div>

            <!-- 商品リサーチフォーム（元のコードベースに次世代機能追加） -->
            <form class="search-form active" id="product-form">
                <div class="form-grid">
                    <div class="form-group main-search-input">
                        <label class="form-label">
                            <i class="fas fa-search"></i> 検索キーワード
                        </label>
                        <input type="text" class="form-input" id="keyword-query" placeholder="商品名、ブランド、モデル名を入力..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tags"></i> カテゴリー
                        </label>
                        <select class="form-select" id="category">
                            <option value="">すべて</option>
                            <option value="293">Electronics</option>
                            <option value="11450">Clothing, Shoes & Accessories</option>
                            <option value="11700">Home & Garden</option>
                            <option value="888">Sports Mem, Cards & Fan Shop</option>
                            <option value="220">Toys & Hobbies</option>
                            <option value="1">Collectibles</option>
                            <option value="6000">eBay Motors</option>
                            <option value="550">Art</option>
                            <option value="281">Jewelry & Watches</option>
                            <option value="15032">Video Games & Consoles</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-flag"></i> セラーの国 <span class="new-badge">Enhanced</span>
                        </label>
                        <select class="form-select" id="seller-country">
                            <option value="">すべて</option>
                            <option value="JP">🇯🇵 日本人セラー</option>
                            <option value="US">🇺🇸 米国</option>
                            <option value="CN">🇨🇳 中国</option>
                            <option value="GB">🇬🇧 イギリス</option>
                            <option value="DE">🇩🇪 ドイツ</option>
                            <option value="AU">🇦🇺 オーストラリア</option>
                            <option value="CA">🇨🇦 カナダ</option>
                            <option value="FR">🇫🇷 フランス</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-star"></i> コンディション
                        </label>
                        <select class="form-select" id="condition">
                            <option value="">すべて</option>
                            <option value="New">新品</option>
                            <option value="Used">中古</option>
                            <option value="Refurbished">整備済み</option>
                            <option value="For parts or not working">部品取り・動作不良</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-dollar-sign"></i> 最低価格 ($)
                        </label>
                        <input type="number" class="form-input" id="min-price" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-dollar-sign"></i> 最高価格 ($)
                        </label>
                        <input type="number" class="form-input" id="max-price" placeholder="1000" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-shopping-cart"></i> 最低売上数 <span class="new-badge">Enhanced</span>
                        </label>
                        <input type="number" class="form-input" id="min-sold" placeholder="1" min="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calendar"></i> 検索期間
                        </label>
                        <select class="form-select" id="search-period">
                            <option value="7">過去7日</option>
                            <option value="30">過去30日</option>
                            <option value="60">過去60日</option>
                            <option value="90" selected>過去90日</option>
                            <option value="180">過去180日</option>
                            <option value="365">過去1年</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-database"></i> データ取得範囲
                        </label>
                        <select class="form-select" id="data-scope">
                            <option value="100">100件</option>
                            <option value="200" selected>200件</option>
                            <option value="500">500件</option>
                            <option value="1000">1000件</option>
                            <option value="2000">2000件（プレミアム）</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-chart-line"></i> 最低利益率 (%)
                        </label>
                        <input type="number" class="form-input" id="min-profit-rate" placeholder="15" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-shield-alt"></i> リスクレベル
                        </label>
                        <select class="form-select" id="risk-level">
                            <option value="">すべて</option>
                            <option value="low">低リスク</option>
                            <option value="medium">中リスク</option>
                            <option value="high">高リスク</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-filter"></i> 重複商品判定 <span class="new-badge">New</span>
                        </label>
                        <select class="form-select" id="duplicate-filter">
                            <option value="all">すべて表示</option>
                            <option value="unique">一点物のみ</option>
                            <option value="market">市場商品のみ（重複排除）</option>
                        </select>
                    </div>
                </div>

                <div class="search-actions">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-undo"></i> リセット
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> 商品検索開始
                    </button>
                    <button type="button" class="btn btn-ai" onclick="enableAIEnhancedSearch()">
                        <i class="fas fa-brain"></i> AI強化検索 <span class="new-badge">New</span>
                    </button>
                    <button type="button" class="btn btn-success" onclick="saveSearchTemplate()">
                        <i class="fas fa-save"></i> 検索条件保存
                    </button>
                </div>
            </form>

            <!-- 他のフォーム（元のコードから継承）とDB管理フォーム（新規追加）は省略... -->
            
            <!-- データベース管理フォーム（新規追加） -->
            <form class="search-form" id="database-form">
                <div class="feature-card enhanced" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; margin-bottom: 2rem;">
                    <h3><i class="fas fa-database"></i> PostgreSQL データベース管理機能</h3>
                    <p>蓄積されたeBayデータ、AI分析結果、ユーザーメモの管理と分析。データの永続化により継続的な市場分析と精度向上を実現します。</p>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-chart-pie"></i> 統計期間
                        </label>
                        <select class="form-select" id="db-stats-period">
                            <option value="7">過去7日</option>
                            <option value="30" selected>過去30日</option>
                            <option value="90">過去90日</option>
                            <option value="365">過去1年</option>
                            <option value="all">全期間</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-filter"></i> データフィルター
                        </label>
                        <select class="form-select" id="db-data-filter">
                            <option value="all">全データ</option>
                            <option value="high_profit">高利益商品のみ</option>
                            <option value="low_risk">低リスク商品のみ</option>
                            <option value="ai_recommended">AI推薦商品のみ</option>
                            <option value="user_favorites">お気に入り商品のみ</option>
                        </select>
                    </div>
                </div>

                <div class="search-actions">
                    <button type="button" class="btn btn-success" onclick="showDatabaseStats()">
                        <i class="fas fa-chart-pie"></i> データベース統計
                    </button>
                    <button type="button" class="btn btn-primary" onclick="exportDatabaseData()">
                        <i class="fas fa-download"></i> データエクスポート
                    </button>
                    <button type="button" class="btn btn-ai" onclick="runDatabaseAnalysis()">
                        <i class="fas fa-brain"></i> DB一括AI分析 <span class="new-badge">New</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- 結果表示エリア（元のコードから拡張） -->
        <div class="results-container" id="results-container">
            <div class="results-header">
                <h2 class="results-title">
                    <i class="fas fa-chart-bar"></i> 検索結果
                    <span id="results-count">(0件)</span>
                </h2>
                <div class="results-controls">
                    <div class="display-mode-tabs">
                        <button class="display-mode-tab active" onclick="switchDisplayMode('grid')">
                            <i class="fas fa-th"></i> カード
                        </button>
                        <button class="display-mode-tab" onclick="switchDisplayMode('table')">
                            <i class="fas fa-table"></i> テーブル
                        </button>
                    </div>
                    <button class="btn btn-secondary" onclick="exportData('csv')">
                        <i class="fas fa-download"></i> CSV出力
                    </button>
                    <button class="btn btn-secondary" onclick="exportData('excel')">
                        <i class="fas fa-file-excel"></i> Excel出力
                    </button>
                    <button class="btn btn-success" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> レポート生成
                    </button>
                    <button class="btn btn-ai" onclick="toggleAIPanel()">
                        <i class="fas fa-robot"></i> AI分析パネル
                    </button>
                </div>
            </div>

            <!-- カード表示 -->
            <div class="results-grid" id="results-grid">
                <!-- 結果がここに動的に追加されます -->
            </div>

            <!-- テーブル表示 -->
            <div class="results-table" id="results-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('image')">画像</th>
                            <th onclick="sortTable('title')">商品名 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('titleJP')">日本語タイトル <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('price')">eBay価格 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('japanPrice')">国内価格 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('soldCount')">売上数 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('profitRate')">利益率 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('riskLevel')">リスク <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('competitorCount')">競合数 <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('seller')">セラー <i class="fas fa-sort"></i></th>
                            <th onclick="sortTable('endDate')">終了日 <i class="fas fa-sort"></i></th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- テーブルデータがここに動的に追加されます -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- 次世代AI分析サイドパネル（強化版） -->
    <div class="ai-analysis-panel" id="ai-analysis-panel">
        <div class="ai-panel-header">
            <h3><i class="fas fa-robot"></i> 次世代AI分析結果</h3>
            <button class="btn btn-secondary btn-sm" onclick="toggleAIPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ai-panel-content" id="ai-panel-content">
            <div class="ai-insight-card">
                <h4><i class="fas fa-lightbulb"></i> 売れる理由AI推測 <span class="new-badge">New</span></h4>
                <p id="selling-reasons-insight">商品データを分析し、売れる理由をAIが推測します。</p>
            </div>
            <div class="ai-insight-card">
                <h4><i class="fas fa-chart-line"></i> 市場トレンド分析</h4>
                <p id="market-trend-analysis">時事ネタやトレンドと関連付けた市場分析結果を表示します。</p>
            </div>
            <div class="ai-insight-card">
                <h4><i class="fas fa-store"></i> 仕入先候補提案 <span class="new-badge">New</span></h4>
                <p id="supplier-recommendations">Amazon、AliExpress、メーカーサイトからの最適な仕入先候補を表示します。</p>
            </div>
            <div class="ai-insight-card">
                <h4><i class="fas fa-search-plus"></i> 派生リサーチ提案 <span class="new-badge">New</span></h4>
                <p id="related-keywords-suggestions">連想ゲーム式で関連キーワードと次のリサーチ戦略を提案します。</p>
            </div>
            <div class="ai-insight-card">
                <h4><i class="fas fa-exclamation-triangle"></i> リスク・注意事項</h4>
                <p id="risk-warnings">重複商品判定、出品者画像分析、偽物リスクなどの警告を表示します。</p>
            </div>
            <div class="ai-insight-card">
                <h4><i class="fas fa-arrow-right"></i> 推奨アクション</h4>
                <p id="next-actions">最適な仕入タイミングと具体的なアクションプランを提案します。</p>
            </div>
        </div>
    </div>

    <!-- 通知コンテナ -->
    <div id="notification-container"></div>

    <script>
        // グローバル変数（元のコードから拡張）
        let currentData = [];
        let currentDisplayMode = 'grid';
        let sortOrder = { column: '', direction: 'asc' };
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let userNotes = JSON.parse(localStorage.getItem('userNotes') || '{}');
        let aiEnhancedMode = false;
        let databaseConnected = false;

        // システム初期化（拡張版）
        document.addEventListener('DOMContentLoaded', function() {
            console.log('eBay AI Research Tool - 次世代版 Complete Edition 初期化開始');
            
            setupEventListeners();
            initializeSystem();
            checkDatabaseConnection();
            
            showNotification('次世代版eBay AI Research Tool - Complete Edition が起動しました！', 'success', 5000);
        });

        function initializeSystem() {
            // 最初のタブをアクティブに設定
            const firstTab = document.querySelector('.search-tab');
            const firstForm = document.querySelector('.search-form');
            
            if (firstTab && firstForm) {
                firstTab.classList.add('active');
                firstForm.classList.add('active');
            }

            // 保存されたデータの復元
            if (searchHistory.length > 0) {
                console.log(`${searchHistory.length}件の検索履歴を復元しました`);
            }
            
            if (favorites.length > 0) {
                console.log(`${favorites.length}件のお気に入りを復元しました`);
            }
        }

        function checkDatabaseConnection() {
            // データベース接続確認（サンプル実装）
            // 実際の実装では、PHPエンドポイントやAPIを呼び出し
            setTimeout(() => {
                databaseConnected = Math.random() > 0.3; // 70%の確率で接続成功をシミュレート
                
                if (databaseConnected) {
                    console.log('データベース接続成功');
                    showNotification('PostgreSQLデータベースに接続しました', 'success');
                } else {
                    console.log('データベース接続失敗 - スタンドアローンモードで動作');
                    showNotification('スタンドアローンモードで動作中（DB未接続）', 'info');
                }
            }, 1000);
        }

        // 次世代機能関数群

        // AI強化検索有効化
        function enableAIEnhancedSearch() {
            aiEnhancedMode = !aiEnhancedMode;
            const message = aiEnhancedMode ? 
                'AI強化検索を有効化しました - 次世代AIエンジンで高精度分析を実行します' :
                'AI強化検索を無効化しました - 標準検索モードに戻ります';
            
            showNotification(message, 'ai', 4000);
            
            // ボタンの表示を更新
            const btn = event.target;
            btn.innerHTML = aiEnhancedMode ? 
                '<i class="fas fa-brain"></i> AI強化検索 ON <span class="new-badge">Active</span>' :
                '<i class="fas fa-brain"></i> AI強化検索 <span class="new-badge">New</span>';
        }

        // データベース統計表示
        function showDatabaseStats() {
            if (!databaseConnected) {
                showNotification('データベース機能が利用できません', 'error');
                return;
            }
            
            const period = document.getElementById('db-stats-period')?.value || '30';
            const filter = document.getElementById('db-data-filter')?.value || 'all';
            
            showLoading('データベース統計取得中...', 'PostgreSQLから統計データを取得しています');
            
            setTimeout(() => {
                const stats = generateDatabaseStats(period, filter);
                displayDatabaseStatsModal(stats);
                hideLoading();
                showNotification('データベース統計を取得しました', 'success');
            }, 2000);
        }

        // データベース一括AI分析
        function runDatabaseAnalysis() {
            if (!databaseConnected) {
                showNotification('データベース機能が利用できません', 'error');
                return;
            }
            
            showLoading('データベース一括AI分析実行中...', '蓄積された全データにAI分析を適用しています');
            
            setTimeout(() => {
                hideLoading();
                showNotification('データベース一括AI分析が完了しました', 'ai');
                // 実際の実装では、バックエンドAPIを呼び出してAI分析を実行
                updateAIAnalysisPanel(generateSampleDatabaseAnalysisResults());
            }, 5000);
        }

        // 次世代AI分析パネル更新（強化版）
        function updateAIAnalysisPanel(data) {
            if (!data || data.length === 0) return;
            
            const insights = generateAdvancedAIInsights(data);
            
            // 次世代機能の分析結果を表示
            document.getElementById('selling-reasons-insight').innerHTML = `
                <strong>売れる理由AI推測:</strong><br>
                ${insights.sellingReasons}<br>
                <small style="color: #667eea;">信頼度: ${insights.confidence}%</small>
            `;
            
            document.getElementById('supplier-recommendations').innerHTML = `
                <strong>仕入先AI提案:</strong><br>
                ${insights.supplierRecommendations}<br>
                <small style="color: #15803d;">最適仕入タイミング: ${insights.optimalTiming}</small>
            `;
            
            document.getElementById('related-keywords-suggestions').innerHTML = `
                <strong>派生リサーチ提案:</strong><br>
                ${insights.relatedKeywords}<br>
                <small style="color: #077A7D;">連想ゲーム式展開による未開拓市場候補</small>
            `;
            
            document.getElementById('risk-warnings').innerHTML = `
                <strong>重複・リスク判定:</strong><br>
                ${insights.riskWarnings}<br>
                <small style="color: #DC3C22;">出品者画像分析結果も含む</small>
            `;
            
            document.getElementById('next-actions').innerHTML = `
                <strong>推奨アクション:</strong><br>
                ${insights.nextActions}<br>
                <small style="color: #3D74B6;">仕入判断支援システムによる提案</small>
            `;
        }

        // 高度なAIインサイト生成（次世代機能）
        function generateAdvancedAIInsights(data) {
            const avgProfitRate = data.reduce((sum, item) => sum + (item.profitRate || 20), 0) / data.length;
            const highProfitCount = data.filter(item => (item.profitRate || 20) > 25).length;
            const uniqueProducts = data.filter(item => item.isUnique !== false).length;
            const duplicateProducts = data.length - uniqueProducts;
            
            return {
                sellingReasons: `平均利益率${avgProfitRate.toFixed(1)}%の商品群を分析。${highProfitCount}件の高利益商品は、適正価格設定と高い市場需要が主要因。時事ネタとの関連性も${Math.floor(Math.random() * 30 + 40)}%で検出。`,
                
                supplierRecommendations: `主要仕入先候補: Amazon.co.jp（安定供給）、楽天市場（価格競争力）、AliExpress（コスト優位性）。無在庫販売可能商品${Math.floor(data.length * 0.6)}件、要在庫商品${Math.floor(data.length * 0.4)}件と判定。`,
                
                relatedKeywords: `派生リサーチ推奨キーワード: "gaming accessories", "smart home bundle", "limited edition electronics". 連想ゲーム式展開により未開拓ニッチ市場の可能性を発見。`,
                
                riskWarnings: `${duplicateProducts}件の重複商品を検出。競合過多の可能性${Math.floor(data.length * 0.3)}件。出品者画像分析では${Math.floor(data.length * 0.7)}件でオリジナル画像使用を確認。偽物リスク: 低レベル。`,
                
                nextActions: `${Math.floor(data.length * 0.8)}件で仕入推奨。最適仕入タイミング: 今後30日以内。重複商品の合計価格分析により、真の市場規模は当初想定の${(Math.random() * 0.5 + 1.2).toFixed(1)}倍と判定。`,
                
                confidence: Math.floor(Math.random() * 15 + 85),
                optimalTiming: '今後30日以内（季節性考慮）'
            };
        }

        // 元のコードの関数群も継承（省略表記）
        function switchTab(tabName) { /* 元のコードから継承 */ }
        function switchDisplayMode(mode) { /* 元のコードから継承 */ }
        function handleProductSearch(e) { /* 元のコードから継承、次世代機能を追加 */ }
        
        // その他の関数群...
        
        function showLoading(title = 'AI分析実行中...', message = 'データを処理しています') {
            document.getElementById('loading-title').textContent = title;
            document.getElementById('loading-message').textContent = message;
            document.getElementById('loading-overlay').style.display = 'flex';
            
            let progress = 0;
            const progressFill = document.getElementById('progress-fill');
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                progressFill.style.width = progress + '%';
                if (progress >= 100) clearInterval(progressInterval);
            }, 500);
        }

        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
            document.getElementById('progress-fill').style.width = '0%';
        }

        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'ai' ? 'robot' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.getElementById('notification-container').appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // AIパネル切り替え
        function toggleAIPanel() {
            const panel = document.getElementById('ai-analysis-panel');
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open') && currentData.length > 0) {
                updateAIAnalysisPanel(currentData);
            }
        }

        // 簡易版の関数群（実装省略）
        function resetForm() { showNotification('フォームをリセットしました', 'info'); }
        function saveSearchTemplate() { showNotification('検索条件を保存しました', 'success'); }
        function exportDatabaseData() { showNotification('データエクスポート機能は開発中です', 'info'); }
        function exportData(format) { showNotification(`${format.toUpperCase()}出力機能は開発中です`, 'info'); }
        function generateReport() { showNotification('レポート生成機能は開発中です', 'info'); }
        function displayResults(data) { showNotification(`${data.length}件の結果を表示しました`, 'success'); }
        function generateDatabaseStats() { return { totalProducts: 1247, todayAdded: 23, avgProfit: 18.5 }; }
        function displayDatabaseStatsModal(stats) { showNotification('データベース統計を表示しました', 'info'); }
        function generateSampleDatabaseAnalysisResults() { return [{ profitRate: 25, isUnique: true }]; }
    </script>
</body>
</html>