<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古物買取査定・管理ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .container {
            max-width: 900px;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .text-interact {
            color: #3b82f6; /* Blue-600 */
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">古物買取クイック査定・管理システム</h1>
            <p class="text-gray-600">買取品の査定目安と受付履歴を管理します。古物商許可は必須です。</p>
        </header>

        <!-- 査定入力エリア -->
        <div id="assessment-card" class="card bg-white p-6 mb-8 border border-blue-200">
            <h2 class="text-xl font-semibold mb-4 text-blue-700">買取査定シミュレーション</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <!-- 品目選択 -->
                <div>
                    <label for="item-category" class="block text-sm font-medium text-gray-700 mb-1">品目カテゴリ</label>
                    <select id="item-category" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <option value="game">中古ゲーム機/ソフト</option>
                        <option value="camera">中古カメラ/レンズ</option>
                        <option value="brand">ブランド品/時計</option>
                        <option value="other">その他一般古物</option>
                    </select>
                </div>

                <!-- 状態選択 -->
                <div>
                    <label for="item-condition" class="block text-sm font-medium text-gray-700 mb-1">商品の状態</label>
                    <select id="item-condition" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <option value="new">新品同様（Sランク）</option>
                        <option value="good">非常に良い（Aランク）</option>
                        <option value="average">並品（Bランク）</option>
                        <option value="junk">ジャンク/故障品（Jランク）</option>
                    </select>
                </div>
                
                <!-- 顧客情報 -->
                <div>
                    <label for="customer-name" class="block text-sm font-medium text-gray-700 mb-1">顧客名 / 問い合わせ番号</label>
                    <input type="text" id="customer-name" placeholder="例: 山田様 / #A123" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <!-- 査定結果とボタン -->
            <div class="flex flex-col md:flex-row items-center gap-4 border-t pt-4">
                <button onclick="calculatePrice()" class="flex-grow w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 transform hover:scale-105 shadow-md">
                    査定目安価格を計算
                </button>
                <div id="price-result" class="text-lg font-bold text-gray-900 bg-yellow-100 p-2 rounded-lg w-full md:w-1/2 text-center border border-yellow-300">
                    -- 価格目安 --
                </div>
                <button onclick="logTransaction()" id="log-button" class="flex-grow w-full md:w-auto px-6 py-3 bg-gray-400 text-white font-semibold rounded-lg transition duration-150 cursor-not-allowed" disabled>
                    受付履歴に追加 (未査定)
                </button>
            </div>
        </div>

        <!-- 履歴エリア -->
        <div id="history-card" class="card bg-white p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">買取受付履歴</h2>
            <div id="transaction-list" class="space-y-3">
                <!-- 履歴はここに表示されます -->
                <p id="no-history" class="text-gray-500 italic">まだ受付履歴がありません。</p>
            </div>
        </div>

        <!-- メッセージボックス (Alert代替) -->
        <div id="message-box" class="fixed bottom-4 right-4 bg-red-600 text-white p-3 rounded-lg shadow-xl hidden transition-opacity duration-300" role="alert"></div>

    </div>

    <script type="text/javascript">
        // Firebaseを使用しないため、一時的なlocalStorageでデータを管理します。
        // 実際の運用ではFirestoreなどのデータベースをご利用ください。
        
        // 買取価格の目安データ (カテゴリと状態に基づく価格乗数)
        // 実際の価格は、人気商品/不人気商品、市場価格によって大きく変動します。
        const basePrices = {
            game: { base: 10000, multipliers: { new: 1.2, good: 1.0, average: 0.7, junk: 0.1 } },
            camera: { base: 50000, multipliers: { new: 1.1, good: 0.9, average: 0.6, junk: 0.05 } },
            brand: { base: 30000, multipliers: { new: 1.3, good: 1.0, average: 0.5, junk: 0.0 } },
            other: { base: 5000, multipliers: { new: 1.0, good: 0.8, average: 0.5, junk: 0.0 } }
        };

        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let lastAssessment = null;

        /**
         * 価格を計算し、結果を表示します。
         */
        function calculatePrice() {
            const category = document.getElementById('item-category').value;
            const condition = document.getElementById('item-condition').value;
            const customerName = document.getElementById('customer-name').value.trim();

            if (!customerName) {
                showMessage("顧客名または問い合わせ番号を入力してください。", "bg-red-500");
                return;
            }

            const data = basePrices[category];
            if (!data) {
                showMessage("選択されたカテゴリのデータが見つかりません。", "bg-red-500");
                return;
            }

            const basePrice = data.base;
            const multiplier = data.multipliers[condition];
            
            // 価格計算（単純な計算ですが、実際は市場価格データベースと連動させます）
            const minPrice = Math.floor(basePrice * multiplier * 0.8); // 下限 (20%の幅)
            const maxPrice = Math.floor(basePrice * multiplier * 1.0); // 上限
            
            const minFormatted = minPrice.toLocaleString('ja-JP');
            const maxFormatted = maxPrice.toLocaleString('ja-JP');

            const resultText = `¥${minFormatted} 〜 ¥${maxFormatted}`;
            
            document.getElementById('price-result').textContent = resultText;
            
            // ログ用にデータを一時保存
            lastAssessment = {
                id: Date.now(),
                customer: customerName,
                category: document.querySelector(`#item-category option[value="${category}"]`).textContent,
                condition: document.querySelector(`#item-condition option[value="${condition}"]`).textContent,
                priceRange: resultText,
                date: new Date().toLocaleString('ja-JP')
            };

            // ログボタンを有効化し、スタイルを変更
            const logBtn = document.getElementById('log-button');
            logBtn.disabled = false;
            logBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
            logBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'transform', 'hover:scale-105');
            logBtn.textContent = '査定内容を履歴に追加';

            showMessage("査定目安が計算されました。", "bg-green-600");
        }

        /**
         * 査定結果を履歴に記録します。
         */
        function logTransaction() {
            if (!lastAssessment) {
                showMessage("まず「査定目安価格を計算」ボタンを押してください。", "bg-red-500");
                return;
            }

            transactions.push(lastAssessment);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            renderTransactions();
            
            // ログ後のリセット
            lastAssessment = null;
            document.getElementById('price-result').textContent = '-- 価格目安 --';
            
            const logBtn = document.getElementById('log-button');
            logBtn.disabled = true;
            logBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            logBtn.classList.remove('bg-green-600', 'hover:bg-green-700', 'transform', 'hover:scale-105');
            logBtn.textContent = '受付履歴に追加 (未査定)';
            
            document.getElementById('customer-name').value = ''; // 顧客名をクリア

            showMessage("買取受付履歴に記録しました。", "bg-blue-600");
        }

        /**
         * 履歴リストをレンダリングします。
         */
        function renderTransactions() {
            const listElement = document.getElementById('transaction-list');
            listElement.innerHTML = ''; // リストをクリア

            if (transactions.length === 0) {
                document.getElementById('no-history').classList.remove('hidden');
                return;
            }
            document.getElementById('no-history')?.classList.add('hidden');

            // 最新の10件のみ表示（多い場合は逆順に）
            const displayTransactions = transactions.slice(-10).reverse();

            displayTransactions.forEach(t => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-gray-50 border border-gray-200 rounded-lg flex justify-between items-center';
                item.innerHTML = `
                    <div>
                        <p class="font-semibold text-interact">${t.customer}</p>
                        <p class="text-sm text-gray-700">${t.category} (${t.condition})</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-lg text-red-600">${t.priceRange}</p>
                        <p class="text-xs text-gray-500">${t.date}</p>
                    </div>
                `;
                listElement.appendChild(item);
            });
        }

        /**
         * カスタムメッセージボックスを表示します。
         */
        function showMessage(text, bgColor) {
            const box = document.getElementById('message-box');
            box.textContent = text;
            box.className = `fixed bottom-4 right-4 text-white p-3 rounded-lg shadow-xl transition-opacity duration-300 ${bgColor}`;
            box.style.display = 'block';

            setTimeout(() => {
                box.style.display = 'none';
            }, 3000);
        }

        // 初期ロード時に履歴をレンダリング
        window.onload = renderTransactions;
    </script>
</body>
</html>